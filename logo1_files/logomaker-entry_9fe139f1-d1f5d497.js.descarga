(window.webpackJsonp=window.webpackJsonp||[]).push([[43],{123:function(e,t,r){var o,n=t,a=r(0),i=r(1),l=r(4),s=r(118),c=r(11),u=r(26),d=r(29),m=r(139),f=r(44),g=r(25),p=r(43),C=r(23),F=r(8),v=r(21),y=r(9),h=r(206),S=r(35),T=r(30),D=r(339),k=r(121),I=r(15),b=r(10);n.DragFacade=(o=function(){l.CoreObject.call(this)},a.defineClass({name:"DragFacade",ctor:o,superName:"CoreObject",statics:{processBeginFormaDrag:function(e){var t=e.dragDelegate.dragController,r=a.opt(t,function(e){return e.owner.document.firstPage});a.opt(r,function(e){return e.publish(new m.BeginFormaDragMessage(r))}),a.opt(t,function(t){return t.afterProcessBeginFormaDrag(e)})},processFormaDrag:function(e){var t=e.dragDelegate.dragController;a.opt(t,function(t){return t.beforeProcessFormaDrag(e)});var r=[],n=!(1==e.dragDelegate.modifierKeys.control)&&1==e.dragDelegate.draggedFormae.length;return e.dragDelegate.forEachDraggedForma(function(t,a){r=r.concat(o.processOneFormaDrag(e,t,a,n))}),a.opt(t,function(t){return t.afterProcessFormaDrag(e)}),r},processOneFormaDrag:function(e,t,r,n){var i=[],l=e.drag;if(null==e.dragDelegate.dragController.owner)return i;if(null==t.controller)return i;var c=e.dragDelegate.dragController.owner;if(!t.controller.moveable||c.interactionMode==s.InteractionMode.SelectionFocused&&c.selection.selectedCount>0&&!c.selection.isSelected(t))return i;var u=new f.FormaTransformChangedEvent(t);t.beginUpdate(u),o.doMove(l,t,r),n&&(i=a.clone(o.doSnap(l,t,r))),t.endUpdate(u);var d=c.document.firstPage;return d.publish(new m.FormaDragMessage(d)),i},doMove:function(e,t,r){var o,n=a.opt(t.parent,function(e){return e.totalPlacement.inverse})||y.Matrix2D.Identity,l=e.freeMovement(n),s=l.movement;switch(l.rise,l.run,o=t.parent instanceof d.FrameForma?t.parent.bounds.center:y._asterisk_TheoPoint_Matrix2D(t.bounds.center,r),e.dragMode){case 1:s=e.noScale(n,o);break;case 2:s=e.noRotation(n,o)}i.CoreAssert.isFalse(0==s.determinant),y._asterisk_Matrix2D_Matrix2D(y._asterisk_Matrix2D_Matrix2D(y.Matrix2D.translation(o),s),y.Matrix2D.translation(I._negate_TheoPoint(o))),e.uncommitedMovement=s;var c,u=y._asterisk_Matrix2D_Matrix2D(r,s);(c=t.controller)&&c.place(u)},doSnap:function(e,t,r){var o,n,i=[];n=t.parent instanceof d.FrameForma?t.parent.bounds.center:y._asterisk_TheoPoint_Matrix2D(t.bounds.center,r);var l,s=t.bounds.locatePoint(t.placement.inverse.transformPoint(n)),u=e.dragMode==h.DragMode.NoScaleNoSkew,m=e.activePace();l=!(!(o=a.opt(F.Host.platform,function(e){return e.isWeb}))&&null==o||!o)||m==h.DragPace.MediumPace||e.currentlySnapped,e.dragMode==h.DragMode.UniformScaleNoRotationNoSkew&&(l=!1);var f,p,C=a.clone(t.filterByControllerKind(g.GridController.KIND,c.FormaTraversal.NearestAncestor));if((f=a.as(a.opt(a.first(C),function(e){return e.controller}),g.GridController))&&f.isChildSwappable(t)&&l&&(l=u),p=t.controller){var v=e.currentlySnapped;if(e.currentlySnapped=!1,l){var S,T=p.setSnappedPlacement(u?s:null,8/e.viewportScale,!1);(S=T.snapLines)&&(i=a.clone(S)),null!=T.movement&&(e.currentlySnapped=!0),!v&&e.currentlySnapped&&e.commitDrag()}}return i},processEndFormaDrag:function(e){var t,r=e.dragDelegate.dragController;if(t=a.as(r,u.FrameController))t.processEndFormaDrag(e);else{var n=e.drag.viewportScale,i=26/n,l=0;e.drag.pointers.length>1&&(l=24/n),D.SelectionFacade.enableAdditionalMultiSelectGestures()&&a.opt(r,function(t){return t.owner.selection.replaceSelectionWithFormae(a.clone(e.dragDelegate.draggedFormae))}),e.dragDelegate.forEachDraggedForma(function(e,t){return o.rescueFormaToPageBounds(e,i,l)});var s=a.opt(r,function(e){return e.owner.document.firstPage});a.opt(s,function(e){return e.publish(new m.EndFormaDragMessage(s))}),e.dragDelegate.forEachDraggedForma(function(e,t){var r;if(r=a.opt(e.root,function(e){return e.filterWithCallback(function(e){return e instanceof C.GroupForma&&null!=e.controller})}))for(var o=a.iter(r);!o.done;o.next()){var n,i=o.value;(n=a.as(i.controller,p.GroupController))&&n.canClaimForma(e)&&n.claimForma(e)}else F.Host.logging.error("Error: forma has not root "+e.print())}),a.opt(r,function(t){return t.afterProcessEndFormaDrag(e)})}},rescueFormaToPageBounds:function(e,t,r){var n;if(void 0===t&&(t=50),void 0===r&&(r=50),n=e.root){var a=n.bounds,i=y.Matrix2D.Identity;o.rescueToArbitraryBounds(e,a,i,t,r)}},rescueToArbitraryBounds:function(e,t,r,o,n){var l;if(l=e.parent){var s=e.totalPlacement,c=e.bounds,u=o*Math.sqrt(Math.abs(r.determinant)),d=t.insetXY(u,u),m=c.maximumSpan(s);if(m<n){i.CoreAssert.isTrue(m>0);var f=s.transformPoint(c.center),g=y.Matrix2D.translation(f.multiply(-1)).concat(y.Matrix2D.uniformScaling(n/m).concat(y.Matrix2D.translation(f))),p=(C=l.totalPlacement).concat(g.concat(C.inverse));a.opt(e.controller,function(e){return e.move(p)})}if(!b.TheoRect.PointInCommon(c,y._asterisk_Matrix2D_Matrix2D(s,r.inverse),t)){var C,F=b.TheoRect.JustTouch(c,s,d,r);p=(C=l.totalPlacement).concat(F.concat(C.inverse)),a.opt(e.controller,function(e){return e.move(p)})}}},getSwappableFormae:function(e){var t=a.first(e.dragDelegate.draggedFormae);a.opt(t,function(e){return e.kind==v.ImageForma.KIND})&&(t=a.opt(t,function(e){return e.parent}));var r=e.dragDelegate.dragController,n=a.opt(a.opt(r,function(e){return e.owner}),function(e){return e.document}),i=[];return null==t||null==n?i:(n.firstPage.root.visitAll(c.FormaTraversal.PreOrder,function(e){o.isFormaSwappable(e,n)&&i.push(e)}),i)},getSwapState:function(e,t,r,n,i){var l=o.getSwapTargetForma(e,a.clone(t),r),s=n;(s||null!=l)&&(s=!0,null!=i&&a.opt(a.first(e.dragDelegate.draggedFormae),function(e){return e.placement=i}));var c=e.drag.pointers[0].currentLocation,u=a.opt(a.opt(e.dragDelegate.dragController.owner,function(e){return e.document}),function(e){return e.firstPage.formaAtPoint(c)}),d=null!=u&&u.kind==S.RootForma.KIND;return null==l&&d&&(l=r,s=n),[s,l]},getSwapTargetForma:function(e,t,r){var n=e.drag;if(1!=e.dragDelegate.draggedFormae.length)return null;var i=a.first(e.dragDelegate.draggedFormae);a.opt(i,function(e){return e.kind==v.ImageForma.KIND})&&(i=a.opt(i,function(e){return e.parent}));var l=e.dragDelegate.dragController,s=a.opt(a.opt(l,function(e){return e.owner}),function(e){return e.document});if(1!=n.pointers.length||null==i||null==s)return null;if(!o.isFormaSwappable(i,s))return null;var u=n.pointers[0].currentLocation,d=s.firstPage.pageSize;if(u.x<0||u.x>d.width||u.y<0||u.y>d.height)return null;for(var m=null,f=a.iter(t);!f.done;f.next()){var g=f.value;if(g.finalFrame.containsPoint(u)&&o.inSwappableRegion(i,g,u,s)){m=g;break}}return null==r&&a.eq(c._equality_Forma_Forma,m,i)&&(m=null),m},isFormaSwappable:function(e,t){return!(e.kind==S.RootForma.KIND||e.kind==C.GroupForma.KIND||null!=e.controller&&e.controller.moveable||!e.isGridCell()||null==o.getGridForma(t)||(r=a.as(e,T.ShapeForma))&&null!=k.TheoDocumentUtils.getCellBackgroundImage(r));var r},getGridForma:function(e){var t=a.clone(e.firstPage.root.filterByControllerKind(g.GridController.KIND));return t.length>0?t[0]:null},inSwappableRegion:function(e,t,r,n){var a=o.getGridForma(n),i=0;if(null!=a&&(i=a.controller.spacing),null==e.finalFrame||null==t.finalFrame)return!1;var l=e.finalFrame.minY==t.finalFrame.maxY+i,s=e.finalFrame.maxY==t.finalFrame.minY-i,c=e.finalFrame.minX==t.finalFrame.maxX+i,u=e.finalFrame.maxX==t.finalFrame.minX-i,d=l&&c||l&&u||s&&c||s&&u,m=e.finalFrame.minY>=t.finalFrame.minY&&e.finalFrame.minY<=t.finalFrame.maxY||t.finalFrame.minY>=e.finalFrame.minY&&t.finalFrame.minY<=e.finalFrame.maxY||d,f=e.finalFrame.minX>=t.finalFrame.minX&&e.finalFrame.minX<=t.finalFrame.maxX||t.finalFrame.minX>=e.finalFrame.minX&&t.finalFrame.minX<=e.finalFrame.maxX||d,g=l&&m,p=s&&m,C=c&&f,F=u&&f;if(g||p||C||F){var v=t.finalFrame.minY,y=t.finalFrame.maxY,h=t.finalFrame.minX,S=t.finalFrame.maxX,T=y-v,D=S-h;return g&&(y-=.2*T),p&&(v+=.2*T),C&&(S-=.2*D),F&&(h+=.2*D),r.x>=h&&r.y>=v&&r.x<=S&&r.y<=y}return!0}}}),o)},124:function(e,t,r){var o,n=t,a=r(0),i=r(39),l=r(1),s=r(26),c=r(29),u=r(8),d=r(9),m=r(15);n.TransformFacade=(o=function(){},a.defineClass({name:"TransformFacade",ctor:o,statics:{translateForma:function(e,t){e.move(d.Matrix2D.translation(t))},nudgeFormaeInPageSpace:function(e,t){if(l.CoreAssert.isTrue(e.length>0,"can't nudge 0 formae"),0!=e.length){var r,n=1,s=a.first(e);(r=a.opt(a.opt(s,function(e){return e.page.view}),function(e){return e.getViewportTransform()}))&&(n=Math.sqrt(Math.abs(r.determinant)));var c=t.divide(n);c=c.multiply(2),o.translateFormaeInPageSpace(a.clone(e),c),e.length>1?a.opt(u.Host.logging,function(t){return t.logToAnalytics(i.AnalyticsConstants.kAnalyticsDataMultipleNudged,{contextualData1:"formae count: "+e.length})}):s.isImage()?a.opt(u.Host.logging,function(e){return e.logToAnalytics(i.AnalyticsConstants.kAnalyticsDataImageNudged,{})}):s.isShape()?a.opt(u.Host.logging,function(e){return e.logToAnalytics(i.AnalyticsConstants.kAnalyticsDataShapeNudged,{})}):s.isText()&&a.opt(u.Host.logging,function(e){return e.logToAnalytics(i.AnalyticsConstants.kAnalyticsDataTextNudged,{})})}},translateFormaeInPageSpace:function(e,t){o.transformFormaeInPageSpaceAboutPoint(a.clone(e),d.Matrix2D.translation(t),m.TheoPoint.ZERO)},transformFormaeInPageSpaceAboutPoint:function(e,t,r){for(var o=d._asterisk_Matrix2D_Matrix2D(d._asterisk_Matrix2D_Matrix2D(d.Matrix2D.translation(m._negate_TheoPoint(r)),t),d.Matrix2D.translation(r)),n=a.iter(e);!n.done;n.next()){var i,l,u=n.value,f=u;if(null==u.controller||u.controller.floating||(i=a.as(u,c.FrameForma))&&(f=i.childAt(0)),l=f.parent){var g,p=d._asterisk_Matrix2D_Matrix2D(d._asterisk_Matrix2D_Matrix2D(l.totalPlacement,o),l.totalPlacement.inverse);f.move(p),(g=a.as(u.controller,s.FrameController))&&(g.updateParentGroup(),g.fitChildrenToFrame())}}},transformInPageSpaceAboutFormaUV:function(e,t,r){o.transformFormaeInPageSpaceAboutPoint([e],t,d._asterisk_TheoPoint_Matrix2D(e.bounds.evalXY(r.x,r.y),e.totalPlacement))},transformAboutFormaCenter:function(e,t){var r;if(r=e.parent){var n=new m.TheoPoint(.5,.5);if(r.controller instanceof s.FrameController){var a=r.bounds.transform(e.parent.totalPlacement).center,i=e.totalPlacement.inverse.transformPoint(a);n=e.bounds.locatePoint(i)}o.transformInPageSpaceAboutFormaUV(e,t,n)}},scaleForma:function(e,t){var r=d.Matrix2D.scalingXY(t,t);o.transformAboutFormaCenter(e,r)},flipForma:function(e,t){var r=t?d.Matrix2D.scalingXY(1,-1):d.Matrix2D.scalingXY(-1,1);o.transformAboutFormaCenter(e,r)},rotateForma:function(e,t){var r=d.Matrix2D.rotation(Math.cos(t),Math.sin(t));o.transformAboutFormaCenter(e,r)}}}),o)},134:function(e,t,r){var o,n=t,a=r(0),i=r(39),l=r(428),s=r(1),c=r(70),u=r(4),d=r(27),m=r(19),f=r(86),g=r(43),p=r(8),C=r(203),F=r(150),v=r(21),y=r(17),h=r(133),S=r(114),T=r(244),D=r(14);n.AUTHORING_CONTEXT_TYPE_LOGO="LOGO",n.AUTHORING_CONTEXT_TYPE_FONT="FONT",n.AUTHORING_CONTEXT_TYPE_COLOR="COLOR",n.SPARK_LOGO_ROLE_PRIMARY="primary-logo",n.SPARK_LOGO_ROLE_SECONDARY="secondary-logo",n.SPARK_LOGO_ROLE_POST_STAMP="post-stamp",n.IAuthoringContext=a.defineProtocol("IAuthoringContext",{id:"String",name:"String",colors:"Array<IAuthoringContextColor>",fonts:"Array<IAuthoringContextFont>",logos:"Array<IAuthoringContextLogo>"}),n.IAuthoringContextColor=a.defineProtocol("IAuthoringContextColor",{id:"String",acRoles:"Array<String>",red:"Double",green:"Double",blue:"Double",alpha:"Double"}),n.IAuthoringContextFont=a.defineProtocol("IAuthoringContextFont",{id:"String",acRoles:"Array<String>",descriptor:"FontDescriptor"}),n.IAuthoringContextLogo=a.defineProtocol("IAuthoringContextLogo",{id:"String",acRoles:"Array<String>",acName:"String",url:"String",pixelWidth:"Integer",pixelHeight:"Integer",mimeType:"String"}),n.BrandingFacade=(o=function(){u.CoreObject.call(this)},a.defineClass({name:"BrandingFacade",ctor:o,superName:"CoreObject",statics:{brandifyDocument:function(e,t,r,n,a){return void 0===r&&(r=!0),void 0===n&&(n=!0),void 0===a&&(a=!0),s.CoreAssert.isTrue(""!=t.id),o.addBrandLogo(e,t,n).then(function(n){return a&&o.brandifyColors(e,t),r&&o.brandifyFonts(e,t),null})},addBrandLogo:function(e,t,r){void 0===r&&(r=!0);var i=d.CorePromise.resolve(null);if(r){var l,s=t.logos.filter(function(e){return!a.isEmpty(e.url)&&e.acRoles.includes(n.SPARK_LOGO_ROLE_POST_STAMP)},this);if((l=a.first(s))&&null==a.first(e.firstPage.root.filterWithCallback(function(e){return e.isLogo()&&e.kind==v.ImageForma.KIND}))){var u=o.makeLogoContentNode(l,e);i=i.then(function(t){return c.CreationFacade.addContent(e.firstPage,u,void 0,void 0,new c.AddFormaParams(void 0,void 0,null))})}}return i},brandifyColors:function(e,t,r){void 0===r&&(r=!1),o.updateBrandedColorPalette(e,t,r)},updateBrandedColorPalette:function(e,t,r){for(var o=0,n=0,i=a.clone(e.firstPage.colorLibraryController.getTheoColorsUsedInDocument()),l=a.iter(i);!l.done;l.next()){var c=l.value;c.isBrandkitSecondaryColor()&&(n+=1),c.isBrandkitShade()&&(o+=1)}for(var u=n>0&&n>=o,d=[],f=a.iter(t.colors);!f.done;f.next()){var g=f.value,p=S.TheoColor.init_bb45(g);(u&&(p.isBrandkitSecondaryColor()||p.isBrandkitPrimaryColor())||!u&&p.isBrandkitShade())&&d.push(p)}if(d.length>0){var C;if(r)if(null!=(y=e.firstPage.root.controller.getGridController())){s.CoreAssert.isTrue(1==y.gridCells.length,"expecting to have a grid with a single cell");var F=y.forma.childAt(0).style.colors.colorID(m.ColorRole.FieldPrimary);null!=F&&(C=e.firstPage.colorLibraryController.getTheoColorForKey(F))}else{var v=e.firstPage.root.style.colors.colorID(m.ColorRole.FieldPrimary);null!=v&&(C=e.firstPage.colorLibraryController.getTheoColorForKey(v))}if(e.firstPage.colorLibraryController.applyColorTheme(a.clone(d),"brandkit"),r){if(null!=C){var y,h=e.firstPage.colorLibraryController.getKeyOfColorInTheme(C);null==h&&(h=e.firstPage.colorLibraryController.addNewThemeKeyWithColor(C)),null!=(y=e.firstPage.root.controller.getGridController())?y.forma.childAt(0).style.colors.setColorId(m.ColorRole.FieldPrimary,h):e.firstPage.root.style.colors.setColorId(m.ColorRole.FieldPrimary,h)}}else e.firstPage.colorLibraryController.shuffleColorAssignments()}else a.info("addBranding asked to update color palette, but brandkit doesn't have any colors. Hope that's ok.")},brandifyFonts:function(e,t){var r=o.getTheoFontForRole(T.TheoFont.SPARK_FONT_ROLE_HEADLINE,t);if(null==r)if(t.fonts.length>0){var n,i=t.fonts[0];(n=o.getFontFromIncludedFonts(i.descriptor))?r=T.TheoFont.init_9e5c(n,i.id,a.clone(i.acRoles)):(a.info("addBranding asked to apply fonts, but brandkit doesn't have a headline font, so we're just picking some random font. Hope that's ok."),r=T.TheoFont.init_9e5c(p.Host.fontProvider.getIncludedFonts(e).fontAt(0)))}else a.info("addBranding asked to apply fonts, but brandkit doesn't have any fonts. Hope that's ok.");if(null!=r){for(var l=!1,s=a.iter(e.firstPage.root.filterWithCallback(function(e){return e.isTypeLockup()}));!s.done;s.next()){var c,u=s.value;(c=a.as(u.style,y.LockupStyle))&&(c.font=r,l=!0)}0==l&&a.info("addBranding asked to apply fonts, but document contains no text lockups, so we can't. Hope that's ok.")}},getTheoFontForRole:function(e,t){for(var r,n=a.iter(t.fonts);!n.done;n.next()){var i,l=n.value;if(i=o.getFontFromIncludedFonts(l.descriptor)){var s=T.TheoFont.init_9e5c(i,l.id,a.clone(l.acRoles));if(s.getSparkFontRole()==e){r=s;break}}}return r},getFontFromIncludedFonts:function(e){if(null==e)return null;var t,r=p.Host.fontProvider.getIncludedFonts(C.ANY_DOCUMENT);return null!=(t=r.indexOf(e))?r.fontAt(t):null},changeBranding:function(e,t,r){o.changeDocumentAuthoringContextAndRemapElements(e,t,r)},changeDocumentAuthoringContextAndRemapElements:function(e,t,r){null==t?""==e.authoringContextID?a.opt(r,function(e){return e(null)}):e.controller.doActionWithCompletion(new l.RemoveBrandingAction,function(e){var t;null!=(t=r)&&t(e)}):e.authoringContextID==t.id?a.opt(r,function(e){return e(null)}):e.controller.doActionWithCompletion(new l.AddBrandingAction(t),function(e){var t;null!=(t=r)&&t(e)})},addBranding:function(e,t){return s.CoreAssert.isTrue(""!=t.id),o.applyLogoForAddBranding(e,t).then(function(r){return o.applyColorsForAddBranding(e,t),o.applyBrandFontsForAddBranding(e,t),e.authoringContextID=t.id,null})},applyLogoForAddBranding:function(e,t){for(var r=[],n=a.iter(e.firstPage.root.filterWithCallback(function(e){return e.isLogo()&&e.kind==v.ImageForma.KIND}));!n.done;n.next()){var i=n.value;r.push(i)}for(var l=d.CorePromise.resolve(null),s=a.iter(r);!s.done;s.next()){var u=s.value,m=a.as(e.content.nodeByID(u.contentID),F.ImageContentNode),f=o.getReplacementLogoContentNode(e,t,m.getSparkLogoRole());null!=f&&(l=l.then(function(t){return c.CreationFacade.addContent(e.firstPage,f,void 0,void 0,new c.AddFormaParams(void 0,void 0,u.parent))}))}return l},applyColorsForAddBranding:function(e,t){for(var r=[],o=a.iter(t.colors);!o.done;o.next()){var n=o.value;r.push(S.TheoColor.init_bb45(n))}r.length>0&&e.firstPage.colorLibraryController.updateSparkColorsByRole(a.clone(r))},applyBrandFontsForAddBranding:function(e,t){for(var r,o=[],n=a.iter(t.fonts);!n.done;n.next()){var i=n.value,l=T.TheoFont.init_557b(i);o.push(l),l.getSparkFontRole()==T.TheoFont.SPARK_FONT_ROLE_BODY&&(r=l)}for(var s=a.iter(e.firstPage.root.filterWithCallback(function(e){return e.isTypeLockup()}));!s.done;s.next()){var c,u=s.value;if(c=a.as(u.style,y.LockupStyle)){var d;if((d=c.font)&&d.isSparkFont()){for(var m,f=r,g=a.iter(o);!g.done;g.next())if(i=g.value,d.getSparkFontRole()==i.getSparkFontRole()){f=i;break}(m=f)&&(c.font=m)}for(var p=a.iter(c.characterStyles);!p.done;p.next()){var C,F=p.value;if((C=F.font)&&C.isSparkFont()){f=r;for(var v=a.iter(o);!v.done;v.next())if(i=v.value,C.getSparkFontRole()==i.getSparkFontRole()){f=i;break}null!=f&&(F.font=f)}}}}},getReplacementLogoContentNode:function(e,t,r){for(var i,l=a.iter(t.logos);!l.done;l.next())for(var s=l.value,c=a.iter(s.acRoles);!c.done;c.next()){var u=c.value;if(u==r)return o.makeLogoContentNode(s,e);u==n.SPARK_LOGO_ROLE_PRIMARY&&(i=s)}return null!=i?o.makeLogoContentNode(i,e):null},removeBranding:function(e){return o.removeAllBrandkitFontsAndLogos(e),e.authoringContextID="",d.CorePromise.resolve(null)},removeAllBrandkitFontsAndLogos:function(e){var t;if(t=e.controller)for(var r=a.iter(e.firstPage.root.filterWithCallback(function(e){return e.isTypeLockup()||e.isLogo()}));!r.done;r.next()){var n=r.value;if(n.isTypeLockup()){var i,l;if((i=a.as(n.style,y.LockupStyle))&&(l=i.font)&&l.isSparkFont()){var c=o.getNonBKFontForRemapping(l);a.info("Replacing brandkit font "+l.fontData.postScriptName+" with non-BK font "+c.postScriptName),i.font=T.TheoFont.init_9e5c(c)}}else{var u;t.selection.deselectForma(n),(u=n.parent)&&a.opt(a.as(u.controller,g.GroupController),function(e){return e.removeFormaFromGroup(n)});var d=n.controller.settings;null!=d&&d==t.controllerSettingsState.settings&&(t.controllerSettingsState.settings=null)}}else s.CoreAssert.fail("Document has no controller")},getNonBKFontForRemapping:function(e){return e.fontData.source==f.FontSource.EMBEDDED?e.fontData:e.fontData.serif?e.fontData.blackness>=7?o.getFontWithPostscriptName("CantataOne-Regular"):e.fontData.italic?o.getFontWithPostscriptName("OldStandardTT-Italic"):o.getFontWithPostscriptName("Lora-Regular"):e.fontData.calligraphic?o.getFontWithPostscriptName("Yellowtail"):e.fontData.blackness>=7?o.getFontWithPostscriptName("SourceSansPro-Black"):e.fontData.italic?o.getFontWithPostscriptName("CallunaSans-Italic"):o.getFontWithPostscriptName("Raleway")},getFontWithPostscriptName:function(e){return p.Host.fontProvider.descriptorForPostScriptName(e,C.ANY_DOCUMENT)},brandDocumentForElement:function(e,t,r){var o=p.Host.brandkitManager.brandkitForElement(t,r);s.CoreAssert.isTrue(null!=o,"Adding a branded "+r+", but can't find the brandkit it belongs to"),a.opt(p.Host.logging,function(e){return e.logToAnalytics(i.AnalyticsConstants.kAnalyticsDataBrandkitElementUsed,{elementType:r})}),null!=o&&(""==e.authoringContextID?(a.info("** Branding document, because it now contains a branded element of type "+r),a.opt(p.Host.logging,function(t){return t.logToAnalytics(i.AnalyticsConstants.kAnalyticsEventAddedBrandingToProject,{projectID:e.uuid})})):e.authoringContextID!=o.id&&a.info("** Re-Branding document, because it was branded (for a different brand) and now contains a branded element of type "+r),e.authoringContextID=o.id)},unBrandDocumentIfNoBrandedElements:function(e){""!=e.authoringContextID&&(o.doesDocumentContainBrandedElements(e,!1)||(e.authoringContextID="",a.info("** Unbranding document, because it no longer contains any branded elements")))},isDocumentBranded:function(e,t){return""!=e.authoringContextID&&(!t||o.getDocumentBrandedElementsUsage(e,!0).length>0)},kBrandUsageColor:"color",kBrandUsageFont:"font",kBrandUsageCustomFont:"customFont",kBrandUsageLogo:"logo",getDocumentBrandedElementsUsage:function(e,t,r){void 0===r&&(r=!0);var n=!1,i=!1,l=!1,s=!1,c=[];if(!t&&e.firstPage.colorLibraryController.areAnySparkColorsInUse()&&(c.push(o.kBrandUsageColor),n=!0,1==r))return c;for(var u=a.iter(e.firstPage.root.filterWithCallback(function(e){return e.isLogo()||e.isTypeLockup()}));!u.done;u.next()){var d=u.value;if(d.isTypeLockup())!i&&o.doesLockupUseBrandedFonts(d)&&(c.push(o.kBrandUsageFont),i=!0),!l&&o.doesLockupUseCustomFonts(d)&&(c.push(o.kBrandUsageCustomFont),l=!0);else if(!s&&d.isLogo()&&null!=d.contentID){var m;(m=a.as(e.content.nodeByID(d.contentID),F.ImageContentNode))&&null!=m.sparkElementID&&""!=m.sparkElementID&&(c.push(o.kBrandUsageLogo),s=!0)}if(r&&(n||i||l||s))return c;if(n&&i&&l&&s)break}return c},doesDocumentContainBrandedElements:function(e,t){return o.getDocumentBrandedElementsUsage(e,t).length>0},areSparkFontsInUse:function(e,t){if(0==t.length)return!1;for(var r=a.iter(e.firstPage.root.filterWithCallback(function(e){return e.isTypeLockup()}));!r.done;r.next()){var o,n=r.value;if(o=a.as(n.style,y.LockupStyle)){var i;if((i=o.font)&&null!=i.sparkElementID&&i.sparkElementID.length>0&&t.includes(i.sparkElementID))return!0;for(var l=a.iter(o.characterStyles);!l.done;l.next()){var s;if((s=l.value.font)&&null!=s.sparkElementID&&s.sparkElementID.length>0&&t.includes(s.sparkElementID))return!0}}}return!1},updateSparkFont:function(e,t){for(var r=!1,o=a.iter(e.firstPage.root.filterWithCallback(function(e){return e.isTypeLockup()}));!o.done;o.next()){var n,i=o.value;if(n=a.as(i.style,y.LockupStyle)){var l;if(l=n.font){var c=l.sparkElementID;null!=c&&c.length>0&&c==t.id&&(r=!0,n.font=T.TheoFont.init_557b(t))}for(var u=a.iter(n.characterStyles);!u.done;u.next()){var d=u.value;null!=d.font&&null!=d.font.sparkElementID&&d.font.sparkElementID.length>0&&d.font.sparkElementID==t.id&&(r=!0,d.font=T.TheoFont.init_557b(t))}}}s.CoreAssert.isTrue(r,"asked to update spark font which isn't currently used.")},relinkSparkFont:function(e,t,r){for(var o=!1,n=a.iter(e.firstPage.root.filterWithCallback(function(e){return e.isTypeLockup()}));!n.done;n.next()){var i,l=n.value;if(i=a.as(l.style,y.LockupStyle)){var c;if(c=i.font){var u=c.sparkElementID;null!=u&&u.length>0&&u==t&&(o=!0,i.font=T.TheoFont.init_557b(r))}for(var d=a.iter(i.characterStyles);!d.done;d.next()){var m=d.value;null!=m.font&&null!=m.font.sparkElementID&&m.font.sparkElementID.length>0&&m.font.sparkElementID==t&&(o=!0,m.font=T.TheoFont.init_557b(r))}}}s.CoreAssert.isTrue(o,"asked to relink spark font which isn't currently used.")},doesLockupUseBrandedFonts:function(e){var t;if(t=a.as(e.style,y.LockupStyle)){var r;if((r=t.font)&&null!=r.sparkElementID&&r.sparkElementID.length>0)return!0;for(var o=a.iter(t.characterStyles);!o.done;o.next()){var n=o.value;if(null!=n.font&&null!=n.font.sparkElementID&&n.font.sparkElementID.length>0)return!0}}else s.CoreAssert.isTrue(!1,"doesLockupUseBrandedFonts called for something which is not a type lockup");return!1},doesLockupUseCustomFonts:function(e){var t;if(t=a.as(e.style,y.LockupStyle)){var r;if((r=t.font)&&r.fontData.source==f.FontSource.USER_UPLOAD)return!0;for(var o=a.iter(t.characterStyles);!o.done;o.next()){var n=o.value;if(null!=n.font&&n.font.fontData.source==f.FontSource.USER_UPLOAD)return!0}}else s.CoreAssert.isTrue(!1,"doesLockupUseCustomFonts called for something which is not a type lockup");return!1},areSparkLogosInUse:function(e,t){if(0==t.length)return!1;for(var r=a.iter(e.firstPage.root.filterWithCallback(function(e){return e.isLogo()&&e.kind==v.ImageForma.KIND}));!r.done;r.next()){var o,n=r.value;if((o=a.as(e.content.nodeByID(n.contentID),F.ImageContentNode))&&null!=o.sparkElementID&&""!=o.sparkElementID&&t.includes(o.sparkElementID))return!0}return!1},updateSparkLogo:function(e,t){for(var r=!1,n=a.iter(e.firstPage.root.filterWithCallback(function(e){return e.isLogo()&&e.kind==v.ImageForma.KIND}));!n.done;n.next()){var i=n.value,l=a.as(e.content.nodeByID(i.contentID),F.ImageContentNode);if(a.opt(l,function(e){return null!=e.sparkElementID&&a.opt(l,function(e){return""!=e.sparkElementID})&&t.id==a.opt(l,function(e){return e.sparkElementID})})){r=!0;var u=o.makeLogoContentNode(t,e);c.CreationFacade.addContent(e.firstPage,u,void 0,void 0,new c.AddFormaParams(void 0,void 0,i.parent))}}s.CoreAssert.isTrue(r,"asked to update spark logo which isn't currently used.")},relinkSparkLogo:function(e,t,r){for(var n=!1,i=a.iter(e.firstPage.root.filterWithCallback(function(e){return e.isLogo()&&e.kind==v.ImageForma.KIND}));!i.done;i.next()){var l=i.value,u=a.as(e.content.nodeByID(l.contentID),F.ImageContentNode);if(a.opt(u,function(e){return null!=e.sparkElementID&&a.opt(u,function(e){return""!=e.sparkElementID})&&t==a.opt(u,function(e){return e.sparkElementID})})){n=!0;var d=o.makeLogoContentNode(r,e);c.CreationFacade.addContent(e.firstPage,d,void 0,void 0,new c.AddFormaParams(void 0,void 0,l.parent))}}s.CoreAssert.isTrue(n,"asked to relink spark logo which isn't currently used.")},isImageBrandedLogo:function(e){var t;return!(null==e.contentID||!(t=a.as(e.page.document.content.nodeByID(e.contentID),F.ImageContentNode))||!e.isLogo()||null==t.sparkElementID||""==t.sparkElementID)},makeLogoContentNode:function(e,t){var r=t.content.createNode(F.ImageContentNode.KIND);return r.url=e.url,r.pixelWidth=e.pixelWidth,r.pixelHeight=e.pixelHeight,r.mimeType=e.mimeType,r.sparkRoles=a.clone(e.acRoles),r.sparkElementID=e.id,r.mediaMetadata=new h.MediaMetadata,r.mediaMetadata.designIntent=h.MediaMetadata.DESIGNINTENT_LOGO,r.mediaMetadata.sourceName="brandkit",r},areSparkColorsInUse:function(e,t){return 0!=t.length&&e.firstPage.colorLibraryController.areSparkColorsInUse(a.clone(t))},updateSparkColor:function(e,t){return e.firstPage.colorLibraryController.updateSparkColor(S.TheoColor.init_bb45(t))},getBrandkitColorsForUI:function(e,t){var r,o,n=!1,i=[];if((r=a.as(a.opt(t,function(e){return e.controller}),D.TypeLockupController))&&r.styleController.isCurrentlyShowingMultipleColors()){n=!0;var l=r.lockupStyle.colors.theoColor(m.ColorRole.FieldPrimary),s=r.lockupStyle.colors.theoColor(m.ColorRole.FieldSecondary);null!=l&&l.isBrandkitColor()&&null!=s&&s.isBrandkitColor()&&(i=[l,s])}for(var c=[],u=a.iter(e.colors);!u.done;u.next()){var d=u.value,f=S.TheoColor.init_bb45(d);if(0==n)c.push([f]),f.isBrandkitPrimaryColor()&&(o=f,f.isBrandkitShade()&&c.push([S.TheoColor.init_bb45(d)]));else{var g=0,p="";if(f.isBrandkitPrimaryColor())o=f,g=5;else if(f.isBrandkitSecondaryColor())g=3;else if(f.isBrandkitShade()){g=1;var C=f.getBrandkitShadeRole();if(C.startsWith(S.SHADE_ROLE_PREFIX)){var F=C.substr(S.SHADE_ROLE_PREFIX.length),v=(a.toInt(F)+3)%7;p=S.SHADE_ROLE_PREFIX+a.toString(v)}}else g=1;for(var y=0,h=a.clone(a.shuffle(e.colors)),T=a.iter(h);!T.done;T.next()){var k=T.value,I=S.TheoColor.init_bb45(k);if((""==p&&Math.abs(f.rgbColor.lightness-I.rgbColor.lightness)>30||p==I.getBrandkitShadeRole())&&(c.push([f,I]),(y+=1)>=g))break}}}if(n&&i.length>0){for(var b=!1,x=a.iter(c);!x.done;x.next()){var P=x.value;if(P[0].sparkElementID==i[0].sparkElementID&&P[1].sparkElementID==i[1].sparkElementID){b=!0;break}}b||c.push(a.clone(i))}return a.sortInPlace(c,function(e,t){var r=e[0],n=t[0];if(null!=o){if(r===o)return n!==o;if(n===o)return!1}if(r.isBrandkitSecondaryColor())return!n.isBrandkitSecondaryColor()||r.rgbColor.lightness<n.rgbColor.lightness;if(n.isBrandkitSecondaryColor())return!1;var a=r.getBrandkitShadeRole(),i=n.getBrandkitShadeRole();return null!=a?null==i||a<i:null==i&&r.rgbColor.lightness<n.rgbColor.lightness}),c},getTheoColorForSolidColor:function(e,t){if(null!=e)for(var r=a.iter(e.colors);!r.done;r.next()){var o=r.value,n=S.TheoColor.init_bb45(o);if(n.rgbColor.isEqual(t))return n}return S.TheoColor.init_5344(t,null,null)}}}),o)},202:function(e,t,r){var o,n=t,a=r(0),i=r(34),l=r(437),s=r(70),c=r(27),u=r(163),d=r(14);n.BadgeFacade=(o=function(){},a.defineClass({name:"BadgeFacade",ctor:o,statics:{addBadge:function(e,t,r){var n=a.clone(o.getFormaeToCopy(e));return 0==n.length?c.CorePromise.reject("Badge is empty"):s.CreationFacade.copyItems(a.clone(n),r).then(function(e){var r=a.clone(e);return o.recordSources(t,a.clone(n),a.clone(r)),new l.BadgeLayoutController(a.clone(r)).update(),r.forEach(o.onBadgeFormaPlaced),new i.FormaActionResult(a.clone(r))})},getDesignIngredientIDAndType:function(e){return{id:u.FormaSourceUtils.stripNamespace(e),type:"lockup"}},getFormaeToCopy:function(e){return e.firstPage.root.filterByControllerKind(d.TypeLockupController.KIND)},onBadgeFormaPlaced:function(e){var t;(t=a.as(e.controller,d.TypeLockupController))&&(t.updateScoring(),t.styleController.doesLockupContrastWithBackground()||t.shuffleColorAssignment())},recordSources:function(e,t,r){for(var n=r.length>1,i=a.iter(a.toSequence(r));!i.done;i.next()){var l=i.value,s=l.offset;l.element.source=o.makeSourceDescriptor(e,n?t[s].formaID:null)}},makeSourceDescriptor:function(e,t){var r;return null!=(r=t)?u.FormaSourceNamespace.DesignIngredient+e+":"+r:u.FormaSourceNamespace.DesignIngredient+e}}}),o)},254:function(e,t,r){var o,n=t,a=r(0),i=r(196),l=r(11),s=r(471),c=r(344),u=r(345),d=r(346),m=r(475),f=r(348);n.EXPOSE_MOTION_STYLE=!1,n.MotionFacade=(o=function(){},a.defineClass({name:"MotionFacade",ctor:o,statics:{ANIM_STYLE_NAME_STACKED:"Stacked",ANIM_STYLE_NAME_COMPOSITE:"Composite",getCurrentAnimationStyle:function(){return o._animStyle},applyEntryToForma:function(e,t){var r=f.MotionSource.getSourceAnimation(t.srcId,e);t.logic.apply(e,r,a.clone(t.args))},canApplyStyle:function(e){return e.name==o.ANIM_STYLE_NAME_STACKED||e.name==o.ANIM_STYLE_NAME_COMPOSITE||e.name==i.AnimationStyle.NAME_DYNAMIC&&3==e.variant},createAllAnimationStyles:function(){return n.EXPOSE_MOTION_STYLE?[i.AnimationStyle.init_e14f(o.ANIM_STYLE_NAME_STACKED,0,1,i.AnimationStyleCategory.Text),i.AnimationStyle.init_e14f(o.ANIM_STYLE_NAME_COMPOSITE,0,1,i.AnimationStyleCategory.Text)]:[]},applyStyle:function(e,t){if(o.canApplyStyle(t))if(o._animStyle=t,t.name==i.AnimationStyle.NAME_DYNAMIC)o.applyEntryToForma(e,new m.MotionEntryStackedRoot);else{var r,n=[],f=new u.MotionEntryNone;e.visitAll(l.FormaTraversal.PreOrder,function(e){o.applyEntryToForma(e,f),e.isTypeLockup()&&n.push(e)}),(r=a.first(n))&&(t.name==o.ANIM_STYLE_NAME_COMPOSITE?(o.applyEntryToForma(r,new s.MotionEntryDropIn),o.applyEntryToForma(r,new c.MotionEntryFadeIn)):t.name==o.ANIM_STYLE_NAME_STACKED&&o.applyEntryToForma(r,new d.MotionEntryStacked))}}}}),o)},315:function(e,t,r){var o,n,a=t,i=r(0),l=r(1),s=r(4),c=r(19),u=r(26),d=r(29),m=r(91),f=r(35),g=r(30),p=r(121);a.SavedColorState=(o=function(e,t,r,o){this.formae=i.clone(e),this.colorLibraryState=t,this.primaryColorIDs=i.clone(r),this.secondaryColorIDs=i.clone(o)},i.defineClass({name:"SavedColorState",ctor:o,superName:"CoreObject"}),o),a.ColorFacade=(n=function(){s.CoreObject.call(this)},i.defineClass({name:"ColorFacade",ctor:n,superName:"CoreObject",statics:{applyColorsToForma:function(e,t,r){var o;if(void 0===r&&(r=c.ColorRole.FieldPrimary),e instanceof d.FrameForma){if(o=p.TheoDocumentUtils.getCellBackgroundShape(e))i.opt(o.controller,function(e){return e.applyColors(i.clone(t),r)});else if(null!=i.as(e.controller,u.FrameController))return m.ImageFacade.replaceImageWithColors(e,i.clone(t))}else e instanceof g.ShapeForma?i.opt(e.controller,function(e){return e.applyColors(i.clone(t),r)}):(f.RootForma,i.opt(e.controller,function(e){return e.applyColors(i.clone(t),r)}));return e},applyColorsToFormae:function(e,t,r){return void 0===r&&(r=c.ColorRole.FieldPrimary),e.map(function(e){return n.applyColorsToForma(e,i.clone(t),r)},this)},getSavedColorState:function(e){var t,r;l.CoreAssert.isTrue(e.length>0,"empty Forma array");var o=e[0].page.colorLibraryController.recordUndoState(),n=e.map(function(e){return(t=e.style.colors.colorID(c.ColorRole.FieldPrimary))||null!=t?t:""},this),s=e.map(function(e){return(r=e.style.colors.colorID(c.ColorRole.FieldSecondary))||null!=r?r:""},this);return new a.SavedColorState(i.clone(e),o,i.clone(n),i.clone(s))}}}),n)},338:function(e,t,r){var o,n=t,a=r(0),i=r(29),l=r(14);n.OpacityFacade=(o=function(){},a.defineClass({name:"OpacityFacade",ctor:o,statics:{applyOpacity:function(e,t){for(var r=a.iter(t);!r.done;r.next()){var o,n=r.value;(o=a.as(n,i.FrameForma))&&o.childCount>0&&(n=o.childAt(0)),a.opt(n.controller,function(t){return t.applyOpacity(e)})}},getOpacityForForma:function(e){var t;if(t=a.as(e.controller,l.TypeLockupController))return t.styleController.getOpacityValue();var r,o=e;return(r=a.as(o,i.FrameForma))&&r.childCount>0&&(o=r.childAt(0)),o.style.opacity}}}),o)},339:function(e,t,r){var o,n=t,a=r(0),i=r(4);n.MultiSelectUIMode=a.defineEnum("MultiSelectUIMode",{ModeWithAutoDismissAfterOneTap:0,ModeRequiresExplicitDismiss:1}),n.SelectionFacade=(o=function(){i.CoreObject.call(this)},a.defineClass({name:"SelectionFacade",ctor:o,superName:"CoreObject",statics:{isMultiSelect:function(e){var t;return!(!((t=e)&&t.selectedCount>1)||t.inCharStyleMode)},isCharStyleSelection:function(e){var t,r,o;return!!((t=e)&&t.selectedCount>1&&(r=t.formaAt(0))&&(o=t.formaAt(1)))&&(r.isTypeLockup()&&o.isText())},getMultiSelectUIMode:function(){return n.MultiSelectUIMode.ModeRequiresExplicitDismiss},enableAdditionalMultiSelectGestures:function(){return!1}}}),o)},347:function(e,t,r){var o,n=t,a=r(0),i=r(1),l=r(4),s=r(474),c=r(17),u=r(14),d=r(72),m=r(165);n.SpacingSequence=a.defineEnum("SpacingSequence",{NextLineSpacing:0,NextShapePadding:1,NextShadowAngle:2,NextLetterTracking:3,NextLineSpacingAndPadding:4}),n.describeSpacingSequence=function(e){switch(e){case 0:return"NextLineSpacing";case 1:return"NextShapePadding";case 2:return"NextShadowAngle";case 3:return"NextLetterTracking";case 4:return"NextLineSpacingAndPadding"}},n.TextFacade=(o=function(){l.CoreObject.call(this)},a.defineClass({name:"TextFacade",ctor:o,superName:"CoreObject",statics:{getLayoutForForma:function(e){var t;return(t=a.as(e.controller,u.TypeLockupController))?t.styleController.targetedLockupStyle.layout:c.LockupLayout.UNSET},getAlignmentForForma:function(e){var t;return(t=a.as(e.controller,u.TypeLockupController))?t.styleController.targetedLockupStyle.alignment:c.LockupAlignment.UNSET},getTextPathIDForForma:function(e){var t;return(t=a.as(e.controller,u.TypeLockupController))?t.styleController.targetedLockupStyle.pathID:m.TextPathID.UNSET},setLayoutAndAlignment:function(e,t,r,o,n,i){void 0===o&&(o=!1),void 0===n&&(n=m.TextPathID.UNSET),void 0===i&&(i=null);for(var l=a.iter(r);!l.done;l.next()){var s,d=l.value;if(s=a.as(d.controller,u.TypeLockupController)){var f=s.styleController.targetedLockupStyle.layout;s.beginBlockedUpdate(),e!=c.LockupLayout.SKIP&&(s.styleController.targetedLockupStyle.layout=e),t!=c.LockupAlignment.SKIP&&(s.styleController.targetedLockupStyle.alignment=t),s.styleController.targetedLockupStyle.pathID=n,s.styleController.targetedLockupStyle.customPath=i,s.endBlockedUpdate(),o||s.styleChanged(),o&&(s.styleController.targetedLockupStyle.spacing=a.toDouble(c.LockupLayout.UNSET),s.styleChanged(),s.selectCharStyleForma()),s.styleController.onLayoutChanged(f)}}},getLineSpacingForForma:function(e){var t;return(t=a.as(e.controller,u.TypeLockupController))?t.styleController.targetedLockupStyle.spacing:0},setLineSpacing:function(e,t,r){void 0===r&&(r=!1);for(var o=a.iter(t);!o.done;o.next()){var n,i=o.value;(n=a.as(i.controller,u.TypeLockupController))&&(n.styleController.targetedLockupStyle.spacing=e,r&&n.styleChanged(),n.styleController.onSpacingChanged())}},setLeading:function(e,t,r){for(var o=a.iter(r);!o.done;o.next()){var n,i=o.value;(n=a.as(i.controller,u.TypeLockupController))&&(n.setLineSpacingAndBounds(e,t),n.styleController.onSpacingChanged())}},getTrackingForForma:function(e){var t;return(t=a.as(e.controller,u.TypeLockupController))?t.styleController.targetedLockupStyle.tracking:0},setTracking:function(e,t,r){for(var o=a.iter(r);!o.done;o.next()){var n,i=o.value;(n=a.as(i.controller,u.TypeLockupController))&&(n.setLetterSpacingAndBounds(e,t),n.styleController.onTrackingChanged())}},getPaddingForForma:function(e){var t;return(t=a.as(e.controller,u.TypeLockupController))?t.styleController.targetedLockupStyle.padding:0},setPadding:function(e,t){for(var r=a.iter(t);!r.done;r.next()){var o,n=r.value;(o=a.as(n.controller,u.TypeLockupController))&&o.styleController.setPaddingFromSlider(e)}},matchNextSize:function(e,t,r){for(var o=0,n=a.iter(r);!n.done;n.next()){var i,l=n.value;(i=a.as(l.controller,u.TypeLockupController))&&(o=i.matchNextSize(a.clone(e),t))}return o},matchNearestSize:function(e,t,r,o){for(var n=0,i=a.iter(o);!i.done;i.next()){var l,s=i.value;(l=a.as(s.controller,u.TypeLockupController))&&(n=l.setSizeSliderValue(e,a.clone(t),r))}return n},getLineBreakForForma:function(e){var t;return!!(t=a.as(e.controller,u.TypeLockupController))&&t.styleController.targetedLockupStyle.lineBreakAtCharacterStyleSizeChange},setLineBreak:function(e,t,r){void 0===r&&(r=!1);for(var o=a.iter(t);!o.done;o.next()){var n,i=o.value;(n=a.as(i.controller,u.TypeLockupController))&&(n.styleController.targetedLockupStyle.lineBreakAtCharacterStyleSizeChange=e,r&&(n.styleChanged(),n.selectCharStyleForma()))}},setNextSpacingSequence:function(e,t){for(var r=a.iter(t);!r.done;r.next()){var o,n=r.value;if(o=a.as(n.controller,u.TypeLockupController))switch(e){case 0:o.styleController.setNextSpacingOption();break;case 1:o.styleController.setNextPaddingOption();break;case 2:o.styleController.setNextShadowAngle();break;case 3:o.styleController.setNextTrackingOption();break;case 4:o.styleController.setNextSpacingAndPaddingOption();break;default:i.CoreAssert.isTrue(!1)}}},getTextLook:function(e){var t;return(t=a.as(e.controller,u.TypeLockupController))?t.styleController.targetedLockupStyle.textLook:c.LockupTextLook.Fill},getOutlineStrokeWeightPercent:function(e){var t;return(t=a.as(e.controller,u.TypeLockupController))?t.styleController.getStrokeWeightPercentForUI():0},getShadowOffsetPercent:function(e){var t;return(t=a.as(e.controller,u.TypeLockupController))?t.styleController.getShadowOffsetPercentForUI():0},setTextEffects:function(e,t,r,o,n){for(var i=a.iter(n);!i.done;i.next()){var l,s=i.value;if((l=a.as(s.controller,u.TypeLockupController))&&(e!=c.LockupTextLook.SKIP&&(l.styleController.targetedLockupStyle.textLook=e,l.styleChanged()),isNaN(t)||(l.styleController.targetedStrokeWeight=t),isNaN(r)||(l.styleController.targetedShadowOffset=r,l.styleChanged()),!isNaN(o))){var d=o<0?360+o:o;l.styleController.targetedShadowAngle=d}}},replaceTextForLockup:function(e,t){var r,o;if((r=a.as(e.controller,u.TypeLockupController))&&(i.CoreAssert.isTrue(null!=r.contentNode),o=r.contentNode)){var n=t,l=r.text,m=0==n.trim().length;if(n!=l||m){if(m)a.opt(a.opt(e.page.document,function(e){return e.controller}),function(t){return t.doAction(new s.DeleteAction([e]))});else{var f,g=null;(c.LockupStyle.layoutSupportsAlignments(r.lockupStyle.layout)||1==r.numLines()&&r.lockupStyle.layout!=c.LockupLayout.Path)&&(g=r.getPin(!0,!0)),n=d.TypeLockupUtils.fixUpQuotes(n,l),o.removeText(),o.insert(n,0),(f=g)&&r.matchPreviousPin(f),r.snapSizeToBounds()}null!=e.parent&&(a.opt(a.opt(e.page.document,function(e){return e.controller}),function(t){return t.selection.deselectForma(e,!0)}),a.opt(a.opt(e.page.document,function(e){return e.controller}),function(t){return t.selection.replaceSelection(e)}))}}}}}),o)},356:function(e,t,r){var o,n=t,a=r(0),i=r(4);n.LayerFacade=(o=function(){i.CoreObject.call(this)},a.defineClass({name:"LayerFacade",ctor:o,superName:"CoreObject",statics:{sortInZOrder:function(e){var t=a.clone(e);return a.sortInPlace(t,function(e,t){return o.getZOrder(e)<o.getZOrder(t)}),t},getZOrder:function(e){var t;return(t=e.controller)?t.getZOrder():0},setZOrder:function(e,t){a.opt(t.controller,function(t){return t.setZOrder(e)})},getMinLayerIndex:function(e){var t;return(t=e.controller)?t.getMinLayerIndex():0},getReorderableLayerCount:function(e){var t;return(t=e.controller)?t.getReorderableLayerCount():0}}}),o)},505:function(e,t,r){var o,n=t,a=r(0),i=r(27),l=r(8);n.FontFacade=(o=function(){},a.defineClass({name:"FontFacade",ctor:o,statics:{ensureFontLoaded:function(e){switch(e.availability){case 1:var t;return(t=l.Host.fontProvider)?new i.CorePromise(function(r,o){return t.loadFont(e,function(){return r(e)},function(){return o("could not load font")})}):i.CorePromise.reject("Host.fontProvider not available; can't load font.");case 2:return i.CorePromise.resolve(e);case 3:return i.CorePromise.reject("font cannot be loaded");case 0:return i.CorePromise.reject("font unknown loadable")}}}}),o)},507:function(e,t,r){var o,n,a=t,i=r(0),l=r(39),s=r(49),c=r(1),u=r(4),d=r(123),m=r(11),f=r(8),g=r(9),p=r(37);a.DistributeType=i.defineEnum("DistributeType",{HorizontalSpace:0,LeftEdge:1,CenterX:2,RightEdge:3,VerticalSpace:4,TopEdge:5,CenterY:6,BottomEdge:7,Row:8,Column:9}),a.describeDistributeType=function(e){switch(e){case 0:return"HorizontalSpace";case 1:return"LeftEdge";case 2:return"CenterX";case 3:return"RightEdge";case 4:return"VerticalSpace";case 5:return"TopEdge";case 6:return"CenterY";case 7:return"BottomEdge";case 8:return"Row";case 9:return"Column"}},a.FormaGeometryInfo=(o=function(){this.minEdge=99999999.9,this.maxEdge=-99999999.9,this.totalObjectSpan=0,this.interiorFormaeSortedByPosition=[]},i.defineClass({name:"FormaGeometryInfo",ctor:o,props:{getNumFormae:function(){return i.eq(m._equality_Forma_Forma,this.firstForma,this.lastForma)?this.interiorFormaeSortedByPosition.length+1:this.interiorFormaeSortedByPosition.length+2}}}),o),a.AlignmentFacade=(n=function(){u.CoreObject.call(this)},i.defineClass({name:"AlignmentFacade",ctor:n,superName:"CoreObject",statics:{arrangeFormae:function(e,t){i.opt(f.Host.logging,function(r){return r.logToAnalytics(l.AnalyticsConstants.kAnalyticsFormaeArranged,{contextualData1:"horizontal: "+e,contextualData2:"formae count: "+t.length})}),n.distributeOrArrangeFormae(e?a.DistributeType.Row:a.DistributeType.Column,i.clone(t)),n.rescueFormae(i.clone(t))},distributeFormae:function(e,t){i.opt(f.Host.logging,function(r){return r.logToAnalytics(l.AnalyticsConstants.kAnalyticsFormaeDistributed,{contextualData1:"type: "+a.describeDistributeType(e),contextualData2:"formae count: "+t.length})}),c.CoreAssert.isTrue(t.length>2,"not enough formae to distribute"),c.CoreAssert.isTrue(e!=a.DistributeType.Row&&e!=a.DistributeType.Column,"Use arrangeFormae to do row/column layout"),n.distributeOrArrangeFormae(e,i.clone(t)),n.rescueFormae(i.clone(t))},alignFormae:function(e,t){i.opt(f.Host.logging,function(r){return r.logToAnalytics(l.AnalyticsConstants.kAnalyticsFormaeAligned,{contextualData1:"type: "+s.describeAlignmentType(e),contextualData2:"formae count: "+t.length})}),e==s.AlignmentType.CenterX||e==s.AlignmentType.CenterY?n.alignCenters(e,i.clone(t)):n.alignEdges(e,i.clone(t)),n.rescueFormae(i.clone(t))},rescueFormae:function(e){for(var t=i.iter(e);!t.done;t.next()){var r=t.value;d.DragFacade.rescueFormaToPageBounds(r)}},calculateFormaGeometryInfo:function(e,t){c.CoreAssert.isTrue(t.length>=2,"Not enough forma to distribute");for(var r=new a.FormaGeometryInfo,o=i.iter(t);!o.done;o.next()){var l=o.value.controller.getUserPerceivedFrame();if(null!=l)switch(e){case 0:case 1:case 2:case 3:case 8:r.minEdge=p.MathUtils.minDouble(r.minEdge,l.minX),r.maxEdge=p.MathUtils.maxDouble(r.maxEdge,l.maxX),r.totalObjectSpan+=l.maxX-l.minX;break;case 4:case 5:case 6:case 7:case 9:r.minEdge=p.MathUtils.minDouble(r.minEdge,l.minY),r.maxEdge=p.MathUtils.maxDouble(r.maxEdge,l.maxY),r.totalObjectSpan+=l.maxY-l.minY}}var s=i.sort(t,function(t,r){var o=t.controller.getUserPerceivedFrame(),n=r.controller.getUserPerceivedFrame();if(null!=o&&null!=n)switch(e){case 0:case 1:case 2:case 3:case 8:return o.minX<n.minX;case 4:case 5:case 6:case 7:case 9:return o.minY<n.minY}return!1});r.firstForma=i.first(s),r.lastForma=i.last(s);for(var u=i.iter(s);!u.done;u.next()){var d=u.value,f=d.controller.getUserPerceivedFrame(),g=r.firstForma.controller.getUserPerceivedFrame(),C=r.lastForma.controller.getUserPerceivedFrame();switch(e){case 0:case 1:case 2:case 3:case 8:n.isVeryClose(g.minX,f.minX)&&f.width>g.width&&(r.firstForma=d),(f.maxX>C.maxX||n.isVeryClose(f.maxX,C.maxX)&&f.width>C.width)&&(r.lastForma=d);break;case 4:case 5:case 6:case 7:case 9:n.isVeryClose(g.minY,f.minY)&&f.height>g.height&&(r.firstForma=d),(f.maxY>C.maxY||n.isVeryClose(f.maxY,C.maxY)&&f.height>C.height)&&(r.lastForma=d)}}return i.remove(s,r.firstForma),i.eq(m._equality_Forma_Forma,r.firstForma,r.lastForma)||i.remove(s,r.lastForma),r.interiorFormaeSortedByPosition=i.clone(s),r},distributeOrArrangeFormae:function(e,t){var r=n.calculateFormaGeometryInfo(e,i.clone(t));c.CoreAssert.isTrue(null!=r.firstForma,"expected to have a firstForma computed"),c.CoreAssert.isTrue(null!=r.lastForma,"expected to have a lastForma computed"),c.CoreAssert.isTrue(r.getNumFormae()==t.length,"expected sorted formae to match formae list"),e==a.DistributeType.Row||e==a.DistributeType.Column||e==a.DistributeType.VerticalSpace||e==a.DistributeType.HorizontalSpace?n.distributeSpaceOrMakeRowColumn(r,e):n.distributeEdges(r,e)},distributeEdges:function(e,t){c.CoreAssert.isTrue(e.getNumFormae()>=3,"expected at least 3 items to distribute"),c.CoreAssert.isTrue(t==a.DistributeType.LeftEdge||t==a.DistributeType.CenterX||t==a.DistributeType.RightEdge||t==a.DistributeType.TopEdge||t==a.DistributeType.CenterY||t==a.DistributeType.BottomEdge,"unexpected distribute type");var r=0,o=0,n=e.firstForma.controller.getUserPerceivedFrame(),l=e.lastForma.controller.getUserPerceivedFrame();switch(c.CoreAssert.isTrue(null!=n&&null!=l,"expecting formae to have frames"),t){case 1:r=n.minX,o=l.minX;break;case 5:r=n.minY,o=l.minY;break;case 3:r=n.maxX,o=l.maxX;break;case 7:r=n.maxY,o=l.maxY;break;case 2:r=(n.maxX+n.minX)/2,o=(l.maxX+l.minX)/2;break;case 6:r=(n.maxY+n.minY)/2,o=(l.maxY+l.minY)/2;break;default:c.CoreAssert.isTrue(!1,"unexpected distribute type")}for(var s=(o-r)/i.toDouble(e.getNumFormae()-1),u=r+s,d=i.iter(e.interiorFormaeSortedByPosition);!d.done;d.next()){var m=d.value,f=m.controller.getUserPerceivedFrame();if(null!=f){var p=0,C=0;switch(t){case 1:p=u-f.minX,u=f.minX+p+s;break;case 3:p=u-f.maxX,u=f.maxX+p+s;break;case 5:C=u-f.minY,u=f.minY+C+s;break;case 7:C=u-f.maxY,u=f.maxY+C+s;break;case 2:var F=(f.maxX+f.minX)/2;u=F+(p=u-F)+s;break;case 6:var v=(f.maxY+f.minY)/2;u=v+(C=u-v)+s;break;default:c.CoreAssert.isTrue(!1,"unexpected distribute type")}if(0!=p||0!=C){var y=new g.Matrix2D(1,0,0,1,p,C);i.opt(m.controller,function(e){return e.move(y)})}}}},isVeryClose:function(e,t){return p.MathUtils.absDouble(e-t)<1e-4},getRequiredShiftAmount:function(e,t,r){var o=0;if(r==a.DistributeType.Row||r==a.DistributeType.Column){var n,l,s=e.totalObjectSpan+t*i.toDouble(e.getNumFormae()-1),c=e.firstForma.controller.getUserPerceivedFrame();r==a.DistributeType.Row?(n=c.minX+s,l=e.firstForma.page.pageSize.width):(n=c.minY+s,l=e.firstForma.page.pageSize.height),n>l&&(o=s>l?r==a.DistributeType.Row?-1*c.minX:-1*c.minY:l-n)}return o},getFormaSpacingForRowCol:function(e,t){var r=e.totalObjectSpan/(10*i.toDouble(e.getNumFormae())),o=e.totalObjectSpan/(5*i.toDouble(e.getNumFormae())),a=e.totalObjectSpan/(2*i.toDouble(e.getNumFormae()));return t<0?0:n.isVeryClose(t,r)?o:n.isVeryClose(t,o)?a:n.isVeryClose(t,a)?0:r},distributeSpaceOrMakeRowColumn:function(e,t){var r,o;c.CoreAssert.isTrue(t==a.DistributeType.Row||t==a.DistributeType.Column||t==a.DistributeType.VerticalSpace||t==a.DistributeType.HorizontalSpace,"wrong distribute type");var l,s=(e.maxEdge-e.minEdge-e.totalObjectSpan)/i.toDouble(e.getNumFormae()-1),u=e.interiorFormaeSortedByPosition.concat();t!=a.DistributeType.Row&&t!=a.DistributeType.Column||(u.push(e.lastForma),s=n.getFormaSpacingForRowCol(e,s)),l=t==a.DistributeType.Row||t==a.DistributeType.HorizontalSpace?((r=i.opt(e.firstForma.controller.getUserPerceivedFrame(),function(e){return e.maxX}))||null!=r?r:0)+s:((o=i.opt(e.firstForma.controller.getUserPerceivedFrame(),function(e){return e.maxY}))||null!=o?o:0)+s;var d=n.getRequiredShiftAmount(e,s,t);0!=d&&u.splice(0,0,e.firstForma);for(var f=i.iter(u);!f.done;f.next()){var p=f.value,C=p.controller.getUserPerceivedFrame();if(null!=C){var F=0,v=0;if(i.eq(m._equality_Forma_Forma,p,e.firstForma)&&!i.eq(m._equality_Forma_Forma,p,e.lastForma)?(c.CoreAssert.isTrue(0!=d,"shouldn't be moving first element"),t==a.DistributeType.Row?(F=d,l=C.maxX+F+s):(c.CoreAssert.isTrue(t==a.DistributeType.Column,"Shouldn't have a shift unless we're doing Row or Column layout"),v=d,l=C.maxY+v+s)):t==a.DistributeType.Row||t==a.DistributeType.HorizontalSpace?(F=l-C.minX,l=C.maxX+F+s):(v=l-C.minY,l=C.maxY+v+s),0!=F||0!=v){var y=new g.Matrix2D(1,0,0,1,F,v);i.opt(p.controller,function(e){return e.move(y)})}}}},alignCenters:function(e,t){c.CoreAssert.isTrue(e==s.AlignmentType.CenterX||e==s.AlignmentType.CenterY);for(var r=99999999.9,o=-99999999.9,n=i.iter(t);!n.done;n.next())null!=(d=(u=n.value).controller.getUserPerceivedFrame())&&(e==s.AlignmentType.CenterX?(r=p.MathUtils.minDouble(r,d.minX),o=p.MathUtils.maxDouble(o,d.maxX)):(r=p.MathUtils.minDouble(r,d.minY),o=p.MathUtils.maxDouble(o,d.maxY)));for(var a=(r+o)/2,l=i.iter(t);!l.done;l.next()){var u,d;if(null!=(d=(u=l.value).controller.getUserPerceivedFrame())){var m=0,f=0;if(e==s.AlignmentType.CenterX?m=a-(d.minX+d.maxX)/2:f=a-(d.minY+d.maxY)/2,0!=m||0!=f){var C=new g.Matrix2D(1,0,0,1,m,f);i.opt(u.controller,function(e){return e.move(C)})}}}},alignEdges:function(e,t){var r=99999999.9;e!=s.AlignmentType.Right&&e!=s.AlignmentType.Bottom||(r*=-1);for(var o=i.iter(t);!o.done;o.next())null!=(l=(a=o.value).controller.getUserPerceivedFrame())&&(e==s.AlignmentType.Left?r=p.MathUtils.minDouble(r,l.minX):e==s.AlignmentType.Right?r=p.MathUtils.maxDouble(r,l.maxX):e==s.AlignmentType.Top?r=p.MathUtils.minDouble(r,l.minY):e==s.AlignmentType.Bottom?r=p.MathUtils.maxDouble(r,l.maxY):c.CoreAssert.isTrue(!1,"align to type "+e+" not yet implemented"));for(var n=i.iter(t);!n.done;n.next()){var a,l;if(null!=(l=(a=n.value).controller.getUserPerceivedFrame())){var u=0,d=0;if(e==s.AlignmentType.Left?u=r-l.minX:e==s.AlignmentType.Right?u=r-l.maxX:e==s.AlignmentType.Top?d=r-l.minY:e==s.AlignmentType.Bottom&&(d=r-l.maxY),0!=u||0!=d){var m=new g.Matrix2D(1,0,0,1,u,d);i.opt(a.controller,function(e){return e.move(m)})}}}}}}),n)},508:function(e,t,r){var o,n=t,a=r(0),i=r(4);n.ColorThemeFacade=(o=function(){i.CoreObject.call(this)},a.defineClass({name:"ColorThemeFacade",ctor:o,superName:"CoreObject",statics:{applyColorTheme:function(e,t,r){r.colorLibraryController.applyColorTheme(a.clone(e),t,!0)},shuffleColorTheme:function(e){e.colorLibraryController.shuffleColorAssignments()},modifyColorTheme:function(e,t,r){r.colorLibraryController.setTheoColorToLibrary(e,t)}}}),o)},509:function(e,t,r){var o,n=t,a=r(0),i=r(1),l=r(19),s=r(25),c=r(92);n.GridFacade=(o=function(){},a.defineClass({name:"GridFacade",ctor:o,statics:{getPageGrid:function(e,t){var r=a.clone(e.root.filterByControllerKind(s.GridController.KIND));return r.length>0?a.as(r[0].controller,s.GridController):t?a.opt(a.as(e.root.controller,c.RootController),function(e){return e.createGridControllerIfNone()}):null},createPaddedCollage:function(e){var t;return(t=o.getPageGrid(e,!0))?(t.setMarginAndSpacing(10,10),t.forma.root.style.colors.setColorId(l.ColorRole.FieldPrimary,"white"),t.forma):(i.CoreAssert.fail("couldn't get a grid controller"),null)},setPageGridParameters:function(e,t,r){var n;(n=o.getPageGrid(e,!0))?null!=t&&null!=r?n.setMarginAndSpacing(t,r):null!=t?n.spacing=t:null!=r&&(n.margin=r):i.CoreAssert.fail("couldn't get a grid controller")}}}),o)},510:function(e,t,r){var o,n=t,a=r(0),i=r(4),l=r(255),s=r(8),c=r(37),u=r(10);n.PageFacade=(o=function(){i.CoreObject.call(this)},a.defineClass({name:"PageFacade",ctor:o,superName:"CoreObject",statics:{kMinPageDimension:50,kMaxPageDimension:6e3,getMinPageDimensionForUnits:function(e,t){var r=o.getNumDecimalPlacesForUnits(e),n=o.unitsToPixelsFactor(e,t),i=o.kMinPageDimension/n;if(0!=r){var l=1/Math.pow(10,a.toDouble(r)),s=.5/Math.pow(10,a.toDouble(r));i=c.MathUtils.nearestMultiple(i+s,l)}return i},getMaxPageDimensionForUnits:function(e,t){var r=o.getNumDecimalPlacesForUnits(e),n=o.unitsToPixelsFactor(e,t),i=o.kMaxPageDimension/n;if(0!=r){var l=1/Math.pow(10,a.toDouble(r)),s=.5/Math.pow(10,a.toDouble(r));i=c.MathUtils.nearestMultiple(i-s,l)}return i},pageDimensionIsInRange:function(e,t,r){return!o.pageDimensionIsTooSmall(e,t,r)&&!o.pageDimensionIsTooLarge(e,t,r)},pageDimensionIsTooSmall:function(e,t,r){var n=o.convertStringToPixelsValue(e,t,r),a=o.getMinPageDimensionForUnits(t,r);return n<o.unitsToPixelsFactor(t,r)*a},pageDimensionIsTooLarge:function(e,t,r){var n=o.convertStringToPixelsValue(e,t,r),a=o.getMaxPageDimensionForUnits(t,r);return n>o.unitsToPixelsFactor(t,r)*a},setPageDesignSize:function(e,t){e.setPageSizeFromDesignSize(t)},getNumDecimalPlacesForUnits:function(e){var t=0;return e==l.PageExportFormat.INCHES?t=2:e==l.PageExportFormat.MILLIMETERS&&(t=1),t},unitsToPixelsFactor:function(e,t){return e==l.PageExportFormat.MILLIMETERS?l.FormaPageExportData.MM_TO_INCHES*t:e==l.PageExportFormat.INCHES?t:1},convertStringToPixelsValue:function(e,t,r){var n;return((n=a.opt(s.Host.locale,function(t){return t.convertStringToNumber(e)}))||null!=n?n:a.toDouble(e))*o.unitsToPixelsFactor(t,r)},convertPixelsToUnitsString:function(e,t,r){var n,i=e/o.unitsToPixelsFactor(t,r),l=o.getNumDecimalPlacesForUnits(t);if(null!=s.Host.locale)return n=s.Host.locale.formatNumber(i,l);if((n=a.toString("%."+l+"f",i)).includes("."))for(;n.endsWith("0");)n=n.substr(0,n.length-1);return n.endsWith(".")&&(n=n.substr(0,n.length-1)),n},aspectRatioIsVeryTallOrWide:function(e){var t=u.TheoRect.fromSize(e);return t.aspectRatio>=5||t.aspectRatio<=.2}}}),o)},663:function(e,t,r){var o,n=t,a=r(0);n.HandleFacade=(o=function(){},a.defineClass({name:"HandleFacade",ctor:o}),o)},664:function(e,t,r){var o,n=t,a=r(0);n.PGMFacade=(o=function(){},a.defineClass({name:"PGMFacade",ctor:o}),o)},70:function(e,t,r){var o,n,a,i=t,l=r(0),s=r(34),c=r(39),u=r(411),d=r(238),m=r(134),f=r(1),g=r(504),p=r(27),C=r(11),F=r(29),v=r(505),y=r(43),h=r(23),S=r(8),T=r(150),D=r(21),k=r(356),I=r(17),b=r(9),x=r(133),P=r(105),A=r(92),L=r(35),N=r(54),E=r(30),M=r(40),_=r(164),O=r(193),R=r(121),B=r(14),w=r(28),U=r(88),Y=r(153),X=r(256),G=r(73);i.AddFormaParams=(o=function(e,t,r,o){void 0===e&&(e=s.ControllerSettingsBehaviorEnum.IgnoreControllerSettings),void 0===t&&(t=!0),void 0===r&&(r=null),void 0===o&&(o=!1),this.behavior=e,this.suggestPlacement=t,this.formaToReplace=r,this.forceAlphaImageAsBackground=o},n={},l.defineClass({name:"AddFormaParams",ctor:o,superName:"CoreObject",statics:{DEFAULTS:{get:function(){return void 0===n.DEFAULTS&&(n.DEFAULTS=new o),n.DEFAULTS}}}}),o),i.CreationFacade=(a=function(){},l.defineClass({name:"CreationFacade",ctor:a,statics:{addImage:function(e,t,r,o,n){var a,i;return(a=e.document)&&(i=a.controller)?p.CorePromise.resolve(null).then(function(e){var c;return(c=l.as(a.content.createNode(T.ImageContentNode.KIND),T.ImageContentNode))?(c.url=t,c.mimeType=r,c.pixelWidth=o,c.pixelHeight=n,i.designController.actions.doAction(new u.AddContentAction(c)).then(function(e){var t,r;return(t=l.as(e,s.FormaActionResult))&&(r=t.formae)?r[0]:(f.CoreAssert.fail("Unexpected result from AddContentAction, expected FormaActionResult"),null)})):p.CorePromise.reject("imageCN is nil")}):p.CorePromise.reject("document has no controller")},addLibraryShape:function(e,t,r,o){var n;return(n=l.as(e.createFormaWithController(E.ShapeForma.KIND,N.ShapeController.KIND),E.ShapeForma))?(e.root.appendChild(n),n.intent=C.Forma.INTENT_ICON,M.ShapeLibrary.applyToShapeForma(n,t),n.style.colors.fieldPrimary=o,n.controller.fit(r),p.CorePromise.resolve(n)):p.CorePromise.reject("could not create shape forma")},addText:function(e,t,r){var o;return(o=e.document)?p.CorePromise.resolve(null).then(function(e){var n;return(n=l.as(o.content.createNode(O.TextContentNode.KIND),O.TextContentNode))?(n.text=t,a.addContent(o.firstPage,n).then(function(e){var t;return(t=l.as(e,C.Forma))?t:(f.CoreAssert.fail("Unexpected result from AddContentAction, expected a Forma"),null)}).then(function(e){var t,o,n,a;return r?(t=l.as(e,C.Forma))&&(o=l.as(t.controller,B.TypeLockupController))&&(n=l.as(t.style,I.LockupStyle))&&(a=n.font)?v.FontFacade.ensureFontLoaded(a.fontData).then(function(e){return o.updateGroup(),t}):p.CorePromise.reject("unable to inspect created lockup for style and font"):e})):p.CorePromise.reject("textCN is nil")}):p.CorePromise.reject("document has no controller")},duplicateItems:function(e,t,r){var o=l.clone(k.LayerFacade.sortInZOrder(l.clone(e)));return a.copyItems(l.clone(o)).then(function(e){var o=l.clone(e);return 0==!o.length&&(t&&o.forEach(function(e){return e.move(b.Matrix2D.translationXY(25,25))}),r&&o[0].page.document.controller.selection.replaceSelectionWithFormae(l.clone(o))),o})},remapReferences:function(e,t){if(e.page!=t.page){var r,o,n=e.style,a=t.style;if((r=n.colorLibrary)&&(o=a.colorLibrary)){var i,s,c={};g.ColorLibraryMap.remapColors(a.colors,r,o,c),(i=l.as(a,I.LockupStyle))&&(s=i.characterStyles[B.TypeLockupController.HIGHLIGHT_STYLE])&&g.ColorLibraryMap.remapColors(s.colors,r,o,c)}}},copyItems:function(e,t){var r;if(void 0===t&&(t=null),0==e.length)return p.CorePromise.resolve([]);if(r=e[0].page.document){var o=e.filter(function(e){return l.opt(e.controller,function(e){return 1==e.duplicatable})},this);if(0==o.length)return p.CorePromise.resolve([]);var n=[],i=!1,s=p.CorePromise.resolve(null);return o.forEach(function(e){s=s.then(function(r){return e.controller.copyTo(t).then(function(t){var r;return(r=l.as(t,C.Forma))?(r.isImage()&&(i=!0),a.remapReferences(e,r),n.push(r),r):null})})}),s.then(function(e){return i&&R.TheoDocumentUtils.updateConstrainedImageInfo(l.opt(t,function(e){return e.document})||r),n})}return p.CorePromise.reject("copyItems: no document?")},deleteFormae:function(e,t){var r;if(e.length>0&&(r=e[0].page.document)){for(var o,n,a=!1,i=l.iter(e);!i.done;i.next()){var s=i.value;if(!(s instanceof L.RootForma)){var u;s.isLogo()?_.TheoBrandkitUtils.isImageBrandedLogo(s)&&(a=!0):s.isTypeLockup()?_.TheoBrandkitUtils.doesLockupUseBrandedFonts(s)&&(a=!0):s.hasIntent(C.Forma.INTENT_ICON)&&l.opt(S.Host.logging,function(e){return e.logToAnalytics(c.AnalyticsConstants.kAnalyticsIconDeleted,{})}),r.controller.selection.isSelected(s)&&r.controller.selection.deselectForma(s),(u=s.parent)&&l.opt(l.as(u.controller,y.GroupController),function(e){return e.removeFormaFromGroup(s)});var m=s.controller.settings;null!=m&&m==s.page.document.controller.controllerSettingsState.settings&&(s.page.document.controller.controllerSettingsState.settings=null),s.destroy()}}(o=l.as(r.firstPage.root.controller,A.RootController))&&(n=o.getGridController())&&n.onFormaeDeleted(l.clone(e)),d.AnimationLibrary.updateCurrentStyle(r),a&&_.TheoBrandkitUtils.unBrandDocumentIfNoBrandedElements(r)}l.opt(t,function(e){return e()})},addContent:function(e,t,r,o,n){var s,c,u,d,m;return void 0===r&&(r=null),void 0===o&&(o=!1),void 0===n&&(n=i.AddFormaParams.DEFAULTS),(s=e.document)&&(c=s.controller)?(null==t.parent&&c.document.content.root.appendChild(t),null!=r&&l.opt(r,function(e){return null==e.parent})&&c.document.content.root.appendChild(r),P.MotionUtils.invalidateAnimation(s),(u=a.createFormaFromContent(e,t,r))?(d=n.formaToReplace)&&(m=l.as(l.opt(d.parent,function(e){return e.controller}),y.GroupController))?(m.replaceChildWithForma(d,u,o),p.CorePromise.resolve(u)):a.addForma(c.document.firstPage,u,n).then(function(e){return u}):p.CorePromise.reject("Could not create forma from content")):p.CorePromise.reject("No related document, or controller")},addForma:function(e,t,r){var o;return void 0===r&&(r=i.AddFormaParams.DEFAULTS),(o=t.controller)?o.addForma(e,t,r).then(function(o){return r.behavior==s.ControllerSettingsBehaviorEnum.SetControllerSettings&&l.opt(l.opt(e.document,function(e){return e.controller}),function(e){return e.controllerSettingsState.settings=l.opt(t.controller,function(e){return e.settings})}),null}):p.CorePromise.reject("forma has no controller")},createFormaFromContent:function(e,t,r){var o,n,a,i,s;if((n=e.document)&&(a=n.controller))if(t instanceof T.ImageContentNode){var c=e.createForma(D.ImageForma.KIND);c.contentID=t.id,(d=e.createForma(F.FrameForma.KIND)).appendChild(c),o=d;var u=t;l.opt(u.mediaMetadata,function(e){return e.designIntent==x.MediaMetadata.DESIGNINTENT_LOGO&&null!=u.sparkElementID&&""!=u.sparkElementID})&&_.TheoBrandkitUtils.brandDocumentForElement(n,u.sparkElementID,m.AUTHORING_CONTEXT_TYPE_LOGO),l.opt(u.mediaMetadata,function(e){return e.designIntent==x.MediaMetadata.DESIGNINTENT_LOGO})&&(c.intent=C.Forma.INTENT_LOGO),l.opt(u.mediaMetadata,function(e){return e.designIntent==x.MediaMetadata.DESIGNINTENT_PATTERN})&&(c.intent=C.Forma.INTENT_PATTERN),l.opt(u.mediaMetadata,function(e){return e.designIntent==x.MediaMetadata.DESIGNINTENT_ICON})&&(c.intent=C.Forma.INTENT_ICON)}else if(t instanceof Y.VideoContentNode){var d,g=e.createForma(G.VideoForma.KIND);g.videoContentID=t.id,null!=r&&(g.contentID=r.id),(d=e.createForma(F.FrameForma.KIND)).appendChild(g),o=d,l.opt(l.opt(g.contentNode,function(e){return e.mediaMetadata}),function(e){return e.designIntent==x.MediaMetadata.DESIGNINTENT_STICKER})&&(g.intent=C.Forma.INTENT_STICKER)}else if(i=l.as(t,U.VectorContentNode)){f.CoreAssert.isFalse(l.opt(i.mediaMetadata,function(e){return e.designIntent==x.MediaMetadata.DESIGNINTENT_ICON}),"can't create icon from VectorContentNode");var p=e.createForma(X.VectorForma.KIND);p.contentID=i.id,o=p}else if(s=l.as(t,O.TextContentNode)){var v=e.createForma(h.GroupForma.KIND),y=a.controllerFactory.createController(B.TypeLockupController.KIND,v);v.controller=y,y.contentNode=s,y.size=new w.TheoSize(400,300),o=v}return o}}}),a)},91:function(e,t,r){var o,n=t,a=r(0),i=r(315),l=r(70),s=r(4),c=r(26),u=r(29),d=r(21),m=r(80),f=r(35),g=r(73);n.ImageFacade=(o=function(){s.CoreObject.call(this)},a.defineClass({name:"ImageFacade",ctor:o,superName:"CoreObject",statics:{replaceImageWithColors:function(e,t){var r=e;if(e instanceof u.FrameForma||e instanceof d.ImageForma&&e.parent instanceof u.FrameForma){var o,n,s=a.as(e,u.FrameForma)||e.parent;(o=a.as(e.parent,f.RootForma))?(l.CreationFacade.deleteFormae([s],null),null!=t&&i.ColorFacade.applyColorsToForma(o,a.clone(t)),r=o):(r=s,(n=a.opt(a.as(s.controller,c.FrameController),function(e){return e.replaceWithColoredShape()}))&&null!=t&&(i.ColorFacade.applyColorsToForma(n,a.clone(t)),r=n))}return r},replaceImagesWithColors:function(e,t){return e.map(function(e){return o.replaceImageWithColors(e,a.clone(t))},this)},shuffleImageStyle:function(e,t){for(var r=a.iter(t);!r.done;r.next()){var n,i=r.value;(n=o.getImageFormaForForma(i))&&(a.opt(a.opt(n.root,function(e){return e.animation}),function(e){return e.invalidate()}),n.applyStyle(e))}},applyImageStyle:function(e,t){for(var r=a.iter(t);!r.done;r.next()){var n,i=r.value;(n=o.getImageFormaForForma(i))&&(a.opt(a.opt(n.root,function(e){return e.animation}),function(e){return e.invalidate()}),n.applyStyle(e))}},getImageStyleForForma:function(e){var t;return(t=o.getImageFormaForForma(e))?a.as(t.style,m.ImageStyle):null},getImageFormaForForma:function(e){var t;return(t=a.as(e,u.FrameForma))&&t.childCount>0?a.as(t.childAt(0),d.ImageForma):a.as(e,d.ImageForma)},getVideoFormaForForma:function(e){var t;return(t=a.as(e,u.FrameForma))&&t.childCount>0?a.as(t.childAt(0),g.VideoForma):a.as(e,g.VideoForma)},getBackgroundImagesFromPage:function(e){for(var t=[],r=a.iter(e.root.filterWithCallback(function(e){return e.kind==u.FrameForma.KIND&&e.isBackgroundImage()&&e.childCount>0}));!r.done;r.next()){var o=r.value;t.push(o.childAt(0))}return t}}}),o)}}]);
//# sourceMappingURL=logomaker-entry_9fe139f1-d1f5d497.js.map