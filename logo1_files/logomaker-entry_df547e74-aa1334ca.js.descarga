(window.webpackJsonp=window.webpackJsonp||[]).push([[63],{240:function(e,t,r){var n,o=t,a=r(0),i=r(23),l=r(241),u=r(162);o.GridScore=(n=function(e,t,r,n,o,s){this.dataset="DefaultGridScore",this.rejectThreshold=-1e3,void 0===n&&(n=null),void 0===o&&(o=!1),void 0===s&&(s=null),this.currentGrid_=n,this.gridStyle_=e,this.gridFrame_=t,this.contentAware_=o,this.layoutItems_=a.clone(r);var c=a.clone(new l.GridStyleFeatureExtractor(a.as(n,i.GroupForma),e,t,a.clone(r)).features);u.WeightedScore.call(this,a.count(c)),this.writeFeatureDict(this.dataset,a.clone(c)),null!=s&&s.length==a.count(c)&&this.setWeights(a.clone(s))},a.defineClass({name:"GridScore",ctor:n,superName:"WeightedScore",props:{gridStyle:{get:function(){return this.gridStyle_}},reject:function(){return this.score<this.rejectThreshold}}}),n)},242:function(e,t,r){var n,o=t,a=r(0),i=r(1);o.RoleData=(n=function(e,t,r){for(var n=a.iter(t);!n.done;n.next()){var o=n.value;i.CoreAssert.isTrue(null!=r[o])}for(var l=a.iter(a.keys(r));!l.done;l.next())o=l.value,i.CoreAssert.isTrue(t.includes(o));this.forma=e,this.featureOrder=a.clone(t),this.featureValues=a.clone(r)},a.defineClass({name:"RoleData",ctor:n,props:{feat:function(e){return this.featureValues[e]},getUniqueKey:function(){for(var e="",t=a.iter(this.getFeatureVector());!t.done;t.next()){var r=t.value;e=e+a.toString("%.2f",r)+"-"}return e=a.replace(e,".","")},asString:{get:function(){for(var e="",t=a.iter(this.featureOrder);!t.done;t.next()){var r=t.value,n=Math.round(1e3*this.featureValues[r])/1e3;e+=r+": "+a.toString(n)+",\n"}return e}},asJson:{get:function(){return"{\n"+this.asString+"\n}"}},getFeatureVector:function(){for(var e=[],t=a.iter(this.featureOrder);!t.done;t.next()){var r=t.value;e.push(this.featureValues[r])}return e}}}),n)},249:function(e,t,r){var n,o=t,a=r(0),i=r(93),l=r(242),u=r(30),s=r(88);o.ShapeRoleFeatures=a.defineEnum("ShapeRoleFeatures",{Area:"Area",ShapeWidth:"ShapeWidth",ShapeHeight:"ShapeHeight",CenterX:"CenterX",CenterY:"CenterY",RotCosine:"RotCosine",RotSine:"RotSine",PercentageDesignArea:"PercentageDesignArea",PercentageOutofBounds:"PercentageOutofBounds",OverlappingGraphicCount:"OverlappingGraphicCount",OverlappingTextCount:"OverlappingTextCount",PercentageTextOverlap:"PercentageTextOverlap",PercentageGraphicOverlap:"PercentageGraphicOverlap",MaskAverage:"MaskAverage",MaskAverageEdge:"MaskAverageEdge",PageHeight:"PageHeight",PageWidth:"PageWidth",ShapeCount:"ShapeCount",TextCount:"TextCount",BackgroundImageCount:"BackgroundImageCount",ForegroundImageCount:"ForegroundImageCount"}),o.ShapeRoleData=(n=function(e,t,r){l.RoleData.call(this,e,a.clone(t),a.clone(r))},a.defineClass({name:"ShapeRoleData",ctor:n,superName:"RoleData",statics:{getShapeRoleData:function(e){var t,r,l;if(l=a.as(e,u.ShapeForma)){var c=[o.ShapeRoleFeatures.Area,o.ShapeRoleFeatures.ShapeWidth,o.ShapeRoleFeatures.ShapeHeight,o.ShapeRoleFeatures.CenterX,o.ShapeRoleFeatures.CenterY,o.ShapeRoleFeatures.RotCosine,o.ShapeRoleFeatures.RotSine,o.ShapeRoleFeatures.PercentageDesignArea,o.ShapeRoleFeatures.PercentageOutofBounds,o.ShapeRoleFeatures.OverlappingGraphicCount,o.ShapeRoleFeatures.OverlappingTextCount,o.ShapeRoleFeatures.PercentageTextOverlap,o.ShapeRoleFeatures.PercentageGraphicOverlap,o.ShapeRoleFeatures.MaskAverage,o.ShapeRoleFeatures.MaskAverageEdge,o.ShapeRoleFeatures.PageHeight,o.ShapeRoleFeatures.PageWidth,o.ShapeRoleFeatures.ShapeCount,o.ShapeRoleFeatures.TextCount,o.ShapeRoleFeatures.BackgroundImageCount,o.ShapeRoleFeatures.ForegroundImageCount],h=i.FeatureExtractorFactory.getFeatureExtractor(i.FeatureExtractorType.Shape,l,a.clone(c)),g={};c.forEach(function(e){g[e]=(t=h.numericFeatureForKey(e))||null!=t?t:-1});for(var f=a.iter(["line","heart","circle","arrow","square","instagram","rectangle","flower","star","love","triangle","food","music","party","?","birthday","sun","facebook","phone","youtube","badge"]);!f.done;f.next()){var p,d,m=f.value,v="search-"+m;c.push(v),g[v]=0,(p=a.as(l.contentNode,s.VectorContentNode))&&null!=(d=a.opt(a.opt(p.mediaMetadata,function(e){return e.searchTerm}),function(e){return e.toLowerCase()}))&&d==m&&(g[v]=1)}r=new n(e,a.clone(c),a.clone(g))}return r}}}),n)},251:function(e,t,r){var n,o,a=t,i=r(0),l=r(1),u=r(91),s=r(14);a.ItemContentType=i.defineEnum("ItemContentType",{Image:0,Floating:1}),a.TextInfo=(n=function(){},i.defineClass({name:"TextInfo",ctor:n,props:{init_91e2:function(e,t,r){this.textLength=e,this.font=t,this.backingShape=r},init_implicit:function(e,t,r){this.textLength=e,this.font=t,this.backingShape=r},clone:function(){return n.init_implicit(this.textLength,this.font,this.backingShape)}}}),n),a.LayoutItem=(o=function(){this.aspectRatios_=null,this.importance_=null,this.focus_=null},i.defineClass({name:"LayoutItem",ctor:o,props:{init_b14a:function(e){this.id_=e.formaID,this.forma_=e;var t,r,n=this.forma_.controller.floating,o=u.ImageFacade.getImageFormaForForma(e);if(n||null==o){if(l.CoreAssert.isTrue(this.forma_.controller.floating),this.type_=a.ItemContentType.Floating,t=i.as(e.controller,s.TypeLockupController)){var c=t.text.length,h=i.opt(i.opt(t.lockupStyle,function(e){return e.font}),function(e){return e.fontData.postScriptName}),g=i.opt(t.lockupStyle,function(e){return e.backingShapeID});this.textInfo_=i.clone(a.TextInfo.init_91e2(c,h,g))}}else this.type_=a.ItemContentType.Image,(r=o.contentNode)&&(this.width_=i.toDouble(r.pixelWidth),this.height_=i.toDouble(r.pixelHeight),this.focus_=r.focusRegion)},init_e2cb:function(e,t,r,n,o,a,l){void 0===a&&(a=null),void 0===l&&(l=null),this.id_=e,this.type_=t,this.width_=r,this.height_=n,this.textInfo_=i.clone(o),this.aspectRatios_=i.clone(a),this.importance_=l,this.forma_=null},id:{get:function(){return this.id_}},forma:{get:function(){return this.forma_}},type:{get:function(){return this.type_}},width:{get:function(){return this.width_}},height:{get:function(){return this.height_}},textInfo:{get:function(){return this.textInfo_}},focusRegion:{get:function(){return this.focus_}},aspectRatios:{get:function(){return this.aspectRatios_},set:function(e){this.aspectRatios_=i.clone(e)}},importance:{get:function(){return this.importance_},set:function(e){this.importance_=e}}}}),o)},316:function(e,t,r){var n,o,a,i,l=t,u=r(0),s=r(1),c=r(198),h=r(11),g=r(26),f=r(25),p=r(240),d=r(335),m=r(336),v=r(116),S=r(8),F=r(251),I=r(92),_=r(14),R=r(94),C=r(10);l.LayoutSuggester=(n=function(){this.scoringWeights_=null,this.layoutTypeModel_=null,this.group_=null},u.defineClass({name:"LayoutSuggester",ctor:n,superName:"CoreObject",statics:{KIND:{get:function(){return"LayoutSuggester"}},createContentAwareSuggestions:function(e){var t;return(t=u.opt(u.as(e.controller,I.RootController),function(e){return e.getGridController()}))?n.init_bfe3(t.gridForma).createSuggestions(!0,!1,!1):[]}},props:{init_bfe3:function(e,t,r){void 0===t&&(t=null),void 0===r&&(r=null);var n=u.clone(e.filterWithCallback(function(e){return e.isBackgroundImage()},h.FormaTraversal.JustChildren)),o=u.clone(e.filterWithCallback(function(e){return null!=e.controller&&e.controller.floating},h.FormaTraversal.JustChildren));this.layoutItems_=n.map(function(e){return[F.LayoutItem.init_b14a(e)]},this),this.imageCount_=this.layoutItems_.length;var a=o.map(function(e){return F.LayoutItem.init_b14a(e)},this);this.layoutItems_.push(u.clone(a)),this.floatingCount_=a.length,this.origLayout_=t,s.CoreAssert.isTrue(null!=e.parent),this.scoringWeights_=u.clone(r),this.gridFrame_=e.frame,this.group_=e},init_5613:function(e,t,r){void 0===t&&(t=null),void 0===r&&(r=null),this.layoutItems_=[];for(var n=[],o=u.iter(e.layoutItems);!o.done;o.next()){var a=o.value;a.type==F.ItemContentType.Image&&this.layoutItems_.push([a]),a.type==F.ItemContentType.Floating&&n.push(a)}this.imageCount_=this.layoutItems_.length,this.floatingCount_=n.length,this.layoutItems_.push(u.clone(n)),this.origLayout_=t,this.scoringWeights_=u.clone(r),this.gridFrame_=e.gridFrame},layoutTypeModel:{get:function(){return this.layoutTypeModel_},set:function(e){this.layoutTypeModel_=e}},createSuggestions:function(e,t,r,n,o){if(void 0===e&&(e=!0),void 0===t&&(t=!1),void 0===r&&(r=!0),void 0===n&&(n=!1),void 0===o&&(o=1),this.imageCount_<1)return[];var a=[];return e&&u.append(a,this.createContentAwareSuggestions(r,o,n)),t&&u.append(a,this.createFixedGridSuggestions(r,o)),u.sortInPlace(a,function(e,t){return e.score>t.score}),a},createEqualSizeSuggestions:function(e,t){return void 0===e&&(e=!0),void 0===t&&(t=1),this.imageCount_<1?[]:this.getEqualSizeGridSuggestions(e,t)},createFixedGridSuggestions:function(e,t){void 0===t&&(t=1);var r=this;if(this.imageCount_<1)return[];for(var n=u.clone(e&&this.floatingCount_>=1?this.layoutItems_:this.layoutItems_.slice(0,this.imageCount_)),o=n.length,a=u.clone(c.DesignSuggester.getPermutations(o,350)),i=null,l=-1e6,s=u.toArray(u.range(1,o,!0)).map(function(e){return r.getFixedGrids(o,e,!1)},this),h=u.toArray(u.range(1,o,!0)).map(function(e){return r.getFixedGrids(o,e,!0)},this),g=u.iter(a);!g.done;g.next()){var f=g.value.map(function(e){return n[e]},this),p=this.fillFixedGrids(o,[s,h],u.clone(f));p.score>l&&(i=p.suggestion,l=p.score)}return[i]},getEqualSizeGridSuggestions:function(e,t){void 0===t&&(t=1);for(var r=u.clone(e&&this.floatingCount_>=1?this.layoutItems_:this.layoutItems_.slice(0,this.imageCount_)),n=r.length,o=[],a=u.iter(u.range(1,n,!0));!a.done;a.next()){var i=a.value,l=i;if(n%i==0){var s=u.toInt(n/i),h=u.clone(this.getGrids(l,s)),g=u.clone(c.DesignSuggester.getPermutations(n,1))[0].map(function(e){return r[e]},this),f=g.map(function(e){return e[0]},this),d=this.createGridStyle(u.clone(h),u.clone(g),"equal_size_layout_"+l+"_"+s),v=new p.GridScore(d,this.gridFrame_,u.clone(f),null,!1,u.clone(this.scoringWeights_)),S=new m.GridSuggestion(void 0,d,this.origLayout_,v);o.push(S)}}return u.sortInPlace(o,function(e,t){return e.score>t.score}),o.slice(0,Math.min(o.length,t))},getGrids:function(e,t){for(var r=1/u.toDouble(e),n=1/u.toDouble(t),o=[],a=u.iter(u.range(0,e,!1));!a.done;a.next())for(var i=a.value,l=u.iter(u.range(0,t,!1));!l.done;l.next()){var s=l.value,c=u.toDouble(i)*r,h=u.toDouble(s)*n,g=u.toDouble(i+1)*r,p=u.toDouble(s+1)*n;o.push(new f.GridCell(new C.TheoRect(c,h,g,p)))}return o},createContentAwareSuggestions:function(e,t,r){if(void 0===t&&(t=1),void 0===r&&(r=!1),this.imageCount_<1)return[];for(var n=u.clone(e&&this.floatingCount_>=1?this.layoutItems_:this.layoutItems_.slice(0,this.imageCount_)),o=n.length,a=this.gridFrame_.aspectRatio,i=[],l=Math.max(250-25*o,25),s=u.clone(c.DesignSuggester.getPermutations(o,l)),h=[],g=[],f=[],p=[],d=[],m=[],v=u.iter(u.toSequence(s));!v.done;v.next()){var S=v.value,F=S.offset,I=S.element.map(function(e){return n[e]},this),_=this.generateContentAwareGrids(o,u.clone(I),a,r);u.append(h,_.heights),u.append(g,_.widths),u.append(f,_.scores),u.append(p,_.orders),u.append(d,_.flipDimensions);for(var R=u.iter(u.range(0,_.scores.length,!1));!R.done;R.next())m.push(F)}for(var C=u.sort(f),y=0;i.length<t&&y<C.length;){for(var T=C[C.length-1-y],D=u.indexOf(f,T),L=u.clone(s[m[D]]).map(function(e){return n[e]},this),x=u.clone(h[D]),M=u.clone(p[D]),b=u.clone(g[D]),A=d[D],E=x.map(function(e){return 1/e},this),G=this.buildBestContentAwareGrid(u.clone(L),u.clone(b),a,u.clone(M),A,u.clone(E),r),k=1,N=u.iter(i);!N.done;N.next()){var P=N.value;if((k=Math.min(k,P.gridStyle.similarity(G.gridStyle)))<.05)break}k>.05&&i.push(G),y+=1}return i},createGridStyle:function(e,t,r){var n=new v.GridStyle(r,void 0,u.clone(e));n.forma=this.group_;for(var o=u.iter(u.toSequence(t));!o.done;o.next())for(var a=o.value,i=a.offset,l=a.element,s=u.iter(l);!s.done;s.next()){var c=s.value;n.formaMapping[c.id]=e[i]}return n},fillFixedGrids:function(e,t,r){for(var n=null,o=-1e6,a=r.map(function(e){return e[0]},this),i=u.iter(u.stride(0,e,1));!i.done;i.next())for(var l=i.value,s=u.iter(t);!s.done;s.next())for(var c=s.value,h=u.iter(c[l]);!h.done;h.next()){var g=h.value,f=this.createGridStyle(u.clone(g),u.clone(r),"Test Layout"),d=new p.GridScore(f,this.gridFrame_,u.clone(a),null,!1,u.clone(this.scoringWeights_)),v=d.score;v>o&&(n=new m.GridSuggestion(void 0,f,this.origLayout_,d),o=v)}return{score:o,suggestion:n}},generateContentAwareGrids:function(e,t,r,n){for(var o=[],a=[],i=[],l=[],s=[],c=u.iter([!1,!0]);!c.done;c.next())for(var h=c.value,g=u.iter(u.stride(1,Math.min(6,e+1),1));!g.done;g.next()){for(var f=g.value,d=u.toArray(u.range(1,f,!0)).map(function(e){return u.toDouble(e)/u.toDouble(f)},this),m=this.buildCellArray(u.clone(d),u.clone(t),h?1/r:r,void 0,h,void 0,n),v=u.clone(m.heights),S=u.clone(m.order),F=[],I=u.repeat(0,f),_=0;_<10;){var R=u.toArray(u.range(0,f,!1)).map(function(e){return 1/(u.toDouble(f)*u.toDouble(v[e]))+I[e]},this),C=1/R.reduce(function(e,t){return e+t},0);F=R.map(function(e){return e*C},this);for(var y=!1,T=u.iter(u.range(0,F.length,!1));!T.done;T.next()){var D=T.value;F[D]<.1&&(I[D]+=.1,y=!0)}for(var L=0,x=u.iter(u.range(0,F.length,!1));!x.done;x.next()){var M=x.value;F[M]+=L,L=F[M]}if(F[F.length-1]=1,!y)break;_+=1}for(var b=this.buildCellArray(u.clone(F),u.clone(t),h?1/r:r,u.clone(S),h,void 0,n),A=u.clone(b.heights),E=A.map(function(e){return 1/e},this),G=this.buildCellArray(u.clone(F),u.clone(t),h?1/r:r,u.clone(S),h,u.clone(E),n),k=this.createGridStyle(u.clone(G.cells),u.clone(t),"Scoring Placeholder"),N=[],P=u.iter(t);!P.done;P.next()){var O=P.value;u.append(N,O)}var W=new p.GridScore(k,this.gridFrame_,u.clone(N),null,!0,u.clone(this.scoringWeights_));a.push(u.clone(F)),o.push(u.clone(A)),i.push(W.score),l.push(u.clone(S)),s.push(h)}var w=u.sort(i);return{widths:a,heights:o,orders:l,scores:i,flipDimensions:s,maxScore:w[w.length-1]}},buildBestContentAwareGrid:function(e,t,r,n,o,a,i){var l=this.buildCellArray(u.clone(t),u.clone(e),o?1/r:r,u.clone(n),o,u.clone(a),i),s=u.clone(l.cells),c=u.clone(this.snapBounds(u.clone(s),this.gridFrame_.size,o)),h=this.createGridStyle(u.clone(c),u.clone(e),"Balanced-Layout");h.cropType=i?g.CropType.FillFocus:g.CropType.FitBorder;for(var f=[],d=u.iter(e);!d.done;d.next()){var v=d.value;u.append(f,v)}var S=new p.GridScore(h,this.gridFrame_,u.clone(f),null,!0,u.clone(this.scoringWeights_));return new m.GridSuggestion(this.group_,h,this.origLayout_,S)},buildCellArray:function(e,t,r,n,o,a,i){var l,s,c;void 0===n&&(n=null),void 0===o&&(o=!1),void 0===a&&(a=null),void 0===i&&(i=!1);var h=null;null==n&&(h=[]);for(var g,p=u.repeat(0,e.length),d=[],m=0,v=u.iter(u.toSequence(t));!v.done;v.next()){var S=v.value,I=S.offset,_=S.element;if(null==n){var R=u.sort(p);g=u.indexOf(p,R[0]),h.push(g)}else g=n[I];var y,T,D=e[g];if(m=0==g?0:e[g-1],1==_.length&&_[0].type==F.ItemContentType.Image){var L=i&&null!=_[0].focusRegion?_[0].focusRegion.width:(l=_[0].width)||null!=l?l:1,x=i&&null!=_[0].focusRegion?_[0].focusRegion.height:(s=_[0].height)||null!=s?s:1;y=1/(o?u.toDouble(x)/u.toDouble(L):u.toDouble(L)/u.toDouble(x))*(D-m)*r}else{var M,b;if(null!=(M=u.opt(u.opt(u.opt(_[0].forma,function(e){return e.parent}),function(e){return e.bounds}),function(e){return e.width}))&&null!=(b=u.opt(u.opt(u.opt(_[0].forma,function(e){return e.parent}),function(e){return e.bounds}),function(e){return e.height}))){for(var A=0,E=u.iter(_);!E.done;E.next()){var G=E.value;A+=(c=u.opt(G.textInfo,function(e){return e.textLength}))||null!=c?c:0}(y=this.getTextCellHeight(_.length,u.toDouble(A),m*M,D*M,M,b)/b)<.15&&(y=.15)}else y=(D-m)*r}null!=(T=u.opt(a,function(e){return e[g]}))&&1-(y*=T)<.001&&(y=1);var k=null;k=o?new f.GridCell(new C.TheoRect(p[g],m,y+p[g],D)):new f.GridCell(new C.TheoRect(m,p[g],D,y+p[g])),d.push(k),p[g]=y+p[g]}return{cells:d,heights:p,order:null==h?n:h}},snapBounds:function(e,t,r,n){void 0===n&&(n=60);var o=e.map(function(e){return e.clone()},this),a=[];if(r)for(var i=u.iter(u.toSequence(e));!i.done;i.next()){var l=i.value;f=l.offset,p=l.element,a.push(p);var s=p.bounds.maxX;if(s<1)for(var c=u.iter(u.stride(f+1,e.length,1));!c.done;c.next())if(S=(v=e[c.value]).bounds,Math.abs(v.bounds.maxX-s)*t.width<n&&1!=v.bounds.maxX&&v.bounds.maxX!=s&&(v.bounds=new C.TheoRect(S.minX,S.minY,s,S.maxY)),Math.abs(v.bounds.minX-s)*t.width<n&&0!=v.bounds.minX&&v.bounds.minX!=s&&(v.bounds=new C.TheoRect(s,S.minY,S.maxX,S.maxY)),v.bounds.width<.05)return o}else for(var h=u.iter(u.toSequence(e));!h.done;h.next()){var g=h.value,f=g.offset,p=g.element;a.push(p);var d=p.bounds.maxY;if(d<1)for(var m=u.iter(u.stride(f+1,e.length,1));!m.done;m.next()){var v,S=(v=e[m.value]).bounds;if(Math.abs(v.bounds.maxY-d)*t.height<n&&1!=v.bounds.maxY&&v.bounds.maxY!=d&&(v.bounds=new C.TheoRect(S.minX,S.minY,S.maxX,d)),Math.abs(v.bounds.minY-d)*t.height<n&&0!=v.bounds.minY&&v.bounds.minY!=d&&(v.bounds=new C.TheoRect(S.minX,d,S.maxX,S.maxY)),v.bounds.height<.05)return o}}return a},getTextCellHeight:function(e,t,r,n,o,a){var i=.13358679,l=-.0261477,s=-.11470111,c=.03862264,h=-.02888805,g=.00561106,f=.03671017,p=.13522773,d=-.0499348,m=.02618676,v=1043.48108,S=3.14978552,F=1.15001079,I=167.10292,_=.639915899,R=.0844010175,C=.0901829377,y=.517425544,T=.44141582,D=78.7709665,L=248.39949567,x=2.99889961,M=1.20115851,b=260.27180508,A=.48002452,E=.27798828,G=.28644367,k=.49969626,N=.49655603,P=117.5756354,O=u.toDouble(this.floatingCount_),W=r,w=n,H=.6568033208493654;return H+=(a-v)/L*i,H+=(O-S)/x*l,H+=(u.toDouble(this.imageCount_)-F)/M*s,H+=(W-I)/b*c,H+=((1==e?1:0)-_)/A*h,H+=((3==e?1:0)-R)/E*g,H+=((e>3?1:0)-C)/G*f,H+=(u.toDouble(e)/O-y)/k*p,H+=((w-W)/o-T)/N*d,H+=(t-D)/P*m,H*=1e3},getFixedGrids:function(e,t,r){if(t>e)return[];for(var n=u.toArray(u.range(0,t,!0)).map(function(e){return u.toDouble(e+1)/u.toDouble(t)},this),o=[u.repeat(1,t)],a=u.iter(u.range(t,e,!1));!a.done;a.next()){for(var i=[],l=u.iter(o);!l.done;l.next())for(var s=l.value,c=u.iter(u.range(0,t,!1));!c.done;c.next()){var h=c.value,g=s.concat();g[h]+=1,i.push(u.clone(g))}o=u.clone(i)}u.shuffleInPlace(o),o=u.clone(o.slice(0,Math.min(350,o.length)));for(var p=[],d=u.iter(o);!d.done;d.next()){for(var m=d.value,v=[],S=u.iter(u.toSequence(m));!S.done;S.next())for(var F=S.value,I=F.offset,_=F.element,R=0==I?0:n[I-1],y=n[I],T=0,D=u.iter(u.stride(1,u.toDouble(_+1),1));!D.done;D.next()){var L=D.value;r?v.push(new f.GridCell(new C.TheoRect(T,R,L/u.toDouble(_),y))):v.push(new f.GridCell(new C.TheoRect(R,T,y,L/u.toDouble(_)))),T=L/u.toDouble(_)}p.push(u.clone(v))}return p},createLayoutIdFeatures:function(e,t,r,n,o){var a=1==n?1:0,i=2==n?1:0,l=3==n?1:0,s=n>3?1:0,c=1==r?1:0,h=2==r?1:0,g=3==r?1:0,f=r>3?1:0,p=Math.atan2(t,e),d=e*t,m=0,v=0,S=0;if(o.length>0){m=o.reduce(function(e,t){return e+t},0)/u.toDouble(o.length);var F=u.sort(o);S=F[F.length-1],v=F[0]}var I=[e,t,u.toDouble(r),u.toDouble(n),a,i,l,s,c,h,g,f,m,v,S,d,p];return new R.TheoMatrix([I])},predictLayoutIds:function(e,t){var r=u.opt(this.group_,function(e){return e.root});if(this.layoutTypeModel_=u.opt(r,function(e){return e.page.layoutLibrary.layoutSuggestionModel}),null==r||null==this.layoutTypeModel_)return[];for(var n=r.filterWithCallback(function(e){return e.isBackgroundImage()}).length,o=u.clone(r.filterWithCallback(function(e){return e.isTypeLockup()})),a=[],i=u.iter(o);!i.done;i.next()){var l,s=i.value;(l=u.as(s.controller,_.TypeLockupController))&&a.push(u.toDouble(l.text.length))}for(var c=r.page.pageSize.width,h=r.page.pageSize.height,g=Math.atan2(h,c),f=this.createLayoutIdFeatures(c,h,o.length,n,u.clone(a)),p=this.layoutTypeModel_.featureScalingMean,m=this.layoutTypeModel_.featureScalingStd,v=u.clone(this.layoutTypeModel_.layoutIDs),F=f.subtract(p).divide(m),I=u.repeat(0,this.layoutTypeModel_.models[0].intercepts.asFlatArray.length),R=u.iter(this.layoutTypeModel_.models);!R.done;R.next()){var C=R.value;if(C.minAngle<g&&g<=C.maxAngle){var y=F.matrixMultiply(C.coefficients.transpose()).sumDim(0);I=u.clone(C.intercepts.add(y).asFlatArray)}}if(I.length!=v.length)return u.opt(S.Host.logging,function(e){return e.error("model scores don't match class labels")}),[];for(var T=u.sort(I,function(e,t){return e>t}),D=[],L=u.clone(r.page.layoutLibrary.getAllGrids()),x=!1,M=!1,b=u.iter(u.range(0,v.length,!1));!b.done;b.next()){var A=b.value;if(D.length>=e)break;for(var E=v[u.indexOf(I,T[A])],G=u.iter(L);!G.done;G.next()){var k=G.value;if(k.name==E){var N=k.nonOverlappingCells().length;if(N>=n){if(N==n){if(x)continue;x=!0}if(2==N){if(M)continue;M=!0}var P=k;if(k.gridCells.length<=3){var O=k.flipRegion(),W=u.clone(new d.GridSuggester(this.group_,null,k).createSuggestions()),w=u.clone(new d.GridSuggester(this.group_,null,O).createSuggestions());W.length>0&&w.length>0&&(P=W[0].score>w[0].score?k:O)}for(var H=!1,U=u.iter(t);!U.done;U.next())if(U.value.similarity(P)<.02){H=!0;break}H||D.includes(P.name)||D.push(P.name)}}}}return D}}}),n),l.GridDocument=(o=function(){},u.defineClass({name:"GridDocument",ctor:o,props:{init_ff8b:function(e,t,r,n,o){this.docID=e,this.userID=t,this.gridFrame=r,this.gridStyle=n,this.layoutItems=u.clone(o)},init_implicit:function(e,t,r,n,o){this.gridFrame=e,this.gridStyle=t,this.layoutItems=u.clone(r),this.docID=n,this.userID=o},clone:function(){return o.init_implicit(this.gridFrame,this.gridStyle,this.layoutItems,this.docID,this.userID)}}}),o),l.RangedLayoutLinearModel=(a=function(e,t,r,n){this.minAngle=e,this.maxAngle=t,this.coefficients=r,this.intercepts=n},u.defineClass({name:"RangedLayoutLinearModel",ctor:a,props:{clone:function(){return new a(this.minAngle,this.maxAngle,this.coefficients,this.intercepts)}}}),a),l.LayoutSuggestionsLinearModel=(i=function(e,t,r,n){this.featureScalingMean=e,this.featureScalingStd=t,this.layoutIDs=u.clone(r),this.models=u.clone(n)},u.defineClass({name:"LayoutSuggestionsLinearModel",ctor:i,superName:"CoreObject"}),i)},318:function(e,t,r){var n,o=t,a=r(0),i=r(93),l=r(242),u=r(40);o.LockupRoleFeatures=a.defineEnum("LockupRoleFeatures",{WordCount:"WordCount",CharacterCount:"CharacterCount",intsSpecialsCount:"intsSpecialsCount",webReferencesCount:"webReferencesCount",checkSocialChar:"checkSocialChar",Spacing:"Spacing",Padding:"Padding",ShapeFilled:"ShapeFilled",TextWidth:"TextWidth",TextHeight:"TextHeight",PercentageArea:"PercentageArea",CenterX:"CenterX",CenterY:"CenterY",PageHeight:"PageHeight",PageWidth:"PageWidth",otherLockupPercDesignArea:"otherLockupPercDesignArea",TextCount:"TextCount",actionWordsCount:"actionWordsCount",TextString:"TextString",BackingShape:"BackingShape",PerAreaAllLockups:"PercentageAreaAllLockups"}),o.LockupRoleData=(n=function(e,t,r){l.RoleData.call(this,e,a.clone(t),a.clone(r))},a.defineClass({name:"LockupRoleData",ctor:n,superName:"RoleData",statics:{digits:"0123456789/@|",webReferenceStrings:[".com","http",".edu",".org",".gov"],actionWordStrings:["join","now","today","try","view","swipe"],socialMediaStrings:["#","instagram"],getLockupRoleData:function(e){var t=[o.LockupRoleFeatures.WordCount,o.LockupRoleFeatures.CharacterCount,o.LockupRoleFeatures.intsSpecialsCount,o.LockupRoleFeatures.checkSocialChar,o.LockupRoleFeatures.webReferencesCount,o.LockupRoleFeatures.Spacing,o.LockupRoleFeatures.Padding,o.LockupRoleFeatures.ShapeFilled,o.LockupRoleFeatures.TextWidth,o.LockupRoleFeatures.TextHeight,o.LockupRoleFeatures.PercentageArea,o.LockupRoleFeatures.CenterX,o.LockupRoleFeatures.CenterY,o.LockupRoleFeatures.PageWidth,o.LockupRoleFeatures.PageHeight,o.LockupRoleFeatures.otherLockupPercDesignArea,o.LockupRoleFeatures.TextCount,o.LockupRoleFeatures.actionWordsCount],r=[o.LockupRoleFeatures.TextString,o.LockupRoleFeatures.BackingShape,o.LockupRoleFeatures.PerAreaAllLockups],l=i.FeatureExtractorFactory.getFeatureExtractor(i.FeatureExtractorType.LockupStyle,e,a.clone(a.as(t.concat(r),["Array","String"]))),u=a.clone(l.numericalFeatures);a.removeKey(u,o.LockupRoleFeatures.PerAreaAllLockups);var s=l.categoricalFeatureForKey(o.LockupRoleFeatures.TextString),c=l.categoricalFeatureForKey(o.LockupRoleFeatures.BackingShape),h=l.numericFeatureForKey(o.LockupRoleFeatures.PerAreaAllLockups);return u[o.LockupRoleFeatures.actionWordsCount]=a.toDouble(n.getNumActionWordReferences(s)),u[o.LockupRoleFeatures.checkSocialChar]=n.checkSocialMediaCharacters(s,c)?1:0,u[o.LockupRoleFeatures.intsSpecialsCount]=a.toDouble(n.getNumIntsAndSpecials(s)),u[o.LockupRoleFeatures.webReferencesCount]=a.toDouble(n.getNumWebReferences(s)),u[o.LockupRoleFeatures.otherLockupPercDesignArea]=h-u[o.LockupRoleFeatures.PercentageArea],new n(e,a.clone(t),a.clone(u))},getNumIntsAndSpecials:function(e){for(var t=0,r=a.iter(a.range(0,e.length,!1));!r.done;r.next()){var o=r.value,i=e.substr(o,1);n.digits.includes(i)&&(t+=1)}return t},getNumWebReferences:function(e){for(var t=0,r=a.iter(n.webReferenceStrings);!r.done;r.next()){var o=r.value;e.toLowerCase().includes(o)&&(t+=1)}return t},getNumActionWordReferences:function(e){for(var t=0,r=a.iter(n.actionWordStrings);!r.done;r.next()){var o=r.value;e.toLowerCase().includes(o)&&(t+=1)}return t},checkSocialMediaCharacters:function(e,t){for(var r,o=!1,i=a.iter(n.socialMediaStrings);!i.done;i.next()){var l=i.value;e.includes(l)&&(o=!0)}return(r=u.ShapeLibrary.shapeDictionary[t])&&r.category==u.ShapeCategory.Social&&(o=!0),o},checkLockupIsGraphic:function(e,t){for(var r=!1,n="",o=a.iter(a.range(0,e.length,!1));!o.done;o.next()){var i=o.value,l=e.substr(i,1);" "!=l&&"\n"!=l&&"\t"!=l&&"\r"!=l&&(n+=l)}return n.length<=1&&t.category!=u.ShapeCategory.None&&(r=!0),r}}}),n)},319:function(e,t,r){var n,o,a=t,i=r(0),l=r(8),u=r(199),s=r(200),c=r(57),h=r(94);a.RoleSuggesterMLP=(n=function(){},o={},i.defineClass({name:"RoleSuggesterMLP",ctor:n,statics:{cache:{get:function(){var e;return void 0===o.cache&&(o.cache=((e=i.opt(l.Host.platform,function(e){return e.isService}))||null!=e)&&e?i.opt(l.Host.learning,function(e){return e.getHostPredictionCache()}):new s.PredictionCacheInferredRole),o.cache},set:function(e){o.cache=e}},_implements:function(e){return"RoleSuggesterProtocol"==e}},props:{getRoleModel:function(){return null},getRole:function(e){var t,r,o=i.clone(c.InferredRole.init_84d1()),a=e.getUniqueKey();if(null==n.cache.getCacheValue(a)){var l,s=0,g="",f=0,p="";if(l=this.getRoleModel()){var d,m=i.clone(e.getFeatureVector()),v=i.clone(m),S=new h.TheoMatrix([v]).subtract(l.featureScalingMean).divide(l.featureScalingStd),F=new u.NNMLPClassifier(i.clone(l.coefficients),i.clone(l.intercepts),l.finalSoftmax).predict(S.transpose()),I=i.clone(F.transpose().asArray);d=i.clone(l.roles);for(var _={},R=i.iter(i.toSequence(I[0]));!R.done;R.next()){var C=R.value,y=C.offset,T=C.element;_[d[y]]=T,T>s?(f=s,p=g,s=T,g=d[y]):T>f&&(f=T,p=d[y])}}var D=(t=c.InferredRoleType.toCaseValue(g))||null!=t?t:c.InferredRoleType.Undefined,L=(r=c.InferredRoleType.toCaseValue(p))||null!=r?r:c.InferredRoleType.Undefined;o=i.clone(c.InferredRole.init_84d1(D,s,L,f)),n.cache.setCacheValue(a,i.clone(o))}return n.cache.getCacheValue(a)}}}),n)},335:function(e,t,r){var n,o=t,a=r(0),i=r(198),l=r(11),u=r(122),s=r(23),c=r(240),h=r(336),g=r(251),f=r(15);o.GridCellContent=a.defineEnum("GridCellContent",{None:0,Image:1,Text:2,Count:3}),o.GridSuggester=(n=function(e,t,r,n){this.gridForma_=null,void 0===n&&(n=null),this.gridStyle_=r,this.origLayout_=t,this.preserveMapping_=a.clone(n),this.gridForma_=e},a.defineClass({name:"GridSuggester",ctor:n,superName:"CoreObject",statics:{KIND:{get:function(){return"GridSuggester"}},defaultWeights:[-.4869963787443057,.10451788427313968,-10,.3841333333333332,.1438482857676463,.05953378239352733,-.7134725705040772,-.7,.2460712826952826,1.7685714285714302,1.7685714285714302,-1.42857142857143,-1.42857142857143,.2857180890092063,.2915071572811428,-.2857180890092063,-.2915071572811428,-.1822757614386357,-.1502170111498276,-.13002813087151563,-.16114682148449702,.28162418627853086,.2916486562661698,.3658656280531089,.31731319724602053,-.05177320346844536,-.04974606109777501,-.03389292805397268,-.021441808254260175,.14285700582863953,.961358333706472,-2.871390476190484,2.531390476190476,-.4,-.6],styleWeightMatrix:{checkerBoard:[-4,.3,-.6,.4,.3,.2,-.7,-.7,0,0,0,0,0,0,0,0,0,0,0,0,0,2,2,2,2,0,0,0,0,0,2,-100,100,-.4,-.6],imageOnTop:[0,.3,-.4,.4,.3,.2,-.7,-.7,0,-5,5,5,-5,0,0,0,0,0,-100,0,100,1,-2,1,-2,0,0,0,0,0,.3,0,0,-.4,-.6],imageOnBottom:[0,.3,-.4,.4,.3,.2,-.7,-.7,0,-5,5,5,-5,0,0,0,0,0,100,0,-100,1,-2,1,-2,0,0,0,0,0,.3,0,0,-.4,-.6],imageLeft:[0,.3,-.4,.4,.3,.2,-.7,-.7,0,5,-5,-5,5,0,0,0,0,-100,0,100,0,-2,1,-2,1,0,0,0,0,0,.3,0,0,-.4,-.6],imageRight:[0,.3,-.4,.4,.3,.2,-.7,-.7,0,5,-5,-5,5,0,0,0,0,100,0,-100,0,-2,1,-2,1,0,0,0,0,0,.3,0,0,-.4,-.6],textTowardCenter:[0,.3,-.7,.4,.3,.2,-.7,-.7,0,5,5,-5,-5,1,1,-1,-1,0,0,0,0,5,5,-1,-1,100,100,-100,-100,1,0,0,0,-.4,-.6],imageTowardCenter:[0,.3,-.7,.4,.3,.2,-.7,-.7,0,5,5,-5,-5,1,1,-1,-1,0,0,0,0,-1,-1,5,5,-100,-100,100,100,0,5,0,0,-.4,-.6]}},props:{sortCells:function(e,t){return e.bounds.minY<t.bounds.minY||!(e.bounds.minY>t.bounds.minY)&&e.bounds.minX<t.bounds.minX},createPreservedGroupMatches:function(e,t){var r=e.concat();a.sortInPlace(r,this.sortCells);for(var n=[],o=a.iter(t);!o.done;o.next()){var l=o.value;n.includes(l)||n.push(l)}a.sortInPlace(n,this.sortCells);for(var u=[],s=a.iter(n);!s.done;s.next())u.push([]);for(var c=a.iter(t);!c.done;c.next()){var h=c.key;l=c.value,u[a.indexOf(n,l)].push(h)}for(var g=Math.max(u.length,r.length),f=a.clone(i.DesignSuggester.getPermutations(g)),p=[],d=a.iter(f);!d.done;d.next()){for(var m=d.value,v=!0,S={},F=a.iter(a.range(0,g,!1));!F.done;F.next())for(var I=F.value,_=a.clone(u[I%u.length]),R=a.iter(_);!R.done;R.next()){h=R.value;var C,y=r[m[I]%r.length];if(C=a.opt(this.gridForma_,function(e){return e.formaByID(h)})){if(C.isBackgroundImage()&&1!=y.opacity){v=!1;break}S[h]=y}}for(var T=!1,D=a.iter(p);!D.done;D.next()){var L=D.value;this.mappingEqual(a.clone(S),a.clone(L))&&(T=!0)}!T&&v&&p.push(a.clone(S))}return p},createFormaMatches:function(e){if(null!=this.preserveMapping_&&a.count(this.preserveMapping_)>0)return this.createPreservedGroupMatches(a.clone(e),a.clone(this.preserveMapping_));for(var t=this.gridForma_,r=a.clone(t.filterWithCallback(function(e){return e.isBackgroundImage()})),n=[],o=[],s=a.iter(a.range(0,e.length-1,!0));!s.done;s.next()){for(var c=e[z=s.value],h=!1,g=a.iter(a.range(0,z,!0));!g.done;g.next()){var p=e[g.value];c!=p&&c.bounds.intersects(p.bounds)&&(h=!0,o.push(p))}h||n.push(c)}for(var d=Math.max(r.length,n.length),m=Math.max(250-20*r.length,100),v=a.clone(i.DesignSuggester.getPermutations(d,m)),S=[],F=a.iter(v);!F.done;F.next()){var I=F.value,_={};if(r.length>0)for(var R=a.iter(a.range(0,d,!1));!R.done;R.next())_[r[(z=R.value)%r.length].formaID]=e[I[z]%e.length];for(var C=!1,y=a.iter(S);!y.done;y.next()){var T=y.value;this.mappingEqual(a.clone(_),a.clone(T))&&(C=!0)}C||S.push(a.clone(_))}for(var D=[],L=a.iter(t.visitAsArray(l.FormaTraversal.JustChildren));!L.done;L.next()){var x=L.value;x.controller.floating&&D.push(x)}a.sortInPlace(D,function(e,t){return e.finalFrame.center.distanceTo(f.TheoPoint.ZERO)<t.finalFrame.center.distanceTo(f.TheoPoint.ZERO)});var M=e.length-r.length;if(this.gridStyle_.moveableShift&&D.length>0){var b=[];if(D.length<=M)for(var A=a.iter(D);!A.done;A.next()){var E=A.value;b.push([E])}else b=a.clone(u.GroupDetector.detectProximityGroups(a.clone(D)));M>b.length&&(b=a.clone(u.GroupDetector.splitFormaGroups(a.clone(b),M)));for(var G=[],k=a.iter(S);!k.done;k.next()){T=k.value;for(var N=a.clone(o),P=a.iter(T);!P.done;P.next()){var O=P.value;N.push(O)}for(var W=[],w=a.iter(e);!w.done;w.next()){c=w.value;for(var H=!1,U=a.iter(N);!U.done;U.next())U.value==c&&(H=!0);H&&0!=M||W.push(c)}a.shuffleInPlace(W);for(var Y=a.iter([!1,!0]);!Y.done;Y.next()){var B=Y.value;if((1==M||1==b.length)&&B)break;for(var X=a.clone(T),V=a.iter(a.range(0,b.length,!1));!V.done;V.next()){var z=V.value,K=a.clone(b[z]);B&&(K=a.clone(b[b.length-z-1]));for(var q=a.iter(a.range(0,K.length,!1));!q.done;q.next())X[K[q.value].formaID]=W[Math.min(z,W.length-1)]}G.push(a.clone(X))}}S=a.clone(G)}return S},mappingEqual:function(e,t){for(var r=a.iter(e);!r.done;r.next()){var n=r.key,o=r.value;if(t[n]!=o)return!1}return!0},createSuggestions:function(e){void 0===e&&(e=null);for(var t=[],r=a.iter(this.gridStyle_.gridCells);!r.done;r.next()){var o=r.value;t.push(o.clone())}var i=a.clone(this.createFormaMatches(a.clone(t)));if(0==i.length)return[];var l,u=[];if(l=this.gridForma_.root)for(var f=a.iter(i[0]);!f.done;f.next()){var p,d=f.key;o=f.value,(p=l.formaByID(d))&&(p.controller.floating||p.isBackgroundImage())&&u.push(g.LayoutItem.init_b14a(p))}var m=a.clone(null!=e?e:n.defaultWeights);t.length>5&&(m=a.clone(n.styleWeightMatrix.checkerBoard));for(var v=[],S=a.iter(i);!S.done;S.next()){var F=S.value,I=this.createGridStyle(a.clone(t),a.clone(F)),_=new c.GridScore(I,this.gridForma_.frame,a.clone(u),this.gridForma_,void 0,a.clone(m));v.push(new h.GridSuggestion(a.as(this.gridForma_,s.GroupForma),I,this.origLayout_,_))}return a.sort(v,function(e,t){return e.score>t.score})},createGridStyle:function(e,t){for(var r=this.gridStyle_.clone(),n=[],o=a.iter(e);!o.done;o.next()){var i=o.value;n.push(i.clone())}for(var l={},u=a.iter(t);!u.done;u.next())for(var s=u.key,c=(i=u.value,a.iter(n));!c.done;c.next()){var h=c.value;if(i.bounds==h.bounds){l[s]=h;break}}return r.gridCells=n,r.formaMapping=l,r.forma=this.gridForma_,r}}}),n)},336:function(e,t,r){var n,o=t,a=r(0),i=r(44),l=r(25);o.GridSuggestion=(n=function(e,t,r,n){void 0===e&&(e=null),this.gridStyle_=t,this.originalLayout_=r,this.forma_=e,this.score_=n},a.defineClass({name:"GridSuggestion",ctor:n,superName:"CoreObject",props:{gridStyle:{get:function(){return this.gridStyle_}},score:{get:function(){return this.score_.score}},weightedScore:{get:function(){return this.score_}},apply:function(){if(a.info("Grid score:"),a.info(this.score_.asString),null!=this.forma_){var e,t=new i.FormaTransformChangedEvent(this.forma_);this.forma_.beginUpdate(t),a.opt(this.originalLayout_,function(e){return e.apply()}),(e=a.as(this.forma_.controller,l.GridController))&&(this.gridStyle_.forma=this.forma_,e.applyGridStyleWithMapping(this.gridStyle_,!0)),this.forma_.endUpdate(t)}}}}),n)},432:function(e,t,r){var n,o=t,a=r(0),i=r(29),l=r(242);o.ImageRoleData=(n=function(e,t,r){l.RoleData.call(this,e,a.clone(t),a.clone(r))},a.defineClass({name:"ImageRoleData",ctor:n,superName:"RoleData",statics:{getImageRoleData:function(e){return e instanceof i.FrameForma?new n(e,[],{}):null}}}),n)},433:function(e,t,r){var n,o,a=t,i=r(0),l=r(26),u=r(57);a.ImageRoleSuggesterFactory=(n=function(){},i.defineClass({name:"ImageRoleSuggesterFactory",ctor:n,statics:{Create:function(e){return void 0===e&&(e=""),new a.ImageRoleSuggesterSimple}}}),n),a.ImageRoleSuggesterSimple=(o=function(){},i.defineClass({name:"ImageRoleSuggesterSimple",ctor:o,statics:{_implements:function(e){return"RoleSuggesterProtocol"==e}},props:{getRole:function(e){var t,r=e.forma,n=u.InferredRoleType.Undefined;if(t=i.as(r.controller,l.FrameController)){if(r.isGridCell())return u.InferredRole.init_84d1(u.InferredRoleType.Background,1);if(r.isLogo())return u.InferredRole.init_84d1(u.InferredRoleType.Logo,1,u.InferredRoleType.GraphicContent,.5);if(t.floating)return u.InferredRole.init_84d1(u.InferredRoleType.GraphicContent,1)}return u.InferredRole.init_84d1(n,1)}}}),o)},434:function(e,t,r){var n,o,a,i=t,l=r(0),u=r(318),s=r(160),c=r(57),h=r(319);i.LockupRoleSuggesterFactory=(n=function(){},l.defineClass({name:"LockupRoleSuggesterFactory",ctor:n,statics:{Create:function(e){return void 0===e&&(e=""),"MLP"==e?new i.LockupRoleSuggesterMLP:new i.LockupRoleSuggesterSimple}}}),n),i.LockupRoleSuggesterMLP=(o=function(){h.RoleSuggesterMLP.call(this)},l.defineClass({name:"LockupRoleSuggesterMLP",ctor:o,superName:"RoleSuggesterMLP",statics:{_implements:function(e){return"RoleSuggesterProtocol"==e}},props:{getRoleModel:function(){return s.MLPModel.loadNNModel("TextRole")}}}),o),i.LockupRoleSuggesterSimple=(a=function(){},l.defineClass({name:"LockupRoleSuggesterSimple",ctor:a,statics:{_implements:function(e){return"RoleSuggesterProtocol"==e}},props:{getRole:function(e){var t,r=c.InferredRoleType.Undefined;if(t=l.as(e,u.LockupRoleData)){var n=t.feat(u.LockupRoleFeatures.WordCount),o=t.feat(u.LockupRoleFeatures.TextCount),a=t.feat(u.LockupRoleFeatures.TextHeight),i=t.feat(u.LockupRoleFeatures.intsSpecialsCount),s=t.feat(u.LockupRoleFeatures.checkSocialChar)>0,h=t.feat(u.LockupRoleFeatures.PercentageArea),g=t.feat(u.LockupRoleFeatures.otherLockupPercDesignArea);r=n<=5&&a>=80?c.InferredRoleType.Title:n<=9&&a>=250?c.InferredRoleType.Title:n<=14?c.InferredRoleType.SubTitle:c.InferredRoleType.Body,i>=5&&n<=18&&a<=220&&(r=c.InferredRoleType.Contact),s&&(r=c.InferredRoleType.Social),o<=3&&h>g&&(r!=c.InferredRoleType.Body&&r!=c.InferredRoleType.Social||(r=c.InferredRoleType.Title))}return c.InferredRole.init_84d1(r,1)}}}),a)},446:function(e,t,r){var n,o,a,i=t,l=r(0),u=r(1),s=r(160),c=r(199),h=r(200),g=r(40),f=r(331),p=r(94);i.predictCategory=!0,i.RawDataShapeSuggester=(n=function(){},l.defineClass({name:"RawDataShapeSuggester",ctor:n,props:{init_b1f8:function(e,t,r,n,o,a,i,l,u,s){this.numImages=e,this.numShapes=t,this.charLength=r,this.lineHeight=n,this.font=o,this.layout=a,this.textWidth=i,this.textHeight=l,this.centerX=u,this.centerY=s},getUniqueKey:function(){var e="";return e=(e=(e=(e=(e=(e=(e=(e=(e=(e=e+l.toString(this.numImages)+"-")+l.toString(this.numShapes)+"-")+l.toString(this.charLength)+"-")+l.toString(this.lineHeight)+"-")+this.font+"-")+this.layout+"-")+l.toString(this.textWidth)+"-")+l.toString(this.textHeight)+"-")+l.toString(this.centerX)+"-")+l.toString(this.centerY)+"-"},init_implicit:function(e,t,r,n,o,a,i,l,u,s){this.numImages=e,this.numShapes=t,this.charLength=r,this.lineHeight=n,this.font=o,this.layout=a,this.textWidth=i,this.textHeight=l,this.centerX=u,this.centerY=s},clone:function(){return n.init_implicit(this.numImages,this.numShapes,this.charLength,this.lineHeight,this.font,this.layout,this.textWidth,this.textHeight,this.centerX,this.centerY)}}}),n),i.ShapeSuggester=(o=function(){this.shapeCatMap={},this.shapeCatMap.banner=g.TagGroup.banner,this.shapeCatMap.square=g.TagGroup.square,this.shapeCatMap.other=g.TagGroup.other,this.shapeCatMap.circle=g.TagGroup.circle,this.shapeCatMap.decorative=g.TagGroup.decorative,this.shapeCatMap.none=g.TagGroup.none,l.defctor(this)},a={},l.defineClass({name:"ShapeSuggester",ctor:o,statics:{cache:{get:function(){return void 0===a.cache&&(a.cache=new h.PredictionCacheDouble),a.cache},set:function(e){a.cache=e}}},props:{getShapeSuggesterFeatures:function(e,t){var r=e.numImages,n=e.shapeCount,a=e.selectedLockup.charCount,u=l.toInt(e.selectedLockup.lineHeight),s=e.selectedLockup.font,c=e.selectedLockup.styleAttributes.layout,h=l.clone(e.selectedLockup.pts),g=(h[0].x+h[3].x)/2/e.width,f=(h[0].y+h[3].y)/2/e.height,p=l.toInt(e.selectedLockup.width),d=l.toInt(e.selectedLockup.height),m=l.clone(i.RawDataShapeSuggester.init_b1f8(r,n,a,u,s,c,p,d,g,f));return o.cache.cleanup(t.page.document.uuid),m},getScores:function(e,t){var r=this,n=t.getUniqueKey();if(null==o.cache.getCacheValue(n)){var a,h=[],d=0;if(a=s.MLPModel.loadNNModel("Shape")){var m,v,S,F=l.repeat(0,55),I=l.repeat(0,4),_=l.repeat(0,8);_[0]=l.toDouble(t.numShapes),_[1]=l.toDouble(t.numShapes),_[2]=l.toDouble(t.charLength),_[3]=l.toDouble(t.lineHeight),_[4]=l.toDouble(t.textWidth),_[5]=l.toDouble(t.textHeight),_[6]=l.toDouble(t.centerX),_[7]=l.toDouble(t.centerY),null!=(v=l.indexOf(a.fonts,t.font))&&(F[v]=1),null!=(S=l.indexOf(a.layouts,t.layout))&&(I[S]=1);var R=l.clone(_.concat(l.clone(F)).concat(l.clone(I)));u.CoreAssert.isTrue(67==R.length);var C=new p.TheoMatrix([R]).subtract(a.featureScalingMean).divide(a.featureScalingStd),y=new c.NNMLPClassifier(l.clone(a.coefficients),l.clone(a.intercepts)).predict(C.transpose()),T=l.clone(y.transpose().asArray);m=l.clone(a.shapes);for(var D={},L=l.iter(l.toSequence(T[0]));!L.done;L.next()){var x=L.value,M=x.offset,b=x.element;D[m[M]]=b,d=Math.max(d,b)}0==i.predictCategory?e.forEach(function(e){var t;null!=(t=D[e])?h.push(t+.2):h.push(0)}):e.forEach(function(e){var t=0;m.forEach(function(n){var o;l.opt(g.ShapeLibrary.getShapeDataForArtworkId(e),function(e){return 1==e.tags.includes(r.shapeCatMap[n])})&&null!=(o=D[n])&&(t=o)}),"row"==e?t=d+.5:l.opt(g.ShapeLibrary.getShapeDataForArtworkId(e),function(e){return 1==e.tags.includes(r.shapeCatMap.none)})&&(t=.1),h.push(t)})}o.cache.setCacheValue(n,l.clone((new f.SuggestionUtils).normalizedWeights(l.clone(h))))}return o.cache.getCacheValue(n)}}}),o)},452:function(e,t,r){var n,o,a,i=t,l=r(0),u=r(160),s=r(57),c=r(319);i.ShapeRoleSuggesterFactory=(n=function(){},l.defineClass({name:"ShapeRoleSuggesterFactory",ctor:n,statics:{Create:function(e){return void 0===e&&(e=""),"MLP"==e?new i.ShapeRoleSuggesterMLP:new i.ShapeRoleSuggesterSimple}}}),n),i.ShapeRoleSuggesterMLP=(o=function(){c.RoleSuggesterMLP.call(this)},l.defineClass({name:"ShapeRoleSuggesterMLP",ctor:o,superName:"RoleSuggesterMLP",statics:{_implements:function(e){return"RoleSuggesterProtocol"==e}},props:{getRoleModel:function(){var e=u.MLPModel.loadNNModel("ShapeRole");return l.opt(e,function(e){return e.finalSoftmax=!1}),e}}}),o),i.ShapeRoleSuggesterSimple=(a=function(){},l.defineClass({name:"ShapeRoleSuggesterSimple",ctor:a,statics:{_implements:function(e){return"RoleSuggesterProtocol"==e}},props:{getRole:function(e){var t=s.InferredRoleType.Undefined;return e.forma.isGridCell()&&(t=e.forma.controller.floating?s.InferredRoleType.Backing:s.InferredRoleType.Background),s.InferredRole.init_84d1(t,1)}}}),a)},506:function(e,t,r){var n,o=t,a=r(0),i=r(1),l=r(104),u=r(29),s=r(323),c=r(161),h=r(25),g=r(37),f=r(92),p=r(35),d=r(10);o.LogoPlacementSuggester=(n=function(e,t){this.CONTRAST_WEIGHT=-10,this.END_BORDER=.98,this.START_BORDER=.02,this.MID_CANONICAL=.5,this.MIN_LIGHTNESS_DIFF=20,this.SYMMETRIC_THRESHOLD=300,c.FormaPlacementSuggester.call(this,e,t)},a.defineClass({name:"LogoPlacementSuggester",ctor:n,superName:"FormaPlacementSuggester",statics:{KIND:{get:function(){return"LogoPlacementSuggester"}}},props:{createPlacementSuggestions:function(e,t){void 0===t&&(t=null);var r=this;if(null==this.group.frame)return[];var n=this.group.frame;if(this.group.kind==p.RootForma.KIND){var o=this.group.page.pageSize;n=d.TheoRect.fromSize(o);var i,u=0,m=this.group.root;if(null!=a.as(m.controller,f.RootController)){var v,S=a.clone(m.filterByControllerKind(h.GridController.KIND));S.length>0&&(v=a.as(S[0].controller,h.GridController))&&(u=v.margin)}(i=this.forma.finalFrame)&&u>0&&(u<i.height||u<i.width)&&(n=d.TheoRect.fromXYWH(u,u,o.width-2*u,o.height-2*u))}for(var F,I=c.FormaPlacementSuggester.createPlacementInputs(this.forma,this.group),_=a.clone(this.getSearchLocations(this.forma,n,I,e,t)),R=-1/0,C=this.initializeLogoPlacementScore(I),y=a.iter(_);!y.done;y.next()){for(var T=y.value,D=c.FormaPlacementSuggester.createPlacementSuggestion(this.forma,T,n,I,C),L=0,x=a.iter(I.backgroundRegions);!x.done;x.next()){var M=x.value;if(null!=T.intersectionWith(M.finalFrame)){var b=a.opt(this.forma.controller,function(e){return e.getAverageColor(r.forma.finalFrame)}),A=a.opt(M.controller,function(e){return e.getAverageColor(T)});if(null!=b&&null!=A&&!a.opt(A,function(e){return e.contrasts(b)})){var E=g.MathUtils.absDouble(this.MIN_LIGHTNESS_DIFF-a.opt(A,function(e){return e.lightnessDifference(b)}));L=g.MathUtils.maxDouble(L,E)}}}a.opt(D.weightedScore,function(e){return e.setFeature(s.FormaPlacementScore.Features.CONTRAST,a.toDouble(L))}),D.weightedScore.reject()||(C=this.initializeLogoPlacementScore(I)),D.score>R&&(R=D.score,F=D,C=this.initializeLogoPlacementScore(I))}return[a.as(F,l.DesignSuggestion)]},getSearchLocations:function(e,t,r,n,o){void 0===o&&(o=null),null!=o&&i.CoreAssert.warning("LogoPlacementSuggestor.getSearchLocations ignores requested aspect ratio");var l,u=[];if(l=e.finalFrame){var s=l.height,c=l.width,h=t.evalXY(this.END_BORDER,this.END_BORDER),g=new d.TheoRect(h.x-c,h.y-s,h.x,h.y),f=t.evalXY(this.END_BORDER,this.START_BORDER),p=new d.TheoRect(f.x-c,f.y,f.x,f.y+s);u.push(g),u.push(p);for(var m=a.iter(this.getContentAlignedLocations(t));!m.done;m.next()){var v=m.value;t.contains(v)&&u.push(v)}var S=t.evalXY(this.MID_CANONICAL,this.START_BORDER),F=new d.TheoRect(S.x-c/2,S.y,S.x+c/2,S.y+s),I=t.evalXY(this.START_BORDER,this.START_BORDER),_=new d.TheoRect(I.x,I.y,I.x+c,I.y+s),R=t.evalXY(this.START_BORDER,this.END_BORDER),C=new d.TheoRect(R.x,R.y-s,R.x+c,R.y),y=t.evalXY(this.MID_CANONICAL,this.END_BORDER),T=new d.TheoRect(y.x-c/2,y.y-s,y.x+c/2,y.y),D=this.getSymmetricContentLocations();D&&(u.push(T),u.push(C)),u.push(F),u.push(_),D||(u.push(C),u.push(T))}return u},initializeLogoPlacementScore:function(e){var t=new s.FormaPlacementScore(e);return t.setWeight(s.FormaPlacementScore.Features.XSYMM,0),t.setWeight(s.FormaPlacementScore.Features.YSYMM,0),t.setWeight(s.FormaPlacementScore.Features.EDGE,0),t.setWeight(s.FormaPlacementScore.Features.DISTANCE_TO_CENTER,0),t.setWeight(s.FormaPlacementScore.Features.ALIGNMENT,0),t.setWeight(s.FormaPlacementScore.Features.CONTRAST,a.toDouble(this.CONTRAST_WEIGHT)),t.setWeight(s.FormaPlacementScore.Features.TEXT_OVERLAP,-1e4),t.setWeight(s.FormaPlacementScore.Features.FLOATING_ELEMENT_OVERLAP,-5e3),t},getContentAlignedLocations:function(e){var t,r,n,o;if((t=a.as(this.forma,u.FrameForma))&&(r=t.root)&&(n=r.finalFrame)&&(o=this.forma.finalFrame)){var i=o.height,l=o.width,s=a.clone(r.filterWithCallback(function(e){return null!=e.controller&&e.controller.floating}));if(s.length>0){var c=a.sort(s,function(e,t){return e.finalFrame.maxY-n.minY<t.finalFrame.maxY-n.minY}),h=a.clone(c[c.length-1].finalFrame.points),g=a.clone(c[0].finalFrame.points),f=a.opt(r.finalFrame,function(e){return e.locate(h[1].x,h[1].y)}),p=e.evalXY(a.opt(f,function(e){return e.x}),a.opt(f,function(e){return e.y})+this.START_BORDER+.03),m=new d.TheoRect(p.x,p.y,p.x+l,p.y+i),v=a.opt(r.finalFrame,function(e){return e.locate(h[3].x,h[3].y)}),S=e.evalXY(a.opt(v,function(e){return e.x}),a.opt(v,function(e){return e.y})+this.START_BORDER+.03),F=new d.TheoRect(S.x-l,S.y,S.x,S.y+i),I=a.opt(r.finalFrame,function(e){return e.locate(g[0].x,g[0].y)}),_=e.evalXY(a.opt(I,function(e){return e.x}),a.opt(I,function(e){return e.y})-this.START_BORDER-.03);return[m,F,new d.TheoRect(_.x-l/2,_.y-i,_.x+l/2,_.y)]}}return[]},getSymmetricContentLocations:function(){var e,t,r,n=this;if((e=a.as(this.forma,u.FrameForma))&&(t=e.root)&&(r=t.finalFrame)){var o=a.clone(t.filterWithCallback(function(e){return null!=e.controller&&e.controller.floating}));return!(o.filter(function(e){return g.MathUtils.absDouble(r.center.distanceTo(e.finalFrame.center))<n.SYMMETRIC_THRESHOLD},this).length<=a.toInt(o.length/2))}return!1}}}),n)},511:function(e,t,r){var n,o,a=t,i=r(0),l=r(1),u=r(37),s=r(10),c=r(162);a.RetargetCompatibilityScore=(n=function(e,t,r){this.rejectThreshold=-500,c.WeightedScore.call(this,n.Features.NUM_FEAT),this.setFeature(n.Features.LENGTH_TEXT_DIFF,0),this.setFeature(n.Features.NUM_MOVEABLE_DIFF,0),this.setFeature(n.Features.NUM_IMAGE_DIFF,0),this.setFeature(n.Features.IMAGE_SIMILARITY,0),this.setFeature(n.Features.DESIGN_SIZE_DIFF,0),this.setFeature(n.Features.GRID_DESIGN,0),this.setFeature(n.Features.VISUAL_GROUP_DISSIMILARITY,0),this.setFeature(n.Features.LOCKUP_ROLE_DISSIMILARITY,0),this.setFeature(n.Features.SHAPE_ROLE_DISSIMILARITY,0),this.setFeature(n.Features.SALIENT_COVERAGE_DISSSIMILARITY,0),this.setFeature(n.Features.NUM_GRIDCELL_DIFF,0),this.setFeature(n.Features.NUM_SHAPE_DIFF,0),this.setFeature(n.Features.NUM_GIFS_DIFF,0),this.setWeight(n.Features.LENGTH_TEXT_DIFF,-100),this.setWeight(n.Features.FAKE_DESIGN,-100),this.setWeight(n.Features.NUM_IMAGE_DIFF,-1e4),this.setWeight(n.Features.IMAGE_SIMILARITY,-50),this.setWeight(n.Features.DESIGN_SIZE_DIFF,-1e4),this.setWeight(n.Features.GRID_DESIGN,50),this.setWeight(n.Features.VISUAL_GROUP_DISSIMILARITY,-1e3),this.setWeight(n.Features.LOCKUP_ROLE_DISSIMILARITY,-1e3),this.setWeight(n.Features.SHAPE_ROLE_DISSIMILARITY,-1e3),this.setWeight(n.Features.SALIENT_COVERAGE_DISSSIMILARITY,-100),this.setWeight(n.Features.NUM_GRIDCELL_DIFF,-1e3),this.setWeight(n.Features.NUM_SHAPE_DIFF,-1e3),this.setWeight(n.Features.NUM_GIFS_DIFF,-1e3),this.setFeatureName(n.Features.NUM_MOVEABLE_DIFF,"Moveable Count Difference"),this.setFeatureName(n.Features.FAKE_DESIGN,"Fake Design"),this.setFeatureName(n.Features.LENGTH_TEXT_DIFF,"Text Length Difference"),this.setFeatureName(n.Features.NUM_IMAGE_DIFF,"Image Count Difference"),this.setFeatureName(n.Features.IMAGE_SIMILARITY,"Image Similarity"),this.setFeatureName(n.Features.DESIGN_SIZE_DIFF,"Design Size Difference"),this.setFeatureName(n.Features.GRID_DESIGN,"Grid Design"),this.setFeatureName(n.Features.VISUAL_GROUP_DISSIMILARITY,"Visual Group Dissimilarity"),this.setFeatureName(n.Features.LOCKUP_ROLE_DISSIMILARITY,"Lockup Roles Dissimilarity"),this.setFeatureName(n.Features.SHAPE_ROLE_DISSIMILARITY,"Shape Roles Dissimilarity"),this.setFeatureName(n.Features.SALIENT_COVERAGE_DISSSIMILARITY,"Salient Coverage Dissimilarity"),this.setFeatureName(n.Features.NUM_GRIDCELL_DIFF,"Grid Cells Difference"),this.setFeatureName(n.Features.NUM_SHAPE_DIFF,"Shape Count Difference"),this.setFeatureName(n.Features.NUM_GIFS_DIFF,"Gifs Count Difference");var o=i.clone(t.edgeMap),a=i.clone(r.edgeMap);if(null!=a&&null!=o)if(o.length==a.length){for(var h=1e-5,g=i.iter(i.range(0,a.length,!1));!g.done;g.next())h+=a[d=g.value];for(var f=0,p=i.iter(i.range(0,o.length,!1));!p.done;p.next()){var d=p.value;f+=Math.abs(o[d]-a[d]/h)}isNaN(f)&&l.CoreAssert.fail("nan "),this.setFeature(n.Features.IMAGE_SIMILARITY,f)}else this.setFeature(n.Features.IMAGE_SIMILARITY,0);var m=i.toDouble(t.numMoveable-r.numMoveable),v=-2e3;function S(e,t){return e.length>t.length}m<0&&(v=-1e3),this.setWeight(n.Features.NUM_MOVEABLE_DIFF,v),this.setFeature(n.Features.NUM_MOVEABLE_DIFF,Math.abs(m));for(var F=i.sort(t.lockupStrings.concat(),S),I=i.sort(r.lockupStrings.concat(),S),_=(f=[],[]),R=i.iter(i.range(0,Math.min(F.length,I.length),!1));!R.done;R.next()){d=R.value;var C=i.toDouble(F[d].length),y=i.toDouble(I[d].length);f.push(C-y),_.push(Math.max(C,y))}function T(e){for(var t=0,r=i.iter(e);!r.done;r.next()){var n=r.value;t+=n*n}return Math.sqrt(t)}var D=T(i.clone(f))/(T(i.clone(_))+.001);this.setFeature(n.Features.LENGTH_TEXT_DIFF,D);for(var L=i.iter(r.lockupStrings);!L.done;L.next())L.value.toLowerCase().includes("lorem ipsum")&&this.setFeature(n.Features.FAKE_DESIGN,1);var x=i.toDouble(Math.abs(t.numImages-r.numImages));this.setFeature(n.Features.NUM_IMAGE_DIFF,x);var M=s.TheoRect.fromSize(r.size),b=s.TheoRect.fromSize(t.size).similarity(M);this.setFeature(n.Features.DESIGN_SIZE_DIFF,b),this.setFeature(n.Features.GRID_DESIGN,""==r.layoutID?0:1);var A=u.MathUtils.absDouble(t.salientCoverage-r.salientCoverage);this.setFeature(n.Features.SALIENT_COVERAGE_DISSSIMILARITY,A);var E=i.toDouble(Math.abs(t.numShapes-r.numShapes));this.setFeature(n.Features.NUM_SHAPE_DIFF,E);var G=i.toDouble(Math.abs(t.gifsCount-r.gifsCount));this.setFeature(n.Features.NUM_GIFS_DIFF,G);var k=this.scoreVisualGroups(i.clone(t.visualGroupInfo),i.clone(r.visualGroupInfo));this.setFeature(n.Features.VISUAL_GROUP_DISSIMILARITY,k);var N=i.toDouble(Math.abs(t.numGridCells-r.numGridCells));this.setFeature(n.Features.NUM_GRIDCELL_DIFF,N);var P=i.clone(t.textRoles),O=i.clone(r.textRoles),W=i.toDouble(this.roleDifference(i.clone(P),i.clone(O)));this.setFeature(n.Features.LOCKUP_ROLE_DISSIMILARITY,W);var w=i.clone(t.shapeRoles),H=i.clone(r.shapeRoles),U=i.toDouble(this.roleDifference(i.clone(w),i.clone(H)));this.setFeature(n.Features.LOCKUP_ROLE_DISSIMILARITY,U)},o={},i.defineClass({name:"RetargetCompatibilityScore",ctor:n,superName:"WeightedScore",statics:{Features:{get:function(){return void 0===o.Features&&(o.Features=i.defineEnum("Features",{NUM_MOVEABLE_DIFF:0,LENGTH_TEXT_DIFF:1,NUM_IMAGE_DIFF:2,IMAGE_SIMILARITY:3,DESIGN_SIZE_DIFF:4,FAKE_DESIGN:5,GRID_DESIGN:6,NUM_SHAPE_DIFF:7,NUM_GIFS_DIFF:8,VISUAL_GROUP_DISSIMILARITY:9,NUM_GRIDCELL_DIFF:10,LOCKUP_ROLE_DISSIMILARITY:11,SHAPE_ROLE_DISSIMILARITY:12,SALIENT_COVERAGE_DISSSIMILARITY:13,NUM_FEAT:14})),o.Features}}},props:{scoreVisualGroups:function(e,t){var r,n,o=0;if(null!=e.children&&null!=t.children&&(r=e.children)&&(n=t.children)){o+=u.MathUtils.absDouble(i.toDouble(r.length-n.length)),e.layoutStrategy!=t.layoutStrategy&&(o+=1);var a=this.computeAreaofGroups(i.clone(r)),l=this.computeAreaofGroups(i.clone(n));o+=u.MathUtils.absDouble(a-l)/Math.max(a,l);for(var s=[],c=i.iter(r);!c.done;c.next()){for(var h=c.value,g=1e5,f=0,p=i.iter(i.range(0,n.length,!1));!p.done;p.next()){var d=p.value,m=i.clone(n[d]);if(!s.includes(d)){var v=this.subTreeMisMatchScore(i.clone(h),i.clone(m));v<g&&(g=v,f=d)}}o+=g/i.toDouble(r.length),s.push(f)}}return o},computeAreaofGroups:function(e){for(var t=0,r=i.iter(e);!r.done;r.next()){var n,o=r.value;(n=s.TheoRect.decodeJson(o.frame))&&(t+=n.area)}return t},subTreeMisMatchScore:function(e,t){var r=this,n=0,o=i.clone(i.as(e.children,["Array",["Dictionary","String","AnyObject"]])),a=i.clone(i.as(t.children,["Array",["Dictionary","String","AnyObject"]]));if(null!=o&&null!=a){e.layoutStrategy!=t.layoutStrategy&&(n+=1);var l=i.clone(i.opt(o,function(e){return e.filter(function(e){return"Group"!=i.as(e.type,"String")},r)})),s=i.clone(i.opt(a,function(e){return e.filter(function(e){return"Group"!=i.as(e.type,"String")},r)})),c=i.clone(i.opt(l,function(e){return e.map(function(e){return e.role},r)})),h=i.clone(i.opt(s,function(e){return e.map(function(e){return e.role},r)}));n+=i.toDouble(this.roleDifference(i.clone(c),i.clone(h)));var g=i.clone(i.opt(o,function(e){return e.filter(function(e){return"Group"==i.as(e.type,"String")},r)})),f=i.clone(i.opt(a,function(e){return e.filter(function(e){return"Group"==i.as(e.type,"String")},r)}));if(g.length>0||f.length>0){var p=this.computeAreaofGroups(i.clone(g)),d=this.computeAreaofGroups(i.clone(f));n+=u.MathUtils.absDouble(p-d)/Math.max(p,d)}}return n},roleDifference:function(e,t,r){void 0===r&&(r=!0);var n=0,o=i.clone(e),a=i.clone(t);r||(o=i.clone(t),a=i.clone(e));for(var l=i.iter(o);!l.done;l.next()){var u=l.value;a.includes(u)||(n+=1)}return n},reject:function(){return this.score<this.rejectThreshold}}}),n)},513:function(e,t,r){var n,o,a=t,i=r(0),l=r(11),u=r(17),s=r(14),c=r(162);a.RetargetScore=(n=function(e,t,r,o,a){this.rejectThreshold=-1e3,this.root_=e,this.model_=t,this.correspondence_=i.clone(r),this.designRoles_=i.clone(o),this.modelRoles_=i.clone(a),c.WeightedScore.call(this,n.Features.NUM_FEAT),this.setWeight(n.Features.MIN_TEXT_SIZE,0),this.setWeight(n.Features.LENGTH_TEXT_DIFF,-30),this.setWeight(n.Features.WEIGHT_DIFF,0),this.setWeight(n.Features.RELATIVE_WEIGHT,-20),this.setWeight(n.Features.RELATIVE_LOCATION,-10),this.setWeight(n.Features.GROUP_SIZE_DIFF,-100),this.setWeight(n.Features.GROUP_COUNT_DIFF,-40),this.setWeight(n.Features.MISSING_TEXT,-5e3),this.setWeight(n.Features.TYPE_MISMATCH,-80),this.setWeight(n.Features.STYLE_MISMATCH,-80),this.setWeight(n.Features.ROLES_MISMATCH,-1e3),this.setFeatureName(n.Features.MIN_TEXT_SIZE,"Min Text Size"),this.setFeatureName(n.Features.LENGTH_TEXT_DIFF,"Text Length Difference"),this.setFeatureName(n.Features.WEIGHT_DIFF,"Weight Difference"),this.setFeatureName(n.Features.RELATIVE_WEIGHT,"Relative Weight"),this.setFeatureName(n.Features.RELATIVE_LOCATION,"Relative Location"),this.setFeatureName(n.Features.GROUP_SIZE_DIFF,"Group Size Diff"),this.setFeatureName(n.Features.GROUP_COUNT_DIFF,"Group Count Diff"),this.setFeatureName(n.Features.MISSING_TEXT,"Missing Text"),this.setFeatureName(n.Features.TYPE_MISMATCH,"Type Mismatch"),this.setFeatureName(n.Features.STYLE_MISMATCH,"Style Mismatch"),this.setFeatureName(n.Features.ROLES_MISMATCH,"Roles Mismatch"),this.setFeature(n.Features.MIN_TEXT_SIZE,0),this.setFeature(n.Features.LENGTH_TEXT_DIFF,0),this.setFeature(n.Features.WEIGHT_DIFF,0),this.setFeature(n.Features.RELATIVE_WEIGHT,0),this.setFeature(n.Features.RELATIVE_LOCATION,0),this.setFeature(n.Features.GROUP_SIZE_DIFF,0),this.setFeature(n.Features.GROUP_COUNT_DIFF,0),this.setFeature(n.Features.MISSING_TEXT,0),this.setFeature(n.Features.TYPE_MISMATCH,0),this.setFeature(n.Features.STYLE_MISMATCH,0),this.setFeature(n.Features.ROLES_MISMATCH,0),this.evaluateLayout()},o={},i.defineClass({name:"RetargetScore",ctor:n,superName:"WeightedScore",statics:{Features:{get:function(){return void 0===o.Features&&(o.Features=i.defineEnum("Features",{MIN_TEXT_SIZE:0,WEIGHT_DIFF:1,LENGTH_TEXT_DIFF:2,RELATIVE_WEIGHT:3,RELATIVE_LOCATION:4,MISSING_TEXT:5,GROUP_SIZE_DIFF:6,GROUP_COUNT_DIFF:7,TYPE_MISMATCH:8,STYLE_MISMATCH:9,ROLES_MISMATCH:10,NUM_FEAT:11})),o.Features}}},props:{evaluateLayout:function(){var e,t,r=this;this.setFeature(n.Features.MIN_TEXT_SIZE,0);for(var o=[],a={},c={},h=0,g=0,f=i.iter(this.correspondence_);!f.done;f.next()){var p=f.value;g+=i.toDouble(Math.abs(p.a.length-p.b.length));for(var d=0,m=0,v=i.iter(p.a);!v.done;v.next())d+=(F=v.value).frame.area/F.root.frame.area;for(var S=i.iter(p.b);!S.done;S.next()){var F;m+=(F=S.value).frame.area/F.root.frame.area}var I=d-m;h+=i.toDouble(I*I);for(var _=i.iter(i.range(0,Math.min(p.a.length,p.b.length),!1));!_.done;_.next()){var R=_.value,C=p.a[R],y=p.b[R];o.push({forma:C,placed:y}),a[C.formaID]={forma:C,length:0,size:(e=C.controller.currentHeightScale)||null!=e?e:C.finalFrame.height,center:C.frame.center},c[y.formaID]={forma:y,length:0,size:(t=y.controller.currentHeightScale)||null!=t?t:y.finalFrame.height,center:y.frame.center}}}this.setFeature(n.Features.GROUP_SIZE_DIFF,h),this.setFeature(n.Features.GROUP_COUNT_DIFF,g/i.toDouble(this.correspondence_.length));for(var T=0,D=0,L=0,x=0,M=0,b=0,A=this.root_.frame.area,E=i.iter(o);!E.done;E.next()){var G,k,N,P,O=E.value;if((O.forma.isTypeLockup()&&O.placed.isGraphic()||O.forma.isGraphic()&&O.placed.isTypeLockup())&&(x+=1,(G=i.as(O.placed.controller,s.TypeLockupController))&&(G.lockupStyle.backing==u.LockupBacking.None&&G.lockupStyle.textLook==u.LockupTextLook.Fill||null!=(k=G.averageLineHeight)&&(M+=k/100))),null!=(N=a[O.forma.formaID])&&null!=(P=c[O.placed.formaID])){T+=Math.abs(N.size-P.size)/A;for(var W=i.iter(o);!W.done;W.next()){var w,H,U=W.value;i.eq(l._equality_Forma_Forma,O.forma,U.forma)||i.eq(l._equality_Forma_Forma,O.placed,U.placed)||null!=(w=a[U.forma.formaID])&&null!=(H=c[U.placed.formaID])&&((N.size-w.size>5&&P.size-H.size<-5||N.size-w.size<-5&&P.size-H.size>5)&&i.opt(N.forma.controller,function(e){return e.kind==i.opt(w.forma.controller,function(e){return e.kind})})&&i.opt(P.forma.controller,function(e){return e.kind==i.opt(H.forma.controller,function(e){return e.kind})})&&(D+=1),(N.center.x-w.center.x>20&&P.center.x-H.center.x<-20||N.center.x-w.center.x<-20&&P.center.x-H.center.x>20)&&(L+=.5),(N.center.y-w.center.y>20&&P.center.y-H.center.y<-20||N.center.y-w.center.y<-20&&P.center.y-H.center.y>20)&&(L+=1))}}var Y=i.clone(this.designRoles_[O.forma.formaID]),B=i.clone(this.modelRoles_[O.placed.formaID]);null!=Y&&null!=B&&i.opt(Y,function(e){return e.role!=i.opt(B,function(e){return e.role})})&&(b+=1)}for(var X=i.iter(this.correspondence_);!X.done;X.next()){p=X.value;for(var V=i.clone(p.a),z=i.iter(i.range(0,V.length,!1));!z.done;z.next()){R=z.value;for(var K=i.iter(i.range(0,V.length,!1));!K.done;K.next()){var q=K.value;R>q&&V[R].frame.center.y>V[q].frame.center.y&&(L+=1)}}}this.setFeature(n.Features.WEIGHT_DIFF,T/i.toDouble(o.length)),this.setFeature(n.Features.RELATIVE_WEIGHT,D/i.toDouble(o.length)),this.setFeature(n.Features.RELATIVE_LOCATION,.5*L/i.toDouble(o.length)),this.setFeature(n.Features.TYPE_MISMATCH,x/i.toDouble(o.length)),this.setFeature(n.Features.STYLE_MISMATCH,M/i.toDouble(o.length)),this.setFeature(n.Features.ROLES_MISMATCH,b/i.toDouble(o.length));var j=0;this.model_.visit(l.FormaTraversal.PreOrder,function(e,t,n){var o;if(o=i.as(e.controller,s.TypeLockupController)){for(var a=!1,u=i.iter(r.correspondence_);!u.done;u.next())for(var c=u.value,h=i.iter(c.b);!h.done;h.next()){var g=h.value;i.eq(l._equality_Forma_Forma,e,g)&&(a=!0)}if(!a){var f=i.toDouble(o.text.length);j+=e.frame.area/f}}return!1}),this.setFeature(n.Features.MISSING_TEXT,j/this.root_.frame.area)},reject:function(){return this.score<this.rejectThreshold}}}),n)},514:function(e,t,r){var n,o=t,a=r(0),i=r(49),l=r(154),u=r(1),s=r(104),c=r(11),h=r(26),g=r(25),f=r(122),p=r(23),d=r(8),m=r(17),v=r(9),S=r(195),F=r(513),I=r(14),_=r(15);o.RetargetSuggestion=(n=function(e,t,r,n,o,i,l,u){void 0===i&&(i=!0),this.correspondence_=a.clone(o),this.modelDoc_=n,this.revert_=i?s.DesignSuggestion.init_3dd9(e,t):null;var c=new F.RetargetScore(t,r,a.clone(o),a.clone(l),a.clone(u));a.super_init(this,s.DesignSuggestion,s.DesignSuggestion.prototype.init_a4fb,e,r,c)},a.defineClass({name:"RetargetSuggestion",ctor:n,superName:"DesignSuggestion",props:{getGroupCorrespondences:function(){for(var e=this.forma_,t=[],r=a.iter(this.correspondence_);!r.done;r.next()){for(var n=r.value,o=[],i=a.iter(n.a);!i.done;i.next()){var l=i.value;e.visitAll(c.FormaTraversal.PreOrder,function(e){e.originalID==l.originalID&&o.push(e)})}t.push({a:o,b:n.b})}return t},getHeightScale:function(e,t){return a.opt(e.controller,function(e){return e.kind==a.opt(t.controller,function(e){return e.kind})})?a.opt(t.controller,function(e){return e.currentHeightScale}):a.opt(e.controller,function(e){return e.currentHeightScale})},matchGroups:function(e,t){if(0!=e.length&&0!=t.length){for(var r=e.length,n=t.length,o=null,i=[],l=[],s=a.iter(a.range(0,Math.min(n,r),!1));!s.done;s.next()){var c,h,g=s.value;null!=(c=this.getHeightScale(e[g],t[g]))&&l.push({forma:e[g],height:c}),e[g].match(t[g]),i.push(e[g]),(h=a.as(t[g].controller,I.TypeLockupController))&&(o=h.lockupStyle)}var f=[];if(r>n)for(var p=a.iter(a.range(n,r,!1));!p.done;p.next()){var d,v;if(g=p.value,(d=a.as(e[g].controller,I.TypeLockupController))&&(v=o)){var S=m.LockupStyle.createDefault();S.colors.match(v.colors),S.alignment=v.alignment,S.layout=v.layout,a.opt(d.forma,function(e){return e.applyStyle(S)})}f.push(e[g])}this.createAlignmentGroupForFormae(a.clone(t),a.clone(i),a.clone(f),a.clone(l))}else u.CoreAssert.fail("can't have an empty match")},createAlignmentGroupForFormae:function(e,t,r,n){for(var o=null,u=null,s=a.iter(a.range(0,e.length,!1));!s.done;s.next()){var h=e[w=s.value].controller.visualParentExpansionFrame;o=null==o?h:o.unionWith(h),u=null==u?e[w].frame:u.unionWith(e[w].frame)}var g,m=null,S=null,F=null;if(0==r.length&&(g=a.clone(f.GroupDetector.detectVerticalAlignmentGroups(a.clone(e)))).length>0){var R=g[0],C=(L=a.as(e[0].page.createFormaWithController(p.GroupForma.KIND,l.AlignmentGroupController.KIND),p.GroupForma)).controller;(x=e[0].root).appendChild(L),C.fit(o);var y=R.formae[0].parent;a.opt(C.alignmentGroupStyle,function(e){return e.numColumns=1}),C.setupWithFormae(a.clone(e),R.alignment),m=C.inferredSpacing,F=Math.max(0,o.maxY-u.maxY),S=Math.max(0,u.minY-o.minY),null!=m&&m<0&&(d.Host.logging.info("possible error in spacing: "+m+"\n"),m=null);for(var T=a.iter(L.visitAsArray(c.FormaTraversal.JustChildren));!T.done;T.next()){var D=T.value;a.opt(y,function(e){return e.appendChild(D,!0)})}L.removeFromParent(),C.dispose()}if(1==(g=a.clone(f.GroupDetector.detectVerticalAlignmentGroups(a.clone(t)))).length||r.length>0){var L,x;R=g[0],C=(L=a.as(this.forma_.page.createFormaWithController(p.GroupForma.KIND,l.AlignmentGroupController.KIND),p.GroupForma)).controller,(x=this.forma_).appendChild(L),y=R.formae[0].parent,C.fit(o);for(var M=a.iter(t);!M.done;M.next())1!=(k=M.value).placement.transformValues.rotCosine&&(k.placement=v.Matrix2D.Identity),C.addFormaToGroup(k);if(null!=C.alignmentGroupStyle)for(var b=a.iter(n);!b.done;b.next()){var A=b.value;C.alignmentGroupStyle.scales[A.forma.formaID]=A.height}C.setHorizontalAlignment(R.alignment),R.alignment==i.AlignmentType.Left?a.opt(C.alignmentGroupStyle,function(e){return e.marginLeft=u.minX-o.minX}):R.alignment==i.AlignmentType.Right&&a.opt(C.alignmentGroupStyle,function(e){return e.marginRight=o.maxX-u.maxX}),null!=m?a.opt(C.alignmentGroupStyle,function(e){return e.spacing=m}):r.length>0&&a.opt(C.alignmentGroupStyle,function(e){return e.spacing=o.height/15}),null!=S&&a.opt(C.alignmentGroupStyle,function(e){return e.marginTop=S}),null!=F&&a.opt(C.alignmentGroupStyle,function(e){return e.marginBottom=F}),0==r.length&&a.opt(C.alignmentGroupStyle,function(e){return e.numColumns=1}),null!=S&&null!=F&&Math.max(F,S)>o.height/10&&((S-F)/o.height>.2?a.opt(C.alignmentGroupStyle,function(e){return e.verticalAlignment=i.AlignmentType.Bottom}):(F-S)/o.height>.2&&a.opt(C.alignmentGroupStyle,function(e){return e.verticalAlignment=i.AlignmentType.Top}));for(var E=0,G=a.iter(r);!G.done;G.next()){var k;1!=(k=G.value).placement.transformValues.rotCosine&&(k.placement=v.Matrix2D.Identity);var N=!1;if(null!=C.alignmentGroupStyle)for(var P=a.iter(n);!P.done;P.next())A=P.value,a.opt(A.forma.controller,function(e){return e.kind==a.opt(k.controller,function(e){return e.kind})})&&(C.alignmentGroupStyle.scales[k.formaID]=A.height,N=!0);N||null==C.alignmentGroupStyle||(null!=a.as(k.controller,I.TypeLockupController)?C.alignmentGroupStyle.scales[k.formaID]=60:C.alignmentGroupStyle.scales[k.formaID]=x.frame.height/5),C.insertForma(k,t.length+E),E+=1}C.updateGroup();for(var O=a.iter(L.visitAsArray(c.FormaTraversal.JustChildren));!O.done;O.next())D=O.value,a.opt(y,function(e){return e.appendChild(D,!0)});a.opt(L,function(e){return e.removeFromParent()}),C.dispose()}for(var W=a.iter(a.range(0,e.length,!1));!W.done;W.next()){var w;if((w=W.value)<t.length){var H=e[w].placement.transformValues,U=t[w].frame.center;t[w].move(v.Matrix2D.rotation(H.rotCosine,H.rotSine)),t[w].movePinToPoint(new _.TheoPoint(.5,.5),U)}}},apply:function(){var e=this,t=this.forma_;null!=this.revert_&&this.revert_.apply();for(var r=a.clone(t.filterWithCallback(function(e){return a.opt(e.controller,function(e){return e.kind==l.AlignmentGroupController.KIND})})),n=a.iter(r);!n.done;n.next()){for(var o=n.value,i=a.clone(o.filterWithCallback(function(e){return null!=e.controller&&e.controller.floating},c.FormaTraversal.JustChildren)),u=a.iter(i);!u.done;u.next()){var s=u.value;a.opt(o.parent,function(e){return e.appendChild(s,!0)})}o.removeFromParent()}for(var h=[],g=[],f=[],p=a.iter(this.getGroupCorrespondences());!p.done;p.next()){var d=p.value;if(1==d.a.length&&1==d.b.length){var m,v,F=d.a[0],I=d.b[0];null!=(m=this.getHeightScale(F,I))&&h.push({forma:F,height:m}),(v=a.opt(I.controller,function(e){return e.getPin()}))&&(v.forma=F,g.push(v)),F.match(I),f.push({design:F,model:I})}else this.matchGroups(a.clone(d.a),a.clone(d.b))}for(var _=a.iter(h);!_.done;_.next()){var R=_.value;a.opt(R.forma.controller,function(e){return e.setHeightScale(R.height)})}a.opt(t.page.document,function(t){return t.content.root.setTag(S.RootContentNode.THEME_ID_TAG,e.modelDoc_.uuid)}),t.page.colorLibraryController.restoreUndoState(this.modelDoc_.firstPage.colorLibrary.encodeJson()),t.applyStyle(t.style),this.cleanupForma(t)},isLogoMatchedWithModelLogo:function(e){var t=this.newForma_;return a.clone(t.filterWithCallback(function(e){return e.isLogo()})).length>0&&this.correspondence_.filter(function(t){var r=t.a[0];return r.isLogo()&&r.originalID==e.originalID&&t.b[0].isLogo()},this).length>0},cleanupForma:function(e){for(var t=a.clone(e.filterWithCallback(function(e){return e.isTypeLockup()&&e.frame.area>1})),r=a.iter(t);!r.done;r.next()){var n,o=r.value;(x=a.as(o.controller,I.TypeLockupController))&&(x.snapSizeToBounds(),null!=(n=x.averageLineHeight)&&n<I.TypeLockupController.MIN_LINE_HEIGHT&&x.setHeightScale(I.TypeLockupController.MIN_LINE_HEIGHT))}for(var i=a.clone(e.filterWithCallback(function(e){return e.isLogo()})),l=a.iter(i);!l.done;l.next()){var u,s=l.value;(u=a.as(s.controller,h.FrameController))&&(this.isLogoMatchedWithModelLogo(s)||u.placeAsLogo())}if(e.visible&&!this.newForma.visible)for(var f=a.iter(t);!f.done;f.next()){var d,v;if(o=f.value,(x=a.as(o.controller,I.TypeLockupController))&&(d=a.opt(x.lockupStyle,function(e){return e.colors.fieldSecondary}))&&(v=a.opt(x.lockupStyle,function(e){return e.colors.fieldPrimary}))){for(var S=e.page.colorLibraryController,F=-1,_=null,R=a.iter(S.getColorThemeAsArrayOfTheoColors());!R.done;R.next()){var C;if((C=R.value)!=d&&C!=v){var y=C.rgbColor.distanceTo(v)+C.rgbColor.distanceTo(d);y>F&&(F=y,_=C)}}(C=_)&&a.opt(e.controller,function(e){return e.applyColors([C])})}}a.sortInPlace(t,function(e,t){var r=a.as(e,p.GroupForma),n=a.as(t,p.GroupForma),o=null!=r?r.childrenFinalFrame:null,i=null!=n?n.childrenFinalFrame:null;return null!=o&&null!=i&&o.area<i.area});for(var T=[],D=0,L=a.iter(t);!L.done;L.next()){var x,M,b;if(o=L.value,D+=1,(x=a.as(o.controller,I.TypeLockupController))&&x.lockupStyle&&(M=a.as(o,p.GroupForma))&&(b=M.childrenFinalFrame))for(var A=a.iter(a.range(0,D-1,!1));!A.done;A.next()){var E=A.value,G=t[E].controller;if(b.intersects(G.textFinalFrame)){T.push(t[E]);break}}}for(var k=a.clone(e.filterWithCallback(function(e){return e.hasIntent(c.Forma.INTENT_ICON)})),N=a.iter(k);!N.done;N.next()){var P=N.value;a.opt(P.controller,function(e){return e.contrastCheck(!1)})}for(var O=a.iter(T);!O.done;O.next())(w=(o=O.value).parent).removeChild(o),w.appendChild(o);for(var W=a.iter(t);!W.done;W.next()){G=(o=W.value).controller;var w=o.parent,H=G.lockupStyle.backing==m.LockupBacking.Knockout&&m.LockupStyle.isKnockoutLook(G.lockupStyle.textLook);if(null!=w&&H){var U=a.clone(w.filterWithCallback(function(e){return(e.isBackgroundImage()||e.isShape())&&null!=e.controller&&!e.controller.floating},c.FormaTraversal.JustChildren));w.insertChildAt(o,U.length)}}for(var Y=a.iter(e.filterByControllerKind(g.GridController.KIND));!Y.done;Y.next()){var B,X=Y.value;if(B=a.as(X.controller,g.GridController))for(var V=a.iter(B.gridStyle.gridCells);!V.done;V.next()){var z,K=V.value;if(null!=(z=K.colorID)&&null==e.page.colorLibrary.color(z)){var q=a.clone(e.page.colorLibraryController.unusedColorKeys(null,!0));q.length>0&&(K.colorID=q[0])}}}},dummy:function(e){}}}),n)},57:function(e,t,r){var n,o,a,i=t,l=r(0),u=r(1),s=r(4),c=r(26),h=r(8),g=r(432),f=r(433),p=r(318),d=r(434),m=r(200),v=r(54),S=r(249),F=r(452),I=r(14);i.RoleSuggesterProtocol=l.defineProtocol("RoleSuggesterProtocol",{getRole:"(RoleData) -> InferredRole"}),i.RoleSuggester=(n=function(){s.CoreObject.call(this)},o={},l.defineClass({name:"RoleSuggester",ctor:n,superName:"CoreObject",statics:{cache:{get:function(){var e;return void 0===o.cache&&(o.cache=((e=l.opt(h.Host.platform,function(e){return e.isService}))||null!=e)&&e?l.opt(h.Host.learning,function(e){return e.getHostPredictionCache()}):new m.PredictionCacheInferredRole),o.cache},set:function(e){o.cache=e}},ROLE_SHORT_LABELS:{Undefined:"udf",Title:"ttl",Subtitle:"stl",BodyText:"bdy",ContactInfo:"ctc",SocialMediaReference:"soc",Quote:"qot",CalltoAction:"act",GraphicContent:"gct",Seperator:"sep",Backing:"bkg",Background:"bgd",Decoration:"dec",Logo:"log"},getShortLabel:function(e){var t;return null!=(t=n.ROLE_SHORT_LABELS[e])?t:(u.CoreAssert.fail("didn't find role in short label dictionary!"),"???")}},props:{getRole:function(e){var t,r,o,a,u,s,m=null,_=null;if(l.as(e.controller,I.TypeLockupController)&&(r=p.LockupRoleData.getLockupRoleData(e))&&(m=r,_=d.LockupRoleSuggesterFactory.Create("MLP"),l.clone(_.getRole(r)).role==i.InferredRoleType.Undefined&&(_=d.LockupRoleSuggesterFactory.Create())),e.controller instanceof v.ShapeController&&(o=S.ShapeRoleData.getShapeRoleData(e))&&(m=o,_=e.isGridCell()?F.ShapeRoleSuggesterFactory.Create("Simple"):F.ShapeRoleSuggesterFactory.Create("MLP")),l.as(e.controller,c.FrameController)&&(a=g.ImageRoleData.getImageRoleData(e))&&(m=a,_=f.ImageRoleSuggesterFactory.Create("Simple")),(u=m)&&(s=_)){var R=u.getUniqueKey();return((t=l.opt(h.Host.platform,function(e){return e.isService}))||null!=t)&&t||n.cache.cleanup(e.page.document.uuid),null==n.cache.getCacheValue(R)&&n.cache.setCacheValue(R,l.clone(this.getRoleForData(u,s))),n.cache.getCacheValue(R)}return i.InferredRole.init_84d1()},getRoleForData:function(e,t){var r=l.clone(t.getRole(e));return u.CoreAssert.isTrue(null!=n.ROLE_SHORT_LABELS[r.role]),u.CoreAssert.isTrue(null!=n.ROLE_SHORT_LABELS[r.secondaryRole]),r}}}),n),i.InferredRoleType=l.defineEnum("InferredRoleType",{Undefined:"Undefined",Title:"Title",SubTitle:"Subtitle",Body:"BodyText",Contact:"ContactInfo",Social:"SocialMediaReference",Quote:"Quote",Action:"CalltoAction",GraphicContent:"GraphicContent",Seperator:"Seperator",Backing:"Backing",Background:"Background",Decoration:"Decoration",Logo:"Logo"}),i.InferredRole=(a=function(){},l.defineClass({name:"InferredRole",ctor:a,props:{init_84d1:function(e,t,r,n){void 0===e&&(e=i.InferredRoleType.Undefined),void 0===t&&(t=0),void 0===r&&(r=i.InferredRoleType.Undefined),void 0===n&&(n=0),this.role=e,this.confidence=t,this.secondaryRole=r,this.secondaryConfidence=n},init_implicit:function(e,t,r,n){this.role=e,this.confidence=t,this.secondaryRole=r,this.secondaryConfidence=n},clone:function(){return a.init_implicit(this.role,this.confidence,this.secondaryRole,this.secondaryConfidence)}}}),a)},656:function(e,t,r){r(0)},657:function(e,t,r){r(0)},658:function(e,t,r){r(0)},659:function(e,t,r){var n,o=t,a=r(0),i=r(4),l=r(93),u=r(29),s=r(21),c=r(511),h=r(512),g=r(10),f=r(28);o.RetargetCompatibilitySuggester=(n=function(){i.CoreObject.call(this)},a.defineClass({name:"RetargetCompatibilitySuggester",ctor:n,superName:"CoreObject",statics:{sortDocuments:function(e,t){for(var r=a.clone(n.scoreDocuments(e,a.clone(t))),o=[],i=a.iter(r);!i.done;i.next()){var l=i.value;o.push(l.data)}return o},scoreDocuments:function(e,t){for(var r=n.createRetargetDocumentData(e),o=(t.filter(function(e){return 0==e.numImages},this),a.clone(e.filterWithCallback(function(e){return e instanceof s.ImageForma&&e.parent instanceof u.FrameForma})),a.clone(r.lockupStrings)),i=r.numImages,l=[],h=a.iter(t);!h.done;h.next()){var g=h.value;a.isEmpty(g.layoutID);for(var f=(_=a.clone(g.lockupStrings)).length,p=!1,d=a.iter(l);!d.done;d.next()){var m=d.value;if(m.lockupStrings.length==f){for(var v=a.clone(m.lockupStrings),S=a.iter(a.range(0,f,!1));!S.done&&_[C=S.value]==v[C];S.next())C+1==f&&(p=!0);if(p)break}}p||g.numImages>1&&i!=g.numImages||o.length>3&&f<3||l.push(g)}for(var F=[],I=a.iter(l);!I.done;I.next()){var _;if(g=I.value,f=(_=a.clone(g.lockupStrings)).length,p=!1,o.length==f)for(var R=a.iter(a.range(0,f,!1));!R.done;R.next()){var C;if(_[C=R.value]!=o[C])break;C+1==f&&(p=!0)}if(!p){var y=new c.RetargetCompatibilityScore(e.frame,r,g);F.push({data:g,score:y})}}return a.sort(F,function(e,t){return e.score.score>t.score.score})},createRetargetDocumentData:function(e){var t=l.FeatureExtractorFactory.getFeatureExtractor(l.FeatureExtractorType.Retarget,e),r=a.clone(t.allFeatures_),n=a.as(r.Focus,"AnyObject"),o=n.length;return new h.RetargetDocumentExemplar("","","","","",f.TheoSize.decodeJson(a.as(r.Size,"AnyObject"))||f.TheoSize.Zero,2,2,"","",a.clone(r.LockupStrings),null!=n&&o>0?g.TheoRect.decodeJson(n):null,r.NumImages,a.clone(a.as(r.Edges,["Array","Double"])),r.LayoutId,r.NumGridsCells,r.NumMoveable,r.NumShapes,a.clone(r.VisualGroupInfo),a.clone(r.TextRoles),a.clone(r.ShapeRoles),r.SalientCoverage,r.GifsCount)}}}),n)},660:function(e,t,r){var n,o=t,a=r(0),i=r(49),l=r(137),u=r(198),s=r(11),c=r(29),h=r(25),g=r(43),f=r(122),p=r(21),d=r(17),m=r(514),v=r(57),S=r(14),F=r(10);o.RetargetSuggester=(n=function(e,t,r){r.controller.setAutomaticLayoutInteractionMode(),r.firstPage.root.isModel=!0,r.firstPage.root.bounds=F.TheoRect.fromSize(r.firstPage.pageSize),this.origModelSize_=r.firstPage.pageSize,this.model_=r.firstPage.root,n.cleanupRoot(this.model_),r.firstPage.setPageSize(e.page.pageSize),this.revertDesign_=!0,this.modelDoc_=r,this.originalRoot_=t,u.DesignSuggester.call(this,e,e)},a.defineClass({name:"RetargetSuggester",ctor:n,superName:"DesignSuggester",statics:{KIND:{get:function(){return"RetargetSuggester"}},cleanupRoot:function(e){for(var t=a.clone(e.filterWithCallback(function(e){return e.isTypeLockup()})),r=a.iter(t);!r.done;r.next()){var o,i,l=r.value;if((o=a.as(l.controller,S.TypeLockupController))&&(i=o.lockupStyle)&&(o.updateGroup(),o.snapSizeToBounds(),1==o.numLines()))for(var u=a.iter(t);!u.done;u.next()){var c=u.value;if(!a.eq(s._equality_Forma_Forma,l,c)){var h=a.as(c.controller,S.TypeLockupController);h.updateGroup();var g=h.numLines(),f=a.opt(h.lockupStyle,function(e){return e.alignment}),p=1==g||g>1&&(f==d.LockupAlignment.Center||f==d.LockupAlignment.UNSET),m=1==g||g>1&&f==d.LockupAlignment.Left,v=1==g||g>1&&f==d.LockupAlignment.Right;o.beginBlockedUpdate(),n.frameAligned(l,c,.5,null)&&p?(i.alignment=d.LockupAlignment.Center,i.layout=d.LockupLayout.Standard):n.frameAligned(l,c,0,null)&&m?(i.alignment=d.LockupAlignment.Left,i.layout=d.LockupLayout.Standard):n.frameAligned(l,c,1,null)&&v?(i.alignment=d.LockupAlignment.Right,i.layout=d.LockupLayout.Standard):(i.alignment=d.LockupAlignment.Center,i.layout=d.LockupLayout.Standard),o.endBlockedUpdate(),o.styleChanged()}}}},frameAligned:function(e,t,r,n){var o=e.frame,l=t.frame;if(null==o||null==l||null==r&&null==n)return!1;var u,s=1;(u=a.opt(e.page.view,function(e){return e.getViewportTransform()}))&&(s=Math.sqrt(Math.abs(u.determinant)));var c=i.AlignmentDetector.DISTANCE_THRESHOLD/s,h=!0;return null!=r&&(h=h&&Math.abs(o.evalXY(r,.5).x-l.evalXY(r,.5).x)<c),null!=n&&(h=h&&Math.abs(o.evalXY(.5,n).y-l.evalXY(.5,n).y)<c),h}},props:{revertDesign:{get:function(){return this.revertDesign_},set:function(e){this.revertDesign_=e}},model:{get:function(){return this.model_}},createFormaMatches:function(e,t){function r(e){return e.isTypeLockup()||e.hasIntent(s.Forma.INTENT_ICON)||e.kind==c.FrameForma.KIND&&e.controller.floating&&!e.isLogo()||e.kind==p.ImageForma.KIND&&e.parent.kind!=c.FrameForma.KIND}var n=a.clone(e.filterWithCallback(r)),o=a.clone(t.filterWithCallback(r)),i=a.clone(f.GroupDetector.detectProximityGroups(a.clone(n),null,!0)),l=a.clone(f.GroupDetector.detectProximityGroups(a.clone(o),e.bounds.height/this.origModelSize_.height*150,!0));l.length>i.length&&(i=a.clone(f.GroupDetector.splitFormaGroups(a.clone(i),l.length)));var g=a.clone(e.filterWithCallback(function(e){return a.opt(e.controller,function(e){return e.kind==h.GridController.KIND})},s.FormaTraversal.JustChildren)),d=a.clone(t.filterWithCallback(function(e){return a.opt(e.controller,function(e){return e.kind==h.GridController.KIND})},s.FormaTraversal.JustChildren)),m=a.clone(e.filterWithCallback(function(e){return e.isLogo()})),v=a.clone(t.filterWithCallback(function(e){return e.isLogo()}));a.sortInPlace(i,function(e,t){return e.length>t.length}),a.sortInPlace(l,function(e,t){return e.length>t.length}),a.sortInPlace(v,function(e,t){var r=e.root.finalFrame.center;return e.finalFrame.center.distanceTo(r)<t.finalFrame.center.distanceTo(r)});for(var S=n.length!=o.length||n.length>4,F=[],I=a.iter(u.DesignSuggester.getPermutations(S?l.length:o.length));!I.done;I.next()){var _=I.value,R=[];if(R.push({a:[a.as(e,s.Forma)],b:[a.as(t,s.Forma)]}),g.length>0&&d.length>0)for(var C=a.iter(a.range(0,g.length,!1));!C.done;C.next()){var y=C.value;R.push({a:[g[y]],b:[d[y%d.length]]})}if(v.length>0)for(var T=a.iter(a.range(0,m.length,!1));!T.done;T.next())y=T.value,R.push({a:[m[y]],b:[v[y%v.length]]});if(n.length>0&&o.length>0)if(S){for(var D=l.concat(),L=[],x=a.iter(a.range(0,D.length,!1));!x.done;x.next())L.push([]);for(var M=a.iter(a.range(0,i.length,!1));!M.done;M.next()){var b=M.value,A=a.clone(i[b]),E=_[b%_.length];a.append(L[E],A)}for(var G=a.iter(a.range(0,D.length,!1));!G.done;G.next())L[y=G.value].length>0&&R.push({a:L[y],b:D[y]})}else for(var k=a.iter(a.range(0,n.length,!1));!k.done;k.next())b=k.value,R.push({a:[n[b]],b:[o[_[b%_.length]]]});F.push(a.clone(R));for(var N=a.iter(a.range(0,R.length,!1));!N.done;N.next()){var P=R[y=N.value],O=Math.max(P.a.length,P.b.length);if(O>1)for(var W=P.a.length==O,w=a.clone(u.DesignSuggester.getPermutations(O,10)),H=a.iter(a.range(1,w.length,!1));!H.done;H.next()){var U=H.value,Y=a.clone(w[U]),B=R.concat(),X=a.clone(B[y].a),V=a.clone(B[y].b);if(W){X=[];for(var z=a.iter(a.range(0,O,!1));!z.done;z.next()){var K=z.value;X.push(B[y].a[Y[K]])}}else{V=[];for(var q=a.iter(a.range(0,O,!1));!q.done;q.next())K=q.value,V.push(B[y].b[Y[K]])}B[y]={a:X,b:V},F.push(a.clone(B))}}}return F},createSuggestions:function(){this.forma;for(var e=a.clone(this.createFormaMatches(this.originalRoot_,this.model)),t=a.clone(this.originalRoot_.filterWithCallback(l.DesignFeatureUtils.isFloating)),r=a.clone(this.model.filterWithCallback(l.DesignFeatureUtils.isFloating)),n={},o={},i=new v.RoleSuggester,u=this.model.filterWithCallback(function(e){return e.isTypeLockup()}).concat(this.originalRoot_.filterWithCallback(function(e){return e.isTypeLockup()})),s=a.iter(u);!s.done;s.next()){var c=s.value;a.opt(a.as(c.controller,g.GroupController),function(e){return e.beginBlockedUpdate()})}for(var h=a.iter(t);!h.done;h.next()){var f=h.value;n[f.formaID]=a.clone(i.getRole(f))}for(var p=a.iter(r);!p.done;p.next()){var d=p.value;o[d.formaID]=a.clone(i.getRole(d))}for(var S=[],F=a.iter(e);!F.done;F.next()){var I=F.value;S.push(new m.RetargetSuggestion(this.forma,this.originalRoot_,this.model,this.modelDoc_,a.clone(I),this.revertDesign_,a.clone(n),a.clone(o)))}for(var _=a.iter(u);!_.done;_.next())c=_.value,a.opt(a.as(c.controller,g.GroupController),function(e){return e.endBlockedUpdate()});return a.sort(S,function(e,t){return e.score>t.score})}}}),n)}}]);
//# sourceMappingURL=logomaker-entry_df547e74-aa1334ca.js.map