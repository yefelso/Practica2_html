(window.webpackJsonp=window.webpackJsonp||[]).push([[24],{104:function(e,t,r){var o,n,i,a=t,l=r(0),s=r(1),c=r(4),u=r(11),g=r(23),h=r(8),f=r(195),d=r(35),p=r(164),m=r(58),C=r(14);a.distanceColorWeight=1,a.distanceSizeWeight=.25,a.distancePositionWeight=.5,a.DesignTextSuggestion=(o=function(e,t){this.text_=t,l.super_init(this,a.DesignSuggestion,a.DesignSuggestion.prototype.init_a05b,e);var r=l.as(e.controller,C.TypeLockupController);s.CoreAssert.isTrue(null!=r,"must be type lockup controller")},l.defineClass({name:"DesignTextSuggestion",ctor:o,superName:"DesignSuggestion",props:{apply:function(){var e=this,t=l.as(this.forma.controller,C.TypeLockupController);l.opt(l.opt(t,function(e){return e.contentNode}),function(t){return t.text=e.text_}),l.opt(t,function(e){return e.updateGroup()}),l.opt(l.opt(this.forma_.page.document,function(e){return e.controller}),function(e){return e.controllerSettingsState.settings=null})}}}),o),a.AddFormaSuggestion=(n=function(e,t){this.parent_=t,l.super_init(this,a.DesignSuggestion,a.DesignSuggestion.prototype.init_a05b,e)},l.defineClass({name:"AddFormaSuggestion",ctor:n,superName:"DesignSuggestion",props:{apply:function(){this.parent_.appendChild(this.forma_)}}}),n),a.DesignSuggestion=(i=function(){},l.defineClass({name:"DesignSuggestion",ctor:i,superName:"CoreObject",statics:{distanceBetween:function(e,t){var r=0,o=e.root.frame.size.hypotenuse;return e.visit(u.FormaTraversal.PreOrder,function(e,n,i){return t.visitAll(u.FormaTraversal.PreOrder,function(t){if(e.originalID==t.originalID){var n,i=e.finalFrame,l=t.finalFrame;if(n=e.style.colors.fieldPrimary){var s=n.distanceTo(t.style.colors.fieldPrimary)/100;r+=a.distanceColorWeight*s}r+=a.distancePositionWeight*i.center.distanceTo(l.center)/o,r+=a.distanceSizeWeight*Math.abs(i.width-l.width)/o,r+=a.distanceSizeWeight*Math.abs(i.height-l.height)/o}}),!1}),r}},props:{init_a05b:function(e){this.forma_=e,e.page.animationController.playing&&e.page.animationController.revertToStaticState();var t=e.clone();this.newForma_=t,this.newFormaIsClone=!0,this.score_=null,this.themeID_=l.opt(e.page.document,function(e){return e.content.root.getTag(f.RootContentNode.THEME_ID_TAG)}),c.CoreObject.call(this),this.updateColorUndoState()},dispose:function(){this.newFormaIsClone&&this.newForma_.destroy()},init_3dd9:function(e,t){this.forma_=e,this.newForma_=t,this.newFormaIsClone=!1,this.score_=null,this.themeID_=l.opt(e.page.document,function(e){return e.content.root.getTag(f.RootContentNode.THEME_ID_TAG)}),c.CoreObject.call(this),this.updateColorUndoState()},init_a4fb:function(e,t,r){this.forma_=e,this.newForma_=t,this.newFormaIsClone=!1,this.score_=r,this.themeID_=l.opt(e.page.document,function(e){return e.content.root.getTag(f.RootContentNode.THEME_ID_TAG)}),c.CoreObject.call(this),this.updateColorUndoState()},forma:{get:function(){return this.forma_}},newForma:{get:function(){return this.newForma_}},weightedScore:{get:function(){return this.score_}},score:{get:function(){return l.opt(this.score_,function(e){return e.score})}},conformFormaTrees:function(e,t){var r;if(r=t.clone()){var o=l.clone(t.filterWithCallback(function(e){return!(e instanceof m.TextForma)}));this.conformNode(e,r,l.clone(o)),r.destroy()}},updateColorUndoState:function(){this.forma_.kind==d.RootForma.KIND&&(this.colorUndoState=this.forma.page.colorLibraryController.recordUndoState())},apply:function(){var e=this;null!=this.newForma_&&(null==l.as(this.forma_,g.GroupForma)||this.forma_.isTypeLockup()?this.forma_.match(this.newForma_):this.conformFormaTrees(this.forma_,this.newForma_),this.forma_.kind==d.RootForma.KIND&&(null!=this.colorUndoState&&this.forma.page.colorLibraryController.restoreUndoState(this.colorUndoState),null!=this.themeID_&&l.opt(this.forma_.page.document,function(t){return t.content.root.setTag(f.RootContentNode.THEME_ID_TAG,e.themeID_)}),p.TheoBrandkitUtils.unBrandDocumentIfNoBrandedElements(this.forma_.page.document)))},conformNode:function(e,t,r){if(e.match(t),!e.isTypeLockup()){for(var o=l.clone(e.visitAsArray(u.FormaTraversal.JustChildren)),n=l.clone(t.visitAsArray(u.FormaTraversal.JustChildren)),i=[],a=l.iter(o);!a.done;a.next())if(!(v=a.value).isGridCell()||!v.isShape()){for(var s=!1,c=l.iter(n);!c.done;c.next()){var f=c.value;f.originalID==v.originalID&&(this.conformNode(v,f,l.clone(r)),s=!0)}s&&!l.opt(l.as(v,g.GroupForma),function(e){return 0==e.childCount})||i.push(v)}for(var d=l.iter(i);!d.done;d.next())(v=d.value).parent.removeChild(v);var p=[];t.visit(u.FormaTraversal.JustChildren,function(t,r,o){return null==l.opt(l.as(e,g.GroupForma),function(e){return e.findChild(function(e){return t.originalID==e.originalID})})&&p.push([t,o]),!1});for(var m=l.iter(p);!m.done;m.next()){var C=m.value,v=C[0],S=C[1];if(!v.isGridCell()){var F=v.clone();l.opt(l.as(F,g.GroupForma),function(e){return e.removeAllChildren()}),e.insertChildAt(F,S),F.isModel=!1,this.conformNode(F,v,l.clone(r))}}t.visit(u.FormaTraversal.JustChildren,function(t,r,o){var n=null,i=null;if(e.visit(u.FormaTraversal.JustChildren,function(e,r,o){return t.originalID==e.originalID&&(n=o,i=e),!1}),null!=i){if(n!=o){l.opt(l.as(e,g.GroupForma),function(e){return e.removeChild(i)});var a=e;a.insertChildAt(i,Math.min(o,a.childCount))}}else h.Host.logging.error("conformNode error. didn't match child of type "+l.toString(l.opt(t.controller,function(e){return e.kind})));return!1}),e.postMatch(t)}},distanceTo:function(e){return i.distanceBetween(this.newForma_,e.newForma)}}}),i)},119:function(e,t,r){var o,n,i,a=t,l=r(0),s=r(1),c=r(243),u=r(11),g=r(25),h=r(89),f=r(17),d=r(37),p=r(57),m=r(54),C=r(14);a.ProfilingCategories=l.defineEnum("ProfilingCategories",{Title:0,Subtitle:1,Body:2,Action:3,GraphicContent:4,Backing:5,Background:6,Separator:7,Decoration:8,NUM_CATEGORIES:9}),a.ColorProfiles=(o=function(){this.PrimaryProfileMedians={},this.BackgroundProfileMedians={},this.PrimaryProfileMedians[a.ProfilingCategories.Title]=[.12545,.09302,.94901],this.PrimaryProfileMedians[a.ProfilingCategories.Subtitle]=[.077319,.04819,.94901],this.PrimaryProfileMedians[a.ProfilingCategories.Body]=[.044715,.12156,.94901],this.PrimaryProfileMedians[a.ProfilingCategories.Action]=[.06959,.04819,.97647],this.BackgroundProfileMedians[a.ProfilingCategories.Title]=[.12581,.20392,.94901],this.BackgroundProfileMedians[a.ProfilingCategories.Subtitle]=[.079709,.44815,.94313],this.BackgroundProfileMedians[a.ProfilingCategories.Body]=[.07142,.20129,.96274],this.BackgroundProfileMedians[a.ProfilingCategories.Action]=[.5,.46886,.89803],this.PrimaryProfileMedians[a.ProfilingCategories.GraphicContent]=[.5,.6,1],this.PrimaryProfileMedians[a.ProfilingCategories.Backing]=[.5,.3,1],this.PrimaryProfileMedians[a.ProfilingCategories.Background]=[.5,.3,1],this.PrimaryProfileMedians[a.ProfilingCategories.Separator]=[.5,.3,1],this.PrimaryProfileMedians[a.ProfilingCategories.Decoration]=[.5,.6,1]},l.defineClass({name:"ColorProfiles",ctor:o}),o),a.ProfilingColorMap=(n=function(){this.colorSet=[];for(var e=l.iter(this.profilingCatgoriesCases());!e.done;e.next()){var t=e.value;null==n.currentPrimaryIndices[t]&&(n.currentPrimaryIndices[t]=0),null==n.currentBackgroundIndices[t]&&(n.currentBackgroundIndices[t]=0)}},i={},l.defineClass({name:"ProfilingColorMap",ctor:n,statics:{PrimaryMap:{},BackgroundMap:{},currentPrimaryIndices:{},currentBackgroundIndices:{},paletteMappingDictionary:{},paletteMappingSelection:{},currentDocumentID:"",backingColorKey:"_Backing",lockupMSLPrimaryColorKey:"_MSLPrimary",lockupMSLBackingColorKey:"_MSLBacking",noKeyFound:"noKeyFound",textCategories:{get:function(){return void 0===i.textCategories&&(i.textCategories=[a.ProfilingCategories.Title,a.ProfilingCategories.Subtitle,a.ProfilingCategories.Body,a.ProfilingCategories.Action]),i.textCategories}},shapeCategories:{get:function(){return void 0===i.shapeCategories&&(i.shapeCategories=[a.ProfilingCategories.GraphicContent,a.ProfilingCategories.Backing,a.ProfilingCategories.Background,a.ProfilingCategories.Separator,a.ProfilingCategories.Decoration]),i.shapeCategories}}},props:{updateRoleProfilingColorMap:function(e){var t;(t=e.document)&&(n.currentDocumentID=t.uuid),this.colorSet=e.colorLibraryController.getThemeColorKeys().concat(e.colorLibraryController.getProfilingColorKeys()),(new n).eraseCurrentPaletteMappingSelection(),n.PrimaryMap={},n.BackgroundMap={};for(var r=new a.ColorProfiles,o=l.iter(this.profilingCatgoriesCases());!o.done;o.next()){var i=o.value;if(null!=r.PrimaryProfileMedians[i]){var s=this.colorSet.length;n.PrimaryMap[i]=l.clone(this.selectRoleProfilingColors(e,i,!1,!0,s))}}for(var c=l.iter(this.profilingCatgoriesCases());!c.done;c.next())i=c.value,null!=r.BackgroundProfileMedians[i]&&(s=this.colorSet.length,n.BackgroundMap[i]=l.clone(this.selectRoleProfilingColors(e,i,!0,!0,s)))},updateIfCurrentDocumentHasChanged:function(e){var t;(t=e.document)&&n.currentDocumentID!=t.uuid&&this.updateRoleProfilingColorMap(e)},updateCurrentColorIndices:function(){for(var e=l.iter(this.profilingCatgoriesCases());!e.done;e.next()){var t=e.value;if(i=n.PrimaryMap[t]){var r=d.CoreRandom.nextIntUniform(i.length);n.currentPrimaryIndices[t]=r}}for(var o=l.iter(this.profilingCatgoriesCases());!o.done;o.next()){var i;if(t=o.value,(i=n.BackgroundMap[t])&&i.length>0){var a=null==n.currentBackgroundIndices[t]?-1:n.currentBackgroundIndices[t];n.currentBackgroundIndices[t]=(a+1)%i.length}}},checkIfMappingIsEmpty:function(){return null==n.PrimaryMap[a.ProfilingCategories.Title]},checkIfTwoFormaAreInSamePaletteMappingGroup:function(e,t){for(var r=!1,o=l.iter(l.keys(n.paletteMappingDictionary));!o.done;o.next()){var i=o.value;n.paletteMappingDictionary[i].includes(e)&&n.paletteMappingDictionary[i].includes(t)&&(r=!0)}return r},getMappingKeyForFormaID:function(e){for(var t=n.noKeyFound,r=l.iter(l.keys(n.paletteMappingDictionary));!r.done;r.next()){var o=r.value;n.paletteMappingDictionary[o].includes(e)&&(t=o)}return t},overridePaletteMappingDueToContrast:function(e,t){var r,o=this.getMappingKeyForFormaID(t),i=e;return o!=n.noKeyFound&&(null!=(r=n.paletteMappingSelection[o])?i=r:n.paletteMappingSelection[o]=e),i},overridePaletteMappingDueToContrastAndForceDifference:function(e,t,r,o){var i=this.getMappingKeyForFormaID(t),a=e;if(i!=n.noKeyFound)if(null!=(u=n.paletteMappingSelection[i]))a=u;else{if(this.checkIfColorAlreadyAssignedToPaletteMapping(a))for(var s=l.iter(l.range(0,r.length,!1));!s.done;s.next()){var u,g=s.value;if(null!=(u=c.ColorSelectorUtils.getContrastingChoice(!1,[r[g]],[o[g]]))&&!this.checkIfColorAlreadyAssignedToPaletteMapping(u)){a=u;break}}n.paletteMappingSelection[i]=a}return a},checkIfColorAlreadyAssignedToPaletteMapping:function(e){for(var t=!1,r=l.iter(l.keys(n.paletteMappingSelection));!r.done;r.next()){var o=r.value;n.paletteMappingSelection[o]==e&&(t=!0)}return t},eraseCurrentPaletteMappingSelection:function(){n.paletteMappingSelection={}},eraseCurrentPaletteMappingDictionary:function(){n.paletteMappingDictionary={}},setPaletteMappingForFormaWithSameRGBColor:function(e){var t,r=this;if(this.eraseCurrentPaletteMappingDictionary(),t=e.root.controller){var o=l.clone(t.getCurrentColors(e.root.style));o.length>0&&this.updateMappingDictionary(o[0].rgbString,e.root.formaID)}e.root.visitAll(u.FormaTraversal.PreOrder,function(e){var t,o,i,a,s,c,u=e.formaID;if((a=l.as(e.controller,C.TypeLockupController))&&((s=e.style.colors.fieldPrimary)&&r.updateMappingDictionary(s.rgbString,u),(c=e.style.colors.fieldSecondary)&&null!=(t=l.opt(l.as(e.style,f.LockupStyle),function(e){return e.backing}))&&t!=f.LockupBacking.None&&r.updateMappingDictionary(c.rgbString,u+n.backingColorKey),(o=a.getCurrentMSLPrimaryColor())&&r.updateMappingDictionary(o.rgbString,u+n.lockupMSLPrimaryColorKey),(i=a.getCurrentMSLBackingColor())&&r.updateMappingDictionary(i.rgbString,u+n.lockupMSLBackingColorKey)),l.as(e.controller,m.ShapeController)&&(s=e.style.colors.fieldPrimary)&&r.updateMappingDictionary(s.rgbString,u),a=l.as(e.controller,g.GridController))for(var d=l.clone(a.getCellIdsGroupedByColor()),p=l.iter(l.keys(d));!p.done;p.next())for(var v=p.value,S=l.iter(d[v]);!S.done;S.next())u=S.value,r.updateMappingDictionary(v,u);l.as(e.controller,h.ImageController)&&null!=e.style.filter&&((s=e.style.colors.fieldPrimary)&&r.updateMappingDictionary(s.rgbString,u),(c=e.style.colors.fieldSecondary)&&r.updateMappingDictionary(c.rgbString,u+n.backingColorKey))})},getNumPaletteMappingGroups:function(){return l.keys(n.paletteMappingDictionary).length},getCurrentPaletteMapping:function(){return l.clone(n.paletteMappingDictionary)},updateMappingDictionary:function(e,t){for(var r=!1,o=l.iter(l.keys(n.paletteMappingDictionary));!o.done;o.next()){var i=o.value;c.ColorSelectorUtils.compareTwoColorStringsWithMargin(i,e)&&(n.paletteMappingDictionary[i].includes(t)||n.paletteMappingDictionary[i].push(t),r=!0)}r||(n.paletteMappingDictionary[e]=[t])},getPrimaryColorsForRoleGlobal:function(e,t,r){var o,i,a=[];if(this.updateIfCurrentDocumentHasChanged(r),(o=n.PrimaryMap[e])&&null!=(i=n.currentPrimaryIndices[e]))if(i<o.length){for(var s=l.iter(l.range(i,o.length,!1));!s.done;s.next()){var c=s.value;a.push(o[c])}for(var u=l.iter(l.range(0,i,!1));!u.done;u.next())c=u.value,a.push(o[c])}else a=l.clone(o);return a},getBackgroundColorsForRoleGlobal:function(e,t,r){var o,i,a=[];if(this.updateIfCurrentDocumentHasChanged(r),(o=n.BackgroundMap[e])&&null!=(i=n.currentBackgroundIndices[e]))if(i<o.length){for(var s=l.iter(l.range(i,o.length,!1));!s.done;s.next()){var c=s.value;a.push(o[c])}for(var u=l.iter(l.range(0,i,!1));!u.done;u.next())c=u.value,a.push(o[c])}else a=l.clone(o);return a},getPrimaryColorsForRoleIndividual:function(e,t,r){return this.colorSet=e.colorLibraryController.getThemeColorKeys().concat(e.colorLibraryController.getProfilingColorKeys()),this.selectRoleProfilingColors(e,t,!1,!1,r)},getBackgroundColorsForRoleIndividual:function(e,t,r){return this.colorSet=e.colorLibraryController.getThemeColorKeys().concat(e.colorLibraryController.getProfilingColorKeys()),this.selectRoleProfilingColors(e,t,!0,!1,r)},getProfilingCategoryForInferredRole:function(e){var t=a.ProfilingCategories.Body;return e.role==p.InferredRoleType.Title||e.role==p.InferredRoleType.Quote?t=a.ProfilingCategories.Title:e.role==p.InferredRoleType.SubTitle?t=a.ProfilingCategories.Subtitle:e.role==p.InferredRoleType.Social||e.role==p.InferredRoleType.Action?t=a.ProfilingCategories.Action:e.role==p.InferredRoleType.Body?t=a.ProfilingCategories.Body:e.role==p.InferredRoleType.Contact?t=a.ProfilingCategories.Body:e.role==p.InferredRoleType.GraphicContent||e.role==p.InferredRoleType.Logo?t=a.ProfilingCategories.GraphicContent:e.role==p.InferredRoleType.Seperator?t=a.ProfilingCategories.Separator:e.role==p.InferredRoleType.Backing?t=a.ProfilingCategories.Backing:e.role==p.InferredRoleType.Background?t=a.ProfilingCategories.Background:e.role==p.InferredRoleType.Decoration?t=a.ProfilingCategories.Decoration:s.CoreAssert.fail("role not supported"),t},countColorUsage:function(e,t){for(var r=0,o=[n.PrimaryMap,n.BackgroundMap],i=l.clone(this.profilingCatgoriesCases()),a=l.iter(o);!a.done;a.next())for(var s=a.value,c=l.iter(i);!c.done;c.next()){var u,g=c.value;if(this.anyCategoryOverlap(t,g)&&(u=s[g]))for(var h=l.iter(u);!h.done;h.next())h.value==e&&(r+=1)}return r},anyCategoryOverlap:function(e,t){return!(!n.textCategories.includes(e)||!n.textCategories.includes(t))||!(!n.shapeCategories.includes(e)||!n.shapeCategories.includes(t))},selectRoleProfilingColors:function(e,t,r,o,n){void 0===n&&(n=2);var i=[],c=new a.ColorProfiles,u=[];if(r&&null==c.BackgroundProfileMedians[t]||!r&&null==c.PrimaryProfileMedians[t])return s.CoreAssert.fail("category not supported in selectRoleProfilingColors"),[];for(var g=l.iter(this.colorSet);!g.done;g.next()){var h,f=g.value;if(h=e.colorLibraryController.getSolidColorForKey(f)){var d=0,p=0;r?d=this.getColorHSBDistance(h,l.clone(c.BackgroundProfileMedians[t])):(d=this.getColorHSBDistance(h,l.clone(c.PrimaryProfileMedians[t])),p=(o?1e3:0)*l.toDouble(this.countColorUsage(f,t))),i.push(d+p)}}for(var m=l.iter(l.range(0,n,!1));!m.done;m.next()){var C=l.min(i);if(null!=C){var v=l.indexOf(i,C);u.push(this.colorSet[v]),i[v]+=1e3}}return u},profilingCatgoriesCases:function(){for(var e=[],t=a.ProfilingCategories.NUM_CATEGORIES,r=l.iter(l.range(0,t,!1));!r.done;r.next()){var o=r.value;e.push(a.ProfilingCategories.toCaseValue(o))}return e},getColorHSBDistance:function(e,t){var r=[e.asHSB.h,e.asHSB.s,e.asHSB.b],o=Math.min(Math.abs(r[0]-t[0]),360-Math.abs(r[0]-t[0]));o/=180;var n=Math.abs(r[1]-t[1]),i=Math.abs(r[2]-t[2])/255;return Math.sqrt(o*o+n*n+i*i)}}}),n)},161:function(e,t,r){var o,n=t,i=r(0),a=r(198),l=r(104),s=r(11),c=r(29),u=r(438),g=r(323),h=r(439),f=r(25),d=r(37),p=r(35),m=r(58),C=r(10),v=r(28);n.FormaPlacementSuggester=(o=function(e,t){a.DesignSuggester.call(this,e,t),this.maxSuggestions=3},i.defineClass({name:"FormaPlacementSuggester",ctor:o,superName:"DesignSuggester",statics:{KIND:{get:function(){return"FormaPlacementSuggester"}},createPlacementInputs:function(e,t){var r=[],o=[],n=[],a=[],l=[],g=[];return t.visitAll(s.FormaTraversal.PreOrder,function(t){i.eq(s._equality_Forma_Forma,e,t)||t instanceof m.TextForma||((t.isBackgroundImage()||f.GridController.isBackgroundColoredCell(t))&&g.push(t),t instanceof c.FrameForma&&(o.push(t.finalFrame),l.push(t),e.originalID!=t.originalID&&a.push(t.finalFrame)),t.isTypeLockup()&&(r.push(t.finalFrame),e.originalID!=t.originalID&&a.push(t.finalFrame)),null!=t.controller&&t.controller.floating&&e.originalID!=t.originalID&&(n.push(t.finalFrame),a.push(t.finalFrame)))}),new u.FormaPlacementInput(e,i.clone(a),i.clone(n),i.clone(r),i.clone(o),i.clone(l),i.clone(g))},createPlacementSuggestion:function(e,t,r,o,n){for(var a=0,l=0,s=0,c=i.iter(i.range(0,o.imageRects.length,!1));!c.done;c.next()){var u=c.value,f=o.imageRects[u];if(null!=(L=t.intersectionWith(f))&&L.area==t.area&&f.area>t.area){var p=o.images[u];a=d.MathUtils.maxDouble(a,p.controller.getAverageEdge(t)),l=d.MathUtils.maxDouble(l,p.controller.getFaceIntersections(t))}else null!=L&&(s+=L.area)}for(var m=r,C=0,v=i.iter(o.backgroundRegions);!v.done;v.next()){var S=v.value;(L=t.intersectionWith(S.finalFrame))&&(Math.abs(L.area-t.area)>100?C+=1:m=S.finalFrame)}n.setFeature(g.FormaPlacementScore.Features.REGION_BOUNDARY_OVERLAP,i.toDouble(C)),n.setFeature(g.FormaPlacementScore.Features.DISTANCE_TO_CENTER,t.center.distanceTo(r.center)/Math.max(r.width,r.height)),n.setFeature(g.FormaPlacementScore.Features.FACE,l),n.setFeature(g.FormaPlacementScore.Features.EDGE,a),n.setFeature(g.FormaPlacementScore.Features.IMAGE_EDGE_OVERLAP,s/r.area),n.setFeature(g.FormaPlacementScore.Features.SIZE,t.area/r.area);var F=1-Math.abs(t.width/r.width-2*t.height/r.height);n.setFeature(g.FormaPlacementScore.Features.ASPECT_RATIO,F);var y=t.minX-m.minX,P=m.maxX-t.maxX,M=1-Math.abs(y-P)/m.width;M<.98&&(M=0),n.setFeature(g.FormaPlacementScore.Features.XSYMM,M);var I=t.minY-m.minY,T=m.maxY-t.maxY,D=1-Math.abs(I-T)/m.height;D<.98&&(D=0),n.setFeature(g.FormaPlacementScore.Features.YSYMM,D);for(var _=0,R=i.iter(o.textRects);!R.done;R.next()){var x=R.value;Math.abs(x.center.x-t.center.x)<3&&(_+=1),Math.abs(x.minY-t.minY)<3?_+=.25:Math.abs(x.center.y-t.center.y)<3&&(_+=.1)}n.setFeature(g.FormaPlacementScore.Features.ALIGNMENT,_);for(var b=0,k=i.iter(o.textRects);!k.done;k.next()){var E=k.value;null!=(L=t.intersectionWith(E))&&(b+=L.area)}n.setFeature(g.FormaPlacementScore.Features.TEXT_OVERLAP,b/r.area);for(var A=0,N=i.iter(o.floatingRects);!N.done;N.next()){var L,w=N.value;null!=(L=t.intersectionWith(w))&&(A+=L.area)}return n.setFeature(g.FormaPlacementScore.Features.FLOATING_ELEMENT_OVERLAP,A/r.area),new h.FormaPlacementSuggestion(e,t,n)}},props:{createSuggestions:function(){return this.createPlacementSuggestions(!0)},createPlacementSuggestions:function(e,t){if(void 0===t&&(t=null),null==this.group.frame)return[];var r=this.group.frame;this.group.kind==p.RootForma.KIND&&(r=C.TheoRect.fromSize(this.group.page.pageSize));var n=o.createPlacementInputs(this.forma,this.group),a=i.clone(this.getSearchLocations(this.forma,r,n,e,t));0==a.length&&a.push(r);for(var s,c=-1/0,u=new g.FormaPlacementScore(n),h=[],f=i.iter(a);!f.done;f.next()){var m=f.value,v=o.createPlacementSuggestion(this.forma,m,r,n,u);v.weightedScore.reject()||(h.push(v),u=new g.FormaPlacementScore(n)),v.score>c&&(c=v.score,s=v,u=new g.FormaPlacementScore(n))}if(e)return o.createPlacementSuggestion(this.forma,s.location,r,n,u),[i.as(s,l.DesignSuggestion)];var S=[];S.push(s),i.sortInPlace(h,function(e,t){return e.score>t.score});for(var F=h.length,y=0,P=i.iter(i.range(0,this.maxSuggestions,!1));!P.done;P.next()){var M=null;for(y+=1;y<F;){for(var I=9999,T=i.iter(i.range(0,S.length,!1));!T.done;T.next()){var D=T.value;I=d.MathUtils.minDouble(I,h[y].distanceTo(S[D]))}if(I>.1){M=h[y];break}y+=1}if(null==M)break;S.push(M)}return S=i.clone(S.slice(1,S.length)),i.sortInPlace(S,function(e,t){return e.location.center.x<t.location.center.x}),i.info("finished suggester"),[i.as(s,l.DesignSuggestion)].concat(S)},fastPlacement:function(){var e=i.clone(this.createPlacementSuggestions(!0));return e.length>0?e[0]:null},getSearchLocations:function(e,t,r,o,n){void 0===n&&(n=null);var a=[],l=[],s=[],c=[],u=C.TheoRect.fromXXYY(d.MathUtils.minDouble(t.width/4,200),t.width-10,d.MathUtils.minDouble(t.height/4,100),t.height-10);o&&(u=C.TheoRect.fromXXYY(d.MathUtils.minDouble(t.width/4,200),t.width-10,d.MathUtils.minDouble(t.height/4,100),t.height-10));var g=t.area/10,h=t.area/5,f=u.minX,p=u.maxX,m=u.minY,S=u.maxY,F=t.width/20,y=t.height/20,P=o?5:8;null!=n&&(P*=P);var M=u.width/P,I=u.height/P;o&&(F=d.MathUtils.maxDouble(t.width/20,30),y=d.MathUtils.maxDouble(t.height/20,30)),l.push((t.minX+t.maxX)/2),s.push((t.minY+t.maxY)/2);for(var T=i.iter(r.otherRects.concat(r.backgroundRegions.map(function(e){return e.finalFrame},this)));!T.done;T.next()){var D=T.value;l.push(D.center.x),s.push(D.center.y),s.push(D.minY)}for(var _=t.minX+5;_<t.maxX-5;)l.push(_),_+=F;for(var R=t.minY+5;R<t.maxY-5;)s.push(R),R+=y;var x=f;if(null==n)for(;x<p;){for(var b=m;b<S;)x*b>=g&&x*b<=h&&c.push(new v.TheoSize(x,b)),b+=I;x+=M}else{for(var k,E=0;x<p;){var A=x*(b=x/n);if(A>=g&&A<=h)c.push(new v.TheoSize(x,b));else if(0==c.length){var N=A<g?A/g:h/A;N>E&&(E=N,k=new v.TheoSize(x,b))}x+=M}0==c.length&&null!=k&&c.push(k)}for(var L=i.iter(l);!L.done;L.next())for(var w=L.value,O=i.iter(s);!O.done;O.next())for(var B=O.value,G=i.iter(c);!G.done;G.next()){var U=G.value;if(x=U.width,b=U.height,_=w-U.width/2,R=B-U.height/2,!(_+x>=t.maxX-5||R+b>=t.maxY-5||_<=t.minX+5||R<=t.minY+5||x/b<.5)){var W=C.TheoRect.fromXYWH(_,R,x,b);a.push(W)}}return a}}}),o)},162:function(e,t,r){var o,n,i=t,a=r(0),l=r(1),s=r(4),c=r(324);i.ScoreComponent=(o=function(e,t,r,o){this.std=1,this.mean=0,this.feature=e,this.weight=t,this.functionParam=r,this.featureName=o},a.defineClass({name:"ScoreComponent",ctor:o,props:{normalFeature:{get:function(){return(this.feature-this.mean)/this.std}}}}),o),i.applyFieldWidth=function(e,t){var r=e.length;return r>=t?e:a.toString(" ",t-r)+e},i.WeightedScore=(n=function(e){this.initScore=-1*a.toDouble(a.MAXFLOAT),this.components_=[],this.score_=0,this.recalculateScore_=!0,this.versionNumber=1;for(var t=a.iter(a.range(0,e,!1));!t.done;t.next())this.components_.push(new i.ScoreComponent(0,1,1e-5,"Feature"));s.CoreObject.call(this)},a.defineClass({name:"WeightedScore",ctor:n,superName:"CoreObject",props:{setFeature:function(e,t){this.recalculateScore_=!0,this.components_[e].feature=t},setStd:function(e,t){t>0&&(this.recalculateScore_=!0,this.components_[e].std=t)},setMean:function(e,t){this.recalculateScore_=!0,this.components_[e].mean=t},getFeatureValue:function(e){return this.components_[e].feature},setWeight:function(e,t){this.recalculateScore_=!0,this.components_[e].weight=t},getWeights:function(){for(var e=[],t=a.iter(this.components_);!t.done;t.next()){var r=t.value;e.push(r.weight)}return e},getNames:function(){for(var e=[],t=a.iter(this.components_);!t.done;t.next()){var r=t.value;e.push(r.featureName)}return e},getFeatures:function(){for(var e=[],t=a.iter(this.components_);!t.done;t.next()){var r=t.value;e.push(r.feature)}return e},setWeights:function(e){this.recalculateScore_=!0;for(var t=a.iter(a.range(0,e.length,!1));!t.done;t.next()){var r=t.value;this.components_[r].weight=e[r]}},setFunctionParam:function(e,t){this.recalculateScore_=!0,this.components_[e].functionParam=t},setFeatureName:function(e,t){this.components_[e].featureName=t},clearFeatures:function(){this.components_.forEach(function(e){e.feature=0})},score:{get:function(){return this.recalculateScore_&&this.calculateScore(),isNaN(this.score_)&&l.CoreAssert.fail("nan score"),this.score_}},calculateScore:function(){var e=0;this.components_.forEach(function(t){return e+=Math.atan(t.normalFeature*t.functionParam)/Math.atan(t.functionParam)*t.weight}),this.recalculateScore_=!1,this.score_=e},asString:{get:function(){return this.getOutputString(!1,!1)}},nonZeroValues:{get:function(){return this.getOutputString(!0,!0)}},asSortedString:{get:function(){return this.getOutputString(!0,!1)}},getOutputString:function(e,t){void 0===e&&(e=!1),void 0===t&&(t=!1);var r="",o=this.score,n=0;if(this.components_.length>0){r+="Features:\n";var l=[];this.components_.forEach(function(e){if(!t||0!=e.normalFeature){var r=Math.atan(e.normalFeature*e.functionParam)/Math.atan(e.functionParam);n+=e.weight*r;var o=Math.round(1e3*e.feature)/1e3,a=Math.round(1e3*e.normalFeature)/1e3,s=Math.round(1e3*e.mean)/1e3,c=Math.round(1e3*e.std)/1e3,u=Math.round(1e3*e.weight)/1e3,g=Math.round(100*u*a)/100,h=" "+i.applyFieldWidth(e.featureName,10)+":\t ("+o+" - "+s+") / "+c+" * "+u+": "+g+" \n";l.push({value:u*a,out:h})}}),e&&a.sortInPlace(l,function(e,t){return e.value<t.value});for(var s=a.iter(l);!s.done;s.next())r+=s.value.out}return Math.abs(n-o)>.001&&(r+="ERROR. scores don't match: "+n+", "+o+" \n"),r+="Total: "+Math.round(1e3*o)/1e3+" \n"},reject:function(){return!1},getVersion:function(){return"v"+this.versionNumber},writeFeatureDict:function(e,t){var r=this,o=0;a.each(t,function(t,n){var i=c.ModelWeightLibrary.getData(e,t);r.setFeatureName(o,t),r.setMean(o,i.mean),r.setStd(o,i.std),r.setWeight(o,i.weight),r.setFeature(o,n),o+=1})}}}),n)},198:function(e,t,r){var o,n=t,i=r(0);n.DesignSuggester=(o=function(e,t){this.maxSuggestions_=100,this.forma_=e,this.group_=t},i.defineClass({name:"DesignSuggester",ctor:o,superName:"CoreObject",statics:{perms:function(e){return o.permute(i.clone(e),i.clone([]))},permute:function(e,t){if(0==e.length)return[t];for(var r=[],n=i.iter(i.range(0,e.length,!1));!n.done;n.next()){var a=n.value,l=i.clone(e),s=i.clone(t);s.push(l[a]),l.splice(a,1),i.append(r,o.permute(i.clone(l),i.clone(s)))}return r},getPermutations:function(e,t){void 0===t&&(t=50);var r=[];if(e<5){var n=i.toArray(i.range(0,e,!1));(r=i.clone(o.perms(i.clone(n)))).length>t&&(i.shuffleInPlace(r),r=i.clone(r.slice(0,t)))}else for(var a=i.iter(i.range(0,t,!1));!a.done;a.next())n=i.toArray(i.range(0,e,!1)),i.shuffleInPlace(n),r.push(i.clone(n));return r}},props:{maxSuggestions:{get:function(){return this.maxSuggestions_},set:function(e){this.maxSuggestions_=e}},forma:{get:function(){return this.forma_}},group:{get:function(){return this.group_}},createSuggestions:function(){return[]}}}),o)},200:function(e,t,r){var o,n,i,a=t,l=r(0),s=r(8);a.RolePredictionCacheProtocol=l.defineProtocol("RolePredictionCacheProtocol",{getCacheValue:"(String) -> InferredRole",setCacheValue:"(String, InferredRole) -> Void",cleanup:"(String) -> Void"}),a.RolePredictionCache=(o=function(){},l.defineClass({name:"RolePredictionCache",ctor:o,statics:{_implements:function(e){return"RolePredictionCacheProtocol"==e}},props:{getCacheValue:function(e){return l.opt(s.Host.logging,function(e){return e.error("This method must be overridden")}),null},setCacheValue:function(e,t){l.opt(s.Host.logging,function(e){return e.error("This method must be overridden")})},cleanup:function(e){l.opt(s.Host.logging,function(e){return e.error("This method must be overridden")})}}}),o),a.PredictionCacheDouble=(n=function(){},l.defineClass({name:"PredictionCacheDouble",ctor:n,statics:{cache:{},currentDocID:""},props:{getCacheValue:function(e){return n.cache[e]},setCacheValue:function(e,t){n.cache[e]=l.clone(t)},cleanup:function(e){e!=n.currentDocID&&(n.currentDocID=e,n.cache={})}}}),n),a.PredictionCacheInferredRole=(i=function(){a.RolePredictionCache.call(this)},l.defineClass({name:"PredictionCacheInferredRole",ctor:i,superName:"RolePredictionCache",statics:{cache:{},currentDocID:"",_implements:function(e){return"RolePredictionCacheProtocol"==e}},props:{getCacheValue:function(e){return i.cache[e]},setCacheValue:function(e,t){i.cache[e]=l.clone(t)},cleanup:function(e){e!=i.currentDocID&&(i.currentDocID=e,i.cache={})}}}),i)},243:function(e,t,r){var o,n=t,i=r(0),a=r(1),l=r(79),s=r(321),c=r(37),u=r(119),g=r(57);n.ColorSelectorUtils=(o=function(){},i.defineClass({name:"ColorSelectorUtils",ctor:o,statics:{getLightDarkColorToPreventIllegibility:function(e,t){for(var r=null,n=e.page.colorLibraryController.getProfilingColorKeys().concat(e.page.colorLibraryController.getThemeColorKeys()).concat(l.ColorLibraryController.BW_KEYS),a=[],c=i.iter(i.range(0,n.length,!1));!c.done;c.next()){var u,g=c.value;(u=e.page.colorLibraryController.getSolidColorForKey(n[g]))&&a.push(u)}var h,f=new s.ColorRankSuggester,d=i.clone(f.weightedColorContrastRanker(i.clone(t),i.clone(a)));return null!=(h=o.getIndexOfContrastingColorChoice(i.clone(d)))&&(r=n[h]),r},getIndexOfContrastingColorChoice:function(e){var t=null,r=i.clone(e);i.sortInPlace(r);for(var o=0,n=r.length>5?r.length-5:0,a=i.iter(i.range(n,r.length,!1).reversed());!a.done;a.next()){var l=a.value;r[l]>0&&(o=r[l])}for(var s=!1;!s&&o>0;){var u=c.CoreRandom.nextIntUniform(100)%e.length;e[u]>=o&&(t=u,s=!0)}return t},getComparisonColors:function(e,t,r){var o=[];if(null!=t)for(var n=i.iter(t);!n.done;n.next()){var a=n.value;o.push(i.clone(s.ColorForComparison.init_c063(a,1)))}return null!=r&&o.push(i.clone(r)),o},getSolidColorForChoices:function(e,t,r){for(var o=[],n=i.iter(i.range(0,r.length,!1));!n.done;n.next()){var a,l=n.value;(a=e.page.colorLibraryController.getSolidColorForKey(r[l]))&&o.push(a)}return o},mapInferredRoleToProfilingRole:function(e){var t=i.clone((new g.RoleSuggester).getRole(e));return(new u.ProfilingColorMap).getProfilingCategoryForInferredRole(i.clone(t))},makeFinalDecisionOnColorChoice:function(e,t,r,n,l,c,u){if(void 0===l&&(l=!1),void 0===u&&(u=!1),0==r.length)return null;var g,h=new s.ColorRankSuggester,f=i.clone(h.weightedColorContrastRanker(i.clone(t),i.clone(n),l)),d=null,p=i.max(f);if(null!=p&&p>0?d=this.getContrastingChoice(u,i.clone(f),i.clone(r)):(d=o.getLightDarkColorToPreventIllegibility(e,i.clone(t)),a.CoreAssert.isTrue(null!=d,"Error: we couldn't find a legible color :(")),null!=(g=d)){var m,C=this.handlePaletteMappingOverride(g,e,c,i.clone(f),i.clone(r));(m=e.page.colorLibraryController.getSolidColorForKey(C))&&(0!=i.clone(h.weightedColorContrastRanker(i.clone(t),[m],!1))[0]||c)&&(d=C)}return null==d&&(d=r[0]),d},getContrastingChoice:function(e,t,r){var o=null,n=i.max(t);if(e)o=r[i.indexOf(t,n)];else for(var a=i.iter(i.range(0,t.length,!1));!a.done;a.next()){var l=a.value;if(0!=t[l]){o=r[l];break}}return o},handlePaletteMappingOverride:function(e,t,r,o,n){var a="None";return a=r?t.formaID+u.ProfilingColorMap.backingColorKey:t.formaID,(new u.ProfilingColorMap).overridePaletteMappingDueToContrastAndForceDifference(e,a,i.clone(o),i.clone(n))},compareTwoColorStringsWithMargin:function(e,t){for(var r=!0,n=i.clone(o.convertColorStringToInt(e)),a=i.clone(o.convertColorStringToInt(t)),l=i.iter(i.range(0,n.length,!1));!l.done;l.next()){var s=l.value;n[s]!=a[s]&&n[s]!=a[s]-1&&n[s]!=a[s]+1&&(r=!1)}return r},convertColorStringToInt:function(e){for(var t=[],r=i.iter(i.range(0,i.toInt(e.length/3),!1));!r.done;r.next()){var o,n=r.value,a=e.substr(3*n,3);null!=(o=i.toInt(a))&&t.push(o)}return t}}}),o)},320:function(e,t,r){var o,n,i,a=t,l=r(0),s=r(1),c=r(79),u=r(243),g=r(119);a.ProfilingColorSelector=(o=function(e,t){var r;this.inertiaRatio=1,this.weights=[],this.weightSum=0,this.currentIndividualIndex=0,this.numIndividualChoices=5,this.isBacking=!1,this.forma=e,this.isBacking=t,(r=l.opt(this.forma,function(e){return e.controller}))?this.colorsBehindForma=l.clone(r.getBackgroundColors()):this.colorsBehindForma=[],this.values=e.page.colorLibraryController.getThemeColorKeys().concat(e.page.colorLibraryController.getProfilingColorKeys())},l.defineClass({name:"ProfilingColorSelector",ctor:o,props:{updateBackgroundColors:function(e){this.colorsBehindForma=l.clone(e||l.opt(l.opt(this.forma,function(e){return e.controller}),function(e){return e.getBackgroundColors()}))},selectColorForGlobalRecolor:function(e,t,r){void 0===e&&(e=!0),void 0===t&&(t=null),void 0===r&&(r=!1);var o=c.ColorLibraryController.BW_KEYS[0];if(null!=this.forma){var n=u.ColorSelectorUtils.mapInferredRoleToProfilingRole(this.forma),i=l.clone(u.ColorSelectorUtils.getComparisonColors(this.forma,l.clone(e?this.colorsBehindForma:null),l.clone(t))),a=l.clone(this.getListOfColorChoicesForRoleGlobal(n));if(a.length>0){var s,g=l.clone(u.ColorSelectorUtils.getSolidColorForChoices(this.forma,n,l.clone(a)));null!=(s=u.ColorSelectorUtils.makeFinalDecisionOnColorChoice(this.forma,l.clone(i),l.clone(a),l.clone(g),r,this.isBacking,!1))&&(o=s)}}return o},selectColorForIndividualRecolor:function(e,t,r){void 0===e&&(e=!0),void 0===t&&(t=null);var o=c.ColorLibraryController.THEME_DERIVED_BW_KEYS[0];if(null!=this.forma){var n=u.ColorSelectorUtils.mapInferredRoleToProfilingRole(this.forma),i=l.clone(u.ColorSelectorUtils.getComparisonColors(this.forma,l.clone(e?this.colorsBehindForma:null),l.clone(t))),a=l.clone(this.getListOfColorChoicesForRoleIndividual(n));if(a.length>0){var s=l.clone(u.ColorSelectorUtils.getSolidColorForChoices(this.forma,n,l.clone(a))),g=this.currentIndividualIndex%a.length,h=a.concat();h.splice(0,0,a[g]);var f,d=s.concat();d.splice(0,0,s[g]),null!=(f=u.ColorSelectorUtils.makeFinalDecisionOnColorChoice(this.forma,l.clone(i),l.clone(h),l.clone(d),r,this.isBacking))&&(o=f)}}return this.currentIndividualIndex=(this.currentIndividualIndex+1)%this.numIndividualChoices,o},getListOfColorChoicesForRoleGlobal:function(e){return s.CoreAssert.fail("base color selector not implemented. use primary or background"),[]},getListOfColorChoicesForRoleIndividual:function(e){return s.CoreAssert.fail("base color selector not implemented. use primary or background"),[]}}}),o),a.ProfilingPrimaryColorSelector=(n=function(e,t){a.ProfilingColorSelector.call(this,e,t)},l.defineClass({name:"ProfilingPrimaryColorSelector",ctor:n,superName:"ProfilingColorSelector",props:{getListOfColorChoicesForRoleGlobal:function(e){return(new g.ProfilingColorMap).getPrimaryColorsForRoleGlobal(e,this.forma.formaID,this.forma.page)},getListOfColorChoicesForRoleIndividual:function(e){return(new g.ProfilingColorMap).getPrimaryColorsForRoleIndividual(this.forma.page,e,this.numIndividualChoices)}}}),n),a.ProfilingBackgroundColorSelector=(i=function(e,t){a.ProfilingColorSelector.call(this,e,t)},l.defineClass({name:"ProfilingBackgroundColorSelector",ctor:i,superName:"ProfilingColorSelector",props:{getListOfColorChoicesForRoleGlobal:function(e){return(new g.ProfilingColorMap).getBackgroundColorsForRoleGlobal(e,this.forma.formaID,this.forma.page)},getListOfColorChoicesForRoleIndividual:function(e){return(new g.ProfilingColorMap).getBackgroundColorsForRoleIndividual(this.forma.page,e,this.numIndividualChoices)}}}),i)},321:function(e,t,r){var o,n,i=t,a=r(0),l=r(22);i.ColorForComparison=(o=function(){this.role=""},a.defineClass({name:"ColorForComparison",ctor:o,props:{init_c063:function(e,t,r){void 0===r&&(r=""),this.color=e,this.weight=t,this.role=r},init_implicit:function(e,t,r){void 0===r&&(r=""),this.color=e,this.weight=t,this.role=r},clone:function(){return o.init_implicit(this.color,this.weight,this.role)}}}),o),i.ColorRankSuggester=(n=function(){},a.defineClass({name:"ColorRankSuggester",ctor:n,superName:"CoreObject",props:{weightedColorContrastRanker:function(e,t,r){var o;void 0===r&&(r=!1);for(var n=a.repeat(0,t.length),i=a.iter(a.range(0,t.length,!1));!i.done;i.next()){for(var s=i.value,c=t[s],u=0,g=a.iter(a.range(0,e.length,!1));!g.done;g.next()){var h,f=g.value;if(h=e[f].color){var d=(o=e[f].weight)||null!=o?o:1;if(a.eq(l._equality_SolidColor_SolidColor,c,h)||!c.contrasts(h,r))u+=1;else{var p=(.7*h.perceptualDifference(c)+50*Math.pow(h.lightnessDifference(c)/50,2)*.3)/2;n[s]+=p*d}}}var m=a.toDouble(u)/a.toDouble(e.length);m>.4||u==e.length?n[s]=0:n[s]*=1-m}return n}}}),n)},323:function(e,t,r){var o,n,i=t,a=r(0),l=r(162);i.FormaPlacementScore=(o=function(e){this.rejectThreshold=-100,l.WeightedScore.call(this,o.Features.NUM_FEAT),this.setWeight(o.Features.XSYMM,10),this.setWeight(o.Features.YSYMM,10),this.setWeight(o.Features.CONTRAST,1),0==e.textRects.length?(this.setWeight(o.Features.EDGE,-200),this.setWeight(o.Features.FACE,-1e3)):(this.setWeight(o.Features.EDGE,-50),this.setWeight(o.Features.FACE,0)),this.setWeight(o.Features.SIZE,100),this.setWeight(o.Features.TEXT_OVERLAP,-5e3),this.setWeight(o.Features.FLOATING_ELEMENT_OVERLAP,-1e3),this.setWeight(o.Features.DISTANCE_TO_CENTER,-20),this.setWeight(o.Features.IMAGE_EDGE_OVERLAP,-500),this.setWeight(o.Features.REGION_BOUNDARY_OVERLAP,-40),this.setWeight(o.Features.ALIGNMENT,50),this.setWeight(o.Features.ASPECT_RATIO,20),this.setFunctionParam(o.Features.EDGE,50),this.setFunctionParam(o.Features.TEXT_OVERLAP,10),this.setFunctionParam(o.Features.FLOATING_ELEMENT_OVERLAP,10),this.setFunctionParam(o.Features.IMAGE_EDGE_OVERLAP,10),this.setFeatureName(o.Features.XSYMM,"X- Symmetry"),this.setFeatureName(o.Features.YSYMM,"Y- Symmetry"),this.setFeatureName(o.Features.CONTRAST,"Contrast"),this.setFeatureName(o.Features.EDGE,"Edges"),this.setFeatureName(o.Features.FACE,"Faces"),this.setFeatureName(o.Features.SIZE,"Size"),this.setFeatureName(o.Features.TEXT_OVERLAP,"Text Overlap"),this.setFeatureName(o.Features.FLOATING_ELEMENT_OVERLAP,"Floating Element Overlap"),this.setFeatureName(o.Features.DISTANCE_TO_CENTER,"Distance To Center"),this.setFeatureName(o.Features.IMAGE_EDGE_OVERLAP,"Image Edge Overlap"),this.setFeatureName(o.Features.REGION_BOUNDARY_OVERLAP,"Region Boundary Overlap"),this.setFeatureName(o.Features.ALIGNMENT,"Alignment"),this.setFeatureName(o.Features.ASPECT_RATIO,"Aspect Ratio")},n={},a.defineClass({name:"FormaPlacementScore",ctor:o,superName:"WeightedScore",statics:{Features:{get:function(){return void 0===n.Features&&(n.Features=a.defineEnum("Features",{XSYMM:1,YSYMM:2,CONTRAST:3,EDGE:4,FACE:5,SIZE:6,TEXT_OVERLAP:7,FLOATING_ELEMENT_OVERLAP:8,IMAGE_EDGE_OVERLAP:9,REGION_BOUNDARY_OVERLAP:10,DISTANCE_TO_CENTER:11,ALIGNMENT:12,ASPECT_RATIO:13,NUM_FEAT:14})),n.Features}}},props:{reject:function(){return this.score<this.rejectThreshold}}}),o)},331:function(e,t,r){var o,n=t,i=r(0);n.SuggestionUtils=(o=function(){},i.defineClass({name:"SuggestionUtils",ctor:o,props:{normalizedWeights:function(e){var t,r,o=[];if(null!=(t=i.min(e))&&null!=(r=i.max(e)))for(var n=r-t==0,a=i.iter(e);!a.done;a.next()){var l=a.value;if(n)o.push(1);else{var s=(l-t)/(r-t);o.push(s)}}return o},weightsEqualNaNOrEmpty:function(e){if(0==e.length==1)return!0;for(var t=i.iter(e);!t.done;t.next()){var r=t.value;if(1==isNaN(r))return!0}return!1}}}),o)},438:function(e,t,r){var o,n=t,i=r(0),a=r(4);n.FormaPlacementInput=(o=function(e,t,r,o,n,l,s){this.forma=e,this.otherRects=i.clone(t),this.floatingRects=i.clone(r),this.textRects=i.clone(o),this.imageRects=i.clone(n),this.images=i.clone(l),this.backgroundRegions=i.clone(s),a.CoreObject.call(this)},i.defineClass({name:"FormaPlacementInput",ctor:o,superName:"CoreObject"}),o)},439:function(e,t,r){var o,n=t,i=r(0),a=r(1),l=r(104),s=r(35);n.FormaPlacementSuggestion=(o=function(e,t,r){a.CoreAssert.isTrue(e.kind!=s.RootForma.KIND),this.location_=t,i.super_init(this,l.DesignSuggestion,l.DesignSuggestion.prototype.init_a4fb,e,null,r)},i.defineClass({name:"FormaPlacementSuggestion",ctor:o,superName:"DesignSuggestion",props:{location:{get:function(){return this.location_}},distanceTo:function(e){var t=e,r=0,o=this.forma_.page.pageSize.hypotenuse;return r+=l.distancePositionWeight*this.location_.center.distanceTo(t.location.center)/o,r+=l.distanceSizeWeight*Math.abs(this.location_.width-t.location.width)/o,r+=l.distanceSizeWeight*Math.abs(this.location_.height-t.location.height)/o},apply:function(){this.forma_.controller.fit(this.location_)}}}),o)},445:function(e,t,r){var o,n,i,a,l=t,s=r(0),c=r(1),u=r(4),g=r(8),h=r(203),f=r(160),d=r(199),p=r(35),m=r(200),C=r(30),v=r(94);l.useNNModel=!0,l.linearLearningRate=.5,l.nnLearningRate=.005,s.gvar(l,"sharedSuggester_",function(){return new l.FontSuggester}),l.concatSecondIntoFirst=function(e,t){for(var r=s.iter(t.descriptors);!r.done;r.next()){var o=r.value;e.append(o)}},l.FontSuggester=(o=function(){u.CoreObject.call(this)},n={},s.defineClass({name:"FontSuggester",ctor:o,superName:"CoreObject",statics:{sharedSuggester:{get:function(){return l.sharedSuggester_}},cache:{get:function(){return void 0===n.cache&&(n.cache=new m.PredictionCacheDouble),n.cache},set:function(e){n.cache=e}}},props:{getFontFeatures:function(e,t){var r,n,i=s.clone(e.selectedLockup.pts),a=i[0].x,c=i[0].y,u=i[3].x,g=i[3].y,h=(a+u)/2,f=(c+g)/2,d=e.width,m=e.height,v=e.selectedLockup.wordCount,S=e.selectedLockup.width,F=e.selectedLockup.height,y=e.numImages,P="root";if(n=s.opt(t.root,function(e){return e.filterWithCallback(function(e){return(e.isBackgroundImage()||e.kind==C.ShapeForma.KIND||e.kind==p.RootForma.KIND)&&null!=e.controller&&!e.controller.moveable})}))for(var M=s.iter(n);!M.done;M.next()){var I=M.value;I.isBackgroundImage()&&I.finalFrame.outsetXY(20,20).contains(t.finalFrame)?P="image":I.kind==C.ShapeForma.KIND&&(P="shape")}r=[d,m,d*m,Math.atan2(m,d),s.toDouble(e.lockups.length),s.toDouble(y),a/d,c/m,h/d,f/m,u/d,g/m,s.toDouble(v),S,F,S*F/s.toDouble(v),"root"==P?1:0,"image"==P?1:0,"shape"==P?1:0];var T=e.selectedLockup.styleAttributes.backing,D=e.selectedLockup.styleAttributes.layout;return o.cache.cleanup(t.page.document.uuid),new l.FontFeatures(s.clone(r),T,D)},suggestFonts:function(e,t){if(null!=g.Host.fontProvider){var r=g.Host.fontProvider.getIncludedFonts(h.ANY_DOCUMENT),o=e.currentDocumentFonts.clone();l.concatSecondIntoFirst(o,e.recentlyUsedFonts),l.concatSecondIntoFirst(o,r),t(o)}},onlineLearning:function(e,t){var r,o;if(l.useNNModel){if(r=f.MLPModel.loadNNModel("Font")){var n=t.regularFeatures.concat(),i=s.repeat(0,58),a=s.repeat(0,4);null!=(k=s.indexOf(r.shapes,t.shape))&&(i[k]=1),null!=(E=s.indexOf(r.layouts,t.layout))&&(a[E]=1),n=s.clone(n.concat(s.clone(i)).concat(s.clone(a))),c.CoreAssert.isTrue(81==n.length);var u=s.clone(r.fonts),h=r.coefficients.length,p=s.repeat(0,r.coefficients[h-1].rows),m=new v.TheoMatrix([n]).subtract(r.featureScalingMean).divide(r.featureScalingStd);if(null!=(A=s.indexOf(u,e.postScriptName))&&A>=0&&A<p.length){p[A]=1;var C=new v.TheoMatrix([p]),S=new d.NNMLPClassifier(s.clone(r.coefficients),s.clone(r.intercepts)),F=s.clone(S.forwardPropagate(m.transpose())),y=F.AL,P=s.clone(F.caches),M=s.clone(S.backwardPropagate(y,C.transpose(),s.clone(P))),I=s.clone(M.dWs),T=s.clone(M.dbs);s.info("nn cost: "+S.computeCost(y,C.transpose())+")");for(var D=[],_=[],R=s.iter(s.range(0,h,!1));!R.done;R.next()){var x=R.value;D.push(r.coefficients[x].subtract(I[x].multiplyConstant(l.nnLearningRate))),_.push(r.intercepts[x].subtract(T[x].multiplyConstant(l.nnLearningRate)))}c.CoreAssert.isTrue(D.length==r.coefficients.length),c.CoreAssert.isTrue(_.length==r.intercepts.length);var b=new f.MLPModel(r.featureScalingMean,r.featureScalingStd,s.clone(D),s.clone(_),s.clone(r.shapes),s.clone(r.fonts),s.clone(r.layouts),s.clone(r.roles));s.opt(g.Host.learning,function(e){return e.updateFontSuggestionNNModel(b)})}}}else if(o=s.opt(g.Host.learning,function(e){return e.loadFontSuggestionLinearModel()})){var k,E,A;if(n=t.regularFeatures.concat(),i=s.repeat(0,58),a=s.repeat(0,4),null!=(k=s.indexOf(o.shapes,t.shape))&&(i[k]=1),null!=(E=s.indexOf(o.layouts,t.layout))&&(a[E]=1),n=s.clone(n.concat(s.clone(i)).concat(s.clone(a))),c.CoreAssert.isTrue(81==n.length),m=new v.TheoMatrix([n]).subtract(o.featureScalingMean).divide(o.featureScalingStd),u=s.clone(o.fonts),p=s.repeat(0,u.length),null!=(A=s.indexOf(u,e.postScriptName))&&A>=0&&A<p.length){p[A]=1,C=new v.TheoMatrix([p]);var N=m.matrixMultiply(o.coefficient.transpose()).add(o.intercept).sigmoid().subtract(C),L=o.coefficient.subtract(N.transpose().matrixMultiply(m).multiplyConstant(l.linearLearningRate)),w=o.intercept.subtract(N.multiplyConstant(l.linearLearningRate));b=new l.FontLinearModel(o.featureScalingMean,o.featureScalingStd,L,w,s.clone(o.shapes),s.clone(o.fonts),s.clone(o.layouts)),s.opt(g.Host.learning,function(e){return e.updateFontSuggestionLinearModel(b)})}}},getScores:function(e,t){var r=t.getUniqueKey();if(null==o.cache.getCacheValue(r)){var n,i,a=[];if(l.useNNModel){if(n=f.MLPModel.loadNNModel("Font")){var u=t.regularFeatures.concat(),h=s.repeat(0,58),p=s.repeat(0,4);null!=(D=s.indexOf(n.shapes,t.shape))&&(h[D]=1),null!=(_=s.indexOf(n.layouts,t.layout))&&(p[_]=1),u=s.clone(u.concat(s.clone(h)).concat(s.clone(p))),c.CoreAssert.isTrue(81==u.length);for(var m=new v.TheoMatrix([u]).subtract(n.featureScalingMean).divide(n.featureScalingStd),C=new d.NNMLPClassifier(s.clone(n.coefficients),s.clone(n.intercepts)).predict(m.transpose()),S=s.clone(C.transpose().asArray),F=s.clone(n.fonts),y={},P=s.iter(s.toSequence(S[0]));!P.done;P.next()){var M=P.value,I=M.offset,T=M.element;y[F[I]]=T}e.forEach(function(e){var t;null!=(t=y[e.postScriptName])?a.push(t):a.push(0)})}}else if(i=s.opt(g.Host.learning,function(e){return e.loadFontSuggestionLinearModel()})){var D,_;u=t.regularFeatures.concat(),h=s.repeat(0,58),p=s.repeat(0,4),null!=(D=s.indexOf(i.shapes,t.shape))&&(h[D]=1),null!=(_=s.indexOf(i.layouts,t.layout))&&(p[_]=1),u=s.clone(u.concat(s.clone(h)).concat(s.clone(p))),c.CoreAssert.isTrue(81==u.length),C=(m=new v.TheoMatrix([u]).subtract(i.featureScalingMean).divide(i.featureScalingStd)).matrixMultiply(i.coefficient.transpose()).add(i.intercept),S=s.clone(C.sigmoid().asArray),F=s.clone(i.fonts),y={};for(var R=s.iter(s.toSequence(S[0]));!R.done;R.next()){var x=R.value;I=x.offset,T=x.element,y[F[I]]=T}e.forEach(function(e){var t;null!=(t=y[e.postScriptName])?a.push(t):a.push(0)})}o.cache.setCacheValue(r,s.clone(a))}return o.cache.getCacheValue(r)}}}),o),l.FontFeatures=(i=function(e,t,r){this.regularFeatures=s.clone(e),this.shape=t,this.layout=r},s.defineClass({name:"FontFeatures",ctor:i,props:{getUniqueKey:function(){for(var e="",t=s.iter(this.regularFeatures);!t.done;t.next()){var r=t.value;e=e+s.toString("%.2f",r)+"-"}return e=(e=e+this.shape+"-")+this.layout+"-"}}}),i),l.FontLinearModel=(a=function(e,t,r,o,n,i,a){this.featureScalingMean=e,this.featureScalingStd=t,this.coefficient=r,this.intercept=o,this.shapes=s.clone(n),this.fonts=s.clone(i),this.layouts=s.clone(a),this.fontMap={}},s.defineClass({name:"FontLinearModel",ctor:a,props:{data:function(){return s.clone(s.as({model:{coef:this.coefficient.asArray,intercept:this.intercept.asFlatArray,shapes:this.shapes,fonts:this.fonts,layouts:this.layouts},featureScalingMean:this.featureScalingMean.asFlatArray,featureScalingStd:this.featureScalingStd.asFlatArray},["Dictionary","String","Any"]))}}}),a)},504:function(e,t,r){var o,n=t,i=r(0),a=r(1),l=r(79),s=r(37);n.ColorLibraryMap=(o=function(){},i.defineClass({name:"ColorLibraryMap",ctor:o,statics:{remapColors:function(e,t,r,n){var a=[];e.forEachColor(function(e,l,s){var c;if(c=null==l?s:i.opt(t.color(l),function(e){return e.rgbColor})){var u=i.opt(n,function(e){return e[c.hex]});null==u&&(u=o.findACloseColor(c,r),null!=n&&(n[c.hex]=u)),a.push({key:e,value:u})}}),e.setColorIDs(i.clone(a))},findACloseColor:function(e,t,r){void 0===r&&(r=20);var o=e.lightness,n=null,c=[];if(t.forEachColor(function(e,t){if(e.startsWith("theme")){var n=Math.abs(t.rgbColor.lightness-o);n<=r&&c.push({id:e,distance:n})}}),0==c.length)a.CoreAssert.info("Unable to find closest color in ColorLibraryMap.findACloseColor"),n=l.ColorLibraryController.BLACK_KEY;else{var u=i.sort(c,function(e,t){return e.distance<t.distance});n=u[s.CoreRandom.nextIntUniform(Math.min(u.length,3))].id}return n}}}),o)},653:function(e,t,r){var o,n=t,i=r(0),a=r(4);n.RetargetDocumentData=(o=function(e,t,r,o,n,l,s,c,u,g,h,f,d){this.docID=e,this.size=t,this.lockupStrings=i.clone(r),this.focus=o,this.numImages=n,this.edgeMap=i.clone(s),this.layoutID=c,this.numMoveable=l,this.numGridCells=u,this.textRoles=i.clone(g),this.shapeRoles=i.clone(h),this.salientCoverage=f,this.visualGroupInfo=i.clone(d),a.CoreObject.call(this)},i.defineClass({name:"RetargetDocumentData",ctor:o,superName:"CoreObject"}),o)},654:function(e,t,r){var o,n,i,a,l=t,s=r(0),c=r(57),u=r(48);l.Timing=(o=function(){},s.defineClass({name:"Timing",ctor:o,props:{init_c5c1:function(e,t,r){void 0===e&&(e=0),void 0===t&&(t=0),void 0===r&&(r=""),this.start=e,this.end=t,this.formaID=r},init_implicit:function(e,t,r){this.start=e,this.end=t,this.formaID=r},clone:function(){return o.init_implicit(this.start,this.end,this.formaID)}}}),o),l.LockupTiming=(n=function(e,t){this.startTime=e,this.endTime=t},s.defineClass({name:"LockupTiming",ctor:n,props:{clone:function(){return new n(this.startTime,this.endTime)}}}),n),l.RoleOrderIndexing=(i=function(){},s.defineClass({name:"RoleOrderIndexing",ctor:i,props:{init_27ef:function(e,t,r,o){void 0===e&&(e=""),void 0===t&&(t=""),void 0===r&&(r=0),void 0===o&&(o=0),this.roleString=e,this.formaID=t,this.posX=r,this.posY=o},init_implicit:function(e,t,r,o){this.roleString=e,this.formaID=t,this.posX=r,this.posY=o},clone:function(){return i.init_implicit(this.roleString,this.formaID,this.posX,this.posY)}}}),i),l.RoleBasedAnimationTiming=(a=function(){this.formaIndex=0,this.lockupRoleBasedTiming=[],this.lockupHierarchyBasedTiming=[],this.currentInterval=0,this.finalAnimDuration=15},s.defineClass({name:"RoleBasedAnimationTiming",ctor:a,props:{updateTiming:function(e,t){this.formaIndex=0,this.lockupRoleBasedTiming=[],this.setLockupRoleBasedTiming(s.clone(e)),this.setLockupHierarchyBasedTiming(s.clone(e))},getLockupRoleBasedTiming:function(e,t){this.currentInterval=e;for(var r=s.clone(l.Timing.init_c5c1()),o=s.iter(this.lockupRoleBasedTiming);!o.done;o.next()){var n=o.value;n.formaID==t&&(r=s.clone(n))}var i=new u.TheoTime(r.start*e,30),a=new u.TheoTime(r.end*e,30);return new l.LockupTiming(i,a)},getLockupHierarchyBasedTiming:function(e){this.currentInterval=e;var t=new u.TheoTime(this.lockupHierarchyBasedTiming[this.formaIndex].start*e,30),r=new u.TheoTime(this.lockupHierarchyBasedTiming[this.formaIndex].end*e,30);return this.formaIndex+=1,new l.LockupTiming(t,r)},getFinalAnimStartTime:function(){return new u.TheoTime(this.getFinalEndTime(),30)},getFinalAnimEndTime:function(){return new u.TheoTime(this.getFinalEndTime()+this.getFinalEndDuration(),30)},getFinalEndTime:function(){return this.lockupRoleBasedTiming.length*this.currentInterval},getFinalEndDuration:function(){return this.finalAnimDuration},setLockupRoleBasedTiming:function(e){for(var t=[],r=s.iter(e);!r.done;r.next()){var o=r.value;if(o.isTypeLockup()){var n=s.clone(o.totalPlacement.transformPoints(s.clone(o.bounds.points)));t.push(s.clone(l.RoleOrderIndexing.init_27ef((new c.RoleSuggester).getRole(o).role,o.formaID,n[0].x,n[0].y)))}}for(var i=[],a=s.iter(["Title","Quote","Subtitle","Call to Action","Body Text","Contact Info","Social Media Reference"]);!a.done;a.next())for(var u=a.value,g=s.iter(s.range(0,t.length,!1));!g.done;g.next())t[g.value].roleString==u&&i.push(u);for(var h=0,f=s.iter(i);!f.done;f.next()){var d=f.value,p=s.clone(this.getNextElementAndRemove(d,t));this.lockupRoleBasedTiming.push(s.clone(l.Timing.init_c5c1(h,h+1,p.formaID))),h+=1}},setLockupHierarchyBasedTiming:function(e){for(var t=0,r=s.iter(e);!r.done;r.next()){var o=r.value;if(o.isTypeLockup()){var n=t+1;this.lockupHierarchyBasedTiming.push(s.clone(l.Timing.init_c5c1(t,n,o.formaID))),t+=1}}},getNextElementAndRemove:function(e,t){for(var r=s.clone(l.RoleOrderIndexing.init_27ef()),o=s.iter(t);!o.done;o.next()){var n=o.value;if(n.roleString==e){r=s.clone(n),this.checkIfMultipleInstances(e,s.clone(t))&&(r=s.clone(this.findNextElementOfRole(e,s.clone(t)))),this.removeRoleOrderElement(r.formaID,t);break}}return r},removeRoleOrderElement:function(e,t){for(var r=0,o=s.iter(t);!o.done;o.next()){if(o.value.formaID==e){t.splice(r,1);break}r+=1}},checkIfMultipleInstances:function(e,t){for(var r=0,o=s.iter(t);!o.done;o.next())o.value.roleString==e&&(r+=1);return r>1},findNextElementOfRole:function(e,t){for(var r=[],o=s.iter(t);!o.done;o.next())(a=o.value).roleString==e&&r.push(s.clone(a));for(var n=s.clone(r[0]),i=s.iter(r);!i.done;i.next()){var a;(a=i.value).posY<=n.posY?n=s.clone(a):a.posX<=n.posX&&a.posY<=n.posY&&(n=s.clone(a))}return n}}}),a)},655:function(e,t,r){var o,n=t,i=r(0),a=r(4),l=r(327),s=r(72);n.FontSuggestionContext=(o=function(){this.currentDocumentFonts_=new l.OrderedFontSet,this.recentlyUsedFonts_=new l.OrderedFontSet,a.CoreObject.call(this)},i.defineClass({name:"FontSuggestionContext",ctor:o,superName:"CoreObject",props:{snapshotCurrentFonts:function(e){this.currentDocumentFonts_=s.TypeLockupUtils.fontsInDocument(e)},currentDocumentFonts:{get:function(){return this.currentDocumentFonts_}},addRecentlyUsedFont:function(e){var t=this,r=null;if(this.recentlyUsedFonts_.contains(e)){var o=e.displayFamilyName;r=i.clone(this.recentlyUsedFonts_.facesInFamily(o))}i.opt(r,function(e){return e.forEach(function(e){return t.recentlyUsedFonts_.remove(e)})}),i.opt(r,function(e){return e.forEach(function(e){return t.recentlyUsedFonts_.append(e)})}),this.recentlyUsedFonts_.append(e)},clearRecentFonts:function(){this.recentlyUsedFonts_=new l.OrderedFontSet},recentlyUsedFonts:{get:function(){return this.recentlyUsedFonts_}}}}),o)}}]);
//# sourceMappingURL=logomaker-entry_55373254-3b724ff8.js.map