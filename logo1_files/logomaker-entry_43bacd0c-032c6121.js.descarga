(window.webpackJsonp=window.webpackJsonp||[]).push([[17],{154:function(t,e,n){var r,o,i,a=e,l=n(0),s=n(49),u=n(190),c=n(1),m=n(19),h=n(104),f=n(11),p=n(155),g=n(43),d=n(23),v=n(8),C=n(9),F=n(37),y=n(30),S=n(246),P=n(40),b=n(204),D=n(14),_=n(15),T=n(10),A=n(28);a.AlignmentGroupItemType=l.defineEnum("AlignmentGroupItemType",{DefaultContent:0,SeperatorShape:1,BackingShape:2,BulletShape:3}),a.AlignmentLayoutItem=(r=function(t,e,n,r,o,i,a,l){this.forma=t,this.type=e,this.formaPin=n,this.parentPosition=r,this.size=o,this.scale=i,this.artworkID=a,this.primaryColor=l},l.defineClass({name:"AlignmentLayoutItem",ctor:r,props:{clone:function(){return new r(this.forma,this.type,this.formaPin,this.parentPosition,this.size,this.scale,this.artworkID,this.primaryColor)}}}),r),a.AlignmentColumnLayout=(o=function(t,e,n,r,o,i,a,s,u){this.columns=l.clone(t),this.contentColumn=l.clone(e),this.contentSizes=l.clone(n),this.contentScales=l.clone(r),this.contentSpacing=l.clone(o),this.seperatorHeights=l.clone(i),this.seperatorPositions=l.clone(a),this.marginLeft=l.clone(s),this.marginRight=l.clone(u)},l.defineClass({name:"AlignmentColumnLayout",ctor:o,props:{clone:function(){return new o(this.columns,this.contentColumn,this.contentSizes,this.contentScales,this.contentSpacing,this.seperatorHeights,this.seperatorPositions,this.marginLeft,this.marginRight)}}}),o),a.AlignmentGroupController=(i=function(t,e,n){this.blockChildUpdates_=!1,this.blockAlignmentLayout_=!1,this.childrenAligned_=!1,this.iconHack_=!1,this.childScales_={},g.GroupController.call(this,t,e,n)},l.defineClass({name:"AlignmentGroupController",ctor:i,superName:"GroupController",statics:{KIND:{get:function(){return"alignment-group"}},MIN_SPACING:{get:function(){return 5}},DEFAULT_MARGINS:{get:function(){return 20}},DEFAULT_SEPERATOR_HEIGHT:{get:function(){return 5}},PROPERTY_BACKING_SHAPE_ID:"backing-shape-id"},props:{selectable:{get:function(){return!0}},moveable:{get:function(){return!0}},rotateable:{get:function(){return!0}},deleteable:{get:function(){var t,e;return(t=l.opt(this.forma,function(t){return t.finalFrame}))&&(e=l.opt(this.forma,function(t){return t.root.finalFrame}))?!t.equal(e):g.GroupController._getters.deleteable.call(this)}},replaceable:{get:function(){return!this.moveable}},maintainAspectRatio:{get:function(){return!1}},contentID:{get:function(){var t=[];if(l.opt(this.forma,function(e){return e.visit(f.FormaTraversal.JustChildren,function(e,n,r){var o;return null!=(o=e.contentID)&&t.push(o),!1})}),0==t.length)return null;l.sortInPlace(t);for(var e="",n=l.iter(t);!n.done;n.next())e+=n.value;return e}},horizontalAlignment:{get:function(){return this.alignmentGroupStyle.horizontalAlignment},set:function(t){this.alignmentGroupStyle.horizontalAlignment=t,this.updateGroup()}},alignmentGroupStyle:{get:function(){var t;return(t=l.as(l.opt(this.forma,function(t){return t.style}),u.AlignmentGroupStyle))?t:(l.opt(this.forma,function(t){return t.applyStyle(u.AlignmentGroupStyle.createDefault())}),l.as(l.opt(this.forma,function(t){return t.style}),u.AlignmentGroupStyle))}},inferredSpacing:{get:function(){var t;if(null!=(t=l.opt(this.alignmentGroupStyle,function(t){return t.spacing})))return t;var e=l.clone(this.getSortedChildren()),n=[];if(e.length>0){for(var r=l.iter(l.range(0,e.length-1,!1));!r.done;r.next()){var o,i=r.value;null!=(o=l.opt(this.alignmentGroupStyle,function(t){return t.topDistances[e[i].formaID]}))&&n.push(o)}return n.reduce(function(t,e){return t+e},0)/l.toDouble(n.length)}return null}},setHorizontalAlignment:function(t,e){void 0===e&&(e=null),this.horizontalAlignment=t},applyOpacity:function(t){l.opt(this.backingShape_,function(e){return e.style.opacity=t}),this.alignmentGroupStyle.opacity=t},setNextSpacingOption:function(){var t,e,n;(t=this.alignmentGroupStyle)&&(e=l.opt(this.forma,function(t){return t.finalFrame}))&&(null!=(n=t.spacing)?n>e.height/5?t.spacing=0:t.spacing=n+20:t.spacing=25,this.updateGroup())},setNextPaddingOption:function(){var t,e;(t=this.alignmentGroupStyle)&&(null!=(e=t.padding)?t.padding=e>.4?-.3:e+.15:t.padding=.15,this.updateBackingShape())},setBackingShape:function(t){l.opt(this.alignmentGroupStyle,function(e){return e.backingArtworkID=t}),this.updateBackingShape()},styleChanged:function(){this.updateBackingShape()},moveableFormae:function(){for(var t=[],e=l.iter(this.forma.visitAsArray(f.FormaTraversal.JustChildren));!e.done;e.next()){var n=e.value;null!=n.controller&&n.controller.moveable&&t.push(n)}return l.sortInPlace(t,function(t,e){return t.finalFrame.center.distanceTo(_.TheoPoint.ZERO)<e.finalFrame.center.distanceTo(_.TheoPoint.ZERO)}),t},showLinkingButtons:{get:function(){if(this.moveableFormae().length>0)return!0;if(this.iconHack_)return!0;for(var t=l.iter(this.forma.siblingForma());!t.done;t.next()){var e=t.value;if(this.containsForma(e))return!0}return!1}},isLinked:{get:function(){var t;return!(t=this.alignmentGroupStyle)||t.layoutMode!=u.GroupLayoutMode.None}},toggleLinkChildren:function(){var t;if(t=this.alignmentGroupStyle)if(t.layoutMode==u.GroupLayoutMode.None)t.layoutMode=u.GroupLayoutMode.Flow,this.claimSiblingForma();else{t.layoutMode=u.GroupLayoutMode.None;for(var e=l.iter(this.moveableFormae());!e.done;e.next()){var n,r=e.value;(n=l.opt(this.forma,function(t){return t.parent}))&&(this.iconHack_=!0,n.appendChild(r,!0),this.iconHack_=!1)}}},setAlignmentSortOrder:function(){var t,e;if((t=l.as(this.forma,d.GroupForma))&&(e=this.alignmentGroupStyle)){var n=l.clone(t.filterWithCallback(function(t){return null!=t.controller},f.FormaTraversal.JustChildren)),r=[];l.sortInPlace(n,function(e,n){return e.frame.center.distanceTo(t.bounds.origin)>n.frame.center.distanceTo(t.bounds.origin)});for(var o=l.iter(n);!o.done;o.next()){var i=o.value;r.push(i.formaID)}e.order=l.clone(r)}},getSortedChildren:function(){var t,e,n,r;if((n=l.as(this.forma,d.GroupForma))&&(r=this.alignmentGroupStyle)){var o=l.clone(n.filterWithCallback(function(t){return null!=t.controller},f.FormaTraversal.JustChildren));return r.order.length!=o.length&&this.setAlignmentSortOrder(),l.sortInPlace(o,function(n,o){return((t=l.indexOf(r.order,n.formaID))||null!=t?t:1e3)>((e=l.indexOf(r.order,o.formaID))||null!=e?e:1e3)}),o}return[]},encode:function(t){c.CoreAssert.fail("ERROR. Should not be persisting alignment groups at this point. If you hit this, talk to Peter"),t.setOptionalStringProperty(S.ShapeGroupController.PROPERTY_BACKING_SHAPE_ID,this.backingShapeID_)},decode:function(t){this.backingShapeID_=t.optionalStringProperty(S.ShapeGroupController.PROPERTY_BACKING_SHAPE_ID)},getDesiredScales:function(t,e){for(var n=[],r=l.iter(t);!r.done;r.next()){var o,i=r.value;(o=i.frame)&&(null==(g=l.opt(this.alignmentGroupStyle,function(t){return t.scales[i.formaID]}))&&(g=l.opt(i.controller,function(t){return t.currentHeightScale})),null!=g&&n.push({forma:i,size:o.size,scale:g}))}for(var a=1,s=!1;!s&&a>.05;){s=!0;for(var u=l.iter(n);!u.done;u.next()){var c=u.value;c.forma.isTypeLockup()&&0==l.clone(this.getSizesForScale(c.forma,c.scale*a,e)).length&&(s=!1,a*=.9)}}for(var m=l.iter(l.range(0,n.length,!1));!m.done;m.next()){var h=m.value;(g=n[h]).forma.isTypeLockup()&&(n[h]={forma:g.forma,size:g.size,scale:g.scale*a})}for(var f={},p=l.iter(n);!p.done;p.next()){var g;f[(g=p.value).forma.formaID]={size:g.size,scale:g.scale}}return f},createChildScales:function(t){var e,n=l.clone(t.controller.getSizeHeightScales());if(this.childScales_[t.formaID]=l.clone(n),e=this.childScales_[t.formaID])if(e.length!=n.length)c.CoreAssert.fail("Error. scales don't match");else for(var r=l.iter(l.range(0,e.length,!1));!r.done;r.next()){var o=r.value,i=e[o].size.height/n[o].size.height;Math.abs(e[o].scale-n[o].scale*i)>1&&c.CoreAssert.fail("scale error")}return n},getSizesForScale:function(t,e,n){var r=[],o=l.clone(this.childScales_[t.formaID]);null==o&&(o=l.clone(this.createChildScales(t)));for(var i=l.iter(o);!i.done;i.next()){var a=i.value,s=a.size.multiply(e/a.scale);(null==n||s.width<=n.width&&s.height<=n.height)&&r.push(s)}var u=this.forma.bounds.scaleXY(2,1).size,m=t.bounds.size;if(l.sortInPlace(r,function(t,e){return 1*t.similarity(m)+t.similarity(u)<1*e.similarity(m)+e.similarity(u)}),null!=n)for(var h=l.iter(r);!h.done;h.next()){var f=h.value;c.CoreAssert.isTrue(f.width<=n.width+.001),c.CoreAssert.isTrue(f.height<=n.height+.001)}return r},getSeperatorPositions:function(t,e,n){var r;if(t.length>0&&(r=this.alignmentGroupStyle)){if(r.seperatorStyle==u.SeperatorStyle.None)return[];if(r.seperatorStyle==u.SeperatorStyle.FirstInner&&0==e)return[0];if(r.seperatorStyle==u.SeperatorStyle.Inner)return l.toArray(l.stride(0,t.length-1,1));if(r.seperatorStyle==u.SeperatorStyle.Outer&&0==e)return[-1,t.length-1];if(r.seperatorStyle==u.SeperatorStyle.BottomAll)return l.toArray(l.stride(0,t.length,1))}return[]},getColumnLayout:function(t,e){var n;if(n=this.alignmentGroupStyle){for(var r=l.clone(this.splitChildren(l.clone(t),e)),o=r.length,u=null!=n.marginTop?n.marginTop:i.DEFAULT_MARGINS,m=null!=n.marginBottom?n.marginBottom:i.DEFAULT_MARGINS,h=null!=n.marginLeft&&o<2?n.marginLeft:i.DEFAULT_MARGINS,p=null!=n.marginRight&&o<2?n.marginRight:i.DEFAULT_MARGINS,g=new T.TheoRect(e.minX+h,e.minY,e.maxX-p,e.maxY),d=l.clone(g.split(r.length,!0)),C=d[0],y=[],S=l.iter(t);!S.done;S.next())for(var P=S.value,b=l.iter(l.range(0,o,!1));!b.done;b.next()){var D=b.value;if(l.containsEq(r[D],P,f._equality_Forma_Forma)){y.push(D);break}}if(y.length!=t.length)return c.CoreAssert.fail("incorrect number of children in assignment"),null;for(var _=l.iter(t);!_.done;_.next())if(P=_.value,null==n.bottomDistances[P.formaID]||null==n.topDistances[P.formaID])return null;for(var x=l.repeat([],o),w=l.repeat([],o),I=l.repeat([],o),k=l.repeat(0,o),E=l.repeat(0,o),M=h/(2*l.toDouble(o)),G=p/(2*l.toDouble(o)),R=new A.TheoSize(C.width-M-G,C.height-u-m),L=l.repeat([],o),z=l.repeat([],o),B=l.clone(this.getDesiredScales(l.clone(t),R)),N=l.repeat([],o),Y=l.iter(l.range(0,r.length,!1));!Y.done;Y.next()){for(var O=Y.value,X=l.clone(r[O]),H=l.iter(l.range(1,X.length,!1));!H.done;H.next()){var U;D=H.value,null!=n.spacing?x[O].push(n.spacing):null!=(U=n.bottomDistances[X[D].formaID])?x[O].push(U):x[O].push(0)}I[O]=l.clone(this.getSeperatorPositions(l.clone(X),O,o));for(var K=l.iter(I[O]);!K.done;K.next())w[O].push(null!=n.seperatorHeight?n.seperatorHeight:i.DEFAULT_SEPERATOR_HEIGHT);var q=null!=n.marginTop?n.marginTop:n.bottomDistances[X[0].formaID],W=null!=n.marginBottom?n.marginBottom:n.topDistances[t[X.length-1].formaID];n.verticalAlignment==s.AlignmentType.CenterY&&(W=q=Math.max(q,W)),k[O]=q,E[O]=W;for(var V=l.iter(X);!V.done;V.next()){var J;if(null!=(J=B[(P=V.value).formaID])){0==(Pt=l.clone(this.getSizesForScale(P,J.scale,R))).length&&(Pt=l.clone(this.getSizesForScale(P,J.scale,null))),z[O].push(Pt[0]),N[O].push(J.scale);for(var Z=Pt[0],j=l.iter(Pt);!j.done;j.next()){var Q=j.value;Q.height<Z.height&&(Z=Q)}L[O].push(Z)}}}for(var $=l.toDouble(t.length-1),tt=!0,et=0;tt&&(100==et&&l.opt(v.Host.logging,function(t){return t.warning("error")}),!(et>10));){et+=1,tt=!1;for(var nt=0,rt=l.iter(l.range(0,o,!1));!rt.done;rt.next()){var ot=x[O=rt.value].reduce(function(t,e){return t+e},0),it=w[O].reduce(function(t,e){return t+e},0);if((nt=(Tt=(_t=L[O].reduce(function(t,e){return t+e.height},0))+(W=E[O])+(q=k[O])+ot+it)-C.height)>0){var at=null==n.spacing?ot-i.MIN_SPACING*$:0,lt=null==n.marginTop&&n.verticalAlignment!=s.AlignmentType.Top?q-i.DEFAULT_MARGINS:0,st=null==n.marginBottom&&n.verticalAlignment!=s.AlignmentType.Bottom?W-i.DEFAULT_MARGINS:0;if(at+lt+st>1){for(var ut=at+lt+st,ct=Math.min(nt,ut),mt=ct*(at/ut),ht=ct*(lt/ut),ft=ct*(st/ut),pt=l.iter(l.range(0,x[O].length,!1));!pt.done;pt.next())D=pt.value,x[O][D]-=mt*(x[O][D]/(ot+1e-4));k[O]-=ht,E[O]-=ft,tt=!0}else{ht=nt*(q/(Tt+1e-4)),ft=nt*(W/(Tt+1e-4)),mt=nt*(ot/(Tt+1e-4));for(var gt=1-nt*(_t/(Tt+1e-4))/_t,dt=l.iter(l.range(0,o,!1));!dt.done;dt.next()){for(var vt=dt.value,Ct=l.iter(l.range(0,L[vt].length,!1));!Ct.done;Ct.next())D=Ct.value,L[vt][D]=L[vt][D].multiply(gt),N[vt][D]=N[vt][D]*gt;for(var Ft=l.iter(l.range(0,x[vt].length,!1));!Ft.done;Ft.next())D=Ft.value,x[vt][D]-=mt*(x[vt][D]/(ot+1e-4)),x[vt][D]=Math.max(x[vt][D],i.MIN_SPACING);k[vt]=Math.max(k[vt]-ht,i.DEFAULT_MARGINS),E[vt]=Math.max(E[vt]-ft,i.DEFAULT_MARGINS)}tt=!0}}}}for(var yt=l.iter(l.range(0,o,!1));!yt.done;yt.next()){O=yt.value;for(var St=l.iter(l.range(0,L[O].length,!1));!St.done;St.next()){D=St.value;var Pt,bt=r[O][D],Dt=N[O][D];(Pt=l.clone(this.getSizesForScale(bt,Dt,R))).length>0&&L[O][D].height-Pt[0].height>0&&(L[O][D]=Pt[0])}ot=x[O].reduce(function(t,e){return t+e},0),it=w[O].reduce(function(t,e){return t+e},0);var _t,Tt=(_t=L[O].reduce(function(t,e){return t+e.height},0))+(W=E[O])+(q=k[O])+ot+it,At=C.height-Tt;if(!(At<=0)){var xt=n.verticalAlignment!=s.AlignmentType.Top?At:0,wt=n.verticalAlignment!=s.AlignmentType.Bottom?At:0,It=xt+wt;if(It>0){var kt=F.MathUtils.minDouble(At,It);k[O]+=kt*(xt/(It+1e-4)),E[O]+=kt*(wt/(It+1e-4)),At-=kt}for(var Et=null==n.spacing?At:0,Mt=l.iter(l.range(0,x[O].length,!1));!Mt.done;Mt.next())D=Mt.value,x[O][D]+=Et*(x[O][D]/(ot+1e-4));At-=Et}}for(var Gt=[],Rt=l.iter(l.range(0,o,!1));!Rt.done;Rt.next()){for(var Lt=[k[O=Rt.value]].concat(x[O]).concat([E[O]]),zt=l.iter(Lt);!zt.done;zt.next()){var Bt=zt.value;c.CoreAssert.isFalse(isNaN(Bt),"not expecting NaN")}Gt.push(l.clone(Lt))}var Nt=l.repeat(M,o),Yt=l.repeat(G,o);return new a.AlignmentColumnLayout(l.clone(d),l.clone(y),l.clone(L),l.clone(N),l.clone(Gt),l.clone(w),l.clone(I),l.clone(Nt),l.clone(Yt))}return null},splitChildren:function(t,e){var n,r=1;if(null!=(n=l.opt(this.alignmentGroupStyle,function(t){return t.numColumns}))?r=n:t.length>1&&(r=Math.max(1,Math.min(t.length,l.toInt(e.aspectRatio-1)))),1==r)return[t];for(var o=l.toDouble(t.length)/l.toDouble(r),i=[],a=0,s=l.iter(l.range(0,r,!1));!s.done;s.next()){for(var u=s.value,m=[];l.toDouble(a)<l.toDouble(u+1)*o&&a<t.length;)m.push(t[a]),a+=1;i.push(l.clone(m))}return c.CoreAssert.isTrue(a==t.length),i},applyStyle:function(t,e){var n,r;(n=l.as(t,u.AlignmentGroupStyle))&&(r=this.alignmentGroupStyle)&&(r.match(n),this.setFormaDistances(l.clone(this.getSortedChildren())),this.layoutGroup())},createLayoutItemsFromColumnLayout:function(t,e){var n,r=[];if(n=this.alignmentGroupStyle){for(var o=l.iter(l.range(0,e.columns.length,!1));!o.done;o.next()){for(var i=o.value,m=e.columns[i],h=l.clone(e.contentSizes[i]),f=l.clone(e.contentScales[i]),p=l.clone(e.contentSpacing[i]),g=l.clone(e.seperatorHeights[i]),d=l.clone(e.seperatorPositions[i]),v=p[0],C=[],F=l.iter(l.range(0,t.length,!1));!F.done;F.next()){var y=F.value;e.contentColumn[y]==i&&C.push(t[y])}c.CoreAssert.isTrue(C.length==h.length);for(var S=[],P=l.iter(l.range(0,h.length,!1));!P.done;P.next()){y=P.value;var b=new _.TheoPoint(m.center.x,v),D=new _.TheoPoint(.5,0);n.horizontalAlignment==s.AlignmentType.Left?(b=new _.TheoPoint(m.minX+e.marginLeft[i],v),D=new _.TheoPoint(0,0)):n.horizontalAlignment==s.AlignmentType.Right&&(b=new _.TheoPoint(m.maxX-e.marginRight[i],v),D=new _.TheoPoint(1,0));var T=l.clone(new a.AlignmentLayoutItem(C[y],a.AlignmentGroupItemType.DefaultContent,D,b,h[y],f[y],null,null));S.push(l.clone(T)),r.push(l.clone(T)),v+=h[y].height+p[y+1]}for(var x=0,w=l.iter(l.range(0,h.length,!1));!w.done;w.next())y=w.value,x=Math.max(x,h[y].width);for(var I=l.iter(l.range(0,g.length,!1));!I.done;I.next()){var k=d[y=I.value];T=null,T=-1==k?l.clone(S[0]):k>=S.length?l.clone(S[S.length-1]):l.clone(S[k]);var E=new A.TheoSize(.75*x,g[y]),M=null;if(n.seperatorStyle==u.SeperatorStyle.FirstInner||n.seperatorStyle==u.SeperatorStyle.BottomAll)M=new _.TheoPoint(T.parentPosition.x,T.parentPosition.y+T.size.height);else if(n.seperatorStyle==u.SeperatorStyle.Outer)E=new A.TheoSize(.75*x,g[y]),M=-1==k?new _.TheoPoint(T.parentPosition.x,T.parentPosition.y-E.height):new _.TheoPoint(T.parentPosition.x,T.parentPosition.y+T.size.height);else if(n.seperatorStyle==u.SeperatorStyle.Inner){var G=l.clone(S[k+1]);M=new _.TheoPoint(T.parentPosition.x,(T.parentPosition.y+T.size.height+G.parentPosition.y)/2)}r.push(l.clone(new a.AlignmentLayoutItem(null,a.AlignmentGroupItemType.SeperatorShape,T.formaPin,M,E,null,n.seperatorArtworkID,n.colors.fieldSecondary)))}}null!=n.backingArtworkID&&r.push(l.clone(new a.AlignmentLayoutItem(null,a.AlignmentGroupItemType.BackingShape,_.TheoPoint.ZERO,_.TheoPoint.ZERO,this.forma.bounds.size,null,n.backingArtworkID,n.colors.fieldPrimary)))}return r},applyColors:function(t,e){void 0===e&&(e=m.ColorRole.FieldPrimary),g.GroupController.prototype.applyColors.call(this,l.clone(t),e),this.updateBackingShape()},conformFormaToLayoutItems:function(t,e){for(var n=this,r=l.clone(this.forma.filterWithCallback(function(t){return null==t.controller&&t.kind==y.ShapeForma.KIND&&t!=n.backingShape_},f.FormaTraversal.JustChildren)),o=l.iter(e);!o.done;o.next()){var i=o.value;if(i.type==a.AlignmentGroupItemType.DefaultContent&&null!=i.forma){var s=i.forma.placement.transformValues;l.opt(i.forma.controller,function(t){return t.fit(T.TheoRect.fromSize(i.size))}),i.forma.move(C.Matrix2D.scalingXY(s.xscale,s.yscale)),i.forma.move(C.Matrix2D.rotation(s.rotCosine,s.rotSine)),i.forma.movePinToPoint(i.formaPin,i.parentPosition),l.opt(i.forma.controller,function(t){return t.setAlignmentType(n.alignmentGroupStyle.horizontalAlignment)})}else if(i.type!=a.AlignmentGroupItemType.SeperatorShape&&i.type!=a.AlignmentGroupItemType.BulletShape||null==i.artworkID){if(i.type==a.AlignmentGroupItemType.BackingShape&&null!=i.artworkID){if(null==this.backingShape_){for(var u=l.iter(this.forma.visitAsArray(f.FormaTraversal.JustChildren));!u.done;u.next()){var c=u.value;c.formaID==this.backingShapeID_&&c instanceof y.ShapeForma&&(this.backingShape_=l.as(c,y.ShapeForma),r.includes(this.backingShape_)&&l.remove(r,this.backingShape_))}null==this.backingShape_&&(this.backingShape_=l.as(this.forma.page.createForma(y.ShapeForma.KIND),y.ShapeForma),this.backingShapeID_=this.backingShape_.formaID,(v=this.forma).insertChildAt(this.backingShape_,0))}if(null!=this.backingShape_){P.ShapeLibrary.applyToShapeForma(this.backingShape_,i.artworkID),this.backingShape_.style.opacity=this.alignmentGroupStyle.opacity,(S=i.primaryColor)&&(this.backingShape_.style.colors.fieldPrimary=S);var m,h=T.TheoRect.fromSize(i.size);null!=(m=l.opt(this.alignmentGroupStyle,function(t){return t.padding}))&&(h=h.outsetXY(m*h.width*.5,m*h.height*.5));var p=new b.SVGBackgroundDecorationStrategy(i.artworkID).calcSVGFrame(h),g=p.frame,d=p.preScale;this.backingShape_.preScale=d,this.backingShape_.size=g.size,this.backingShape_.movePinToPoint(i.formaPin,i.parentPosition),this.backingShape_.move(C.Matrix2D.translationXY(g.minX,g.minY))}}}else{var v,F,S,D=null;0==r.length?(D=l.as(this.forma.page.createForma(y.ShapeForma.KIND),y.ShapeForma),(v=this.forma).insertChildAt(D,v.childCount-1)):D=r.pop(),(F=D)&&(P.ShapeLibrary.applyToShapeForma(F,i.artworkID),(S=i.primaryColor)&&(F.style.colors.fieldPrimary=S),F.size=i.size,F.movePinToPoint(i.formaPin,i.parentPosition))}}for(var _=l.iter(r);!_.done;_.next())_.value.removeFromParent();l.opt(this.alignmentGroupStyle,function(t){return null==t.backingArtworkID})&&(l.opt(this.backingShape_,function(t){return t.removeFromParent()}),this.backingShapeID_=null,this.backingShape_=null)},updateBackingShape:function(){var t;if(t=this.alignmentGroupStyle){var e=l.clone(this.getSortedChildren());if(null!=t.backingArtworkID){var n=l.clone(new a.AlignmentLayoutItem(null,a.AlignmentGroupItemType.BackingShape,_.TheoPoint.ZERO,_.TheoPoint.ZERO,this.forma.bounds.size,null,t.backingArtworkID,t.colors.fieldPrimary));this.conformFormaToLayoutItems(l.clone(e),[n])}}},layoutGroup:function(){var t,e,n=l.clone(this.getSortedChildren());if(n.length<1||this.blockAlignmentLayout_)this.updateBackingShape();else if((t=this.forma.bounds)&&(e=this.getColumnLayout(l.clone(n),t))){var r=l.clone(this.createLayoutItemsFromColumnLayout(l.clone(n),l.clone(e)));this.conformFormaToLayoutItems(l.clone(n),l.clone(r))}},fit:function(t){var e;(e=this.forma)&&(this.blockAlignmentLayout_=null==this.getChildrenAlignment(),e.bounds=T.TheoRect.fromSize(t.size),e.placement=C.Matrix2D.translation(t.origin),this.updateParentGroup(),this.blockAlignmentLayout_=!1)},updateChildren:function(){var t,e,n;if((t=this.oldBounds)&&(e=l.opt(this.forma,function(t){return t.bounds}))&&(n=this.alignmentGroupStyle))for(var r=e.height/t.height,o=l.keys(n.bottomDistances),i=l.iter(o);!i.done;i.next()){var a=i.value;n.setBottomDistance(a,n.bottomDistances[a]*r),n.setTopDistance(a,n.topDistances[a]*r)}},match:function(t){this.blockAlignmentLayout_=!0,g.GroupController.prototype.match.call(this,t),this.blockAlignmentLayout_=!1},updateGroup:function(){this.blockUpdate||this.blockChildUpdates_||(this.blockChildUpdates_=!0,g.GroupController.prototype.updateGroup.call(this),this.updateChildren(),this.layoutGroup(),this.blockChildUpdates_=!1)},setFormaDistances:function(t){var e={},n={};if(!(t.length<1)){for(var r,o=l.clone(this.splitChildren(l.clone(t),this.forma.bounds)),i=l.iter(o);!i.done;i.next())for(var a=i.value,s=l.iter(l.range(0,a.length,!1));!s.done;s.next()){var u=s.value,c=0,m=0,h=a[u];l.opt(v.Host.logging,function(t){return t.info("child frame "+h.finalFrame)}),c=u<a.length-1?this.getFormaFrame(a[u+1]).minY-this.getFormaFrame(h).maxY:Math.max(this.forma.bounds.maxY-this.getFormaFrame(h).maxY,0),((m=u>0?this.getFormaFrame(h).minY-this.getFormaFrame(a[u-1]).maxY:Math.max(this.getFormaFrame(h).minY-this.forma.bounds.minY,0))<0||c<0)&&l.opt(v.Host.logging,function(t){return t.info("possible error with negative distances")}),n[h.formaID]=m,e[h.formaID]=c,l.opt(v.Host.logging,function(t){return t.info("forma "+h.formaID+" has bottom distance: "+m+" top distance: "+c)})}if(r=this.alignmentGroupStyle)for(var f=l.iter(l.keys(e));!f.done;f.next()){var p=f.value;r.setTopDistance(p,e[p]),r.setBottomDistance(p,n[p])}}},getFormaFrame:function(t,e){void 0===e&&(e=!1);var n,r=e?t.finalFrame:t.frame;if(n=l.as(t.controller,D.TypeLockupController)){var o=n.textFinalFrame,i=n.textFrame;null!=o&&null!=i?r=e?o:i:l.opt(v.Host.logging,function(t){return t.error("text frame nil")})}return r},addFormaToGroup:function(t){var e;if(e=l.as(this.forma,d.GroupForma)){if(null!=e.indexOfChild(t))return void c.CoreAssert.fail("can't add an existing child");e.appendChild(t,!0),this.setAlignmentSortOrder(),this.setFormaDistances(l.clone(this.getSortedChildren()))}},insertForma:function(t,e,n){var r,o;if(void 0===e&&(e=null),void 0===n&&(n=!0),(r=l.as(this.forma,d.GroupForma))&&(o=this.alignmentGroupStyle)){if(null!=r.indexOfChild(t))return void c.CoreAssert.fail("can't insert an existing child");var i=l.clone(this.getSortedChildren());if(null!=e&&(e<0||e>i.length))return void c.CoreAssert.fail("index not valid ");var a=this.getFormaFrame(t),s=null!=e?e:0;if(null==e)for(var u=l.iter(l.range(0,i.length,!1));!u.done;u.next()){var m=u.value;a.minY>this.getFormaFrame(i[m]).minY&&(s=m+1)}0==s?(o.setBottomDistance(t.formaID,o.bottomDistances[i[0].formaID]),o.setTopDistance(t.formaID,o.topDistances[i[0].formaID]),o.setBottomDistance(i[0].formaID,o.topDistances[t.formaID])):s==i.length?(o.setBottomDistance(t.formaID,o.bottomDistances[i[s-1].formaID]),o.setTopDistance(t.formaID,o.topDistances[i[s-1].formaID]),o.setTopDistance(i[s-1].formaID,o.bottomDistances[t.formaID])):(o.setBottomDistance(t.formaID,o.topDistances[i[s-1].formaID]),o.setTopDistance(t.formaID,o.topDistances[i[s-1].formaID])),o.order.splice(s,0,t.formaID),null!=o.topDistances[t.formaID]&&null!=o.bottomDistances[t.formaID]||c.CoreAssert.fail("missing distances"),r.appendChild(t,!0),this.layoutGroup()}},removeFormaFromGroup:function(t){var e;g.GroupController.prototype.removeFormaFromGroup.call(this,t),(e=this.alignmentGroupStyle)&&(e.removeChild(t.formaID),this.inferStyleProperties())},handleRemoval:function(){for(var t=l.iter(this.getSortedChildren());!t.done;t.next()){var e=t.value;l.opt(l.opt(this.forma,function(t){return t.parent}),function(t){return t.appendChild(e,!0)})}},scaleChildren:function(t){},beginChildResizeEvent:function(t){this.updatedChild=t.forma},endChildResizeEvent:function(t){this.updatedChild=null,l.removeKey(this.childScales_,t.forma.formaID)},childUpdate:function(t){void 0===t&&(t=null)},processBeginFormaDrag:function(t){g.GroupController.prototype.processBeginFormaDrag.call(this,t)},processEndFormaDrag:function(t){g.GroupController.prototype.processEndFormaDrag.call(this,t),this.containsForma(t.forma)||(l.opt(l.opt(this.forma,function(t){return t.parent}),function(e){return e.appendChild(t.forma,!0)}),l.opt(this.alignmentGroupStyle,function(e){return e.removeChild(t.forma.formaID)})),this.inferStyleProperties(),this.claimSiblingForma()},afterProcessEndFormaDrag:function(t){this.containsForma(t.forma)||(l.opt(l.opt(this.forma,function(t){return t.parent}),function(e){return e.appendChild(t.forma,!0)}),l.opt(this.alignmentGroupStyle,function(e){return e.removeChild(t.forma.formaID)})),this.inferStyleProperties(),this.claimSiblingForma()},processFormaDrag:function(t){g.GroupController.prototype.processFormaDrag.call(this,t)},inferStyleProperties:function(){var t;if(t=this.alignmentGroupStyle){this.setAlignmentSortOrder();var e,n,r=l.clone(this.getSortedChildren());this.setFormaDistances(l.clone(r)),t.spacing=null,r.length>0&&null!=(e=t.bottomDistances[r[0].formaID])&&null!=(n=t.topDistances[r[r.length-1].formaID])&&(t.verticalAlignment=e>2*n&&e>50?s.AlignmentType.Bottom:n>2*e&&n>50?s.AlignmentType.Top:s.AlignmentType.CenterY);var o=this.getChildrenAlignment();null!=o&&(this.alignmentGroupStyle.horizontalAlignment=o),this.childrenAligned_=null!=o||r.length<=1}},canClaimForma:function(t){var e,n,r=t.finalFrame,o=l.opt(this.forma,function(t){return t.finalFrame});if(null!=r&&null!=o&&(e=l.opt(this.forma,function(t){return t.parent}))&&(n=this.alignmentGroupStyle)){if(n.layoutMode==u.GroupLayoutMode.None)return!1;var i,a;if(t.parent==e&&null!=(i=e.indexOfChild(this.forma))&&null!=(a=e.indexOfChild(t))&&i>a)return!1;if(this.containsForma(t))return!0}return!1},claimForma:function(t){g.GroupController.prototype.claimForma.call(this,t),this.forma!=t.parent&&!l.eq(f._equality_Forma_Forma,this.forma,t)&&this.canClaimForma(t)&&this.inferStyleProperties()},claimSiblingForma:function(){for(var t=l.iter(this.forma.siblingForma());!t.done;t.next()){var e=t.value;this.claimForma(e)}},getChildrenAlignment:function(){var t=l.clone(this.moveableFormae());if(0==t.length)return null;var e,n=1,r=l.first(t);(e=l.opt(l.opt(r,function(t){return t.page.view}),function(t){return t.getViewportTransform()}))&&(n=Math.sqrt(Math.abs(e.determinant)));for(var o,i=s.AlignmentDetector.DISTANCE_THRESHOLD/n,a=l.iter(t);!a.done;a.next()){var u=a.value;if(u.placement.transformValues.rotCosine<.99)return null;for(var c,m=0,h={},p=l.clone(s.AlignmentDetector.init_a05b(u).detectFormaAlignments(2*i)),g=l.iter(t);!g.done;g.next()){var d=g.value;if(!l.eq(f._equality_Forma_Forma,u,d)&&u.finalFrame.xDistance(d.finalFrame)<=0){m+=1;for(var v=l.iter(p);!v.done;v.next()){var C,F=v.value;l.eq(f._equality_Forma_Forma,F.forma,d)&&(null!=(C=h[F.line.type])?h[F.line.type]=C+1:h[F.line.type]=1)}}}for(var y=l.iter(h,!0);!y.done;y.next()){var S=y.key;y.value==m&&(c=s.AlignmentType.toCaseValue(S))}if(0==m)c=l.opt(u.controller,function(t){return t.preferredXAlignment});else if(null==c)return null;o=c}return o},preferredXAlignment:{get:function(){return l.opt(this.alignmentGroupStyle,function(t){return t.horizontalAlignment})}},setupWithFormae:function(t,e,n){if(void 0===e&&(e=null),void 0===n&&(n=null),0!=t.length){var r=n;null==r&&(r=t[0]);var o,i=e;null==i&&(i=null!=(o=l.opt(r.controller,function(t){return t.preferredXAlignment}))?o:s.AlignmentType.CenterX),this.setHorizontalAlignment(i,n);for(var a,u=null,c=l.iter(t);!c.done;c.next()){var m=c.value;u=T.TheoRect.unionOf(u,this.getFormaFrame(m,!0))}(a=u)&&l.opt(this.forma,function(t){return t.placement})&&(l.opt(this.forma,function(t){return t.bounds=T.TheoRect.fromSize(a.size)}),l.opt(this.forma,function(t){return t.placement=C.Matrix2D.translationXY(a.minX,a.minY)}));for(var h=l.iter(t);!h.done;h.next())m=h.value,g.GroupController.prototype.addFormaToGroup.call(this,m);this.setFormaDistances(l.clone(this.getSortedChildren()))}},processBeginFormaResize:function(t){var e;g.GroupController.prototype.processBeginFormaResize.call(this,t),(e=this.moveableInitState_)&&e.forEach(function(t){return t.dispose()}),this.moveableInitSize_={},this.moveableInitState_=[];for(var n=l.clone(this.moveableFormae()),r=l.iter(n);!r.done;r.next()){var o,i=r.value;(o=i.controller)&&(this.moveableInitSize_[i.formaID]=o.currentHeightScale,this.moveableInitState_.push(h.DesignSuggestion.init_a05b(i)))}this.childrenAligned_=null!=this.getChildrenAlignment(),this.initBounds_=l.opt(this.forma,function(t){return t.bounds}),this.initPlacement_=l.opt(this.forma,function(t){return t.placement})},processFormaResize:function(t){this.blockAlignmentLayout_=!0;var e=l.clone(this.moveableInitSize_);if(null!=e&&null!=this.alignmentGroupStyle&&(this.alignmentGroupStyle.scales=l.clone(e)),this.blockAlignmentLayout_){this.beginBlockedUpdate(),this.forma.bounds=this.initBounds_,this.forma.placement=this.initPlacement_,this.endBlockedUpdate();for(var n=l.iter(this.moveableInitState_);!n.done;n.next())n.value.apply()}var r,o,i=null;if((o=t.pin)&&(i=this.forma.totalPlacement.transformPoint(this.forma.bounds.eval(o))),this.forma.placement=this.forma.placement.scaleTo(1,1),this.forma.bounds=T.TheoRect.fromSize(t.newSize),(r=i)&&(o=t.pin)){var a=this.forma.totalPlacement.transformPoint(this.forma.bounds.eval(o));this.forma.move(C.Matrix2D.translation(r.subtract(a)))}this.updateParentGroup()},processEndFormaResize:function(t){g.GroupController.prototype.processEndFormaResize.call(this,t),this.blockAlignmentLayout_=!1,this.claimSiblingForma()},dispose:function(){var t;(t=this.moveableInitState_)&&t.forEach(function(t){return t.dispose()})},clone:function(t){return new p.FormaControllerFactory(this.owner).createController(this.kind,t)}}}),i)},155:function(t,e,n){var r,o=e,i=n(0),a=n(154),l=n(1),s=n(4),u=n(26),c=n(25),m=n(43),h=n(89),f=n(92),p=n(54),g=n(246),d=n(14),v=n(332);o.FormaControllerFactory=(r=function(t){this.constructors_={},this.owner_=t,s.CoreObject.call(this),this.setConstructors()},i.defineClass({name:"FormaControllerFactory",ctor:r,superName:"CoreObject",props:{owner:{get:function(){return this.owner_},set:function(t){this.owner_=t,this.setConstructors()}},setConstructors:function(){var t=this;this.constructors_[m.GroupController.KIND]=function(e,n,r){return new m.GroupController(e,n,i.opt(t,function(t){return t.owner_}))},this.constructors_[f.RootController.KIND]=function(e,n,r){return new f.RootController(e,n,i.opt(t,function(t){return t.owner_}))},this.constructors_[u.FrameController.KIND]=function(e,n,r){return new u.FrameController(e,n,i.opt(t,function(t){return t.owner_}))},this.constructors_[h.ImageController.KIND]=function(e,n,r){return new h.ImageController(e,n,i.opt(t,function(t){return t.owner_}))},this.constructors_[v.VideoController.KIND]=function(e,n,r){return new v.VideoController(e,n,i.opt(t,function(t){return t.owner_}))},this.constructors_[p.ShapeController.KIND]=function(e,n,r){return new p.ShapeController(e,n,i.opt(t,function(t){return t.owner_}))},this.constructors_[d.TypeLockupController.KIND]=function(e,n,r){return new d.TypeLockupController(e,n,i.opt(t,function(t){return t.owner_}))},this.constructors_[a.AlignmentGroupController.KIND]=function(e,n,r){return new a.AlignmentGroupController(e,n,i.opt(t,function(t){return t.owner_}))},this.constructors_[c.GridController.KIND]=function(e,n,r){return new c.GridController(e,n,i.opt(t,function(t){return t.owner_}))},this.constructors_[g.ShapeGroupController.KIND]=function(e,n,r){return new g.ShapeGroupController(e,n,i.opt(t,function(t){return t.owner_}))},this.constructors_.AbsolutePositionController=function(e,n,r){return new f.RootController(e,n,i.opt(t,function(t){return t.owner_}))},this.constructors_.responsive=function(e,n,r){return new m.GroupController(e,n,i.opt(t,function(t){return t.owner_}))}},createController:function(t,e){var n=this.constructors_[t];return null==n?(l.CoreAssert.warning("createController: No constructor for kind "+t+" available."),null):n(t,e,this.owner_)}}}),r)},197:function(t,e,n){var r,o,i=e,a=n(0),l=n(39),s=n(49),u=n(154),c=n(1),m=n(79),h=n(27),f=n(19),p=n(118),g=n(123),d=n(11),v=n(26),C=n(155),F=n(117),y=n(82),S=n(29),P=n(139),b=n(44),D=n(25),_=n(43),T=n(122),A=n(23),x=n(8),w=n(21),I=n(17),k=n(9),E=n(37),M=n(119),G=n(206),R=n(35),L=n(54),z=n(22),B=n(30),N=n(40),Y=n(114),O=n(124),X=n(14),H=n(248),U=n(15),K=n(10),q=n(28);i.FormaController=(r=function(t,e,n){this.kind=t,this.forma_=e,this.owner_=n},a.defineClass({name:"FormaController",ctor:r,superName:"CoreObject",props:{owner:{get:function(){return this.owner_}},forma:{get:function(){return this.forma_}},parentController:function(){for(var t=a.opt(this.forma,function(t){return t.parent});null!=t&&null!=t.controller;)t=t.parent;return null==t?null:t.controller},moveable:{get:function(){return null==this.forma.allowUserMove||this.forma.allowUserMove}},floating:{get:function(){return this.moveableInDirection(new U.TheoPoint(1,0))&&this.moveableInDirection(new U.TheoPoint(0,1))}},moveableInDirection:function(t){var e;return(e=a.as(a.opt(a.opt(this.forma,function(t){return t.parent}),function(t){return t.controller}),_.GroupController))?e.childMoveableInDirection(this.forma,t)&&this.moveable:this.moveable},selectable:{get:function(){return!1}},rotateable:{get:function(){return this.moveable}},replaceable:{get:function(){return!0}},deleteable:{get:function(){return!0}},duplicatable:{get:function(){return!1}},copyTo:function(t){return void 0===t&&(t=null),h.CorePromise.resolve(null)},flippable:{get:function(){return!1}},nudgeable:{get:function(){return!1}},scalable:{get:function(){var t=this;return!a.opt(this.forma,function(e){return null==e.parent||null!=t.forma&&D.GridController.isBackgroundColoredCell(t.forma)})}},opacityChangeable:{get:function(){return this.moveable}},maintainAspectRatio:{get:function(){return!1}},selectionHandlePositions:{get:function(){return c.CoreAssert.isTrue(this.selectable,"this forma isn't selectable. why get the handle positions?"),[new U.TheoPoint(0,0),new U.TheoPoint(0,1),new U.TheoPoint(1,0),new U.TheoPoint(1,1)]}},showHandle:function(t){var e,n=this;return null!=(e=a.opt(a.opt(a.opt(this.forma,function(t){return t.parent}),function(t){return t.controller}),function(e){return e.showChildHandle(n.forma,t)}))?e:this.selectionHandlePositions.includes(t)},visibleSelectionHandlePositions:{get:function(){for(var t=[],e=a.iter(this.selectionHandlePositions);!e.done;e.next()){var n=e.value;this.showHandle(n)&&t.push(n)}return t}},showChildHandle:function(t,e){var n=t.finalFrame.eval(e);return!(n.x<5||n.y<5||n.x>t.root.finalFrame.maxX-5||n.y>t.root.finalFrame.maxY-5)},alignmentDetector:{get:function(){return null==this.alignmentDetector_&&(this.alignmentDetector_=s.AlignmentDetector.init_a05b(this.forma_)),this.alignmentDetector_},set:function(t){this.alignmentDetector_=t}},getAlignments:function(t){var e;if(void 0===t&&(t=!1),e=this.forma_.bounds){c.CoreAssert.isFalse(isNaN(e.origin.x)||isNaN(e.origin.y),"forma "+this.forma_.kind+" "+(null!=this.forma_.controller?this.forma_.controller.kind:"")+" has Nan origin pt"),c.CoreAssert.isFalse(isNaN(e.size.width),"forma "+this.forma_.kind+" "+(null!=this.forma_.controller?this.forma_.controller.kind:"")+" has Nan width"),c.CoreAssert.isFalse(isNaN(e.size.height),"forma "+this.forma_.kind+" "+(null!=this.forma_.controller?this.forma_.controller.kind:"")+" has Nan height");var n=this.forma_.kind==R.RootForma.KIND||this.forma_.isGridCell()?z.SolidColor.ALIGNMENT_ROOT:z.SolidColor.ALIGNMENT_FORMA,r=this.forma_.kind==R.RootForma.KIND||this.forma_.isGridCell()?s.AlignmentLocation.Root:s.AlignmentLocation.Forma,o=this.forma_.visit(d.FormaTraversal.FurthestAncestor,function(t,e,n){return!0});return[new s.AlignmentLine(s.AlignmentType.Left,r,n,e.verticalLine(0).transform(this.forma_.totalPlacement),!1,o),new s.AlignmentLine(s.AlignmentType.CenterX,r,n,e.verticalLine(.5).transform(this.forma_.totalPlacement),!1,o),new s.AlignmentLine(s.AlignmentType.Right,r,n,e.verticalLine(1).transform(this.forma_.totalPlacement),!1,o),new s.AlignmentLine(s.AlignmentType.Top,r,n,e.horizontalLine(0).transform(this.forma_.totalPlacement),!1,o),new s.AlignmentLine(s.AlignmentType.CenterY,r,n,e.horizontalLine(.5).transform(this.forma_.totalPlacement),!1,o),new s.AlignmentLine(s.AlignmentType.Bottom,r,n,e.horizontalLine(1).transform(this.forma_.totalPlacement),!1,o)]}return[]},addForma:function(t,e,n){var r;return(r=a.as(t.root,R.RootForma))?(e.controller.fit(r.frame.insetRel(.25,.25,.25,.25)),r.appendChild(e),h.CorePromise.resolve(null)):h.CorePromise.reject("page has no root?")},getUserPerceivedFrame:function(){for(var t,e,n,r,o=a.clone(this.getAlignments()),i=a.iter(o);!i.done;i.next()){var l=i.value;if(l.location==s.AlignmentLocation.Forma)switch(l.type){case 0:t=l.line;break;case 2:e=l.line;break;case 3:n=l.line;break;case 5:r=l.line}}var u=a.opt(this.forma,function(t){return t.finalFrame});if(null!=u&&(null==t&&(t=u.verticalLine(0)),null==e&&(e=u.verticalLine(1)),null==n&&(n=u.horizontalLine(0)),null==r&&(r=u.horizontalLine(1))),null!=t&&null!=e&&null!=n&&null!=r){var c=t.intersection(n),m=n.intersection(e),h=r.intersection(e),f=r.intersection(t);if(null!=c&&null!=m&&null!=h&&null!=f)return K.TheoRect.boundsOfPoints([c,m,h,f])}return a.opt(this.forma,function(t){return t.finalFrame})},canMultiSelect:{get:function(){return this.selectable&&this.floating}},move:function(t){var e;(e=this.forma_)&&(e.placement=e.placement.concat(t),this.updateParentGroup())},place:function(t){var e;(e=this.forma_)&&(e.placement=t,this.updateParentGroup())},flip:function(t){var e;void 0===t&&(t=!1),(e=this.forma_)&&(O.TransformFacade.flipForma(e,t),this.updateParentGroup())},rotate:function(t){var e;void 0===t&&(t=Math.PI/180),(e=this.forma_)&&(O.TransformFacade.rotateForma(e,t),this.updateParentGroup())},rotation:function(){var t;return(t=this.forma_)?t.rotation():0},nudge:function(t){var e;(e=this.forma_)&&(O.TransformFacade.translateForma(e,t),this.updateParentGroup())},fit:function(t){var e,n;(e=this.forma)&&(e.placement=k.Matrix2D.Identity,e.bounds=K.TheoRect.fromSize(t.size),(n=e.frame)&&(e.move(k.Matrix2D.uniformScaling(n.aspectRatio>=1?t.width/n.width:t.height/n.height)),e.moveCenterToPoint(t.center)),this.updateParentGroup())},clone:function(t){return new C.FormaControllerFactory(this.owner).createController(this.kind,t)},match:function(t){var e,n;if((e=a.opt(this.forma,function(t){return t.bounds}))&&(n=a.opt(t.forma,function(t){return t.bounds}))&&!e.equal(n))if(this.maintainAspectRatio){var r=n.fitAspectRatioWithin(e.aspectRatio);this.forma.bounds=K.TheoRect.fromSize(r),this.forma.moveCenterToPoint(t.forma.frame.center)}else this.forma.bounds=t.forma.bounds},postMatch:function(t){},styleChanged:function(){},contentID:{get:function(){return null}},settings:{get:function(){return null}},attach:function(){},detach:function(){},encode:function(t){},decode:function(t){},postDecode:function(){},onEvent:function(t){this.preProcessEvent(t)||this.processEvent(t)||this.postProcessEvent(t)},preProcessEvent:function(t){return!1},processEvent:function(t){return null!=this.owner&&((e=a.as(t,y.BeginPointerTrackingEvent))?e.trackingResponse=F.BeginPointerTrackingResponseEnum.TrackWithinGroup:t instanceof y.BeginFormaDragEvent?this.processBeginFormaDrag(t):t instanceof y.EndFormaDragEvent?this.processEndFormaDrag(t):t instanceof y.FormaDragEvent?this.processFormaDrag(t):t instanceof y.FormaClickEvent?this.processFormaClick(t):t instanceof y.FormaDoubleClickEvent?this.processFormaDoubleClick(t):t instanceof y.BeginFormaResizeEvent?this.processBeginFormaResize(t):t instanceof y.FormaResizeEvent?this.processFormaResize(t):t instanceof y.EndFormaResizeEvent&&this.processEndFormaResize(t),!1);var e},processFormaDoubleClick:function(t){},processBeginFormaResize:function(t){var e;this.alignmentDetector_=s.AlignmentDetector.init_a05b(this.forma_),(e=a.as(a.opt(this.forma.parent,function(t){return t.controller}),_.GroupController))&&e.beginChildResizeEvent(t)},processFormaResize:function(t){var e;if(this.clearAlignmentLines(),e=this.forma.bounds){var n=this.forma.placement.transformPoint(this.forma.bounds.eval(t.pin)),r=t.newSize.width>=0?t.newSize.width:this.forma.bounds.width,o=t.newSize.height>=0?t.newSize.height:this.forma.bounds.height,i=new q.TheoSize(r,o);this.maintainAspectRatio&&(i=e.size.myAspectRatioClosestCorner(i));var a=this.forma.placement.extractedScale;this.forma.placement=a.matrix,this.forma.bounds=K.TheoRect.fromSize(i);var l=this.forma.placement.transformPoint(this.forma.bounds.eval(t.pin));this.forma.move(k.Matrix2D.translation(U._minus_TheoPoint_TheoPoint(n,l))),this.updateParentGroup()}},processEndFormaResize:function(t){var e,n=new b.FormaAlignmentChangedEvent(this.forma_,[],null);this.forma_.beginUpdate(n),this.forma_.endUpdate(n),(e=a.as(a.opt(this.forma.parent,function(t){return t.controller}),_.GroupController))&&e.endChildResizeEvent(t)},processBeginFormaDrag:function(t){this.clearAlignmentLines();var e=a.clone(t.dragDelegate.draggedFormae);this.alignmentDetector_=s.AlignmentDetector.init_f94b(a.clone(e));var n=this.owner.document.firstPage;n.publish(new P.BeginFormaDragMessage(n))},afterProcessBeginFormaDrag:function(t){},processEndFormaDrag:function(t){var e=a.first(t.dragDelegate.draggedFormae),n=t.drag.viewportScale,r=26/n;g.DragFacade.rescueFormaToPageBounds(e,r,24/n);var o=new b.FormaAlignmentChangedEvent(e,[],null);e.beginUpdate(o),e.endUpdate(o);var i,l,s=this.owner.document.firstPage;if(s.publish(new P.EndFormaDragMessage(s)),i=a.opt(e.root,function(t){return t.filterWithCallback(function(t){return t instanceof A.GroupForma&&null!=t.controller})}))for(var u=a.iter(i);!u.done;u.next()){var c,m=u.value;(c=a.as(m.controller,_.GroupController))&&c.canClaimForma(e)&&c.claimForma(e)}else x.Host.logging.error("Error: forma has not root "+e.print());(l=a.as(e.controller,X.TypeLockupController))&&l.invalidateStyleScores()},afterProcessEndFormaDrag:function(t){},containsForma:function(t){var e,n=a.clone(t.totalPlacement.transformPoints(a.clone(t.bounds.points))),r=a.clone(this.forma.totalPlacement.inverse.transformPoints(a.clone(n))),o=r.map(function(t){return t.x},this),i=r.map(function(t){return t.y},this),l=K.TheoRect.fromXYXY(a.min(o),a.min(i),a.max(o),a.max(i));return!!(e=a.opt(this.forma.bounds,function(t){return t.intersectionWith(l)}))&&e.area>.8*l.area},clearAlignmentLines:function(){var t=new b.FormaAlignmentChangedEvent(this.forma,[],[]);this.forma.beginUpdate(t),this.forma.endUpdate(t)},beforeProcessFormaDrag:function(t){},afterProcessFormaDrag:function(t){},processFormaDrag:function(t){var e=this,n=t.drag,r=1==t.dragDelegate.draggedFormae.length;t.dragDelegate.forEachDraggedForma(function(t,o){return e.processOneFormaDrag(n,t,o,r)})},processOneFormaDrag:function(t,e,n,r){if(null!=this.owner){var o=this.owner;if(c.CoreAssert.isTrue(null!=e.controller,"processFormaDrag dragged forma with nil controller, forma kind "+e.kind+" and controller kind: "+this.kind),null!=e.controller){var i=e.controller;if(!(!i.moveable||o.interactionMode==p.InteractionMode.SelectionFocused&&o.selection.selectedCount>0&&!o.selection.isSelected(e)))if(x=t.newDragPlacement)i.place(x);else{var l=new b.FormaTransformChangedEvent(e);e.beginUpdate(l);var s,u=a.opt(e.parent,function(t){return t.totalPlacement.inverse})||k.Matrix2D.Identity,m=t.freeMovement(u),h=m.movement,f=m.rise,g=m.run,v=g>0&&Math.abs(f/g),C=new U.TheoPoint(.5,.5);switch(s=e.parent instanceof S.FrameForma?e.parent.bounds.center:k._asterisk_TheoPoint_Matrix2D(e.bounds.center,n),C=e.bounds.locatePoint(e.placement.inverse.transformPoint(s)),t.dragMode){case 1:h=t.noScale(u,s);break;case 2:h=t.noRotation(u,s)}v=t.dragMode==G.DragMode.NoScaleNoSkew,c.CoreAssert.isFalse(0==h.determinant),k._asterisk_Matrix2D_Matrix2D(k._asterisk_Matrix2D_Matrix2D(k.Matrix2D.translation(s),h),k.Matrix2D.translation(U._negate_TheoPoint(s))),t.uncommitedMovement=h;var F=t.activePace()==G.DragPace.MediumPace||t.currentlySnapped;r||(F=!1),t.dragMode==G.DragMode.UniformScaleNoRotationNoSkew&&(F=!1);var y,_=a.clone(e.filterByControllerKind(D.GridController.KIND,d.FormaTraversal.NearestAncestor));(y=a.as(a.opt(a.first(_),function(t){return t.controller}),D.GridController))&&y.isChildSwappable(e)&&(F=!1);var T,A=t.currentlySnapped;if(T=e.controller){var x=k._asterisk_Matrix2D_Matrix2D(n,h);if(T.place(x),t.currentlySnapped=!1,F)null!=T.setSnappedPlacement(v?C:null,8/t.viewportScale,!1).movement&&(t.currentlySnapped=!0),!A&&t.currentlySnapped&&t.commitDrag();else{var w=new b.FormaAlignmentChangedEvent(e,[],null);this.forma_.beginUpdate(w),this.forma_.endUpdate(w)}}t.currentlySnapped,e.endUpdate(l);var I=o.document.firstPage;I.publish(new P.FormaDragMessage(I))}}}},processFormaClick:function(t){var e,n=this;this.alignmentDetector_=s.AlignmentDetector.init_a05b(this.forma_);var r,o=t.forma,i=1==t.modifierKeys.shift||1==t.modifierKeys.command||1==t.modifierKeys.control;r=x.Host.platform.isWeb?"Web":x.Host.platform.isIOS?"iOS":x.Host.platform.isAndroid?"Android":"Unknown",i?this.owner.selection.isSelected(o)?(this.owner.selection.deselectForma(o),a.opt(x.Host.logging,function(t){return t.logToAnalytics(l.AnalyticsConstants.kAnalyticsEventClickOccured,{contextualData2:"New selected count: "+a.toString(n.owner.selection.selectedCount),contextualData3:"Did deselect: yes",contextualData4:"Platform: "+r})})):(this.owner.selection.selectForma(o),a.opt(x.Host.logging,function(t){return t.logToAnalytics(l.AnalyticsConstants.kAnalyticsEventClickOccured,{contextualData2:"New selected count: "+a.toString(n.owner.selection.selectedCount),contextualData3:"Did deselect: no",contextualData4:"Platform: "+r})})):this.owner.selection.isSelected(o)?((e=a.opt(x.Host.platform,function(t){return t.isWeb}))||null!=e)&&e||this.owner.selection.deselectForma(o):(o.controller.selectable&&this.owner.selection.replaceSelection(o),this.owner.controllerSettingsState.settings=null)},setSnappedPlacement:function(t,e,n){var r,o=this.alignmentDetector.snapped_Placement(t,e,n),l=o[0],s=o[1];(r=l)&&this.move(r);for(var u=[],c=a.iter(this.alignmentDetector.possibleAlignmentLines);!c.done;c.next())for(var m=c.value,h=a.iter(m.lines);!h.done;h.next()){var f=h.value;u.push(f)}var p=new b.FormaAlignmentChangedEvent(this.forma_,a.clone(s),null);return this.forma_.beginUpdate(p),this.forma_.endUpdate(p),new i.SnappedPlacement(l,a.clone(s.length>0?s:null))},updateParentGroup:function(){var t,e=a.opt(this.forma,function(t){return t.parent});(t=a.as(a.opt(e,function(t){return t.controller}),_.GroupController))&&t.childUpdate(this.forma_)},postProcessEvent:function(t){return!1},containsPoint:function(t,e){void 0===e&&(e=0);var n=this.forma.bounds;return null!=n&&(0!=e&&(n=n.outsetXY(e,e)),n.containsPoint(t))},applyStyle:function(t,e){void 0===e&&(e=0),a.opt(this.forma,function(e){return e.applyStyle(t)})},shuffleColorAssignment:function(){if(a.opt(this.forma,function(t){return null!=t.style})){var t,e=this.getCurrentColors(this.forma.style).length,n=[];if(t=this.getBackgroundColor()){var r=this.forma.page.colorLibraryController,o=a.clone(r.getThemeColorKeys());if(o.length>e){var i=r.getKeyOfColorInTheme(r.getTheoColorForSolidColor(t));null!=i&&a.remove(o,i)}for(var l=[],s=a.iter(o);!s.done;s.next()){var u=s.value,c=r.getSolidColorForKey(u);null!=c&&c.contrasts(t,!1)&&l.push(u)}l.length>=e&&(o=a.clone(l)),a.shuffleInPlace(o);for(var m=0;m<e;)n.push(r.getTheoColorForKey(o[m])),m+=1}for(var h=a.iter(a.range(0,n.length,!1));!h.done;h.next()){var f,p=h.value;if(null!=(f=this.forma.page.colorLibraryController.getKeyOfColorInTheme(n[p]))){var g,d=(new M.ProfilingColorMap).overridePaletteMappingDueToContrast(f,this.forma.formaID);(g=this.forma.page.colorLibraryController.getTheoColorForKey(d))&&(n[p]=g)}}this.applyColors(a.clone(n))}},getSuggestableColors:function(){for(var t=this.forma.page.colorLibraryController,e=a.clone(t.getColorThemeAsArrayOfTheoColors()),n=[],r=a.iter(e);!r.done;r.next()){var o=r.value;o.isBrandkitColor()||n.push([o])}return n},getCurrentColors:function(t){var e,n,r=[];return this.primaryColorVisible()&&(e=t.colors.color(f.ColorRole.FieldPrimary))&&r.push(e),this.secondaryColorVisible()&&(n=t.colors.color(f.ColorRole.FieldSecondary))&&r.push(n),r},applyColors:function(t,e){var n;if(void 0===e&&(e=f.ColorRole.FieldPrimary),n=this.forma){var r=a.clone(n.page.colorLibraryController.addColorsToTheme(a.clone(t),n));r.length>0&&n.style.colors.setColorId(f.ColorRole.FieldPrimary,r[0]),r.length>1&&n.style.colors.setColorId(f.ColorRole.FieldSecondary,r[1])}this.updateParentGroup()},primaryColorVisible:function(){return!0},secondaryColorVisible:function(){return!1},applyOpacity:function(t){a.opt(a.opt(a.opt(this.forma,function(t){return t.root}),function(t){return t.animation}),function(t){return t.invalidate()}),a.opt(this.forma,function(e){return e.style.opacity=t}),this.updateParentGroup()},currentOpacity:{get:function(){var t;return(t=a.opt(this.forma,function(t){return t.style.opacity}))||null!=t?t:1}},preferredXAlignment:{get:function(){return null}},setAlignmentType:function(t){},currentHeightScale:{get:function(){var t,e;if((t=a.opt(this.forma,function(t){return t.bounds}))&&(e=a.opt(this.forma,function(t){return t.totalPlacement}))){var n=a.clone(t.evalPts([U.TheoPoint.ZERO,new U.TheoPoint(0,1)])),r=a.clone(e.transformPoints(a.clone(n)));return r[0].distanceTo(r[1])}return null}},getSizeHeightScales:function(){var t;return(t=a.opt(this.forma,function(t){return t.bounds}))?[{size:t.size,scale:t.height}]:[]},setHeightScale:function(t,e,n){void 0===e&&(e=null),void 0===n&&(n=!1);var r=e||this.getPin();null!=r&&(r.targetHeight=t,this.matchPreviousPin(r,n))},getParentForPin:function(){var t;return(t=this.forma)?a.opt(a.opt(t.parent,function(t){return t.controller}),function(t){return t.kind==_.GroupController.KIND})||a.opt(a.opt(t.parent,function(t){return t.controller}),function(t){return t.kind==u.AlignmentGroupController.KIND})?t.parent:T.GroupDetector.getVisualParent(t):null},determinePinPosition:function(t,e,n,r,o,i,a,l){var s=i-o,u=e-t,c=Math.max(-1*(o-t)/s,0),m=Math.min(1-(i-t-u)/s,1),h=Math.max(Math.max(o,0)-t,0)/s,f=Math.max(e-i,0)/s,p=Math.max(Math.max(o,0)-n,0)/s,g=Math.max(Math.min(r,e)-i,0)/s;return this.isFrameCentered(p,g)||this.isFrameCentered(h,f)?(c+m)/2:E.MathUtils.absDouble(a-t)<25?0:E.MathUtils.absDouble(l-e)<25?1:p>g?m:c},isFrameCentered:function(t,e){var n=.1+Math.min(t,e);return E.MathUtils.absDouble(t-e)<n&&(t>=0&&e>=0||t+e<.05)},visualParent:{get:function(){return T.GroupDetector.getVisualParent(this.forma)}},visualParentExpansionFrame:{get:function(){var t=T.GroupDetector.getVisualParent(this.forma),e=this.getExpansionBounds(t);return t.totalPlacement.transformRect(e)}},getExpansionBounds:function(t){var e,n,r;if((e=this.forma)&&e.bounds&&(n=t.bounds)&&(r=this.getFrameInOtherFormaCoord(t))){for(var o=n.minX,i=n.maxX,l=n.minY,s=n.maxY,u=a.clone(e.parent.filterWithCallback(function(t){return null!=t.controller&&t.controller.floating})),c=a.iter(u);!c.done;c.next()){var m=c.value;if(!a.eq(d._equality_Forma_Forma,m,e)){var h=m.controller.getFrameInOtherFormaCoord(t);if(!m.isTypeLockup()&&h.intersects(r))continue;var f=Math.max(r.minX,h.minX),p=Math.min(r.maxX,h.maxX),g=Math.max(r.minY,h.minY),v=Math.min(r.maxY,h.maxY),C=E.MathUtils.absDouble(1-(p-f)/Math.min(r.width,h.width))<.2,F=E.MathUtils.absDouble(1-(v-g)/Math.min(r.height,h.height))<.2;p>f&&!F&&(h.center.y>r.center.y?s=Math.min(s,(h.minY+r.maxY)/2):l=Math.max(l,(h.maxY+r.minY)/2)),v>g&&!C&&(h.center.x>r.center.x?i=Math.min(i,(h.minX+r.maxX)/2):o=Math.max(o,(h.maxX+r.minX)/2))}}return new K.TheoRect(o,l,i,s)}return null},boundaryAlignment:function(t,e){return E.MathUtils.absDouble(t.minX-e.minX)<25||E.MathUtils.absDouble(t.maxX-e.maxX)<25||E.MathUtils.absDouble(t.minY-e.minY)<25||E.MathUtils.absDouble(t.maxY-e.maxY)<25},getPinBounds:function(t){return a.opt(this.forma,function(t){return t.bounds})},getPin:function(t,e){void 0===t&&(t=!0),void 0===e&&(e=!0);var n,r,o,i=this;if(!this.floating)return null;if((n=this.forma)&&(r=n.finalFrame)&&(o=a.opt(n.root,function(t){return t.finalFrame}))){var l=this.currentHeightScale;null==l||!n.isShape()&&0!=l||(l=null);var u,c=this.getParentForPin(),m=c.finalFrame,h=m,f=H.PinBoundsType.Bounds,p=r,g=!1;a.as(this,_.GroupController)&&(u=n.childrenFinalFrame)&&(p=u,(g=this.boundaryAlignment(u,o))&&(f=H.PinBoundsType.ChildrenBounds));var d,v=this.getExpansionBounds(c),C=c.totalPlacement.transformRect(v),F=this.determinePinPosition(h.minX,h.maxX,C.minX,C.maxX,r.minX,r.maxX,p.minX,p.maxX),y=this.determinePinPosition(h.minY,h.maxY,C.minY,C.maxY,r.minY,r.maxY,p.minY,p.maxY),S=r.eval(new U.TheoPoint(F,y)),P=this.forma.totalPlacement.inverse.transformPoint(S),b=new U.TheoPoint(P.x/this.forma.bounds.width,P.y/this.forma.bounds.height),D=c.totalPlacement.inverse.transformPoint(S),T=c.bounds,A=new U.TheoPoint(D.x/T.width,D.y/T.height),x=H.PinBoundsType.Bounds,w=new H.TheoPin(n,f,b,c,x,A,l,0,0),I=1;(d=a.opt(n.page.view,function(t){return t.getViewportTransform()}))&&(I=Math.sqrt(Math.abs(d.determinant)));var k=s.AlignmentDetector.DISTANCE_THRESHOLD/I,E=Math.abs(m.center.x-r.center.x)<5;if(t&&!g&&!E){var M=a.clone(this.alignmentDetector.detectFormaAlignments(2*k,!0,!1));a.sortInPlace(M,function(t,e){return 10*Math.abs(t.offset.length())+t.line.line.length+.1*a.toDouble(t.line.type)<10*Math.abs(e.offset.length())+e.line.line.length+.1*a.toDouble(e.line.type)});for(var G=a.iter(M);!G.done;G.next()){var R,L,z=G.value;if((R=a.opt(this.getPinBounds(f),function(t){return t.transform(i.forma.totalPlacement)}))&&(L=a.opt(z.forma.controller.getPinBounds(H.PinBoundsType.Bounds),function(t){return t.transform(z.forma.totalPlacement)}))){var B=Math.max(0,-1*Math.min(R.maxY-L.minY,L.maxY-R.minY));if(z.forma.parent!=n.parent||L.area<=p.area||L.intersects(R)||!z.forma.controller.floating||B>200)continue;var N=null;if(z.line.type==s.AlignmentType.CenterX?N=.5:z.line.type==s.AlignmentType.Left?N=0:z.line.type==s.AlignmentType.Right&&(N=1),null!=N){F=N;var Y=z.forma,O=(x=H.PinBoundsType.Bounds,this.forma.controller.getPinBounds(f)),X=Y.controller.getPinBounds(x),K=Y.totalPlacement.transformPoint(X.eval(new U.TheoPoint(.5,.5))),q=this.forma.totalPlacement.inverse.transformPoint(K);y=.5,q.y>O.maxY?y=1:q.y<O.minY&&(y=0);var W=new U.TheoPoint(F,y),V=new U.TheoPoint(F,1-y),J=(A=Y.totalPlacement.transformPoint(X.eval(V)),this.forma.totalPlacement.transformPoint(O.eval(W))),Z=Math.abs(J.y-A.y),j=Z/Y.controller.currentHeightScale;return new H.TheoPin(n,f,W,Y,x,V,l,Z,j,!0)}}}}return w}return null},matchPreviousPin:function(t,e){void 0===e&&(e=!1);var n,r,o=this.forma.placement.transformValues;if((n=this.getParentForPin())&&(r=n.bounds)){for(var i,l,s,u,c,m,h=this.forma.isTypeLockup()&&!this.maintainAspectRatio?2:1,f=this.getExpansionBounds(n),p=a.iter(a.range(0,h,!1));!p.done;p.next()){var g=p.value,d=this.getFrameInOtherFormaCoord(n);d=d.scale(1.1,new U.TheoPoint(.5,.5));var v=Math.max(d.minX-f.minX,0),C=Math.max(Math.min(f.maxX,r.maxX)-d.maxX,0),F=Math.max(d.minY-f.minY,0),y=Math.max(Math.min(f.maxY,r.maxY)-d.maxY,0);v=0==t.pinPoint.x?0:v,C=1==t.pinPoint.x?0:C,F=0==t.pinPoint.y?0:F,y=1==t.pinPoint.y?0:y,.5==t.pinPoint.x&&(v=Math.min(v,C),C=Math.min(v,C)),.5==t.pinPoint.y&&(F=Math.min(F,y),y=Math.min(F,y));var S=1+(v+C)/d.width,P=1+(F+y)/d.height,b=this.currentHeightScale,D=null!=t.targetHeight&&null!=b?t.targetHeight/b:1;if(Math.abs(D-1)<.01)break;var _=S>D,T=P>D;if(!(g>0&&Math.abs(D-1)<.05))if(this.maintainAspectRatio){var A=_&&T?D:Math.min(S,P);this.forma.bounds=a.opt(this.forma.bounds,function(t){return t.scaleXY(A,A,new U.TheoPoint(0,0))})}else this.forma.bounds=_&&T?a.opt(this.forma.bounds,function(t){return t.scaleXY(D,D,new U.TheoPoint(0,0))}):_?a.opt(this.forma.bounds,function(t){return t.scaleXY(D,P,new U.TheoPoint(0,0))}):T?a.opt(this.forma.bounds,function(t){return t.scaleXY(S,D,new U.TheoPoint(0,0))}):a.opt(this.forma.bounds,function(t){return t.scaleXY(S,P,new U.TheoPoint(0,0))})}null!=(i=t.targetHeight)&&null!=(l=this.currentHeightScale)&&(s=a.opt(this.forma,function(t){return t.finalFrame}))&&(u=a.opt(this.forma,function(t){return t.bounds}))&&(c=a.opt(a.opt(this.forma,function(t){return t.root}),function(t){return t.finalFrame}))&&(D=i/l,Math.abs(D-1)>.001&&(f=this.getExpansionBounds(n),(e||u.width*D<f.width&&u.height*D<f.height&&s.width*D<c.width&&s.height*D<c.height)&&(this.forma.placement=this.forma.placement.scaleTo(o.xscale*D,o.yscale*D)))),(m=a.as(this.forma.controller,X.TypeLockupController))&&m.snapSizeToBounds(),this.forma.move(t.offsetMatrix()),f=this.getExpansionBounds(n),this.preventOutofBounds(n,f);for(var x=.9;t.containedInParent&&this.preventOutofBounds(n,f)&&x>=.5;)this.forma.move(t.offsetMatrix()),x-=.1}},getFrameInOtherFormaCoord:function(t){var e,n;return(e=this.forma.bounds)&&(n=t.totalPlacement.inverse)?t==a.opt(this.forma,function(t){return t.parent})?a.opt(this.forma,function(t){return t.frame}):this.forma.totalPlacement.concat(n).transformRect(e):null},preventOutofBounds:function(t,e,n){void 0===n&&(n=0);var r,o,i=!1;if((r=null!=e?e:t.bounds)&&(o=this.getFrameInOtherFormaCoord(t))&&!r.contains(o)){var a=r.insetXY(n,n),l=o.minX-a.minX,s=o.maxX-a.maxX,u=o.minY-a.minY,c=o.maxY-a.maxY;l<0&&(this.forma.move(k.Matrix2D.translationXY(-l,0)),i=!0),s>0&&(this.forma.move(k.Matrix2D.translationXY(-s,0)),i=!0),u<0&&(this.forma.move(k.Matrix2D.translationXY(0,-u)),i=!0),c>0&&(this.forma.move(k.Matrix2D.translationXY(0,-c)),i=!0)}return i},linkedForma:function(t){var e,n;return(e=this.forma.parent)&&(n=e.controller)?n.linkedFormaForChild(this.forma,t):[]},linkedFormaForChild:function(t,e){return[]},getZOrder:function(){var t,e=-1;return null==this.forma||null==this.forma.parent?(c.CoreAssert.isTrue(!1),e):e=(t=this.forma.parent.indexOfChild(this.forma))||null!=t?t:-1},setZOrder:function(t){null!=this.forma&&null!=this.forma.parent?this.forma.parent.insertChildAt(this.forma,t):c.CoreAssert.isTrue(!1)},getMinLayerIndex:function(){var t=0;if(null==this.forma||null==this.forma.parent)return c.CoreAssert.isTrue(!1),t;var e=this.forma.parent;return null!=e&&(t=a.clone(e.filterWithCallback(function(t){return(t.isBackgroundImage()||t.isShape())&&null!=t.controller&&!t.controller.floating},d.FormaTraversal.JustChildren)).length),t},getReorderableLayerCount:function(){var t=0;if(null==this.forma)return c.CoreAssert.isTrue(!1),t;if(a.opt(this.forma,function(t){return t.isGridCell()}))return t;var e=this.forma.parent;return null!=e&&(t=a.clone(e.filterWithCallback(function(t){return!t.isBackgroundImage()&&!D.GridController.isBackgroundColoredCell(t)},d.FormaTraversal.JustChildren)).length),t},contrastCheck:function(t){var e,n,r;if(void 0===t&&(t=!0),(e=this.forma.style.colors.fieldPrimary)&&null!=(n=this.forma.style.colors.colorID(f.ColorRole.FieldPrimary))&&(r=this.getBackgroundColor())&&!e.contrasts(r,t)){var o=e.contrastWithColor(r),i=m.ColorLibraryController.getBackgroundContrastKey(n);this.forma.page.colorLibraryController.setTheoColorToLibrary(Y.TheoColor.init_5344(o,null,null),i),this.forma.style.colors.setColorId(f.ColorRole.FieldPrimary,i)}},getBackingContrastRole:function(){return f.ColorRole.FieldPrimary},getBackgroundColor:function(t){void 0===t&&(t=null);var e=this;if(null==this.forma.finalFrame)return null;var n,r=null!=t?t:this.forma.finalFrame;if(n=a.as(this.forma.root,R.RootForma)){var o,i=n.style.colors.fieldPrimary,l=a.opt(n.finalFrame,function(t){return t.intersectionWith(r)});if(null==l)return null;r=l,(o=a.as(this,X.TypeLockupController))&&o.styleController.targetedLockupStyle!==o.lockupStyle&&o.textBacked&&!I.LockupStyle.isShadowLook(o.lockupStyle.textLook)&&(i=o.lockupStyle.colors.fieldPrimary),null==i&&(a.opt(x.Host.logging,function(t){return t.warning("Possible error. background color is nil.")}),i=z.SolidColor.WHITE);for(var s=a.iter(n.visitAsArray(d.FormaTraversal.PreOrder));!s.done;s.next()){var u,c=s.value,m=c.finalFrame,h=c.controller;if(!(null==h||a.eq(d._equality_Forma_Forma,c,this.forma)||null==m||(u=h)&&u.kind!=L.ShapeController.KIND&&u.kind!=v.FrameController.KIND)){for(var f=c.parent,p=!1;null!=f&&f.kind!=R.RootForma.KIND&&f!=c;){if(f==this.forma){p=!0;break}f=f.parent}if(!p){var g=r.intersectionWith(m);if(null!=g&&g.area/r.area>.5){var C,F;if(c.parent==a.opt(this.forma,function(t){return t.parent})&&null!=c.parent&&null!=(C=a.opt(c.parent,function(t){return t.indexOfChild(e.forma)}))&&null!=(F=c.parent.indexOfChild(c))&&C<F)continue;if(c instanceof S.FrameForma){var y=c.controller.getAverageColor(r);null!=y?i=i.blend(y,y.alpha):(x.Host.logging.warning("Error: Couldn't find the background color"),i=new z.SolidColor(.5,.5,.5,1))}else if(c instanceof B.ShapeForma){if(!(new M.ProfilingColorMap).checkIfTwoFormaAreInSamePaletteMappingGroup(c.formaID,this.forma.formaID)&&!(new M.ProfilingColorMap).checkIfTwoFormaAreInSamePaletteMappingGroup(c.formaID,this.forma.formaID+M.ProfilingColorMap.backingColorKey)){var P=a.opt(a.opt(a.as(c,B.ShapeForma),function(t){return t.contentNode}),function(t){return t.getTag(N.TAG_SHAPE_ID)});if(null==P||N.ShapeLibrary.FilledBackingShapes.includes(P)){var b=c.style.colors.fieldPrimary,D=a.as(c,B.ShapeForma).getAverageAlpha(r);null!=b&&null!=i&&(i=i.blend(b,c.style.opacity*D))}}}else A.GroupForma}}}}return i}return null},getBackgroundColors:function(){var t,e,n=[];if((t=this.forma.finalFrame)&&(e=this.forma.root)){var r=a.clone(e.filterWithCallback(function(e){return e.isGraphic()&&e.kind!=w.ImageForma.KIND&&e.kind!=R.RootForma.KIND&&null!=e.finalFrame&&e.finalFrame.intersects(t)}));if(1==r.length&&r[0].isGridCell()&&r[0].isShape()){var o,i=r[0].style.colors.fieldPrimary;if((o=r[0].finalFrame)&&o.contains(t)&&null!=i)return[i]}for(var l=3;t.width/a.toDouble(l)<50&&1!=l;)l-=1;for(var s=3;t.height/a.toDouble(s)<50&&1!=s;)s-=1;for(var u=new q.TheoSize(t.width/a.toDouble(l),t.height/a.toDouble(s)),c=a.iter(a.range(0,l,!1));!c.done;c.next())for(var m=c.value,h=a.iter(a.range(0,s,!1));!h.done;h.next()){var f=h.value,p=K.TheoRect.fromXYWH(a.toDouble(m)*u.width+t.origin.x,a.toDouble(f)*u.height+t.origin.y,u.width,u.height);null==(i=this.getBackgroundColor(p))||a.containsEq(n,i,z._equality_SolidColor_SolidColor)||n.push(i)}}return n},getAverageColor:function(t){return this.forma.style.colors.fieldPrimary}}}),r),i.SnappedPlacement=(o=function(t,e){this.movement=t,this.snapLines=a.clone(e)},a.defineClass({name:"SnappedPlacement",ctor:o,superName:"CoreObject"}),o)},648:function(t,e,n){var r,o=e,i=n(0),a=n(197);o.AbsolutePositionController=(r=function(t,e,n){a.FormaController.call(this,t,e,n)},i.defineClass({name:"AbsolutePositionController",ctor:r,superName:"FormaController",statics:{KIND:{get:function(){return"AbsolutePositionController"}}}}),r)},649:function(t,e,n){n(0)},650:function(t,e,n){n(0)},651:function(t,e,n){n(0)},82:function(t,e,n){var r,o,i,a,l,s,u,c,m,h,f,p,g,d=e,v=n(0),C=n(441),F=n(11),y=n(117);d.FormaControllerEvent=(r=function(){},v.defineClass({name:"FormaControllerEvent",ctor:r,superName:"ControllerEvent",props:{forma:{get:function(){return v.first(this.formae)},set:function(t){v.eq(F._equality_Forma_Forma,v.first(this.formae),t)||(this.formae[0]=t)}},init_939b:function(t,e){this.formae=v.clone(e),C.ControllerEvent.call(this,t)},init_83ea:function(t,e){this.init_939b(t,[e])}}}),r),d.PSMFormaControllerEvent=(o=function(){},v.defineClass({name:"PSMFormaControllerEvent",ctor:o,superName:"FormaControllerEvent",props:{init_939b:function(t,e){v.super_init(this,d.FormaControllerEvent,d.FormaControllerEvent.prototype.init_939b,t,v.clone(e))},init_83ea:function(t,e){v.super_init(this,d.FormaControllerEvent,d.FormaControllerEvent.prototype.init_83ea,t,e)}}}),o),d.BeginPointerTrackingEvent=(i=function(){this.trackingResponse=y.BeginPointerTrackingResponseEnum.TrackAsGroup},v.defineClass({name:"BeginPointerTrackingEvent",ctor:i,superName:"PSMFormaControllerEvent",statics:{TYPE:{get:function(){return"BeginPointerTrackingEvent"}}},props:{dragTargetForma:{get:function(){return v.first(this.dragTargetFormae)},set:function(t){v.eq(F._equality_Forma_Forma,v.first(this.dragTargetFormae),t)||(this.dragTargetFormae[0]=t)}},init_73bd:function(t,e){this.dragTargetFormae=v.clone(e),v.super_init(this,d.PSMFormaControllerEvent,d.PSMFormaControllerEvent.prototype.init_939b,i.TYPE,[t])},init_bb89:function(t,e){this.init_73bd(t,[e])}}}),i),d.PSMFormaDragControllerEvent=(a=function(t,e){this.drag=e,this.dragDelegate=e.activeDragDelegate,v.super_init(this,d.PSMFormaControllerEvent,d.PSMFormaControllerEvent.prototype.init_939b,t,v.clone(this.dragDelegate.draggedFormae))},v.defineClass({name:"PSMFormaDragControllerEvent",ctor:a,superName:"PSMFormaControllerEvent"}),a),d.BeginFormaDragEvent=(l=function(t){d.PSMFormaDragControllerEvent.call(this,l.TYPE,t)},v.defineClass({name:"BeginFormaDragEvent",ctor:l,superName:"PSMFormaDragControllerEvent",statics:{TYPE:{get:function(){return"BeginFormaDragEvent"}}}}),l),d.FormaDragEvent=(s=function(t){d.PSMFormaDragControllerEvent.call(this,s.TYPE,t)},v.defineClass({name:"FormaDragEvent",ctor:s,superName:"PSMFormaDragControllerEvent",statics:{TYPE:{get:function(){return"FormaDragEvent"}}}}),s),d.EndFormaDragEvent=(u=function(t){d.PSMFormaDragControllerEvent.call(this,u.TYPE,t)},v.defineClass({name:"EndFormaDragEvent",ctor:u,superName:"PSMFormaDragControllerEvent",statics:{TYPE:{get:function(){return"EndFormaDragEvent"}}}}),u),d.BeginFormaResizeEvent=(c=function(t,e){this.spot=e,v.super_init(this,d.FormaControllerEvent,d.FormaControllerEvent.prototype.init_939b,c.TYPE,[t])},v.defineClass({name:"BeginFormaResizeEvent",ctor:c,superName:"FormaControllerEvent",statics:{TYPE:{get:function(){return"BeginFormaResizeEvent"}}}}),c),d.FormaResizeEvent=(m=function(t,e,n){this.newSize=e,this.pin=n,v.super_init(this,d.FormaControllerEvent,d.FormaControllerEvent.prototype.init_939b,m.TYPE,[t])},v.defineClass({name:"FormaResizeEvent",ctor:m,superName:"FormaControllerEvent",statics:{TYPE:{get:function(){return"FormaResizeEvent"}}}}),m),d.EndFormaResizeEvent=(h=function(t){v.super_init(this,d.FormaControllerEvent,d.FormaControllerEvent.prototype.init_939b,h.TYPE,[t])},v.defineClass({name:"EndFormaResizeEvent",ctor:h,superName:"FormaControllerEvent",statics:{TYPE:{get:function(){return"EndFormaResizeEvent"}}}}),h),d.FormaClickEvent=(f=function(t){this.modifierKeys={},v.super_init(this,d.PSMFormaControllerEvent,d.PSMFormaControllerEvent.prototype.init_939b,f.TYPE,[t])},v.defineClass({name:"FormaClickEvent",ctor:f,superName:"PSMFormaControllerEvent",statics:{TYPE:{get:function(){return"FormaClickEvent"}}}}),f),d.FormaDoubleClickEvent=(p=function(t){this.modifierKeys={},v.super_init(this,d.PSMFormaControllerEvent,d.PSMFormaControllerEvent.prototype.init_939b,p.TYPE,[t])},v.defineClass({name:"FormaDoubleClickEvent",ctor:p,superName:"PSMFormaControllerEvent",statics:{TYPE:{get:function(){return"FormaDoubleClickEvent"}}}}),p),d.AddFormaEvent=(g=function(t){v.super_init(this,d.FormaControllerEvent,d.FormaControllerEvent.prototype.init_939b,g.TYPE,[t])},v.defineClass({name:"AddFormaEvent",ctor:g,superName:"FormaControllerEvent",statics:{TYPE:{get:function(){return"AddFormaEvent"}}}}),g)}}]);
//# sourceMappingURL=logomaker-entry_43bacd0c-032c6121.js.map