(window.webpackJsonp=window.webpackJsonp||[]).push([[46],{201:function(t,e,o){var i,r=e,a=o(0);r.LockupRowInfo=(i=function(){this.aspectRatio=0,this.words=[],this.text="",this.appendable=!0,this.rowHeightAdjustRatio=1,this.colOffsetLeft=0,this.colOffsetRight=0},a.defineClass({name:"LockupRowInfo",ctor:i,props:{init_d97e:function(t,e){if(void 0===t&&(t=null),void 0===e&&(e=!0),null!=t)for(var o=a.iter(t);!o.done;o.next()){var i=o.value;this.addWord(a.clone(i))}this.appendable=e},addWord:function(t){if(this.words.length>0){var e=a.clone(this.words[this.words.length-1]);this.aspectRatio+=e.spaceAspectRatio,this.text+=" "}this.text+=t.text,this.words.push(a.clone(t)),this.aspectRatio+=t.aspectRatio,1!=this.words.length&&t.characterHeightRatio!=this.rowHeightAdjustRatio?this.rowHeightAdjustRatio=1:this.rowHeightAdjustRatio=t.characterHeightRatio},init_implicit:function(t,e,o,i,r,n,l){void 0===t&&(t=0),void 0===e&&(e=[]),void 0===o&&(o=""),void 0===i&&(i=!0),void 0===r&&(r=1),void 0===n&&(n=0),void 0===l&&(l=0),this.aspectRatio=t,this.words=a.clone(e),this.text=o,this.appendable=i,this.rowHeightAdjustRatio=r,this.colOffsetLeft=n,this.colOffsetRight=l},clone:function(){return i.init_implicit(this.aspectRatio,this.words,this.text,this.appendable,this.rowHeightAdjustRatio,this.colOffsetLeft,this.colOffsetRight)}}}),i)},322:function(t,e,o){var i,r=e,a=o(0);r.LockupUtils=(i=function(){},a.defineClass({name:"LockupUtils",ctor:i,statics:{percentageDiff:function(t,e){return 100*Math.abs((t-e)/((t+e)/2))}}}),i)},326:function(t,e,o){var i,r=e,a=o(0),n=o(28);r.LockupWordInfo=(i=function(){},a.defineClass({name:"LockupWordInfo",ctor:i,props:{init_e9d6:function(t,e,o,i,r,a,l,s,c){void 0===c&&(c=n.TheoSize.Zero),this.text=t,this.aspectRatio=e,this.spaceAspectRatio=o,this.characterStyle=i,this.characterHeightRatio=r,this.isNewLine=a,this.canBreak=l,this.rangeInLockup=s,this.relativeMargins=c},init_implicit:function(t,e,o,i,r,a,n,l,s){this.text=t,this.aspectRatio=e,this.spaceAspectRatio=o,this.characterStyle=i,this.characterHeightRatio=r,this.isNewLine=a,this.canBreak=n,this.rangeInLockup=l,this.relativeMargins=s},clone:function(){return i.init_implicit(this.text,this.aspectRatio,this.spaceAspectRatio,this.characterStyle,this.characterHeightRatio,this.isNewLine,this.canBreak,this.rangeInLockup,this.relativeMargins)}}}),i)},329:function(t,e,o){var i,r,a,n,l,s,c,u,h,g,p,d,k,y=e,f=o(0),S=o(39),L=o(49),m=o(202),C=o(1),b=o(79),v=o(4),A=o(321),D=o(320),T=o(19),x=o(11),O=o(445),w=o(163),_=o(8),F=o(203),B=o(245),I=o(17),E=o(37),R=o(119),P=o(22),W=o(40),U=o(446),K=o(331),V=o(114),N=o(121),H=o(14),M=o(72),G=o(15),z=o(165);y.kColorPairDistanceThreshold=10,y.kPuffyTextThreshold=.12,f.gvar(y,"BACKING_SHAPES_BASIC",function(){return W.ShapeLibrary.NonSvgBackingShapeIDs}),f.gvar(y,"BACKING_SHAPES_SVG",function(){return W.ShapeLibrary.BrowsableBackingShapes}),f.gvar(y,"ALLOWED_BACKING_VALUES",function(){return y.BACKING_SHAPES_BASIC.concat(y.BACKING_SHAPES_SVG)}),f.gvar(y,"BACKING_COUNT_SCALE",function(){return f.toDouble(y.ALLOWED_BACKING_VALUES.length)}),f.gvar(y,"ALLOWED_LAYOUT_VALUES",function(){return["left","right","center","fill"]}),f.gvar(y,"LAYOUT_COUNT_SCALE",function(){return f.toDouble(y.ALLOWED_LAYOUT_VALUES.length)}),f.gvar(y,"ALLOWED_OPACITY_VALUES",function(){return["full","mediumBacking","faintBacking","medium","faint"]}),f.gvar(y,"OPACITY_COUNT_SCALE",function(){return f.toDouble(y.ALLOWED_OPACITY_VALUES.length)}),f.gvar(y,"ALLOWED_SHADOWANGLE_VALUES",function(){return[45,135,225,315]}),f.gvar(y,"SHADOWANGLE_COUNT_SCALE",function(){return f.toDouble(y.ALLOWED_SHADOWANGLE_VALUES.length)}),f.gvar(y,"ALLOWED_PADDING_VALUES",function(){return[0,.33,.66,1]}),f.gvar(y,"PADDING_COUNT_SCALE",function(){return f.toDouble(y.ALLOWED_PADDING_VALUES.length)}),f.gvar(y,"ALLOWED_SPACING_VALUES",function(){return[0,.5,1]}),f.gvar(y,"SPACING_COUNT_SCALE",function(){return f.toDouble(y.ALLOWED_SPACING_VALUES.length)}),f.gvar(y,"ALLOWED_TRACKING_VALUES",function(){return[-.1,0,.5]}),y.LockupStyleAttributes=(i=function(t,e,o,i,r,a,n,l,s,c,u,h,g,p,d,k){this.font=0,this.layout="fill",this.backing="none",this.opacity="useLockupOpacities",this.textOpacity=1,this.backingOpacity=1,this.primaryColor="themeColor0",this.secondaryColor="themeColor1",this.shadowAngle=135,this.spacing=.35,this.tracking=0,this.padding=.35,this.textLook="fill",this.shadowOffset=I.LockupStyle.DEFAULT_SHADOWOFFSET,this.strokeWeight=I.LockupStyle.DEFAULT_STROKEWEIGHT,this.wheelUsed=!1,void 0===t&&(t=0),void 0===e&&(e="fill"),void 0===o&&(o="none"),void 0===i&&(i="useLockupOpacities"),void 0===r&&(r=1),void 0===a&&(a=1),void 0===n&&(n="themeColor0"),void 0===l&&(l="themeColor1"),void 0===s&&(s=135),void 0===c&&(c=.35),void 0===u&&(u=0),void 0===h&&(h=.35),void 0===g&&(g="fill"),void 0===p&&(p=I.LockupStyle.DEFAULT_SHADOWOFFSET),void 0===d&&(d=I.LockupStyle.DEFAULT_STROKEWEIGHT),void 0===k&&(k=!1),this.font=t,this.layout=e,this.backing=o,this.opacity=i,this.textOpacity=r,this.backingOpacity=a,this.primaryColor=n,this.secondaryColor=l,this.shadowAngle=s,this.spacing=c,this.tracking=u,this.padding=h,this.textLook=g,this.shadowOffset=p,this.strokeWeight=d,this.wheelUsed=k},f.defineClass({name:"LockupStyleAttributes",ctor:i,props:{clone:function(){return new i(this.font,this.layout,this.backing,this.opacity,this.textOpacity,this.backingOpacity,this.primaryColor,this.secondaryColor,this.shadowAngle,this.spacing,this.tracking,this.padding,this.textLook,this.shadowOffset,this.strokeWeight,this.wheelUsed)}}}),i),y.getFontPairingMatrix=function(t){for(var e={},o=t.count,i=f.iter(f.range(0,o,!1));!i.done;i.next()){for(var r=i.value,a=t.fontAt(r),n=a.postScriptName,l={},s=f.iter(f.range(0,o,!1));!s.done;s.next()){var c=s.value,u=t.fontAt(c),h=u.postScriptName,g=r==c,p=1;p+=1+f.toDouble(10-E.MathUtils.absInt(a.formality-u.formality)),p+=1+f.toDouble(10-E.MathUtils.absInt(a.width-u.width)),p+=1+f.toDouble(E.MathUtils.absInt(a.blackness-u.blackness));var d=f.toDouble(a.drama-u.drama);p+=d,d<-1&&(p*=.1),a.square==u.square&&(p*=2),a.geometric==u.geometric&&(p*=2),a.italic==u.italic&&(p*=2),a.handdrawn&&u.handdrawn&&(p*=2);var k=a.slab&&u.slab,y=0==(a.slab||u.slab);k&&(p*=2);var S=a.serif&&u.serif;S&&y&&(p*=2),0==(a.serif||u.serif)&&(p*=2),S&&a.slab!=u.slab&&(p*=0);var L=a.decorative&&u.decorative;0==g&&L&&(p*=0),a.calligraphic&&u.calligraphic&&0==g&&(p*=0),l[h]=p}e[n]=f.clone(l)}return e},y.getFontPairScore=function(t,e,o){var i,r;if((i=t[e])&&null!=(r=i[o]))return r;return 0},y.hasSufficientLegibilityContrast=function(t,e){return t.contrasts(e,!1)},y.needsContrastingColor=function(t,e,o){return e!=I.LockupTextLook.Fill&&e!=I.LockupTextLook.KnockoutOnly||o},y.getTextOpacity=function(t){switch(t.opacity){case"medium":return B.kOpacityRuleMediumAlpha;case"faint":return B.kOpacityRuleFaintAlpha;case"useLockupOpacities":return t.textOpacity;default:return 1}},y.getBackingOpacity=function(t){switch(t.opacity){case"medium":case"mediumBacking":return B.kOpacityRuleMediumAlpha;case"faint":case"faintBacking":return B.kOpacityRuleFaintAlpha;case"useLockupOpacities":return t.backingOpacity;default:return 1}},y.getTextLook=function(t){var e;switch(t.textLook){case"fill":e=I.LockupTextLook.Fill;break;case"knockoutOnly":e=I.LockupTextLook.KnockoutOnly;break;case"knockoutAndOutline":e=I.LockupTextLook.KnockoutAndOutline;break;case"outlineOnly":e=I.LockupTextLook.OutlineOnly;break;case"fillAndOutline":e=I.LockupTextLook.FillAndOutline;break;case"fillAndOutline2":e=I.LockupTextLook.FillAndOutline2;break;case"shadow":e=I.LockupTextLook.Shadow;break;case"shadowAndOutline":e=I.LockupTextLook.ShadowAndOutline;break;case"knockoutAndShadow":e=I.LockupTextLook.KnockoutAndShadow;break;default:e=I.LockupTextLook.Fill}return e},y.InterestingLockupData=(r=function(){},f.defineClass({name:"InterestingLockupData",ctor:r,props:{init_a05b:function(t){var e,o,i,r,a,n,l,s,c,u,h,g,p,d,k,S,L,m,C,b,v,A,D;(v=f.as(t.style,I.LockupStyle))&&(g=f.clone(y.lockupStyleToLockupStyleAttributes(v,t.page.document)),u=f.opt(v.font,function(t){return t.fontData.postScriptName}),(A=f.as(t.controller,H.TypeLockupController))&&(h=A.getCurrentFontSize()),b=y.lockupStyleToLockupStyleAttributes(v,t.page.document).backing),(A=f.as(t.controller,H.TypeLockupController))&&((D=A.size)&&(m=D.width,C=D.height,p=f.toDouble(D.width/D.height)),d=f.clone(t.totalPlacement.transformPoints(f.clone(t.bounds.points))),k=A.text.length,S=A.text,L=A.wordCount()),this.id=t.formaID,this.width=(e=m)||null!=e?e:100,this.height=(o=C)||null!=o?o:100,this.font=(i=u)||null!=i?i:"BebasNeue",this.lineHeight=(r=h)||null!=r?r:1,this.styleAttributes=f.clone(g||new y.LockupStyleAttributes),this.aspectRatio=(a=p)||null!=a?a:1,this.pts=f.clone(d||[]),this.wordCount=(n=L)||null!=n?n:1,this.charCount=(l=k)||null!=l?l:1,this.originalBacking=(s=b)||null!=s?s:"",this.lockupString=(c=S)||null!=c?c:""},init_implicit:function(t,e,o,i,r,a,n,l,s,c,u,h){this.id=t,this.font=e,this.lineHeight=o,this.styleAttributes=f.clone(i),this.aspectRatio=r,this.pts=f.clone(a),this.charCount=n,this.lockupString=l,this.wordCount=s,this.width=c,this.height=u,this.originalBacking=h}}}),r),y.InterestingPageData=(a=function(){this.colorsBehindSelectedLockup=[],this.numImages=0,this.shapeCount=0},f.defineClass({name:"InterestingPageData",ctor:a,props:{init_a05b:function(t){this.selectedLockup=y.InterestingLockupData.init_a05b(t);var e=this.selectedLockup,o=[this.selectedLockup],i=10,r=1e3,a=1e3;if(t.page.hasRoot()){var n,l;r=t.page.pageSize.width,a=t.page.pageSize.height,(n=f.as(t.controller,H.TypeLockupController))&&(this.colorsBehindSelectedLockup=f.clone(n.getBackgroundColors()),i=n.getBackgroundLightnessSpread(f.clone(this.colorsBehindSelectedLockup)),this.shapeCount=n.shapeCount()),0==this.colorsBehindSelectedLockup.length&&(l=t.page.root.style.colors.fieldPrimary)&&this.colorsBehindSelectedLockup.push(l);for(var s=f.clone(t.page.root.filterWithCallback(function(t){return t.isTypeLockup()})),c=f.iter(s);!c.done;c.next())if((t=c.value).formaID!=this.selectedLockup.id){var u=y.InterestingLockupData.init_a05b(t);u.lineHeight>e.lineHeight&&(e=u),o.push(u)}}this.height=a,this.width=r,this.numImages=t.root.filterWithCallback(function(t){return t.isBackgroundImage()}).length,this.lockups=f.clone(o),this.largestLineHeightLockup=e,0==this.colorsBehindSelectedLockup.length&&this.colorsBehindSelectedLockup.push(P.SolidColor.BLACK),this.lightnessSpreadBehindSelectedLockup=i},isColorVisibleAgainstBackground:function(t){for(var e=f.iter(this.colorsBehindSelectedLockup);!e.done;e.next()){var o=e.value;if(!y.hasSufficientLegibilityContrast(t,o))return!1}return!0},init_implicit:function(t,e,o,i,r,a,n,l,s){void 0===i&&(i=[]),void 0===l&&(l=0),void 0===s&&(s=0),this.largestLineHeightLockup=t,this.selectedLockup=e,this.lockups=f.clone(o),this.colorsBehindSelectedLockup=f.clone(i),this.lightnessSpreadBehindSelectedLockup=r,this.width=a,this.height=n,this.numImages=l,this.shapeCount=s},clone:function(){return a.init_implicit(this.largestLineHeightLockup,this.selectedLockup,this.lockups,this.colorsBehindSelectedLockup,this.lightnessSpreadBehindSelectedLockup,this.width,this.height,this.numImages,this.shapeCount)}}}),a),y.getBackingStringForBackingEnumAndArtworkId=function(t,e){var o="none";switch(t){case 0:o="none";break;case 2:o="row";break;case 9:o="bannerHorizontal";break;case 8:o="bannerVertical";break;case 11:o="knockout";break;case 4:o="none";break;default:null!=e&&(o=e)}return o},y.getBackingEnumAndArtworkIdForBackingString=function(t){var e,o=null;switch(t){case"none":e=I.LockupBacking.None;break;case"row":e=I.LockupBacking.Rows;break;case"bannerHorizontal":e=I.LockupBacking.BannerHorizontal;break;case"bannerVertical":e=I.LockupBacking.BannerVertical;break;case"knockout":e=I.LockupBacking.Knockout;break;default:e=I.LockupBacking.SVGBackground,o=t}return{backing:e,artworkID:o}},y.lockupStyleToLockupStyleAttributes=function(t,e){var o,i=f.clone(new y.LockupStyleAttributes),r=_.Host.fontProvider.getIncludedFonts(e);i.shadowAngle=t.shadowAngle;var a,n,l,s,c,u=-1;switch((a=t.font)&&(u=(o=r.indexOf(a.fontData))||null!=o?o:-1),i.font=u,i.spacing=t.spacing,i.tracking=t.tracking,i.padding=t.padding,i.textLook=t.textLookAsString,i.shadowOffset=t.shadowOffset,i.strokeWeight=t.strokeWeight,null!=(n=t.colors.colorID(T.ColorRole.FieldPrimary))&&(i.primaryColor=n),null!=(l=t.colors.colorID(T.ColorRole.FieldSecondary))&&(i.secondaryColor=l),t.opacityRule){case 1:s="mediumBacking";break;case 2:s="faintBacking";break;case 3:s="medium";break;case 4:s="faint";break;case 0:s="full";break;default:s="useLockupOpacities"}i.opacity=s,i.textOpacity=t.textOpacity,i.backingOpacity=t.backingOpacity;var h=t.layout;if(I.LockupStyle.isLetterGrid(h)||h==I.LockupLayout.Standard){var g=I.LockupStyle.isLetterGrid(h)?"letter-grid-":"";switch(t.alignment){case 0:c=g+"left";break;case 1:c=g+"right";break;case 2:c=g+"center";break;default:C.CoreAssert.fail("Unexpected alignment: "+t.alignment),c=g+"left"}}else if(I.LockupStyle.isPath(h)){c="path"+t.pathID}else c="fill";return i.layout=c,i.backing=y.getBackingStringForBackingEnumAndArtworkId(t.backing,t.backingArtworkID),i.wheelUsed=t.wheelUsed,i},y.lockupStyleAttributesToLockupStyle=function(t,e,o){var i,r,a=null,n=t.font;(C.CoreAssert.isTrue(n>-1,"lockupStyleAttributesToLockupStyle called with no font. It is valid for a character style to have no font but this function doesn't work for character styles "),n>-1)&&((r=_.Host.fontProvider.getIncludedFonts(o).fontAt(n))&&(a=M.TypeLockupUtils.createTheoFont(r,_.Host.brandkitManager.brandkitForDocument(o))));var l,s,c=T.ColorTable.init_d41d();switch(c.setColorIDs([{key:T.ColorRole.FieldPrimary,value:t.primaryColor},{key:T.ColorRole.FieldSecondary,value:t.secondaryColor}]),t.opacity){case"mediumBacking":l=I.OpacityRule.MediumBacking;break;case"faintBacking":l=I.OpacityRule.FaintBacking;break;case"medium":l=I.OpacityRule.Medium;break;case"faint":l=I.OpacityRule.Faint;break;case"full":l=I.OpacityRule.Full;break;default:l=I.OpacityRule.UseLockupOpacities}var u,h,g=I.LockupAlignment.UNSET,p=z.TextPathID.UNSET,d=null;if(t.layout.startsWith("path"))s=I.LockupLayout.Path,null!=(u=f.toInt(t.layout.substr("path".length)))&&(p=(i=z.TextPathID.toCaseValue(u))||null!=i?i:z.TextPathID.UNSET)==z.TextPathID.Custom&&(h=e.customPath)&&(d=h);else switch(t.layout){case"left":s=I.LockupLayout.Standard,g=I.LockupAlignment.Left;break;case"right":s=I.LockupLayout.Standard,g=I.LockupAlignment.Right;break;case"center":s=I.LockupLayout.Standard,g=I.LockupAlignment.Center;break;case"letter-grid-left":s=I.LockupLayout.LetterGrid,g=I.LockupAlignment.Left;break;case"letter-grid-right":s=I.LockupLayout.LetterGrid,g=I.LockupAlignment.Right;break;case"letter-grid-center":s=I.LockupLayout.LetterGrid,g=I.LockupAlignment.Center;break;case"fill":default:s=I.LockupLayout.FitJustified}var k=y.getBackingEnumAndArtworkIdForBackingString(t.backing),S=y.getTextLook(f.clone(t)),L=t.wheelUsed,m=new I.LockupStyle(t.textOpacity,t.backingOpacity,c,a,t.spacing,t.tracking,t.padding,k.backing,k.artworkID,t.shadowAngle,s,g,l,S,t.shadowOffset,t.strokeWeight,p,d,L);return m.characterStyles=f.clone(e.characterStyles),m},y.randomDbl=function(){return f.toDouble(E.CoreRandom.nextInt)/2147483647},y.getWeightedIndex=function(t,e){for(var o=t.length,i=e*y.randomDbl(),r=0,a=0,n=f.iter(f.range(0,o,!1));!n.done;n.next()){var l=n.value;if((r+=t[l])>=i){a=l;break}}return a},y.selectWeightedValue=function(t,e,o,i,r){var a,n=i,l=f.clone(o);return null!=(a=f.indexOf(e,t))&&o[a]>0&&(l[a]+=n*r,n+=n*r),e[y.getWeightedIndex(f.clone(l),n)]},y.WeightedAttributeSelector=f.defineProtocol("WeightedAttributeSelector",{inertiaRatio:"Double",forma:"Forma",pageData:"InterestingPageData",values:"Array<TypeAlias>",weights:"Array<Double>",weightSum:"Double",scoreValue:"(TypeAlias) -> Double",updateWeights:"(InterestingPageData) -> Void",select:"(LockupStyleAttributes, Boolean, Boolean, Boolean) -> TypeAlias"}),y.WeightedFontSelector=(n=function(t,e){this.inertiaRatio=1,this.weights=[],this.weightSum=0,this.machineRecommend=!0;var o=this;this.forma=t,this.pageData=f.clone(e),this.listOfFonts=_.Host.fontProvider.getIncludedFonts(t.page.document),this.values=f.toArray(f.range(0,this.listOfFonts.count,!1));var i=this.listOfFonts.revisionNumber,r=this.listOfFonts.fontSetID;i==n.cacheRevisionNumber&&r==n.cacheFontSetID?this.fontPairingMatrix=f.clone(n.fontPairingMatrixCache):(this.fontPairingMatrix={},n.fontPairingMatrixCache={},f.each(y.getFontPairingMatrix(this.listOfFonts),function(t,e){o.fontPairingMatrix[t]=f.clone(e),n.fontPairingMatrixCache[t]=f.clone(e)}),n.cacheRevisionNumber=i,n.cacheFontSetID=r)},f.defineClass({name:"WeightedFontSelector",ctor:n,statics:{cacheRevisionNumber:0,cacheFontSetID:"charlie",_implements:function(t){return"WeightedAttributeSelector"==t}},props:{updateWeights:function(t){if(this.pageData=f.clone(t),this.values.length!=_.Host.fontProvider.getIncludedFonts(this.forma.page.document).count&&(this.listOfFonts=_.Host.fontProvider.getIncludedFonts(this.forma.page.document),this.values=f.toArray(f.range(0,this.listOfFonts.count,!1))),this.machineRecommend){var e,o=new O.FontSuggester;(e=o.getFontFeatures(f.clone(t),this.forma))?this.weights=f.clone(o.getScores(this.listOfFonts,e)):this.weights=this.values.map(this.scoreValue,this)}0!=this.machineRecommend&&1!=(new K.SuggestionUtils).weightsEqualNaNOrEmpty(f.clone(this.weights))||(this.weights=this.values.map(this.scoreValue,this)),this.weightSum=this.weights.reduce(function(t,e){return t+e},0)},getTopFonts:function(t){C.CoreAssert.isTrue(t<this.listOfFonts.count,"cannot get top fonts more than total number");for(var e=[],o=f.iter(f.toSequence(this.weights));!o.done;o.next()){var i=o.value,r=i.offset,a=i.element;e.push([a,r])}e=f.sort(e,function(t,e){return t[0]>e[0]});for(var n=[],l=0,s=f.iter(e);!s.done;s.next()){var c=s.value;if(!(l<t))break;n.push(this.listOfFonts.fontAt(c[1])),l+=1}return n},scoreValue:function(t){return this.manuallyScoreValue(t)},manuallyScoreValue:function(t){var e=this.listOfFonts.fontAt(t),o=e.postScriptName,i=_.Host.fontProvider.descriptorForPostScriptName(o,F.ANY_DOCUMENT),r=this.pageData.selectedLockup.lineHeight;if(!_.Host.fontProvider.getSuggestableFonts(f.opt(this.forma,function(t){return t.page.document})).contains(e))return 0;for(var a=.1,n=f.iter(this.pageData.lockups);!n.done;n.next()){var l=n.value;if(l.id!=this.pageData.selectedLockup.id){var s=E.MathUtils.absDouble(r-l.lineHeight)/r,c=l.lineHeight>r,u=c?l.font:o,h=c?o:l.font;a+=y.getFontPairScore(f.clone(this.fontPairingMatrix),u,h),o==l.font&&(a*=2,s<.5&&(a*=2))}}return a*=i.popularity,M.TypeLockupUtils.createTheoFont(e,_.Host.brandkitManager.brandkitForDocument(this.forma.page.document)).isSparkFont()&&(a*=2),r<40&&0==i.bodyAllowed&&(a=0),r>150&&0==i.displayAllowed&&(a=0),a},select:function(t,e,o,i){void 0===i&&(i=!1);var r=t.font,a=o?this.inertiaRatio:0;return y.selectWeightedValue(r,f.clone(this.values),f.clone(this.weights),this.weightSum,a)}}}),n),y.WeightedLayoutSelector=(l=function(t,e){this.inertiaRatio=0,this.values=y.ALLOWED_LAYOUT_VALUES,this.weights=[],this.weightSum=0,this.forma=t,this.pageData=f.clone(e)},f.defineClass({name:"WeightedLayoutSelector",ctor:l,statics:{_implements:function(t){return"WeightedAttributeSelector"==t}},props:{updateWeights:function(t){this.pageData=f.clone(t),this.weights=this.values.map(this.scoreValue,this),this.weightSum=this.weights.reduce(function(t,e){return t+e},0)},scoreValue:function(t){var e=1,o=this.pageData.selectedLockup.aspectRatio,i=this.pageData.selectedLockup.wordCount,r=this.pageData.selectedLockup.id;"left"!=t&&"right"!=t||(i<=1||o>4?e=0:e*=.05),0==this.pageData.lockups.length&&("fill"==t&&(e*=5),"center"==t&&(e*=4)),"fill"==t&&this.pageData.selectedLockup.wordCount>10&&(e*=4/f.toDouble(this.pageData.selectedLockup.wordCount));for(var a=L.AlignmentDetector.init_a05b(this.forma),n=f.clone(a.detectFormaAlignments(20)),l=!1,s=!1,c=f.iter(n);!c.done;c.next()){var u=c.value;u.line.type==L.AlignmentType.Left&&(l=!0),u.line.type==L.AlignmentType.Right&&(s=!0)}l&&!s&&"left"==t&&(e=2.5),s&&!l&&"right"==t&&(e=2.5);for(var h=f.iter(this.pageData.lockups);!h.done;h.next()){var g=h.value;g.id!=r&&t==g.styleAttributes.layout&&(e*=y.LAYOUT_COUNT_SCALE/2)}return e},select:function(t,e,o,i){void 0===i&&(i=!1);var r=t.layout,a=o?this.inertiaRatio:0;return y.selectWeightedValue(r,f.clone(this.values),f.clone(this.weights),this.weightSum,a)}}}),l),y.WeightedBackingSelector=(s=function(t,e){this.inertiaRatio=1,this.values=y.ALLOWED_BACKING_VALUES,this.weights=[],this.weightSum=0,this.machineRecommend=!0,this.forma=t,this.pageData=f.clone(e)},f.defineClass({name:"WeightedBackingSelector",ctor:s,statics:{_implements:function(t){return"WeightedAttributeSelector"==t}},props:{updateWeights:function(t){if(this.pageData=f.clone(t),1==this.machineRecommend){var e=new U.ShapeSuggester,o=f.clone(e.getShapeSuggesterFeatures(f.clone(t),this.forma));this.weights=f.clone(e.getScores(f.clone(this.values),f.clone(o)))}0!=this.machineRecommend&&1!=(new K.SuggestionUtils).weightsEqualNaNOrEmpty(f.clone(this.weights))||(this.weights=this.values.map(this.scoreValue,this)),this.weightSum=this.weights.reduce(function(t,e){return t+e},0)},scoreValue:function(t){var e=this.pageData.selectedLockup,o=this.pageData.largestLineHeightLockup,i=e.lineHeight,r=o.id==e.id,a=W.ShapeLibrary.shapeDictionary[t]||W.ShapeLibrary.shapeDictionary.none,n=1;if(a.premium)return 0;if(W.ShapeLibrary.NonSuggestableBackingShapes.includes(t))return 0;this.pageData.lockups.length>0&&y.BACKING_SHAPES_SVG.includes(t)&&(n*=.1);for(var l=f.iter(this.pageData.lockups);!l.done;l.next()){var s,c=l.value;c.id!=e.id&&(E.MathUtils.absDouble(i-c.lineHeight)/i<.4&&(n*=3),(s=W.ShapeLibrary.shapeDictionary[c.styleAttributes.backing])&&(n*=(11-f.toDouble(E.MathUtils.absInt(a.formality-s.formality)))/2,n*=(11-f.toDouble(E.MathUtils.absInt(a.drama-s.drama)))/2))}var u,h=E.MathUtils.maxDouble(e.width/this.pageData.width,e.height/this.pageData.height);if(a.maxScale<1&&h>a.maxScale&&(n=0),(a.maxAspect<e.aspectRatio||a.minAspect>e.aspectRatio)&&(n=0),0==r&&(u=W.ShapeLibrary.shapeDictionary[o.styleAttributes.backing])){var g=u.drama;a.drama<g&&(n*=2)}return"none"==t&&(n*=10),"row"==t&&(n*=10),this.pageData.lightnessSpreadBehindSelectedLockup>=20&&0==a.filled&&(n*=.01),n},select:function(t,e,o,i){void 0===i&&(i=!1);var r=this.values.length,a=f.clone(this.weights),n=t.layout,l="center"==n||"fill"==n,s=!1,c=_.Host.fontProvider.getIncludedFonts(this.forma.page.document).fontAt(t.font),u=this.pageData.selectedLockup.width/this.pageData.selectedLockup.height,h=!0,g=this.pageData.selectedLockup.originalBacking;"none"!=g&&"shadow"!=g&&"row"!=g||(h=!1),"knockout"==t.backing&&(h=!1);for(var p=f.iter(this.pageData.lockups);!p.done;p.next()){var d,k=p.value,S=k.styleAttributes.backing;k.id!=this.pageData.selectedLockup.id&&("none"!=S&&(s=!0),t.font==k.styleAttributes.font&&null!=(d=f.indexOf(y.ALLOWED_BACKING_VALUES,S))&&(a[d]*=5))}for(var L=f.iter(f.range(0,r,!1));!L.done;L.next()){var m,C=L.value,b=this.values[C];if(m=W.ShapeLibrary.shapeDictionary[b]){l&&1==m.centered&&(a[C]*=5),u>4&&m.category==W.ShapeCategory.Circle&&(a[C]*=0),u<4&&m.category==W.ShapeCategory.Banner&&(a[C]*=0),m.category!=W.ShapeCategory.Cutout&&m.category!=W.ShapeCategory.Avoid||(a[C]*=0),"knockoutOnly"!=t.textLook||"none"!=b&&"shadow"!=b||(a[C]*=0);var v=f.toDouble(10-E.MathUtils.absInt(c.formality-m.formality));a[C]*=v/5;var A=f.toDouble(10-E.MathUtils.absInt(c.drama-m.drama));a[C]*=A/5,s&&"row"!=b&&"none"!=b&&(a[C]/=5)}}var D=t.backing,T=o?this.inertiaRatio:0,x=a.reduce(function(t,e){return t+e},0);return 1==h&&(D=y.selectWeightedValue(D,f.clone(this.values),f.clone(a),x,T)),D}}}),s),y.WeightedShadowAngleSelector=(c=function(t,e){this.inertiaRatio=1,this.values=y.ALLOWED_SHADOWANGLE_VALUES,this.weights=[],this.weightSum=0,this.foo=4,this.forma=t,this.pageData=f.clone(e)},f.defineClass({name:"WeightedShadowAngleSelector",ctor:c,statics:{_implements:function(t){return"WeightedAttributeSelector"==t}},props:{updateWeights:function(t){this.pageData=f.clone(t),this.weights=this.values.map(this.scoreValue,this),this.weightSum=this.weights.reduce(function(t,e){return t+e},0)},scoreValue:function(t){return 1},select:function(t,e,o,i){void 0===i&&(i=!1);var r=t.shadowAngle,a=o?this.inertiaRatio:0;return y.selectWeightedValue(r,f.clone(this.values),f.clone(this.weights),this.weightSum,a)}}}),c),y.WeightedOpacitySelector=(u=function(t,e){this.inertiaRatio=1,this.values=y.ALLOWED_OPACITY_VALUES,this.weights=[],this.weightSum=0,this.forma=t,this.pageData=f.clone(e)},f.defineClass({name:"WeightedOpacitySelector",ctor:u,statics:{_implements:function(t){return"WeightedAttributeSelector"==t}},props:{updateWeights:function(t){this.pageData=f.clone(t),this.weights=this.values.map(this.scoreValue,this),this.weightSum=this.weights.reduce(function(t,e){return t+e},0)},scoreValue:function(t){var e=1,o=this.pageData.selectedLockup.width*this.pageData.selectedLockup.height,i=this.pageData.width*this.pageData.height;return"full"==t&&o>.5*i&&(e*=.1),"faint"==t&&(o<.5*i?e=0:e*=.5),e},select:function(t,e,o,i){void 0===i&&(i=!1);var r=t.opacity,a=f.clone(this.weights);(W.ShapeLibrary.shapeDictionary[t.backing]||W.ShapeLibrary.shapeDictionary.none).filled?(a[f.indexOf(y.ALLOWED_OPACITY_VALUES,"faint")]=0,a[f.indexOf(y.ALLOWED_OPACITY_VALUES,"medium")]=0):(a[f.indexOf(y.ALLOWED_OPACITY_VALUES,"faintBacking")]=0,a[f.indexOf(y.ALLOWED_OPACITY_VALUES,"mediumBacking")]=0);var n=o?this.inertiaRatio:0,l=a.reduce(function(t,e){return t+e},0);return y.selectWeightedValue(r,f.clone(this.values),f.clone(a),l,n)}}}),u),y.WeightedPaddingSelector=(h=function(t,e){this.inertiaRatio=1,this.values=y.ALLOWED_PADDING_VALUES,this.weights=[],this.weightSum=0,this.forma=t,this.pageData=f.clone(e)},f.defineClass({name:"WeightedPaddingSelector",ctor:h,statics:{_implements:function(t){return"WeightedAttributeSelector"==t}},props:{updateWeights:function(t){this.pageData=f.clone(t),this.weights=this.values.map(this.scoreValue,this),this.weightSum=this.weights.reduce(function(t,e){return t+e},0)},scoreValue:function(t){var e=this.pageData.selectedLockup,o=1,i=1;if(0==this.pageData.lockups.length)i=E.MathUtils.absDouble(t-I.LockupStyle.DEFAULT_PADDING);else for(var r=f.iter(this.pageData.lockups);!r.done;r.next()){var a=r.value;i=E.MathUtils.minDouble(i,E.MathUtils.absDouble(t-a.styleAttributes.padding))}o*=E.MathUtils.maxDouble(1/(i+.1),.05);var n=E.MathUtils.maxDouble(e.width/this.pageData.width,e.height/this.pageData.height)+t;return o/=4*E.MathUtils.absDouble(n-1)},select:function(t,e,o,i){void 0===i&&(i=!1);var r=t.padding,a=o?this.inertiaRatio:0;return y.selectWeightedValue(r,f.clone(this.values),f.clone(this.weights),this.weightSum,a)}}}),h),y.WeightedSpacingSelector=(g=function(t,e){this.inertiaRatio=1,this.values=y.ALLOWED_SPACING_VALUES,this.weights=[],this.weightSum=0,this.forma=t,this.pageData=f.clone(e)},f.defineClass({name:"WeightedSpacingSelector",ctor:g,statics:{_implements:function(t){return"WeightedAttributeSelector"==t}},props:{updateWeights:function(t){this.pageData=f.clone(t),this.weights=this.values.map(this.scoreValue,this),this.weightSum=this.weights.reduce(function(t,e){return t+e},0)},scoreValue:function(t){var e=1,o=1;if(0==this.pageData.lockups.length)o=E.MathUtils.absDouble(t-I.LockupStyle.DEFAULT_SPACING);else for(var i=f.iter(this.pageData.lockups);!i.done;i.next()){var r=i.value;o=E.MathUtils.minDouble(o,E.MathUtils.absDouble(t-r.styleAttributes.spacing))}return e*=E.MathUtils.maxDouble(1/(o+.1),.05)},select:function(t,e,o,i){void 0===i&&(i=!1);var r=t.spacing,a=o?this.inertiaRatio:0;return y.selectWeightedValue(r,f.clone(this.values),f.clone(this.weights),this.weightSum,a)}}}),g),y.PrimaryColorSelector=(p=function(t,e){this.inertiaRatio=1,this.weights=[],this.weightSum=0,this.forma=t,this.pageData=f.clone(e),this.values=t.page.colorLibraryController.getThemeColorKeys().concat(b.ColorLibraryController.THEME_DERIVED_BW_KEYS).concat(t.page.colorLibraryController.getProfilingColorKeys())},f.defineClass({name:"PrimaryColorSelector",ctor:p,statics:{_implements:function(t){return"WeightedAttributeSelector"==t}},props:{updateWeights:function(t){this.pageData=f.clone(t),this.values=this.forma.page.colorLibraryController.getThemeColorKeys().concat(b.ColorLibraryController.THEME_DERIVED_BW_KEYS).concat(this.forma.page.colorLibraryController.getProfilingColorKeys()),this.weights=this.values.map(this.scoreValue,this),this.weightSum=this.weights.reduce(function(t,e){return t+e},0)},scoreValue:function(t){return"themeDerivedDark"==t?.1:1},select:function(t,e,o,i){void 0===i&&(i=!1);var r=(W.ShapeLibrary.shapeDictionary[t.backing]||W.ShapeLibrary.shapeDictionary.none).filled,a=this.values.length;C.CoreAssert.isTrue(a==this.forma.page.colorLibraryController.getNumThemeColorKeys()+b.ColorLibraryController.THEME_DERIVED_BW_KEYS.length+this.forma.page.colorLibraryController.getNumProfilingColorsKeys(),"values contains wrong number of colors");for(var n=t.primaryColor,l=f.clone(this.weights),s=new A.ColorRankSuggester,c=[],u=f.iter(f.range(0,a,!1));!u.done;u.next()){var h,g=u.value;(h=this.forma.page.colorLibraryController.getSolidColorForKey(this.values[g]))&&c.push(h)}if(C.CoreAssert.isTrue(a==c.length,"not all value colors were added."),a!=c.length)return n;var p,d=[];if(0==r)for(var k=f.iter(this.pageData.colorsBehindSelectedLockup);!k.done;k.next()){var S=k.value;d.push(f.clone(A.ColorForComparison.init_c063(S,1)))}else(p=this.forma.page.colorLibraryController.getSolidColorForKey(t.secondaryColor))&&d.push(f.clone(A.ColorForComparison.init_c063(p,1)));i&&(p=this.forma.page.colorLibraryController.getSolidColorForKey(t.primaryColor))&&d.push(f.clone(A.ColorForComparison.init_c063(p,.66))),l=f.clone(s.weightedColorContrastRanker(f.clone(d),f.clone(c))),l=f.clone((new K.SuggestionUtils).normalizedWeights(f.clone(l)));for(var L=f.iter(f.range(0,a,!1));!L.done;L.next()){g=L.value;var m,v=this.values[g],D=1;if(m=this.forma.page.colorLibraryController.getSolidColorForKey(v)){for(var T=f.iter(this.pageData.colorsBehindSelectedLockup);!T.done;T.next())if((S=T.value).isEqual(m)||!y.hasSufficientLegibilityContrast(m,S)&&!r){D*=0;break}i&&f.eq(P._equality_SolidColor_SolidColor,m,this.forma.page.colorLibraryController.getSolidColorForKey(t.primaryColor))&&(D*=0)}(1==e&&v==n||i&&v==n)&&(D*=0),l[g]*=D}var x=l.reduce(function(t,e){return t+e},0),O=o?this.inertiaRatio:0;return y.selectWeightedValue(n,f.clone(this.values),f.clone(l),x,O)}}}),p),y.SecondaryColorSelector=(d=function(t,e){this.inertiaRatio=0,this.weights=[],this.weightSum=0,this.forma=t,this.pageData=f.clone(e),this.values=t.page.colorLibraryController.getThemeColorKeys().concat(b.ColorLibraryController.THEME_DERIVED_BW_KEYS)},f.defineClass({name:"SecondaryColorSelector",ctor:d,statics:{_implements:function(t){return"WeightedAttributeSelector"==t}},props:{updateWeights:function(t){this.pageData=f.clone(t),this.values=this.forma.page.colorLibraryController.getThemeColorKeys().concat(b.ColorLibraryController.THEME_DERIVED_BW_KEYS),this.weights=this.values.map(this.scoreValue,this),this.weightSum=this.weights.reduce(function(t,e){return t+e},0)},scoreValue:function(t){return 1},select:function(t,e,o,i){void 0===i&&(i=!1);var r=t.secondaryColor,a=this.pageData.selectedLockup,n=(W.ShapeLibrary.shapeDictionary[t.backing]||W.ShapeLibrary.shapeDictionary.none).filled,l=y.needsContrastingColor(t.backing,y.getTextLook(f.clone(t)),n),s=this.values.length;C.CoreAssert.isTrue(s==this.forma.page.colorLibraryController.getNumThemeColorKeys()+b.ColorLibraryController.THEME_DERIVED_BW_KEYS.length,"values contains wrong number of colors");for(var c=f.clone(this.weights),u=new A.ColorRankSuggester,h=[],g=f.iter(f.range(0,s,!1));!g.done;g.next()){var p,d=g.value;(p=this.forma.page.colorLibraryController.getSolidColorForKey(this.values[d]))?h.push(p):C.CoreAssert.isTrue(!1,"failed to get SolidColor for key "+this.values[d]+". colorCount:"+s+". num color keys:"+this.forma.page.colorLibraryController.getNumThemeColorKeys())}if(C.CoreAssert.isTrue(s==h.length,"not all value colors were added."),s!=h.length)return r;for(var k=[],S=f.iter(this.pageData.colorsBehindSelectedLockup);!S.done;S.next()){var L=S.value;k.push(f.clone(A.ColorForComparison.init_c063(L,1)))}c=f.clone(u.weightedColorContrastRanker(f.clone(k),f.clone(h))),c=f.clone((new K.SuggestionUtils).normalizedWeights(f.clone(c)));for(var m=f.iter(f.range(0,s,!1));!m.done;m.next()){d=m.value;for(var v=this.values[d],D=this.forma.page.colorLibraryController.getSolidColorForKey(v),T=1,x=f.iter(this.pageData.colorsBehindSelectedLockup);!x.done;x.next())if((L=x.value).isEqual(D)){T*=0;break}i&&f.eq(P._equality_SolidColor_SolidColor,D,this.forma.page.colorLibraryController.getSolidColorForKey(t.secondaryColor))&&(T*=0),l||t.primaryColor!=v||(T*=8);for(var O=f.iter(this.pageData.lockups);!O.done;O.next()){var w=O.value;w.id!=a.id&&"none"!=w.styleAttributes.backing&&w.styleAttributes.secondaryColor==v&&(T*=4,w.styleAttributes.backing==t.backing&&(T*=2))}1==e&&v==r&&(T=0),c[d]*=T}var _=c.reduce(function(t,e){return t+e},0),F=o?this.inertiaRatio:0;return y.selectWeightedValue(r,f.clone(this.values),f.clone(c),_,F)}}}),d),y.LockupStyleController=(k=function(t){this._sessionAttrsDict={},this.hasScoresForAttributes=!1,this.loggedDesignIngredientColorChanged=!1,this.forma=t,this.targetedLockupStyleName_="",this.pageData=f.clone(y.InterestingPageData.init_a05b(t)),this.fontSelector=new y.WeightedFontSelector(t,f.clone(this.pageData)),this.layoutSelector=new y.WeightedLayoutSelector(t,f.clone(this.pageData)),this.backingSelector=new y.WeightedBackingSelector(t,f.clone(this.pageData)),this.opacitySelector=new y.WeightedOpacitySelector(t,f.clone(this.pageData)),this.primaryColorSelector=new y.PrimaryColorSelector(t,f.clone(this.pageData)),this.profilingBackgroundColorSelector=new D.ProfilingBackgroundColorSelector(t,!0),this.profilingPrimaryColorSelector=new D.ProfilingPrimaryColorSelector(t,!1),this.secondaryColorSelector=new y.SecondaryColorSelector(t,f.clone(this.pageData)),this.shadowAngleSelector=new y.WeightedShadowAngleSelector(t,f.clone(this.pageData)),this.spacingSelector=new y.WeightedSpacingSelector(t,f.clone(this.pageData)),this.paddingSelector=new y.WeightedPaddingSelector(t,f.clone(this.pageData)),v.CoreObject.call(this),this.resetSessionAttrs()},f.defineClass({name:"LockupStyleController",ctor:k,superName:"CoreObject",props:{targetedLockupStyleName:{get:function(){return this.targetedLockupStyleName_},set:function(t){this.targetedLockupStyleName_=t,this.pageData=f.clone(y.InterestingPageData.init_a05b(this.forma))}},targetedLockupStyle:{get:function(){return""!=this.targetedLockupStyleName?this.forma.controller.getCharacterStyle(this.targetedLockupStyleName):this.forma.style}},targetedFont:{get:function(){var t;return(t=this.targetedLockupStyle.font)?t:this.forma.style.font}},targetedShadowAngle:{get:function(){return this.forma.style.shadowAngle},set:function(t){this.forma.style.shadowAngle=t}},targetedShadowOffset:{get:function(){return this.forma.style.shadowOffset},set:function(t){this.forma.style.shadowOffset=t}},targetedStrokeWeight:{get:function(){return this.forma.style.strokeWeight},set:function(t){this.forma.style.strokeWeight=t}},targetedTextLook:{get:function(){return this.targetedLockupStyle.textLook!=I.LockupTextLook.UNSET?this.targetedLockupStyle.textLook:this.forma.style.textLook}},updateScoring:function(){this.pageData=f.clone(y.InterestingPageData.init_a05b(this.forma)),this.fontSelector.updateWeights(f.clone(this.pageData)),this.layoutSelector.updateWeights(f.clone(this.pageData)),this.backingSelector.updateWeights(f.clone(this.pageData)),this.opacitySelector.updateWeights(f.clone(this.pageData)),this.primaryColorSelector.updateWeights(f.clone(this.pageData)),this.secondaryColorSelector.updateWeights(f.clone(this.pageData)),this.shadowAngleSelector.updateWeights(f.clone(this.pageData)),this.spacingSelector.updateWeights(f.clone(this.pageData)),this.paddingSelector.updateWeights(f.clone(this.pageData)),this.profilingPrimaryColorSelector.updateBackgroundColors(f.clone(this.pageData.colorsBehindSelectedLockup)),this.profilingBackgroundColorSelector.updateBackgroundColors(f.clone(this.pageData.colorsBehindSelectedLockup)),this.hasScoresForAttributes=!0},getRecommendedFonts:function(){return this.fontSelector.getTopFonts(10)},onlineLearning:function(t){var e,o=new O.FontSuggester;(e=o.getFontFeatures(f.clone(this.pageData),this.forma))&&o.onlineLearning(t,e)},getDominantColorRole:function(){var t,e=f.clone(y.lockupStyleToLockupStyleAttributes(this.targetedLockupStyle,this.forma.page.document)).backing,o=T.ColorRole.FieldPrimary;return(t=W.ShapeLibrary.shapeDictionary[e])&&1==t.filled&&(o=T.ColorRole.FieldSecondary),o},fixUpSecondaryColor:function(){var t;if((t=f.as(this.forma.controller,H.TypeLockupController))&&t.secondaryColorVisible()&&this.targetedLockupStyle.textBacked&&this.targetedLockupStyle.backing!=I.LockupBacking.UNSET){var e,o=this.targetedLockupStyle.colors.colorID(T.ColorRole.FieldPrimary),i=this.targetedLockupStyle.colors.colorID(T.ColorRole.FieldSecondary);if(null!=o&&o==i&&(e=this.forma.page.colorLibraryController.getSolidColorForKey(o)))for(var r=f.iter(this.forma.page.colorLibraryController.getThemeColorKeys().concat(b.ColorLibraryController.THEME_DERIVED_BW_KEYS));!r.done;r.next()){var a,n=r.value;if(n!=o&&(a=this.forma.page.colorLibraryController.getSolidColorForKey(n))&&(this.targetedLockupStyle.colors.setColorId(T.ColorRole.FieldSecondary,n),a.contrasts(e,!1)))break}}},fixUpBackingShape:function(){var t,e,o=this.forma.style;if((t=W.ShapeLibrary.shapeDictionary[y.getBackingStringForBackingEnumAndArtworkId(o.backing,o.backingArtworkID)])&&(e=W.ShapeLibrary.shapeDictionary[y.getBackingStringForBackingEnumAndArtworkId(this.targetedLockupStyle.backing,this.targetedLockupStyle.backingArtworkID)])){if(I.LockupStyle.isKnockoutLook(this.targetedLockupStyle.textLook)){(this.targetedLockupStyle===this.forma.style?t.filled:I.LockupStyle.isLetterGrid(o.layout)?(this.targetedLockupStyle.backing!=I.LockupBacking.None?e:t).filled:t.filled||e.filled)||(this.targetedLockupStyle.backing=I.LockupBacking.SVGBackground,this.targetedLockupStyle.backingArtworkID="square_001")}!e.filled||this.targetedLockupStyle.textLook!=I.LockupTextLook.Shadow&&this.targetedLockupStyle.textLook!=I.LockupTextLook.ShadowAndOutline&&this.targetedLockupStyle.textLook!=I.LockupTextLook.FillAndOutline&&this.targetedLockupStyle.textLook!=I.LockupTextLook.FillAndOutline2&&this.targetedLockupStyle.textLook!=I.LockupTextLook.OutlineOnly||1!=this.targetedLockupStyle.backingOpacity||(this.targetedLockupStyle.opacityRule=I.OpacityRule.UseLockupOpacities,this.targetedLockupStyle.backingOpacity=.5)}},getKnockoutColor:function(){var t,e,o=this.forma.style;return this.targetedLockupStyle!==this.forma.style&&(t=W.ShapeLibrary.shapeDictionary[y.getBackingStringForBackingEnumAndArtworkId(o.backing,o.backingArtworkID)])&&(e=W.ShapeLibrary.shapeDictionary[y.getBackingStringForBackingEnumAndArtworkId(this.targetedLockupStyle.backing,this.targetedLockupStyle.backingArtworkID)])&&(e.filled||!t.filled)?this.targetedLockupStyle.colors.fieldSecondary:o.colors.fieldSecondary},getTextLookForUI:function(){return this.targetedTextLook==I.LockupTextLook.FillAndOutline2||this.targetedTextLook==I.LockupTextLook.OutlineOnly?I.LockupTextLook.FillAndOutline:this.targetedTextLook},getStrokeWeightPercentForUI:function(){return 99*this.targetedStrokeWeight+1},getShadowOffsetPercentForUI:function(){return 99*this.targetedShadowOffset+1},setTextLook:function(t){this.targetedLockupStyle!==this.forma.style&&t==this.forma.style.textLook?this.targetedLockupStyle.textLook=I.LockupTextLook.UNSET:(this.targetedLockupStyle.textLook=t,this.targetedLockupStyle.textLook==I.LockupTextLook.KnockoutAndShadow&&(135==this.targetedShadowAngle&&225==this.targetedShadowAngle||(this.targetedShadowAngle=135)),this.targetedLockupStyle.textLook==I.LockupTextLook.ShadowAndOutline?this.targetedShadowOffset=I.LockupStyle.DEFAULT_SHADOWOFFSET/2:this.targetedShadowOffset=I.LockupStyle.DEFAULT_SHADOWOFFSET,this.targetedLockupStyle.textLook==I.LockupTextLook.KnockoutAndOutline?this.targetedStrokeWeight=0:this.targetedStrokeWeight=I.LockupStyle.DEFAULT_STROKEWEIGHT,this.targetedLockupStyle.textLook==I.LockupTextLook.FillAndOutline&&this.targetedLockupStyle.padding>y.kPuffyTextThreshold&&(this.targetedLockupStyle.textLook=I.LockupTextLook.FillAndOutline2)),this.fixUpSecondaryColor(),this.fixUpBackingShape(),this.forma.controller.styleChanged()},applyBacking:function(t,e){var o,i=y.getBackingStringForBackingEnumAndArtworkId(t,e);if(null!=(o=f.opt(this.forma,function(t){return t.source}))&&w.FormaSourceUtils.isDesignIngredient(o)){var r=m.BadgeFacade.getDesignIngredientIDAndType(o),a=r.id,n=r.type;f.opt(_.Host.logging,function(t){return t.logToAnalytics(S.AnalyticsConstants.kDesignIngredientBackingShapeChanged,{contextualData1:"designIngredientId:"+a,contextualData2:"designIngredientType:"+n,contextualData12:"shapeName:"+i})})}var l=f.clone(y.lockupStyleToLockupStyleAttributes(this.targetedLockupStyle,this.forma.page.document)),s=null;this.targetedLockupStyle!==this.forma.style&&(s=this.targetedLockupStyle);var c,u=!1,h=!1,g=this.targetedLockupStyle.currentBackingOpacity,p=this.targetedLockupStyle.textLook;if(t==I.LockupBacking.Knockout){I.LockupStyle.isKnockoutLook(p)||(p=I.LockupTextLook.KnockoutOnly,l.textLook="knockoutOnly"),null!=this.forma.root&&this.forma.root.visitAll(x.FormaTraversal.PreOrder,function(t){if(t.style instanceof I.LockupStyle){var e=t.style;e.backing==I.LockupBacking.Knockout&&(e.backing=I.LockupBacking.None,e.textLook=I.LockupTextLook.Fill)}});var d=this.forma.parent;if(null!=d){var k=f.clone(d.filterWithCallback(function(t){return(t.isBackgroundImage()||t.isShape())&&null!=t.controller&&!t.controller.floating},x.FormaTraversal.JustChildren));d.insertChildAt(this.forma,k.length)}}null!=s&&(t==I.LockupBacking.None||t==I.LockupBacking.Rows||t==I.LockupBacking.SVGBackground?(s.backing=t,s.backingArtworkID=e):t==I.LockupBacking.Knockout&&(s.backing=I.LockupBacking.UNSET,p=I.LockupTextLook.KnockoutOnly),l=f.clone(y.lockupStyleToLockupStyleAttributes(s,this.forma.page.document)),i=y.getBackingStringForBackingEnumAndArtworkId(s.backing,s.backingArtworkID),p=s.textLook),l.backing!=i&&(c=W.ShapeLibrary.shapeDictionary[i])&&(u=y.needsContrastingColor(i,p,c.filled),0==c.filled&&p!=I.LockupTextLook.FillAndOutline&&p!=I.LockupTextLook.FillAndOutline2&&(h=!0),0==c.filled&&(g=1)),l.backing=i,t!=I.LockupBacking.None||p!=I.LockupTextLook.KnockoutOnly&&p!=I.LockupTextLook.KnockoutAndOutline||(l.textLook="none");var L=f.clone(this.updateOpacityAttributes(g,f.clone(l)));if(u&&(O=this.forma.page.colorLibraryController.getSolidColorForKey(l.secondaryColor))&&(T=this.forma.page.colorLibraryController.getSolidColorForKey(l.primaryColor))){var C=y.getBackingOpacity(f.clone(l));C==I.LockupStyle.OPACITY_UNSET&&(C=y.getBackingOpacity(f.clone(y.lockupStyleToLockupStyleAttributes(this.forma.style,this.forma.page.document))));for(var b=!0,v=f.iter(this.pageData.colorsBehindSelectedLockup);!v.done;v.next()){var A=v.value.blend(O,C);if(!y.hasSufficientLegibilityContrast(T,A)){b=!1;break}}if(!b){var D=this.getContrastingColorKey(l.secondaryColor,l.primaryColor);L.secondaryColor=D}}if(h){var T,O,F,B=l.primaryColor,E=l.secondaryColor;(T=this.forma.page.colorLibraryController.getSolidColorForKey(B))&&(this.pageData.isColorVisibleAgainstBackground(T)||(O=this.forma.page.colorLibraryController.getSolidColorForKey(E))&&(this.pageData.isColorVisibleAgainstBackground(O)&&!f.opt(W.ShapeLibrary.shapeDictionary[i],function(t){return t.category==W.ShapeCategory.Cutout})?(L.primaryColor=E,L.secondaryColor=B):null!=(F=this.getThemeColorContrastingWithBackground())&&(L.primaryColor=F)))}if(null!=s)s.textOpacity!=I.LockupStyle.OPACITY_UNSET&&(s.textOpacity=L.textOpacity),s.backingOpacity!=I.LockupStyle.OPACITY_UNSET&&(s.backingOpacity=L.backingOpacity),this.pickVisibleColorsForCharStyle(),this.forma.controller.styleChanged();else{var R=y.lockupStyleAttributesToLockupStyle(f.clone(L),this.forma.style,this.forma.page.document);if(R.shapeSupportsKnockout)R.textLook!=I.LockupTextLook.Shadow&&R.textLook!=I.LockupTextLook.ShadowAndOutline&&R.textLook!=I.LockupTextLook.FillAndOutline&&R.textLook!=I.LockupTextLook.FillAndOutline2&&R.textLook!=I.LockupTextLook.OutlineOnly||1!=R.backingOpacity||(R.backingOpacity=.5);else{I.LockupStyle.isKnockoutLook(R.textLook)&&(R.textLook=I.LockupTextLook.Fill);for(var P=f.iter(R.characterStyles);!P.done;P.next()){var U=P.value;!U.shapeSupportsKnockout&&I.LockupStyle.isKnockoutLook(U.textLook)&&(U.textLook=I.LockupTextLook.UNSET)}}this.forma.applyStyle(R)}this.onBackingShapeChanged()},switchPrimaryColorAndSecondaryColor:function(){var t,e=!1;if(t=f.as(f.opt(this.forma,function(t){return t.style}),I.LockupStyle)){var o=f.clone(y.lockupStyleToLockupStyleAttributes(t,this.forma.page.document)),i=this.forma.page.colorLibraryController.getSolidColorForKey(o.primaryColor),r=this.forma.page.colorLibraryController.getSolidColorForKey(o.secondaryColor);if(null!=i&&null!=r){var a=o.primaryColor;o.primaryColor=o.secondaryColor,o.secondaryColor=a;var n=y.lockupStyleAttributesToLockupStyle(f.clone(o),this.forma.style,this.forma.page.document);this.forma.applyStyle(n),e=!0}}return e},getContrastingThemeColorBasedOnSolidColor:function(t,e){if(void 0===e&&(e=null),null==t)return null;for(var o=this.forma.page.colorLibraryController,i=f.iter(o.getThemeColorKeys().concat(b.ColorLibraryController.THEME_DERIVED_BW_KEYS));!i.done;i.next()){var r,a=i.value;if((r=o.getSolidColorForKey(a))&&r.contrasts(t,!1)&&!r.isEqual(e))return a}return null},getThemeColorContrastingWithBackground:function(t){void 0===t&&(t=null);for(var e=this.forma.page.colorLibraryController,o=f.iter(e.getThemeColorKeys().concat(b.ColorLibraryController.THEME_DERIVED_BW_KEYS));!o.done;o.next()){var i,r=o.value;if((i=e.getSolidColorForKey(r))&&(null==t||!i.isEqual(t))){for(var a=!0,n=f.iter(this.pageData.colorsBehindSelectedLockup);!n.done;n.next()){var l=n.value;if(!i.contrasts(l,!1)){a=!1;break}}if(a)return r}}return null},doesLockupContrastWithBackground:function(){var t,e=!0;if(t=f.as(f.opt(this.forma,function(t){return t.style}),I.LockupStyle)){var o=f.clone(y.lockupStyleToLockupStyleAttributes(t,this.forma.page.document)),i=this.forma.page.colorLibraryController.getSolidColorForKey(o.primaryColor),r=this.forma.page.colorLibraryController.getSolidColorForKey(o.secondaryColor);t.secondaryColorVisible?t.textBacked?null!=i&&null!=r&&(e=this.pageData.isColorVisibleAgainstBackground(r)&&i.contrasts(r,!1)):null!=i&&null!=r&&(e=this.pageData.isColorVisibleAgainstBackground(i)&&this.pageData.isColorVisibleAgainstBackground(r)):null!=i&&(e=this.pageData.isColorVisibleAgainstBackground(i))}return e},pickVisibleColorsForLockup:function(){var t=this.pickVisibleColorsForTextAndShape(),e=this.pickVisibleColorsForCharStyle(),o=t||e;return o&&this.forma.controller.styleChanged(),o},pickVisibleColorsForTextAndShape:function(){if(this.doesLockupContrastWithBackground())return!1;if(this.switchPrimaryColorAndSecondaryColor()){if(this.doesLockupContrastWithBackground())return!0;this.switchPrimaryColorAndSecondaryColor()}var t,e=!1;if(t=f.as(f.opt(this.forma,function(t){return t.style}),I.LockupStyle)){var o=f.clone(y.lockupStyleToLockupStyleAttributes(t,this.forma.page.document)),i=this.forma.page.colorLibraryController.getSolidColorForKey(o.primaryColor),r=this.forma.page.colorLibraryController.getSolidColorForKey(o.secondaryColor);if(t.secondaryColorVisible){if(t.textBacked){if(null!=i&&null!=r)if(this.pageData.isColorVisibleAgainstBackground(r))i.contrasts(r,!1)||null!=(a=this.getContrastingThemeColorBasedOnSolidColor(r))&&(o.primaryColor=a,e=!0);else if(null!=(l=this.getThemeColorContrastingWithBackground())){o.secondaryColor=l;var a,n=this.forma.page.colorLibraryController.getSolidColorForKey(o.secondaryColor);e=!0,y.hasSufficientLegibilityContrast(i,n)||null!=(a=this.getContrastingThemeColorBasedOnSolidColor(n))&&(o.primaryColor=a)}}else if(null!=i&&null!=r){var l;this.pageData.isColorVisibleAgainstBackground(i)||null!=(l=this.getThemeColorContrastingWithBackground())&&(o.primaryColor=l,e=!0),this.pageData.isColorVisibleAgainstBackground(r)||(i.isEqual(r)?(o.secondaryColor=o.primaryColor,e=!0):null!=(l=this.getThemeColorContrastingWithBackground(i))?(o.secondaryColor=l,e=!0):(o.secondaryColor=o.primaryColor,e=!0))}}else null!=i&&(this.pageData.isColorVisibleAgainstBackground(i)||null!=(l=this.getThemeColorContrastingWithBackground())&&(o.primaryColor=l,e=!0));if(e){var s=y.lockupStyleAttributesToLockupStyle(f.clone(o),this.forma.style,this.forma.page.document);this.forma.applyStyle(s)}}return e},pickVisibleColorsForCharStyle:function(){var t,e=!1;if(t=f.as(f.opt(this.forma,function(t){return t.style}),I.LockupStyle)){if(0==f.count(t.characterStyles))return e;for(var o=I.LockupStyle.isKnockoutLook(t.textLook)?"":t.colors.colorID(T.ColorRole.FieldPrimary),i=t.textBacked?t.colors.colorID(T.ColorRole.FieldSecondary):"",r=this.forma.page.colorLibraryController,a=[],n=f.iter(r.getThemeColorKeys().concat(b.ColorLibraryController.THEME_DERIVED_BW_KEYS));!n.done;n.next()){var l,s=n.value;(l=r.getSolidColorForKey(s))&&this.pageData.isColorVisibleAgainstBackground(l)&&a.push(s)}for(var c=f.iter(t.characterStyles);!c.done;c.next()){var u=c.value,h=u.colors.colorID(T.ColorRole.FieldPrimary),g=u.secondaryColorVisible?u.colors.colorID(T.ColorRole.FieldSecondary):"";if(u.secondaryColorVisible&&u.backing!=I.LockupBacking.UNSET){var p,d=!1;if(""==i&&(p=r.getSolidColorForKey(g))&&(this.pageData.isColorVisibleAgainstBackground(p)||(d=!0)),d)for(var k=f.iter(a);!k.done;k.next())(x=k.value)!=i&&(u.colors.setColorId(T.ColorRole.FieldSecondary,x),e=!0);else if(g==i)for(var y=f.iter(r.getThemeColorKeys().concat(b.ColorLibraryController.THEME_DERIVED_BW_KEYS));!y.done;y.next())(s=y.value)!=i&&(u.colors.setColorId(T.ColorRole.FieldSecondary,s),e=!0)}var S=!1,L=h!=o,m=r.getSolidColorForKey(t.colors.colorID(T.ColorRole.FieldPrimary));if(null==m)return e;if(!u.textBacked){var C=r.getSolidColorForKey(h);L&&""!=o&&(L=C.contrasts(m,!1)),""!=i||this.pageData.isColorVisibleAgainstBackground(C)||(S=!0)}if((u.backing!=I.LockupBacking.None&&u.backing!=I.LockupBacking.UNSET||L&&h!=i)&&!S){if(u.textBacked&&h==u.colors.colorID(T.ColorRole.FieldSecondary))for(var v=f.iter(r.getThemeColorKeys());!v.done;v.next())if((s=v.value)!=u.colors.colorID(T.ColorRole.FieldSecondary)){u.colors.setColorId(T.ColorRole.FieldPrimary,s),e=!0;break}}else for(var A=f.iter(a);!A.done;A.next()){var D=A.value,x=r.getSolidColorForKey(D),O=""==o||x.contrasts(m,!1);if(D!=o&&D!=i&&(!O&&e||u.colors.setColorId(T.ColorRole.FieldPrimary,D),e=!0,O))break}}}return e},getBrandkitColorsInUse:function(){for(var t=[],e=this.forma.page.colorLibraryController,o=f.iter(e.getColorThemeAsArrayOfTheoColors());!o.done;o.next()){var i=o.value;i.isBrandkitColor()&&t.push(i)}return t},getAllColorsFromDocumentBrandkit:function(){var t=[],e=_.Host.brandkitManager.brandkitForDocument(this.forma.page.document);if(null!=e)for(var o=f.iter(e.colors);!o.done;o.next()){var i=o.value,r=V.TheoColor.init_bb45(i);t.push(r)}return t},getBaseSuggestableColors:function(){for(var t=this.forma.page.colorLibraryController,e=f.clone(t.getColorThemeAsArrayOfTheoColors()),o=f.clone(t.getThemeDerivedColorsAsArrayOfTheoColors()),i=f.clone(t.getSuggestedColorsAsArraysOfTheoColors()),r=e.concat(i).concat(o),a=[],n=f.clone(this.getAllColorsFromDocumentBrandkit()),l=f.iter(r);!l.done;l.next()){var s=l.value;if(!s.isBrandkitColor()){for(var c=!0,u=f.iter(a);!u.done;u.next()){var h=u.value;if(s.rgbColor.distanceTo(h)<20){c=!1;break}}for(var g=f.iter(n);!g.done;g.next()){var p=g.value;if(s.rgbColor.distanceTo(p.rgbColor)<20){c=!1;break}}if(c&&a.push(s.rgbColor),a.length>=10)break}}return a},getSuggestableSingleColors:function(){for(var t=f.clone(this.getBaseSuggestableColors()),e=y.getTextOpacity(f.clone(this.pageData.selectedLockup.styleAttributes)),o=[],i=f.iter(t);!i.done;i.next()){for(var r=i.value,a=r.withAlphaOf(e),n=!0,l=f.iter(this.pageData.colorsBehindSelectedLockup);!l.done;l.next()){var s=l.value;if(!y.hasSufficientLegibilityContrast(a,s)){n=!1;break}}n&&o.push(r)}return o},getSuggestableColors:function(){var t=f.clone(this.getSuggestableColorPairs());if(0==t.length)for(var e=f.clone(this.getSuggestableSingleColors()),o=f.iter(e);!o.done;o.next()){var i=o.value;t.push([i])}for(var r=[],a=f.iter(t);!a.done;a.next()){for(var n=a.value,l=[],s=f.iter(n);!s.done;s.next()){var c=s.value;l.push(this.forma.page.colorLibraryController.getTheoColorForSolidColor(c))}r.push(f.clone(l))}return r},isCurrentlyShowingMultipleColors:function(){var t;return!((t=f.as(this.forma.controller,H.TypeLockupController))&&(!t.secondaryColorVisible()||this.targetedLockupStyle.textLook==I.LockupTextLook.KnockoutOnly||this.targetedLockupStyle.textLook==I.LockupTextLook.OutlineOnly))},getSuggestableColorPairs:function(){var t=[];if(!this.isCurrentlyShowingMultipleColors())return t;var e=this.targetedLockupStyle,o=f.clone(y.lockupStyleToLockupStyleAttributes(e,this.forma.page.document)),i=(W.ShapeLibrary.shapeDictionary[o.backing]||W.ShapeLibrary.shapeDictionary.none).filled,r=y.getBackingOpacity(f.clone(o));r==I.LockupStyle.OPACITY_UNSET&&(r=y.getBackingOpacity(f.clone(y.lockupStyleToLockupStyleAttributes(this.forma.style,this.forma.page.document))));var a=f.clone(this.getBaseSuggestableColors()),n=a.length;if(0==n)return t;for(var l={},s=f.toArray(f.range(0,n,!1)),c=f.clone(f.shuffle(s)),u=f.iter(this.pageData.lockups);!u.done;u.next()){var h=u.value;if(h.id!=this.forma.formaID&&"none"!=h.styleAttributes.backing){var g=this.forma.page.colorLibraryController.getSolidColorForKey(h.styleAttributes.primaryColor),p=this.forma.page.colorLibraryController.getSolidColorForKey(h.styleAttributes.secondaryColor);if(null!=g&&null!=p&&y.hasSufficientLegibilityContrast(g,p)){for(var d=-1,k=-1,S=f.iter(f.range(0,a.length,!1));!S.done;S.next()){var L=S.value;a[L].distanceTo(g)<.1&&(d=L),a[L].distanceTo(p)<.1&&(k=L)}null==l[A=f.toString(E.MathUtils.maxInt(d,k))+" "+f.toString(E.MathUtils.minInt(d,k))]&&(t.push([g,p]),l[A]=!0)}}}for(var m=f.iter(f.range(0,2,!0));!m.done;m.next()){for(var C=f.iter(c);!C.done;C.next()){d=C.value;for(var b=f.clone(f.shuffle(s)),v=f.iter(b);!v.done;v.next()){var A;if(k=v.value,t.length>=10)break;if(null==l[A=f.toString(E.MathUtils.maxInt(d,k))+" "+f.toString(E.MathUtils.minInt(d,k))]){var D=a[d],T=a[k],x=D,O=T;D.lightness<T.lightness&&(x=T,O=D);var w=[];w=this.pageData.colorsBehindSelectedLockup[0].lightness>x.lightness?[O,x]:[x,O],i&&(w=f.reverse(w));for(var _=w[0],F=!0,B=f.iter(this.pageData.colorsBehindSelectedLockup);!B.done;B.next()){var R=B.value.blend(w[1],r),P=_.distanceTo(w[1]);if(!y.hasSufficientLegibilityContrast(_,R)||P<y.kColorPairDistanceThreshold){F=!1;break}}F&&(l[A]=!0,t.push(f.clone(w)))}}if(t.length>=10)break}if(t.length>=10)break}return t},applyColors:function(t,e){var o=this.targetedLockupStyle,i=this.forma.page.colorLibraryController;if(0!=t.length){var r;if(null!=(r=f.opt(this.forma,function(t){return t.source}))&&!this.loggedDesignIngredientColorChanged&&w.FormaSourceUtils.isDesignIngredient(r)){var a=m.BadgeFacade.getDesignIngredientIDAndType(r),n=a.id,l=a.type;f.opt(_.Host.logging,function(t){return t.logToAnalytics(S.AnalyticsConstants.kDesignIngredientColorChanged,{contextualData1:"designIngredientId:"+n,contextualData2:"designIngredientType:"+l})}),this.loggedDesignIngredientColorChanged=!0}var s=f.clone(i.addColorsToTheme(f.clone(t),this.targetedLockupStyle!==this.forma.style?null:this.forma));if(1==t.length)this.applyColor(e,s[0]);else{var c=e==T.ColorRole.FieldPrimary?T.ColorRole.FieldSecondary:T.ColorRole.FieldPrimary;o.colors.setColorIDs([{key:e,value:s[0]},{key:c,value:s[1]}])}this.targetedLockupStyle!==this.forma.style&&(this.forma.style.colorTableBeforeChanged(),this.forma.style.colorTableAfterChanged(),this.forma.controller.styleChanged())}},applyColor:function(t,e){var o=this.targetedLockupStyle,i=f.clone(y.lockupStyleToLockupStyleAttributes(o,this.forma.page.document)),r=(W.ShapeLibrary.shapeDictionary[i.backing]||W.ShapeLibrary.shapeDictionary.none).filled,a=y.needsContrastingColor(i.backing,o.textLook,r),n=this.getContrastingColorKey(e,null);switch(t){case 1:i.primaryColor=e,i.secondaryColor=a?n:e;break;case 2:i.secondaryColor=e,i.primaryColor=a?n:e;break;default:return}o.colors.setColorIDs([{key:T.ColorRole.FieldPrimary,value:i.primaryColor},{key:T.ColorRole.FieldSecondary,value:i.secondaryColor}])},getContrastingColorKey:function(t,e){var o,i=this.forma.page.colorLibraryController.getTheoColorForKey(t);if(null==i)return"";null!=e&&(o=this.forma.page.colorLibraryController.getTheoColorForKey(e));var r=this.forma.page.colorLibraryController,a="";if(i.isBrandkitColor())for(var n=f.clone(this.getBrandkitColorsInUse()),l=i.getBrandkitShadeRole(),s=f.iter(n);!s.done;s.next()){var c=s.value,u=c.getBrandkitShadeRole();if((null==l&&(u==V.TheoColor.SPARK_COLOR_ROLE_SHADE0||u==V.TheoColor.SPARK_COLOR_ROLE_SHADE6)||null!=l&&(u==V.TheoColor.SPARK_COLOR_ROLE_SHADE1||u==V.TheoColor.SPARK_COLOR_ROLE_SHADE5))&&c.rgbColor.distanceTo(i.rgbColor)>30&&(null==o||c.rgbColor.distanceTo(o.rgbColor)>30)){a=r.getKeyOfColorInTheme(c);break}}return""==a&&null!=i&&(a=r.setLightnessContrastColorAndReturnKey(t,i)),a},setContrastingColor:function(t,e,o,i,r){var a=t.contrastWithColor(e),n=b.ColorLibraryController.getBackgroundContrastKey(i);return this.forma.page.colorLibraryController.setTheoColorToLibrary(V.TheoColor.init_5344(a,null,null),n),r.colors.setColorIDs([{key:o,value:n}]),n},backgroundContrastCheck:function(t){void 0===t&&(t=!0),0==this.hasScoresForAttributes&&this.updateScoring();var e=this.targetedLockupStyle,o=f.clone(y.lockupStyleToLockupStyleAttributes(e,this.forma.page.document)),i=W.ShapeLibrary.shapeDictionary[o.backing],r=f.count(e.characterStyles)>0;if(null!=i){var a=i.filled;if(!a||e.textLook==I.LockupTextLook.KnockoutOnly||r){for(var n,l,s=e.textLook==I.LockupTextLook.KnockoutOnly,c=e.strokeWeight>.15,u=s||c?T.ColorRole.FieldSecondary:T.ColorRole.FieldPrimary,h=!1,g=f.iter(this.forma.style.characterStyles);!g.done;g.next())(L=g.value).colors.colorID(u)==e.colors.colorID(u)&&(h=!0);if((n=f.as(this.forma.controller,H.TypeLockupController))&&(l=n.getBackgroundColor())){var p=e.colors.color(u);if(null!=p&&!p.contrasts(l,t)){var d=this.getContrastingColorKey(e.colors.colorID(u),null);e.colors.setColorId(u,d),this.forma.controller.styleChanged()}if(r&&!h)for(var k=f.iter(this.forma.style.characterStyles);!k.done;k.next()){var S,L=k.value;if(S=a?e.colors.color(T.ColorRole.FieldSecondary):l){var m=L.colors.color(u);if(null!=m&&!m.contrasts(S,t)){var b=L.colors.colorID(u);d=this.getContrastingColorKey(b,null),L.colors.setColorId(u,d)}}}}}}else C.CoreAssert.fail("shape is not set up in ShapeLibrary.shapeDictionary")},shuffleColorAssignment:function(){this.updateScoring();var t=f.as(this.forma.controller,H.TypeLockupController);null!=t&&t.beginBlockedUpdate();var e=this.targetedLockupStyle,o=f.clone(y.lockupStyleToLockupStyleAttributes(e,this.forma.page.document)),i=I.LockupStyle.isOutlineLook(e.textLook)||I.LockupStyle.isShadowLook(e.textLook),r=!1;i||(r=W.ShapeLibrary.shapeDictionary[o.backing].filled),("none"!=o.backing||i)&&(o.secondaryColor=this.profilingBackgroundColorSelector.selectColorForGlobalRecolor(!0));var a,n=null;(r||i)&&(a=this.forma.page.colorLibraryController.getSolidColorForKey(o.secondaryColor))&&(n=f.clone(A.ColorForComparison.init_c063(a,i?.7:1)));var l=!r;l&&this.pageData.lockups.length<=2?o.primaryColor=this.profilingPrimaryColorSelector.selectColorForIndividualRecolor(l,f.clone(n),!1):o.primaryColor=this.profilingPrimaryColorSelector.selectColorForGlobalRecolor(l,f.clone(n),!0),this.setSecondaryMultiStyleLockupColors(e,f.clone(o)),e.colors.setColorIDs([{key:T.ColorRole.FieldPrimary,value:o.primaryColor},{key:T.ColorRole.FieldSecondary,value:o.secondaryColor}]),null!=t&&t.endBlockedUpdate(),this.forma.controller.styleChanged()},shuffleMultiStyleLockupColors:function(){this.pageData=f.clone(y.InterestingPageData.init_a05b(this.forma)),this.profilingPrimaryColorSelector.updateBackgroundColors(f.clone(this.pageData.colorsBehindSelectedLockup)),this.profilingBackgroundColorSelector.updateBackgroundColors(f.clone(this.pageData.colorsBehindSelectedLockup));var t=this.targetedLockupStyle,e=f.clone(y.lockupStyleToLockupStyleAttributes(t,this.forma.page.document));this.setSecondaryMultiStyleLockupColors(t,f.clone(e))},setSecondaryMultiStyleLockupColors:function(t,e,o){void 0===o&&(o=!0);for(var i=f.iter(this.forma.style.characterStyles);!i.done;i.next()){var r=i.value,a=f.eq(P._equality_SolidColor_SolidColor,t.colors.fieldPrimary,t.colors.fieldSecondary);if(r.backing!=I.LockupBacking.None&&r.backing!=I.LockupBacking.UNSET&&!a&&f.eq(P._equality_SolidColor_SolidColor,r.colors.fieldPrimary,t.colors.fieldSecondary)&&f.eq(P._equality_SolidColor_SolidColor,r.colors.fieldSecondary,t.colors.fieldPrimary)&&o)r.colors.setColorIDs([{key:T.ColorRole.FieldPrimary,value:e.secondaryColor},{key:T.ColorRole.FieldSecondary,value:e.primaryColor}]);else{var n,l=this.secondaryColorSelector.select(f.clone(e),!0,!1,!0);if(l=(new R.ProfilingColorMap).overridePaletteMappingDueToContrast(l,this.forma.formaID+R.ProfilingColorMap.lockupMSLBackingColorKey),r.backing!=I.LockupBacking.None){var s=f.clone(y.lockupStyleToLockupStyleAttributes(r,this.forma.page.document));s.secondaryColor=l,n=this.primaryColorSelector.select(f.clone(s),!0,!1,!1)}else n=this.primaryColorSelector.select(f.clone(e),!1,!1,!0);n=(new R.ProfilingColorMap).overridePaletteMappingDueToContrast(n,this.forma.formaID+R.ProfilingColorMap.lockupMSLPrimaryColorKey),r.colors.setColorIDs([{key:T.ColorRole.FieldPrimary,value:n},{key:T.ColorRole.FieldSecondary,value:l}])}}},generateAndApplyNewStyleAttributes:function(t){void 0===t&&(t=!0),this.forma.applyStyle(this.getNewStyleAttributes(t))},generateAndApplyInitialStyleAttributes:function(){0==this.hasScoresForAttributes&&this.updateScoring();for(var t=this.forma.style,e=f.clone(y.lockupStyleToLockupStyleAttributes(t,this.forma.page.document)),o=["Lato-Light","Lora-Regular","Montserrat-Regular","PlayfairDisplay-Regular","CantataOne-Regular","FuturaPT-Medium"],i=["square_001","row"],r=o[E.CoreRandom.nextIntUniform(o.length)],a=_.Host.fontProvider.getIncludedFonts(this.forma.page.document),n=f.iter(f.range(0,a.count,!1));!n.done;n.next()){var l=n.value;f.opt(a.fontAt(l),function(t){return t.postScriptName==r})&&(e.font=l)}e.layout=this.layoutSelector.select(f.clone(e),!1,!1,!1),"fill"!=e.layout&&"right"!=e.layout||(e.layout="center");var s=E.CoreRandom.nextIntUniform(i.length);e.backing=i[s],e.padding=0,"row"==e.backing&&(e.spacing=1,e.padding=.33),e.textOpacity=1,e.backingOpacity=1;var c,u=W.ShapeLibrary.shapeDictionary[e.backing].filled,h=I.LockupStyle.isOutlineLook(t.textLook)||I.LockupStyle.isShadowLook(t.textLook),g=null,p=!u;("none"!=e.backing||h)&&(e.secondaryColor=this.profilingBackgroundColorSelector.selectColorForGlobalRecolor(!0),(c=this.forma.page.colorLibraryController.getSolidColorForKey(e.secondaryColor))&&(g=f.clone(A.ColorForComparison.init_c063(c,h?.7:1)))),e.primaryColor=this.profilingPrimaryColorSelector.selectColorForIndividualRecolor(p,f.clone(g),!0);var d=y.lockupStyleAttributesToLockupStyle(f.clone(e),this.forma.style,this.forma.page.document);this.forma.applyStyle(d)},getNewStyleAttributes:function(t){void 0===t&&(t=!0),0==this.hasScoresForAttributes&&this.updateScoring();var e=this.forma.style,o=f.clone(y.lockupStyleToLockupStyleAttributes(e,this.forma.page.document));return o.font=this.fontSelector.select(f.clone(o),!1,t,!1),o.layout=this.layoutSelector.select(f.clone(o),!1,t,!1),o.backing=this.backingSelector.select(f.clone(o),!1,t,!1),o.secondaryColor=this.secondaryColorSelector.select(f.clone(o),!1,t,!1),o.primaryColor=this.primaryColorSelector.select(f.clone(o),!1,t,!1),this.setSecondaryMultiStyleLockupColors(e,f.clone(o),!1),o.shadowAngle=this.shadowAngleSelector.select(f.clone(o),!1,t,!1),o.spacing=this.spacingSelector.select(f.clone(o),!1,t,!1),o.wheelUsed=!0,y.lockupStyleAttributesToLockupStyle(f.clone(o),e,this.forma.page.document)},updateOpacityAttributes:function(t,e){var o=(W.ShapeLibrary.shapeDictionary[e.backing]||W.ShapeLibrary.shapeDictionary.none).filled,i=f.clone(e);return i.opacity="useLockupOpacities",o?(y.getTextLook(f.clone(i))==I.LockupTextLook.KnockoutAndOutline?i.textOpacity=t:i.textOpacity=1,i.backingOpacity=t):(i.textOpacity=t,i.backingOpacity=t),i},setOpacity:function(t){var e=this.targetedLockupStyle,o=f.clone(y.lockupStyleToLockupStyleAttributes(e,this.forma.page.document)),i=f.clone(this.updateOpacityAttributes(t,f.clone(o)));this.targetedLockupStyle===this.forma.style?this.forma.applyStyle(y.lockupStyleAttributesToLockupStyle(f.clone(i),this.forma.style,this.forma.page.document)):(this.targetedLockupStyle.opacityRule=I.OpacityRule.UseLockupOpacities,this.targetedLockupStyle.textOpacity=i.textOpacity,this.targetedLockupStyle.backingOpacity=i.backingOpacity,this.forma.controller.styleChanged())},getOpacityValue:function(){return this.targetedLockupStyle.opacityRule!=I.OpacityRule.UNSET?this.targetedLockupStyle.currentBackingOpacity:this.forma.style.currentBackingOpacity},hasSpacingOptions:function(){return this.targetedLockupStyle===this.forma.style&&!(!(t=f.as(this.forma.controller,H.TypeLockupController))||!(t.numLines()>1||0==t.numLines()));var t},hasPaddingOptions:function(){var t=this.targetedLockupStyle;return t.backing!=I.LockupBacking.None&&t.backing!=I.LockupBacking.Knockout&&t.backing!=I.LockupBacking.UNSET},areSpacingAndPaddingOptionsAvailable:function(){return this.hasSpacingOptions()||this.hasPaddingOptions()},setNextSpacingAndPaddingOption:function(){var t,e;if(this.targetedLockupStyle===this.forma.style){var o=this.hasPaddingOptions(),i=this.hasSpacingOptions();if(o||i){var r=this.forma.style,a=f.clone(y.lockupStyleToLockupStyleAttributes(r,this.forma.page.document)),n=y.ALLOWED_PADDING_VALUES.length,l=y.ALLOWED_SPACING_VALUES.length,s=n*l,c=(t=f.indexOf(y.ALLOWED_PADDING_VALUES,a.padding))||null!=t?t:0,u=(e=f.indexOf(y.ALLOWED_SPACING_VALUES,a.spacing))||null!=e?e:0,h=(o?u*n+c:c*l+u)+1;h%=s;var g=o?f.toInt(h/n):h%l,p=o?h%n:f.toInt(h/l);a.padding=y.ALLOWED_PADDING_VALUES[p],a.spacing=y.ALLOWED_SPACING_VALUES[g],this.forma.applyStyle(y.lockupStyleAttributesToLockupStyle(f.clone(a),this.forma.style,this.forma.page.document))}}else this.setNextPaddingOption()},setNextSpacingOption:function(){var t,e=this.forma.style,o=f.clone(y.lockupStyleToLockupStyleAttributes(e,this.forma.page.document)),i=((t=f.indexOf(y.ALLOWED_SPACING_VALUES,o.spacing))||null!=t?t:0)+1;i>=y.ALLOWED_SPACING_VALUES.length&&(i=0),o.spacing=y.ALLOWED_SPACING_VALUES[i],this.forma.applyStyle(y.lockupStyleAttributesToLockupStyle(f.clone(o),this.forma.style,this.forma.page.document))},setSpacingFromSlider:function(t){this.setSpacing(N.TheoDocumentUtils.sliderToSpacingPaddingMapping(t))},setSpacing:function(t){var e,o=this.forma.style,i=f.clone(y.lockupStyleToLockupStyleAttributes(o,this.forma.page.document)),r=((e=f.indexOf(y.ALLOWED_SPACING_VALUES,i.spacing))||null!=e?e:0)+1;r>=y.ALLOWED_SPACING_VALUES.length&&(r=0),i.spacing=t,this.forma.applyStyle(y.lockupStyleAttributesToLockupStyle(f.clone(i),this.forma.style,this.forma.page.document))},setNextPaddingOption:function(){var t;if(this.hasPaddingOptions()){var e=this.targetedLockupStyle;this.targetedLockupStyle!=this.forma.style&&this.targetedLockupStyle.backing==I.LockupBacking.Rows&&this.forma.style.backing==I.LockupBacking.Rows&&(e=this.forma.style);var o=f.clone(y.lockupStyleToLockupStyleAttributes(e,this.forma.page.document)),i=((t=f.indexOf(y.ALLOWED_PADDING_VALUES,o.padding))||null!=t?t:0)+1;i>=y.ALLOWED_PADDING_VALUES.length&&(i=0),o.padding=y.ALLOWED_PADDING_VALUES[i],e===this.forma.style?this.forma.applyStyle(y.lockupStyleAttributesToLockupStyle(f.clone(o),this.forma.style,this.forma.page.document)):(this.targetedLockupStyle.padding=o.padding,this.forma.controller.styleChanged())}},setPaddingFromSlider:function(t){this.setPadding(N.TheoDocumentUtils.sliderToSpacingPaddingMapping(t))},setPadding:function(t){if(this.hasPaddingOptions()){var e=this.targetedLockupStyle;this.targetedLockupStyle!=this.forma.style&&this.targetedLockupStyle.backing==I.LockupBacking.Rows&&this.forma.style.backing==I.LockupBacking.Rows&&(e=this.forma.style);var o=f.clone(y.lockupStyleToLockupStyleAttributes(e,this.forma.page.document));o.padding=t,e===this.forma.style?this.forma.applyStyle(y.lockupStyleAttributesToLockupStyle(f.clone(o),this.forma.style,this.forma.page.document)):(this.targetedLockupStyle.padding=o.padding,this.forma.controller.styleChanged())}},setNextTrackingOption:function(){var t=this.forma.style,e=f.clone(y.lockupStyleToLockupStyleAttributes(t,this.forma.page.document));e.tracking+=.2,e.tracking>.9&&(e.tracking=0),this.forma.applyStyle(y.lockupStyleAttributesToLockupStyle(f.clone(e),this.forma.style,this.forma.page.document))},setTrackingFromSlider:function(t){var e;if(e=f.as(f.opt(this.forma,function(t){return t.controller}),H.TypeLockupController)){var o=e.getCurrentFontSize();this.targetedLockupStyle.tracking=t;var i=f.opt(e.getPin(!0,!0),function(t){return t.pinPoint})||G.TheoPoint.ZERO;e.setSizeSliderValue(o,[],i)}},setNextShadowAngle:function(){var t;if(I.LockupStyle.isShadowLook(this.targetedLockupStyle.textLook)){var e=this.forma.style,o=f.clone(y.lockupStyleToLockupStyleAttributes(e,this.forma.page.document)),i=((t=f.indexOf(y.ALLOWED_SHADOWANGLE_VALUES,o.shadowAngle))||null!=t?t:0)+1;i>=y.ALLOWED_SHADOWANGLE_VALUES.length&&(i=0),o.shadowAngle=y.ALLOWED_SHADOWANGLE_VALUES[i],this.forma.applyStyle(y.lockupStyleAttributesToLockupStyle(f.clone(o),this.forma.style,this.forma.page.document))}},legacyColorConversion:function(){if(null==this.forma)return _.Host.logging.info("forma has been de-alloc'd"),void C.CoreAssert.isTrue(!1);for(var t=this.forma.style,e=[T.ColorRole.FieldPrimary,T.ColorRole.FieldSecondary],o=f.iter(e);!o.done;o.next()){var i=o.value,r=t.colors.color(i),a=t.colors.colorID(i),n=null!=a&&b.ColorLibraryController.keyFromImage(a);if(null!=r&&null==a||n){var l=this.forma.page.colorLibraryController.addUnlinkedColor(r);t.colors.setColorId(i,l)}}},onTrackingChanged:function(){var t=this.forma.style;this._sessionAttrsDict[this.getSessionAttrsKey("tracking",t.layout)]=t.tracking},onSpacingChanged:function(){var t=this.forma.style;this._sessionAttrsDict[this.getSessionAttrsKey("spacing",t.layout)]=t.spacing},onBackingShapeChanged:function(){this._sessionAttrsDict[this.getSessionAttrsKey("backing")]="none"},onLayoutChanged:function(t){var e=this.forma.style,o=e.layout;if(this.getSessionAttrsKey("",t)!=this.getSessionAttrsKey("",o)){this._sessionAttrsDict[this.getSessionAttrsKey("tracking",t)]=e.tracking,this._sessionAttrsDict[this.getSessionAttrsKey("spacing",t)]=e.spacing,e.tracking=this._sessionAttrsDict[this.getSessionAttrsKey("tracking",o)],e.spacing=this._sessionAttrsDict[this.getSessionAttrsKey("spacing",o)];var i=I.LockupStyle.isLetterGrid(e.layout);if(I.LockupStyle.isLetterGrid(t)!=i)if(i)W.ShapeLibrary.isBackingShapeLetterGridCompatible(e.backing,e.backingArtworkID)||(this._sessionAttrsDict[this.getSessionAttrsKey("backing")]=y.getBackingStringForBackingEnumAndArtworkId(e.backing,e.backingArtworkID),e.backing=I.LockupBacking.None,e.backingArtworkID=null);else{var r=this._sessionAttrsDict[this.getSessionAttrsKey("backing")];if("none"!=r){var a=y.getBackingEnumAndArtworkIdForBackingString(r);e.backing=a.backing,e.backingArtworkID=a.artworkID,this._sessionAttrsDict[this.getSessionAttrsKey("backing")]="none"}}}},getSessionAttrsKey:function(t,e){void 0===e&&(e=null);var o,i="default";return null!=(o=e)&&(I.LockupStyle.isLetterGrid(o)?i="letterGrid":I.LockupStyle.isPath(o)&&(i="path")),i+"_"+t},resetSessionAttrs:function(){this._sessionAttrsDict[this.getSessionAttrsKey("backing")]="none",this._sessionAttrsDict[this.getSessionAttrsKey("tracking")]=0,this._sessionAttrsDict[this.getSessionAttrsKey("spacing")]=.35,this._sessionAttrsDict[this.getSessionAttrsKey("tracking",I.LockupLayout.LetterGrid)]=.35,this._sessionAttrsDict[this.getSessionAttrsKey("spacing",I.LockupLayout.LetterGrid)]=.35,this._sessionAttrsDict[this.getSessionAttrsKey("tracking",I.LockupLayout.Path)]=.15,this._sessionAttrsDict[this.getSessionAttrsKey("spacing",I.LockupLayout.Path)]=.35},endSession:function(){this.resetSessionAttrs()}}}),k)},448:function(t,e,o){var i,r=e,a=o(0),n=o(138),l=o(71),s=o(17),c=o(14);r.NoDecorationStrategy=(i=function(){n.BaseDecorationStrategy.call(this)},a.defineClass({name:"NoDecorationStrategy",ctor:i,superName:"BaseDecorationStrategy",statics:{_implements:function(t){return"LockupDecorationStrategy"==t}},props:{supportsConfiguration:function(t){return t.style.backing==s.LockupBacking.None},decorate:function(t,e){var o,i=t.style,r=!1;if((o=t.style.characterStyles[c.TypeLockupController.HIGHLIGHT_STYLE])&&(r=o.textLook==s.LockupTextLook.FillAndOutline2),i.textLook!=s.LockupTextLook.FillAndOutline2&&!r)return new n.DecorationResults([]);for(var u=[],h=a.iter(a.range(0,e.items.length,!1));!h.done;h.next()){var g=h.value,p=a.clone(e.items[g]);if(p.type==l.LockupItemType.Text){var d,k,y=i.textLook==s.LockupTextLook.FillAndOutline2;null!=(d=p.characterStyle)&&(k=t.style.characterStyles[d])&&(y=k.textLook==s.LockupTextLook.FillAndOutline2||k.textLook==s.LockupTextLook.UNSET&&y),y&&(p.hasPrimaryColor=!1,u.push(a.clone(p)))}}return new n.DecorationResults(a.clone(u))}}}),i)},449:function(t,e,o){var i,r,a=e,n=o(0),l=o(1),s=o(86),c=o(8),u=o(71),h=o(17),g=o(9),p=o(14),d=o(72),k=o(15),y=o(165),f=o(10),S=o(95),L=o(28);a.PathLayoutStrategy=(i=function(){this.trackingScalar=1.5,this.precision=.003,this.ascentCoeff=.594,this.concavityCoeff=1,this.requiredCoverageClosed=.99,this.requiredCoverageOpen=.99,this.coverageThresholdMustCenter=.98,this.sampleFontSize=32,this.minFontSize=8,this.maxFontSize=600,this.maxIterations=100,u.BaseLockupLayoutStrategy.call(this)},n.defineClass({name:"PathLayoutStrategy",ctor:i,superName:"BaseLockupLayoutStrategy",statics:{_implements:function(t){return"LockupLayoutStrategy"==t}},props:{supportsConfiguration:function(t){return h.LockupStyle.isPath(t.style.layout)},fitText:function(t){return t.style.alignment!=h.LockupAlignment.Right},layout:function(t){var e=t.containerSize,o=t.style,i=o.tracking*this.trackingScalar,r=t.text,a=o.font.fontData;a.allCapsAllowed&&(r=r.toUpperCase());var l=u.getTypographicBoundingRatiosOfString(r,a,!1),s=y.TextPathLibrary.getPathForLockupStyle(o),c=this.transformPath(s,e),h=this.precision*c.hypotenuse,p=this.getCorrectedPathLen(s,l.heightFromBaselineRatio*this.sampleFontSize,h),d=s.isClosed()?this.requiredCoverageClosed:this.requiredCoverageOpen,m=n.clone(this.measureLetters(r,n.clone(t.characterStyleRanges),this.sampleFontSize,o,a,i,l.hasUppercase,s.isClosed())),C=this.estimateFontSizeToFit(s,r,a,l,i,h);C=Math.min(Math.max(this.minFontSize,C),this.maxFontSize);for(var b=0,v=this.minFontSize,A=this.maxFontSize,D=0,T=null;b<this.maxIterations&&v<A;){var x=s.clone();if((T=this.placeLetters(x,n.clone(m),l,C,h)).placements.length<m.length)A=C;else{if((D=1-this.getCorrectedPathLen(x,l.heightFromBaselineRatio*this.sampleFontSize,h)/p)>=d)break;v=C}C=(v+A)/2,b+=1}D<this.coverageThresholdMustCenter&&(T=this.placeLettersAndCenter(s,n.clone(m),l,C,h));var O=this.fitText(t),w=T.bounds,_=w.size,F=1;O&&((_.width>e.width||_.height>e.height)&&(F=(_=this.getFitSize(w,e)).width/w.width),s.offset(k._minus_TheoPoint_TheoPoint(k.TheoPoint.ZERO,w.origin)),s.multiply(new L.TheoSize(F,F)));for(var B=s.getBounds(),I=l.heightFromBaselineRatio*C,E=[],R=n.iter(n.toSequence(T.placements));!R.done;R.next()){var P=R.value,W=P.offset,U=P.element,K=m[W],V=O?w:B,N=(U.tx-V.minX)*F,H=(U.ty-V.minY)*F,M=new g.Matrix2D(U.a,U.b,U.c,U.d,N,H),G=C*K.fontSizeAdjustRatio*F,z=n.clone(u.LockupItem.init_e7b2(!0,K.characterStyle,new L.TheoSize(K.unitWidth*G,I),M,K.character,K.font,G,G,l,0,new S.TextRange(W,W+1)));E.push(n.clone(z))}var Y=O?f.TheoRect.fromSize(_).unionWith(B).size:B.size;return u.LayoutResults.init_8322(n.clone(E),Y,g.Matrix2D.Identity,l,Y.aspectRatio)},placeOneLetter:function(t,e,o,i,r){var a=i*this.ascentCoeff,s=this.concavityCoeff*a,c=t.findTValueByCorrectedPrefixLength(a,s,o,r);if(c>=n.toDouble(t.numSegments))return{placement:null,t:0};var u=t.findTValueByCorrectedPrefixLength(a,s,e/2,r);l.CoreAssert.isTrue(u<n.toDouble(t.numSegments));var h=t.pointAt(u),p=t.tangentUnitVectorAt(u),d=Math.atan2(p.y,p.x),k=g.Matrix2D.translationXY(-e/2,-i).rotate(Math.cos(d),Math.sin(d)).translate(h);return t.truncatePrefix(c),{placement:k,t:c}},placeLetters:function(t,e,o,i,r){for(var a=o.heightFromBaselineRatio*i,l=0,s=f.TheoRect.Zero,c=[],u=n.iter(e);!u.done;u.next()){var h=u.value,g=i*h.fontSizeAdjustRatio,p=h.unitWidth*g,d=h.unitTrackedWidth*g,k=h.unitYAdjust*g,y=this.placeOneLetter(t,p,d,a-k,r).placement;if(null==y)break;c.push(y);var S=new f.TheoRect(0,0,d,a).transform(y);s=s.unionWith(S),l+=d}return{placements:c,bounds:s,composedWidth:l}},placeLettersAndCenter:function(t,e,o,i,r){var a=t.clone(),l=this.placeLetters(a,n.clone(e),o,i,r);if(l.placements.length<e.length)return l;for(var s=0,c=r,u=0;(Math.abs(s-c)>.01*(s+c)||l.placements.length<e.length)&&u<this.maxIterations;)s>c||l.placements.length<e.length?s-=(s-c)/2:s+=(c-s)/2,(a=t.clone()).truncatePrefix(a.findTValueByCorrectedPrefixLength(0,0,s,r)),c=(l=this.placeLetters(a,n.clone(e),o,i,r)).placements.length<e.length?0:a.getLength(r),u+=1;return l},calculateLeading:function(t,e){return t.style.spacing},adjustHeightForLeading:function(t,e,o,i){return 0},calculateTracking:function(t,e){return t.style.tracking},adjustWidthForTracking:function(t,e,o,i){return null},getFitSize:function(t,e,o){void 0===o&&(o=1);var i,r,a=t.width,n=t.height,l=0==n?1/0:a/n,s=e.width,c=e.height,u=s/c,h=o>1?o:1/o;return l<u?(r=c,i=c*(u=Math.min(u,l*h))):(i=s,r=s/(u=Math.max(u,l/h))),new L.TheoSize(i,r)},transformPath:function(t,e){var o=t.getBounds(),i=this.getFitSize(o,e,t.flex),r=0==o.width?1:i.width/o.width,a=0==o.height?1:i.height/o.height;return t.multiply(new L.TheoSize(r,a)),i},getCorrectedPathLen:function(t,e,o){var i=e*this.ascentCoeff,r=this.concavityCoeff*i;return t.getCorrectedLength(i,r,o)},estimateFontSizeToFit:function(t,e,o,i,r,a){var l=e.length,s=n.clone(c.Host.textModelUtils.getGlyphPositions(e,o,32,!1)),u=n.toDouble(t.isClosed()?l:l-1)*r*32,h=n.last(s)+u,g=t.getLength(a);return 32*g/(h-(this.getCorrectedPathLen(t,32*i.heightFromBaselineRatio,a)-g))},getCharacterStyle:function(t,e,o){for(var i=n.iter(t);!i.done;i.next()){var r=i.value;if(e>=r.start&&e<r.end)return p.TypeLockupController.HIGHLIGHT_STYLE}return""},measureLetters:function(t,e,o,i,r,l,u,h){var g,k=t.length,y=n.opt(n.opt(i.characterStyles[p.TypeLockupController.HIGHLIGHT_STYLE],function(t){return t.font}),function(t){return t.fontData})||r,f=d.TypeLockupUtils.getCharFontAdjust(i,u,!1),S=d.TypeLockupUtils.getCharFontYAdjust(i,o,o*f),L=[],m=[],C=[],b=l<=.25;b&&(m=n.clone(c.Host.textModelUtils.getGlyphPositions(t,r,o,!1)),C=n.clone(n.eq(s._equality_FontDescriptor_FontDescriptor,y,r)?m:c.Host.textModelUtils.getGlyphPositions(t,y,o,!1)));for(var v,A,D=!1,T=n.iter(n.toSequence(n.chars(t)));!T.done;T.next()){var x=T.value,O=x.offset,w=x.element,_=n.toString(w),F=(g=A)||null!=g?g:this.getCharacterStyle(n.clone(e),O,O+1);O<k-1&&(A=this.getCharacterStyle(n.clone(e),O+1,O+2));var B=F==p.TypeLockupController.HIGHLIGHT_STYLE,I=B?y:r,E=B?f:1,R=B?S/(o*E):0,P=0;if(b&&F==A){var W=n.clone(B?C:m);P=(W[O+1]-W[O])/o}else P=c.Host.textModelUtils.measureInkBounds(_,I,o).width/o;var U=a.LetterInfo.init_3ebc(_,I,E,F,P,R,O!=k-1||h?l:0);(D=d.TypeLockupUtils.isWhiteSpace(_))&&(v=U),L.push(U)}return h&&!D&&null!=v&&L.push(v),L}}}),i),a.LetterInfo=(r=function(){},n.defineClass({name:"LetterInfo",ctor:r,props:{init_3ebc:function(t,e,o,i,r,a,n){this.character=t,this.font=e,this.fontSizeAdjustRatio=o,this.characterStyle=i,this.unitWidth=r,this.unitYAdjust=a,this.unitTrackedWidth=r+n},init_implicit:function(t,e,o,i,r,a,n){this.character=t,this.font=e,this.fontSizeAdjustRatio=o,this.characterStyle=i,this.unitWidth=r,this.unitYAdjust=a,this.unitTrackedWidth=n}}}),r)}}]);
//# sourceMappingURL=logomaker-entry_abf5159c-bdbeb062.js.map