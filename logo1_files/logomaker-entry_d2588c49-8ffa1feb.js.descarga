(window.webpackJsonp=window.webpackJsonp||[]).push([[57],{14:function(t,e,n){var o,i,r,a=e,l=n(0),s=n(39),h=n(49),u=n(435),c=n(134),g=n(1),d=n(70),p=n(234),f=n(27),m=n(156),y=n(19),k=n(436),S=n(440),v=n(11),L=n(26),T=n(155),F=n(117),x=n(86),C=n(82),R=n(29),A=n(161),M=n(44),w=n(25),_=n(43),I=n(23),b=n(8),H=n(21),D=n(245),B=n(442),E=n(443),P=n(71),O=n(17),N=n(329),z=n(9),G=n(37),U=n(448),Y=n(449),X=n(450),W=n(35),V=n(22),K=n(451),Q=n(30),q=n(40),j=n(334),J=n(204),Z=n(205),$=n(120),tt=n(164),et=n(193),nt=n(115),ot=n(58),it=n(72),rt=n(194),at=n(248),lt=n(81),st=n(15),ht=n(10),ut=n(95),ct=n(28);a.CharStyleApplyMode=l.defineEnum("CharStyleApplyMode",{SwipeApply:0,Apply:1,Remove:2,Toggle:3}),a.HighlightMethod=l.defineEnum("HighlightMethod",{Manual:0,EvenRows:1,OddRows:2,EvenWords:3,OddWords:4,First:5,Last:6,Bracket:7,InsideBracket:8,Numbers:100,Nouns:101,Verbs:102,Names:103,Adjectives:104,SmallWords:105}),a.LockupFormaPool=(o=function(t,e){this.stringsToFormae_={},this.shapeFormae_=[],this.formaUsedStatus_={},this.page_=t,this.createModelFormae_=e},l.defineClass({name:"LockupFormaPool",ctor:o,props:{createForma:function(t){var e=this.page_;return null==e?null:this.createModelFormae_?e.createModelForma(t):e.createForma(t)},configureTextFormae:function(t){var e,n=this,o=[],i=[],r=[];l.each(this.stringsToFormae_,function(n,a){var s=(e=t[n])||null!=e?e:0,h=a.length;if(0==s)l.append(o,a),r.push(n);else if(s<h){var u=h-s,c=a.slice(s,h);a.splice(s,u),l.append(o,c)}else for(var g=s-h,d=l.iter(l.range(0,g,!1));!d.done;d.next())i.push(n)});for(var a=l.iter(r);!a.done;a.next()){var s=a.value;l.removeKey(this.stringsToFormae_,s)}l.each(t,function(t,e){if(null==n.stringsToFormae_[t]){n.stringsToFormae_[t]=[];for(var o=e,r=l.iter(l.range(0,o,!1));!r.done;r.next())i.push(t)}});for(var h=l.iter(i);!h.done;h.next()){s=h.value;var u=this.createForma(ot.TextForma.KIND);this.stringsToFormae_[l.as(s,"String")].push(u)}return o.forEach(function(t){return n.cleanupForFormaRemoval(t)}),o},configureShapeFormae:function(t){var e=this,n=[],o=this.shapeFormae_.length;if(o>t){var i=o-t,r=this.shapeFormae_.slice(t,o);this.shapeFormae_.splice(t,i),l.append(n,r)}else if(o<t){var a=t-o;if(a>0)for(var s=l.iter(l.range(1,a,!0));!s.done;s.next()){var h=l.as(this.createForma(Q.ShapeForma.KIND),Q.ShapeForma);null!=h&&this.shapeFormae_.push(h)}}return n.forEach(function(t){return e.cleanupForFormaRemoval(t)}),n},cleanupForFormaRemoval:function(t){l.removeKey(this.formaUsedStatus_,t.uuid)},formaHasBeenUsed:function(t){return null!=this.formaUsedStatus_[t.uuid]},markFormaAsUsed:function(t){this.formaUsedStatus_[t.uuid]=t.uuid},nthTextFormaForString:function(t,e){var n=l.opt(this.stringsToFormae_[e],function(e){return e[t]});if(null==n)return null;var o=this.formaHasBeenUsed(n);return this.markFormaAsUsed(n),{forma:n,recycled:o}},nthShapeForma:function(t){var e=t<this.shapeFormae_.length?this.shapeFormae_[t]:null;if(null==e)return null;var n=this.formaHasBeenUsed(e);return this.markFormaAsUsed(e),{forma:e,recycled:n}},shapeFormaCount:function(){return this.shapeFormae_.length}}}),o),a.TypeLockupController=(i=function(t,e,n){var o,r,l,s;this.changeSubscriptions_=[],this.settings_=null,this.contentID_=null,this.tagsToFormae_={},this.isRightToLeft=!1,this.initialCharStyleRanges_=[],this.highlightMethod=a.HighlightMethod.Manual,this.charStyleRanges=[],this.bannerRatio_=i.DEFAULT_BANNER_RATIO,this.forceLetterFormaMode=!1,this.currentPrimaryColor=V.SolidColor.WHITE,this.currentSecondaryColor=V.SolidColor.BLACK,this.cachedPin_=null,this.shouldCachePin_=!1,this.startSize_=null,this.passedARThreshold_=!1,this.lockLineBreaks_=!1,this.allowFewerLineBreaks_=!1,this.missingFontCount_=0,this.validDecode_=null,this.layoutStrategy_=null,this.decorationStrategy_=null,this.renderedConfiguration_=null,this.renderedColorLibrary_=null,this.renderedLayoutResults_=null,this.renderedDecorationResults_=null,this.updateQueued_=!1,this.thresholdGroupWidth=0,this.thresholdGroupHeight=0,this.hasFirstUpdateRun=!1,this.sgID=e.formaID,this.layoutFormaePool_=new a.LockupFormaPool(e.page,e.isModel),this.decorationFormaePool_=new a.LockupFormaPool(e.page,e.isModel),this.styleController_=new N.LockupStyleController(e),this.missingFontCount_=0,null!=(o=e.style.colors.colorID(y.ColorRole.FieldPrimary))&&(r=e.page.colorLibraryController.getSolidColorForKey(o))&&(this.currentPrimaryColor=r),null!=(l=e.style.colors.colorID(y.ColorRole.FieldSecondary))&&(s=e.page.colorLibraryController.getSolidColorForKey(l))&&(this.currentSecondaryColor=s),_.GroupController.call(this,t,e,n)},r={},l.defineClass({name:"TypeLockupController",ctor:i,superName:"GroupController",statics:{KIND:{get:function(){return"type-lockup"}},PROPERTY_SIZE_DEPRECATED:"size",PROPERTY_LOCKUPSTYLE_DEPRECATED:"lockup-style",PROPERTY_CONTENT_ID:"content-id",PROPERTY_WRAPPER_ID:"wrapper-id",PROPERTY_HIGHLIGHTMETHOD_ID:"highlightMethod",PROPERTY_CHARSTYLERANGES:"charstyle-ranges",MIN_LINE_HEIGHT:{get:function(){return 20}},DEFAULT_BANNER_RATIO:{get:function(){return 1.5}},HIGHLIGHT_STYLE:"Highlight",FIRST_AUTO_METHOD:{get:function(){return void 0===r.FIRST_AUTO_METHOD&&(r.FIRST_AUTO_METHOD=a.HighlightMethod.EvenRows),r.FIRST_AUTO_METHOD}},MAX_AUTO_METHOD:{get:function(){return void 0===r.MAX_AUTO_METHOD&&(r.MAX_AUTO_METHOD=a.HighlightMethod.InsideBracket),r.MAX_AUTO_METHOD}},FIRST_NLP_METHOD:{get:function(){return void 0===r.FIRST_NLP_METHOD&&(r.FIRST_NLP_METHOD=a.HighlightMethod.Numbers),r.FIRST_NLP_METHOD}},MAX_NLP_METHOD:{get:function(){return void 0===r.MAX_NLP_METHOD&&(r.MAX_NLP_METHOD=a.HighlightMethod.SmallWords),r.MAX_NLP_METHOD}},NUM_HIGHLIGHTMETHODS:14,DelayBetweenUpdates:{get:function(){return 16}}},props:{processEvent:function(t){var e;return(e=l.as(t,C.BeginPointerTrackingEvent))?(e.trackingResponse=F.BeginPointerTrackingResponseEnum.TrackAsGroup,!1):_.GroupController.prototype.processEvent.call(this,t)},selectable:{get:function(){return!0}},moveable:{get:function(){return null==this.forma.allowUserMove||this.forma.allowUserMove}},rotateable:{get:function(){return!0}},duplicatable:{get:function(){return!0}},flippable:{get:function(){return!1}},nudgeable:{get:function(){return!0}},copyTo:function(t){void 0===t&&(t=null);var e=this,n=l.opt(t,function(t){return t.document})||this.owner.document,o=n.content.createNode(et.TextContentNode.KIND);return o.match(this.contentNode),d.CreationFacade.addContent(t||n.firstPage,o,void 0,void 0,new d.AddFormaParams(void 0,!1)).then(function(t){var n,o;return(n=l.as(t,v.Forma))?((o=l.as(n.controller,i))&&o.match(e),n.match(e.forma),l.opt(b.Host.logging,function(t){return t.logToAnalytics(s.AnalyticsConstants.kAnalyticsDataTextDuplicated,{})}),n):f.CorePromise.reject("didn't get a forma back from addContent?")})},size:{get:function(){return l.opt(l.opt(this.forma,function(t){return t.bounds}),function(t){return t.size})},set:function(t){var e=ht.TheoRect.fromSize(t),n=l.opt(this.forma,function(t){return t.bounds});null!=n&&e.equal(n)||l.opt(this.forma,function(t){return t.bounds=e})}},contentDocument:{get:function(){return l.opt(l.opt(this.forma,function(t){return t.page.document}),function(t){return t.content})}},contentID:{get:function(){return this.contentID_},set:function(t){t!=this.contentID_&&(g.CoreAssert.isFalse(!(null==this.contentID_||""==this.contentID_||null!=t&&""!=t),"Why are we setting a nil/empty text content node id?"),this.removeListenersFromNode(),this.contentID_=t,this.addListenersToNode(),this.updateGroup())}},lockupForma:{get:function(){return l.as(this.forma,I.GroupForma)}},contentNode:{get:function(){var t=this;return null==this.contentID_?null:l.as(l.opt(this.contentDocument,function(e){return e.nodeByID(t.contentID_)}),et.TextContentNode)},set:function(t){g.CoreAssert.isFalse(null==t,"Why are we setting a nil text content node?"),this.contentID=l.opt(t,function(t){return t.id}),g.CoreAssert.isFalse(""==this.contentID,"Why are we setting a text content node with empty id?")}},text:{get:function(){var t,e=this;if(null==this.contentNode){var n=l.opt(this.forma,function(t){return t.formaID!=l.opt(e.forma,function(t){return t.originalID})})?"Forma is a clone":"NOT A CLONE",o=1==this.validDecode_?"VALID DECODE":"Decode not valid";g.CoreAssert.fail("Why do we have a type lockup with no content node? "+n+" "+o)}return(t=l.opt(this.contentNode,function(t){return t.text}))||null!=t?t:""}},getCurrentMSLPrimaryColor:function(){for(var t=l.iter(this.forma.style.characterStyles);!t.done;t.next()){var e;if(e=t.value.colors.fieldPrimary)return e}return null},getCurrentMSLBackingColor:function(){for(var t=l.iter(this.forma.style.characterStyles);!t.done;t.next()){var e,n=t.value;if((e=n.colors.fieldSecondary)&&n.backing!=O.LockupBacking.None)return e}return null},settings:{get:function(){return null==this.settings_&&(this.settings_=new m.TypeLockupControllerSettings(this)),this.settings_}},loadFontsForStyle:function(){var t,e=this;(t=l.opt(l.as(l.opt(this.lockupForma,function(t){return t.style}),O.LockupStyle),function(t){return t.font}))&&b.Host.fontProvider.loadFont(t.fontData,function(){null!=e.lockupForma&&e.updateGroup()},function(){return b.Host.logging.warning("Unable to load font "+t.fontData.postScriptName+" for style.")})},styleChanged:function(){l.opt(l.opt(l.opt(this.forma,function(t){return t.root}),function(t){return t.animation}),function(t){return t.invalidate()}),this.updateGroup()},maintainAspectRatio:{get:function(){var t=l.replace(l.replace(this.text,"\n","")," ","");return this.lockLineBreaks_||this.text==t}},getAlignments:function(t){var e;if(void 0===t&&(t=!1),null==this.localCoordinateAlignmentLines_&&(this.localCoordinateAlignmentLines_=l.clone(this.alignmentsInLocalCoords(t))),e=this.lockupForma){for(var n=[],o=e.totalPlacement,i=this.forma_.visit(v.FormaTraversal.FurthestAncestor,function(t,e,n){return!0}),r=l.iter(this.localCoordinateAlignmentLines_);!r.done;r.next()){var a=r.value;g.CoreAssert.isTrue(a.coordinateSpace==e),n.push(new h.AlignmentLine(a.type,a.location,V.SolidColor.ALIGNMENT_FORMA,a.line.transform(o),a.text,i))}return n}return[]},alignmentsInLocalCoords:function(t){void 0===t&&(t=!1);var e,n=[];if(e=this.lockupForma){var o,i,r,a=h.AlignmentEdges.None,s=!1,u=!1,c=!1,g=!1,d=!1,p=!1,f=!1;if(r=this.lockupStyle){if(r.backing!=O.LockupBacking.None){o=e.childrenBoundsInCoordSpace(z.Matrix2D.Identity);var m=q.ShapeLibrary.shapeDictionary[r.backingShapeID];null!=m?(a=m.alignmentEdges,s=m.centered):(s=!0,r.backing==O.LockupBacking.BannerHorizontal?a=h.AlignmentEdges.TopAndBottom:r.backing==O.LockupBacking.BannerVertical?a=h.AlignmentEdges.LeftAndRight:r.backing==O.LockupBacking.Knockout?(a=h.AlignmentEdges.None,o=null,s=!1):a=h.AlignmentEdges.All)}null!=o&&(0!=(l.toInt(a)&l.toInt(h.AlignmentEdges.CenterX))&&(n.push(new h.AlignmentLine(h.AlignmentType.CenterX,h.AlignmentLocation.Forma,V.SolidColor.ALIGNMENT_FORMA,o.verticalLine(.5),!0,e)),p=!0),0!=(l.toInt(a)&l.toInt(h.AlignmentEdges.Left))&&(n.push(new h.AlignmentLine(h.AlignmentType.Left,h.AlignmentLocation.Forma,V.SolidColor.ALIGNMENT_FORMA,o.verticalLine(0),!1,e)),u=!0),0!=(l.toInt(a)&l.toInt(h.AlignmentEdges.Right))&&(n.push(new h.AlignmentLine(h.AlignmentType.Right,h.AlignmentLocation.Forma,V.SolidColor.ALIGNMENT_FORMA,o.verticalLine(1),!1,e)),c=!0),0!=(l.toInt(a)&l.toInt(h.AlignmentEdges.CenterY))&&(n.push(new h.AlignmentLine(h.AlignmentType.CenterY,h.AlignmentLocation.Forma,V.SolidColor.ALIGNMENT_FORMA,o.horizontalLine(.5),!0,e)),f=!0),0!=(l.toInt(a)&l.toInt(h.AlignmentEdges.Top))&&(n.push(new h.AlignmentLine(h.AlignmentType.Top,h.AlignmentLocation.Forma,V.SolidColor.ALIGNMENT_FORMA,o.horizontalLine(0),!1,e)),d=!0),0!=(l.toInt(a)&l.toInt(h.AlignmentEdges.Bottom))&&(n.push(new h.AlignmentLine(h.AlignmentType.Bottom,h.AlignmentLocation.Forma,V.SolidColor.ALIGNMENT_FORMA,o.horizontalLine(1),!1,e)),g=!0)),null==(i=this.textBoundsInCoordSpace(z.Matrix2D.Identity))||null!=o&&s&&a==h.AlignmentEdges.All||((null==o||!s||!(u||p||c))&&(this.numLines()<=1||l.opt(this.lockupStyle,function(t){return t.alignment==O.LockupAlignment.UNSET})?(n.push(new h.AlignmentLine(h.AlignmentType.CenterX,h.AlignmentLocation.Forma,V.SolidColor.ALIGNMENT_FORMA,i.verticalLine(.5),!0,e)),n.push(new h.AlignmentLine(h.AlignmentType.Left,h.AlignmentLocation.Forma,V.SolidColor.ALIGNMENT_FORMA,i.verticalLine(0),!0,e)),n.push(new h.AlignmentLine(h.AlignmentType.Right,h.AlignmentLocation.Forma,V.SolidColor.ALIGNMENT_FORMA,i.verticalLine(1),!0,e))):l.opt(this.lockupStyle,function(t){return t.alignment==O.LockupAlignment.Center})?n.push(new h.AlignmentLine(h.AlignmentType.CenterX,h.AlignmentLocation.Forma,V.SolidColor.ALIGNMENT_FORMA,i.verticalLine(.5),!0,e)):l.opt(this.lockupStyle,function(t){return t.alignment==O.LockupAlignment.Left})?n.push(new h.AlignmentLine(h.AlignmentType.Left,h.AlignmentLocation.Forma,V.SolidColor.ALIGNMENT_FORMA,i.verticalLine(0),!0,e)):l.opt(this.lockupStyle,function(t){return t.alignment==O.LockupAlignment.Right})&&n.push(new h.AlignmentLine(h.AlignmentType.Right,h.AlignmentLocation.Forma,V.SolidColor.ALIGNMENT_FORMA,i.verticalLine(1),!0,e))),(null==o||!s||!(d||f||g))&&(n.push(new h.AlignmentLine(h.AlignmentType.CenterY,h.AlignmentLocation.Forma,V.SolidColor.ALIGNMENT_FORMA,i.horizontalLine(.5),!0,e)),n.push(new h.AlignmentLine(h.AlignmentType.Top,h.AlignmentLocation.Forma,V.SolidColor.ALIGNMENT_FORMA,i.horizontalLine(0),!0,e)),n.push(new h.AlignmentLine(h.AlignmentType.Bottom,h.AlignmentLocation.Forma,V.SolidColor.ALIGNMENT_FORMA,i.horizontalLine(1),!0,e))))}}return n},processFormaDoubleClick:function(t){this.owner.selection.replaceSelection(t.forma),this.owner.selection.isSelected(t.forma)&&(l.opt(b.Host.logging,function(t){return t.logToAnalytics(s.AnalyticsConstants.kAnalyticsDataTextDoubleTapEnterTextEditor,{})}),this.owner.controllerSettingsState.settings=this.settings)},processBeginFormaResize:function(t){_.GroupController.prototype.processBeginFormaResize.call(this,t),this.startSize_=this.size,this.passedARThreshold_=!1,l.opt(l.opt(l.opt(this.forma,function(t){return t.root}),function(t){return t.animation}),function(t){return t.invalidate()}),this.updateBannerRatio()},processFormaResize:function(t){var e=null;(a=t.pin)&&(e=this.forma.placement.transformPoint(this.forma.bounds.eval(a)));var n=t.newSize;if(null!=this.startSize_){var o=this.startSize_.similarity(t.newSize);o<.03?(o<.005&&(this.passedARThreshold_=!1),this.passedARThreshold_||(n=this.startSize_.myAspectRatioClosestCorner(n))):this.passedARThreshold_=!0}this.updateBanner(n);var i=new M.FormaTransformChangedEvent(this.forma);this.forma.beginUpdate(i);var r,a,l=this.forma.placement.extractedScale;if(this.forma.placement=l.matrix,this.size=n,(r=e)&&(a=t.pin)){var s=this.forma.placement.transformPoint(this.forma.bounds.eval(a));this.forma.move(z.Matrix2D.translation(r.subtract(s)))}this.forma.endUpdate(i),this.updateParentGroup()},processEndFormaResize:function(t){_.GroupController.prototype.processEndFormaResize.call(this,t),this.snapSizeToBounds(),this.startSize_=null,this.invalidateStyleScores()},processEndFormaDrag:function(t){_.GroupController.prototype.processEndFormaDrag.call(this,t)},invalidateStyleScores:function(){this.styleController_.hasScoresForAttributes=!1},addListenersToNode:function(){var t=this;if(0==this.changeSubscriptions_.length&&null!=this.contentNode){var e=function(e){return l.opt(t,function(t){return t.updateGroup()})};this.changeSubscriptions_.push(this.contentNode.subscribeWithCallbackToTextModel(e,rt.TextModelDidApplyMessage.TYPE)),this.changeSubscriptions_.push(this.contentNode.subscribeWithCallbackToTextModel(e,rt.TextModelDidInsertMessage.TYPE)),this.changeSubscriptions_.push(this.contentNode.subscribeWithCallbackToTextModel(e,rt.TextModelDidRemoveMessage.TYPE))}},removeListenersFromNode:function(){for(;this.changeSubscriptions_.length>0;)this.changeSubscriptions_.pop().unsubscribe()},bannerRatio:{get:function(){return this.bannerRatio_},set:function(t){this.bannerRatio_=t}},styleController:{get:function(){return this.styleController_}},updateBannerRatio:function(){var t;(t=this.lockupStyle)&&(t.backing!=O.LockupBacking.Banner&&t.backing!=O.LockupBacking.BannerHorizontal&&t.backing!=O.LockupBacking.BannerVertical||(t.backing==O.LockupBacking.BannerHorizontal&&this.size.width<this.size.height?this.bannerRatio=this.size.height/this.size.width+.1:t.backing==O.LockupBacking.BannerVertical&&this.size.height<this.size.width?this.bannerRatio=this.size.width/this.size.height+.1:this.bannerRatio=i.DEFAULT_BANNER_RATIO))},updateBanner:function(t){var e;(e=this.lockupStyle)&&(e.backing!=O.LockupBacking.Banner&&e.backing!=O.LockupBacking.BannerHorizontal&&e.backing!=O.LockupBacking.BannerVertical||(e.backing==O.LockupBacking.BannerVertical&&t.width/t.height>this.bannerRatio?(e.backing=O.LockupBacking.BannerHorizontal,this.bannerRatio=i.DEFAULT_BANNER_RATIO):e.backing==O.LockupBacking.BannerHorizontal&&t.height/t.width>this.bannerRatio&&(e.backing=O.LockupBacking.BannerVertical,this.bannerRatio=i.DEFAULT_BANNER_RATIO)))},shift:function(t,e){return new ut.TextRange(t.start+e,t.end+e)},onStyleApplication:function(){this.loadFontsForStyle(),this.updateGroup()},layoutStrategyForConfiguration:function(t){if(null!=this.layoutStrategy_&&this.layoutStrategy_.supportsConfiguration(t))return this.layoutStrategy_;var e=t.style.layout;return e==O.LockupLayout.FitJustified?new S.EvenRowWidthsLayoutStrategy:e==O.LockupLayout.Standard?new k.EvenRowHeightsLayoutStrategy(t.style.alignment):O.LockupStyle.isLetterGrid(e)?new E.LetterGridLayoutStrategy:O.LockupStyle.isPath(e)?new Y.PathLayoutStrategy:(g.CoreAssert.isTrue(!1,"Unknown Layout "+e),new k.EvenRowHeightsLayoutStrategy(O.LockupAlignment.Left))},decorationStrategyForConfiguration:function(t){if(null!=this.decorationStrategy_&&this.decorationStrategy_.supportsConfiguration(t))return this.decorationStrategy_;var e=null,n=t.style.backing;return O.LockupStyle.isLetterGrid(t.style.layout)?e=new B.LetterDecorationStrategy:n==O.LockupBacking.None?e=new U.NoDecorationStrategy:n==O.LockupBacking.Rows?e=new X.RowsDecorationStrategy:n==O.LockupBacking.Knockout?e=new X.KnockoutDecorationStrategy:n==O.LockupBacking.Banner||n==O.LockupBacking.BannerVertical||n==O.LockupBacking.BannerHorizontal?e=new u.BannerDecorationStrategy:n==O.LockupBacking.SVGBackground?null!=t.style.backingArtworkID?e=new J.SVGBackgroundDecorationStrategy(t.style.backingArtworkID):(b.Host.logging.warning("Error in svg background. nil backingArtworkID. defaulting to no backing"),e=new U.NoDecorationStrategy):(g.CoreAssert.isTrue(!1,"Unimplemented value for lockup layout."),e=new U.NoDecorationStrategy),e},styleFontsLoaded:function(){var t;return!(t=l.opt(l.as(l.opt(this.lockupForma,function(t){return t.style}),O.LockupStyle),function(t){return t.font}))||t.fontData.availability==x.FontAvailability.LOADED},updatePoolForItems:function(t,e){for(var n,o=0,i={},r=l.iter(t);!r.done;r.next()){var a=r.value;if(a.type==P.LockupItemType.Text){var s=a.text.toUpperCase(),h=(n=i[s])||null!=n?n:0;i[s]=h+1}else o+=1}for(var u=l.iter(e.configureTextFormae(l.clone(i)));!u.done;u.next()){var c=u.value;l.opt(c.parent,function(t){return t.removeChild(c)})}for(var g=l.iter(e.configureShapeFormae(o));!g.done;g.next())c=g.value,l.opt(c.parent,function(t){return t.removeChild(c)})},conformFormaeForItems:function(t,e,n,o){var i;if(void 0===n&&(n=!1),void 0===o&&(o=!1),null!=this.lockupForma)for(var r={},a=0,s=l.iter(t);!s.done;s.next()){var h,u,c,g=s.value,d=!1;switch(g.type){case 0:var p,f,m=g.text.toUpperCase(),y=(i=r[m])||null!=i?i:0,k=e.nthTextFormaForString(y,m);this.conformTextFormaToItem(k.forma,l.clone(g),d),h=k.forma,r[m]=y+1,u=o?0:1,(p=h.parent)&&(f=l.as(l.opt(this.wrappingGroup_,function(t){return t.childAt(u)}),I.GroupForma))&&p!==f&&p.removeChild(h);break;case 1:case 2:k=e.nthShapeForma(a),this.conformShapeFormaToItem(k.forma,l.clone(g),d),d=!k.recycled,h=k.forma,a+=1,u=0}if(h.isFullCanvas=g.isFullCanvas,0==u&&(c=h.parent)){var S=n?e.shapeFormaCount()-a:a-1;c.childCount<=S||S<0?(c.removeChild(h),c.appendChild(h,!1)):l.eq(v._equality_Forma_Forma,c.childAt(S),h)||(c.removeChild(h),c.insertChildAt(h,S,!1))}if(null==h.parent){var L=l.as(l.opt(this.wrappingGroup_,function(t){return t.childAt(u)}),I.GroupForma);null!=L&&(n?L.insertChildAt(h,0,!1):L.appendChild(h,!1))}}},lockupStyle:{get:function(){return l.as(l.opt(this.lockupForma,function(t){return t.style}),O.LockupStyle)}},renderedLayoutResults:{get:function(){return this.renderedLayoutResults_}},calculateScalarToFit:function(t,e){var n=t.width,o=t.height,i=n/o,r=e.width,a=e.height,l=r/a,s=(i>=l?o:n/l)/a;return isNaN(s)?1:s},scalarToFitLayoutResultsIntolockupForma:function(){var t=l.clone(this.renderedLayoutResults_);if(null==t)return 1;var e=t.size,n=this.calculateScalarToFit(this.size,e);return isNaN(n)?1:n},wrappingGroup:{get:function(){var t,e=this;return null!=this.wrappingGroup_?this.wrappingGroup_:null!=this.wrappingGroupID_&&(t=l.as(l.opt(this.lockupForma,function(t){return t.page.formaByID(e.wrappingGroupID_)}),I.GroupForma))?t:l.opt(this.lockupForma,function(t){return 1==t.childCount})?l.as(l.opt(this.lockupForma,function(t){return t.childAt(0)}),I.GroupForma):null}},onFirstUpdate:function(){var t,e=this,n=!1;null!=(t=this.wrappingGroupID_)&&0==l.isEmpty(t)&&(n=!0);var o=null!=this.wrappingGroup_;0==n?(r=l.as(this.lockupForma.isModel?l.opt(this.lockupForma,function(t){return t.page.createModelForma(I.GroupForma.KIND)}):l.opt(this.lockupForma,function(t){return t.page.createForma(I.GroupForma.KIND)}),I.GroupForma))&&(l.opt(this.lockupForma,function(t){return t.removeAllChildren()}),this.wrappingGroup_=r,this.wrappingGroupID_=r.formaID,l.opt(this.lockupForma,function(t){return t.appendChild(r)})):0==o&&(this.wrappingGroup_=l.as(l.opt(this.lockupForma,function(t){return t.page.formaByID(e.wrappingGroupID_)}),I.GroupForma)),l.opt(this.wrappingGroup_,function(t){return t.removeAllChildren()});for(var i=l.iter(l.range(0,2,!1));!i.done;i.next()){var r;(r=l.as(this.lockupForma.isModel?this.lockupForma.page.createModelForma(I.GroupForma.KIND):this.lockupForma.page.createForma(I.GroupForma.KIND),I.GroupForma))&&l.opt(this.wrappingGroup_,function(t){return t.appendChild(r)})}},recalculateTracking:function(t){var e=this.lockupForma,n=this.lockupStyle,o=this.text,i=new D.LockupConfiguration(o,n,t,e.placement,l.opt(e.parent,function(t){return t.bounds})),r=new ct.TheoSize(this.size.width,this.size.height);null==this.layoutStrategy_&&(this.layoutStrategy_=this.layoutStrategyForConfiguration(i));var a=this.layoutStrategy_.calculateTracking(i,r),s=t;0!=a&&a<1e-4&&(s=new ct.TheoSize(-a,s.height),a=0),this.beginBlockedUpdate(),l.opt(l.as(l.opt(this.lockupForma,function(t){return t.style}),O.LockupStyle),function(t){return t.tracking=a}),this.styleController.onTrackingChanged(),this.size=s,this.endBlockedUpdate(),this.internalUpdateGroup(!1)},recalculateLeading:function(t){var e=this.lockupForma,n=this.lockupStyle,o=this.text,i=new D.LockupConfiguration(o,n,t,e.placement,l.opt(e.parent,function(t){return t.bounds})),r=new ct.TheoSize(this.size.width,this.size.height);null==this.layoutStrategy_&&(this.layoutStrategy_=this.layoutStrategyForConfiguration(i));var a=this.layoutStrategy_.calculateLeading(i,r),s=t;a<0&&(s=new ct.TheoSize(s.width,-a),a=0),this.beginBlockedUpdate(),l.opt(this.lockupStyle,function(t){return t.spacing=a}),this.styleController.onSpacingChanged(),this.size=s,this.endBlockedUpdate(),this.internalUpdateGroup(!1)},setLetterSpacingAndBounds:function(t,e){var n;if(void 0===e&&(e=st.TheoPoint.ZERO),null==this.renderedLayoutResults_&&this.updateGroup(),n=this.renderedLayoutResults_){var o=this.layoutStrategy_.adjustWidthForTracking(this.text,l.clone(n),this.lockupStyle.tracking,t);if(0==o)return;var i,r=!1,a=0;null!=(i=o)&&(r=!0,a=i);var s=this.forma.placement.transformValues,h=this.forma.bounds,u=new ct.TheoSize(h.width*s.xscale,h.height*s.xscale),c=new ct.TheoSize(u.width+a,u.height);if(c.width<=0)return;if(r){this.beginBlockedUpdate(),this.lockupStyle.tracking=t,this.endBlockedUpdate();var g=new C.FormaResizeEvent(this.forma,c,e);this.onEvent(g),this.snapSizeToBounds()}else this.lockupStyle.tracking=t}},setLineSpacingAndBounds:function(t,e){var n;if(void 0===e&&(e=st.TheoPoint.ZERO),!(this.numLines()-1<1)&&(null==this.renderedLayoutResults_&&this.updateGroup(),n=this.renderedLayoutResults_)){var o=this.layoutStrategy_.adjustHeightForLeading(this.forma.bounds,l.clone(n),this.lockupStyle.spacing,t),i=this.forma.placement.transformValues,r=this.forma.bounds,a=new ct.TheoSize(r.width*i.xscale,r.height*i.xscale),s=new ct.TheoSize(a.width,a.height+o);this.beginBlockedUpdate(),this.lockupStyle.spacing=t,this.endBlockedUpdate();var h=new C.FormaResizeEvent(this.forma,s,e);this.onEvent(h),this.snapSizeToBounds()}},addLineBreakConstraints:function(){this.allowFewerLineBreaks_=!1;var t=l.replace(l.replace(this.text,"\n"," "),"  "," "),e=l.replace(t," ","");this.lockLineBreaks_=t.split(" ").length==e.length,!this.lockLineBreaks_&&this.text.split("\n").length>1&&(this.allowFewerLineBreaks_=!0)},removeLineBreakConstraints:function(){this.lockLineBreaks_=!1,this.allowFewerLineBreaks_=!1},updateGroup:function(){this.internalUpdateGroup(!0)},internalUpdateGroup:function(t){if(null!=this.lockupForma){if(!this.blockUpdate&&null!=this.lockupStyle){0==this.hasFirstUpdateRun&&(this.onFirstUpdate(),this.hasFirstUpdateRun=!0);var e=this.lockupForma,n=this.lockupStyle;if(!(null!=this.size&&null!=n.font&&this.styleFontsLoaded()&&n.colors.count>0&&this.text.length>0))return this.renderedConfiguration_=null,this.renderedColorLibrary_=null,this.renderedDecorationResults_=null,this.renderedLayoutResults_=null,this.clearLockupFormaPool(this.layoutFormaePool_),void this.clearLockupFormaPool(this.decorationFormaePool_);var o,r,a=this.text,s=!this.owner.selection.inCharStyleMode,h=this.forceLetterFormaMode,u=new D.LockupConfiguration(a,n,this.size,e.placement,l.opt(e.parent,function(t){return t.bounds}),s,h);if(u.characterStyleRanges=l.clone(this.charStyleRanges),u.highlightMethod=this.highlightMethod,u.rowWordLengths=null,this.lockLineBreaks_||this.allowFewerLineBreaks_){for(var c=l.clone(this.lockupForma.filterByKind(ot.TextForma.KIND)),d=0,f=l.iter(c);!f.done;f.next()){var m=f.value;d=Math.max(d,m.rowIndex)}u.rowWordLengths=l.repeat(0,d+1);for(var y=l.iter(c);!y.done;y.next())m=y.value,u.rowWordLengths[m.rowIndex]+=1;u.allowFewerLineBreaks=this.allowFewerLineBreaks_}(o=n.colors.fieldPrimary)&&(this.currentPrimaryColor=o),(r=n.colors.fieldSecondary)&&(this.currentSecondaryColor=r),this.decorationStrategy_=this.decorationStrategyForConfiguration(u),this.layoutStrategy_=this.layoutStrategyForConfiguration(u);var k=null==this.renderedConfiguration_||Math.abs(this.size.height-this.thresholdGroupHeight)>1||Math.abs(this.size.width-this.thresholdGroupWidth)>1||this.renderedConfiguration_.text!=u.text||u.style.needsLayout(this.renderedConfiguration_.style)||this.renderedConfiguration_.characterStyleRanges!=u.characterStyleRanges||this.renderedConfiguration_.highlightMethod!=u.highlightMethod||this.renderedConfiguration_.forceLetterForma!=u.forceLetterForma;if(!k)for(var S=l.iter(u.style.characterStyles);!S.done;S.next()){var v=S.key,L=S.value;if(!(R=this.renderedConfiguration_.style.characterStyles[v])){k=!0;break}if(R.colorLibrary=this.renderedColorLibrary_,g.CoreAssert.isTrue(L.colorLibrary==n.colorLibrary,"char style library doesnt match lockup style"),L.needsLayout(R)||L.textOpacity!=R.textOpacity||L.backingOpacity!=R.backingOpacity){k=!0;break}}var T=k||!u.style.sameColors(this.renderedConfiguration_.style),F=null==this.renderedConfiguration_||u.style.needsLayout(this.renderedConfiguration_.style),x=null==this.renderedConfiguration_||k||!this.renderedConfiguration_.containerSize.equal(u.containerSize)||!this.renderedConfiguration_.placement.equal(u.placement)||this.renderedConfiguration_.style.backingArtworkID!=u.style.backingArtworkID||this.renderedConfiguration_.style.backing!=u.style.backing||this.renderedConfiguration_.style.textLook!=u.style.textLook||this.renderedConfiguration_.style.shadowAngle!=u.style.shadowAngle||T&&O.LockupStyle.isShadowLook(u.style.textLook);if(!x)for(var C=l.iter(u.style.characterStyles);!C.done;C.next()){var R;if(v=C.key,L=C.value,x=T&&L.textLook==O.LockupTextLook.KnockoutAndShadow,(R=this.renderedConfiguration_.style.characterStyles[v])&&(L.backingArtworkID!=R.backingArtworkID||L.shadowAngle!=R.shadowAngle)){x=!0;break}}if(this.isRightToLeft=it.TypeLockupUtils.isTextRightToLeft(a),k){var A=l.clone(this.layoutStrategy_.layout(u));this.isRightToLeft&&A.flipForRightToLeft(),this.updatePoolForItems(l.clone(A.items),this.layoutFormaePool_),this.renderedLayoutResults_=l.clone(A)}var M=u.style.backing==O.LockupBacking.None,w=!1;if(x){var _=this.decorationStrategy_.decorate(u,l.clone(this.renderedLayoutResults_));if((L=u.style.characterStyles[i.HIGHLIGHT_STYLE])&&!O.LockupStyle.isPath(u.style.layout)){if(O.LockupStyle.isShadowLook(L.textLook)){var I=(new K.ShadowDecorationStrategy).decorate(u,l.clone(this.renderedLayoutResults_));l.append(_.items,I.items),M=!0,w=L.textLook==O.LockupTextLook.KnockoutAndShadow}if(u.style.backing!=O.LockupBacking.None&&L.textLook==O.LockupTextLook.FillAndOutline2){var b=(new U.NoDecorationStrategy).decorate(u,l.clone(this.renderedLayoutResults_));l.append(_.items,b.items),M=!0}if((L.backing==O.LockupBacking.Rows||L.backing==O.LockupBacking.SVGBackground)&&u.style.backing!=O.LockupBacking.Rows&&!O.LockupStyle.isLetterGrid(u.style.layout)){var H=(new X.RowsDecorationStrategy).decorate(u,l.clone(this.renderedLayoutResults_));if(M&&_.items.length>1)for(var B=l.iter(H.items);!B.done;B.next()){var E=B.value;_.items.splice(0,0,l.clone(E))}else l.append(_.items,H.items)}}if(u.style.backing!=O.LockupBacking.None&&u.style.textLook==O.LockupTextLook.FillAndOutline2){var P=(new U.NoDecorationStrategy).decorate(u,l.clone(this.renderedLayoutResults_));l.append(_.items,P.items),M=!0}else if(O.LockupStyle.isShadowLook(u.style.textLook)){var N=(new K.ShadowDecorationStrategy).decorate(u,l.clone(this.renderedLayoutResults_));l.append(_.items,N.items),M=!0,w=u.style.textLook==O.LockupTextLook.KnockoutAndShadow}this.updatePoolForItems(l.clone(_.items),this.decorationFormaePool_),this.renderedDecorationResults_=_}(T||k)&&this.conformFormaeForItems(l.clone(this.renderedLayoutResults_.items),this.layoutFormaePool_),(T||x)&&this.conformFormaeForItems(l.clone(this.renderedDecorationResults_.items),this.decorationFormaePool_,M,w);var G=this.renderedLayoutResults_.size.width,Y=this.renderedLayoutResults_.size.height;this.thresholdGroupHeight=this.size.height,this.thresholdGroupWidth=this.size.width,this.setLayerOpacities(n);var W=this.findInternalOffset(n,this.size,new ct.TheoSize(G,Y));this.updateChildGroupBounds(),t&&l.opt(this.wrappingGroup,function(t){return t.placement=z.Matrix2D.Identity.translate(W)}),this.localCoordinateAlignmentLines_=l.clone(this.alignmentsInLocalCoords(!0)),(k||x)&&l.opt(l.opt(this.lockupForma,function(t){return t.animation}),function(t){return t.invalidate()}),u.style=n.clone(),this.renderedColorLibrary_=new p.ColorLibrary,this.renderedColorLibrary_.decodeAndSetJson(l.opt(n.colorLibrary,function(t){return t.encodeJson()})),this.renderedConfiguration_=u,this.renderedConfiguration_.style.colorLibrary=this.renderedColorLibrary_,k&&this.highlightMethod>=i.FIRST_AUTO_METHOD&&this.highlightMethod<=i.MAX_AUTO_METHOD&&(this.autoApplyCharStyle(!0,!1,!0),F&&this.updateGroup())}}else g.CoreAssert.warning("TypeLockupController.updateGroup() after detachment")},setLayerOpacities:function(t){var e=t.currentTextOpacity,n=t.currentBackingOpacity,o=l.as(l.opt(this.wrappingGroup_,function(t){return t.childAt(1)}),I.GroupForma);l.opt(o,function(t){return t.style.opacity=e}),o=l.as(l.opt(this.wrappingGroup_,function(t){return t.childAt(0)}),I.GroupForma),l.opt(o,function(t){return t.style.opacity=n})},updateChildGroupBounds:function(){var t,e;if(t=this.wrappingGroup_){var n=new M.FormaGeometryChangedEvent(t);t.beginUpdate(n),t.endUpdate(n)}(e=l.as(l.opt(this.wrappingGroup_,function(t){return t.childAt(1)}),I.GroupForma))&&(n=new M.FormaGeometryChangedEvent(e),e.beginUpdate(n),e.endUpdate(n)),(e=l.as(l.opt(this.wrappingGroup_,function(t){return t.childAt(0)}),I.GroupForma))&&(n=new M.FormaGeometryChangedEvent(e),e.beginUpdate(n),e.endUpdate(n))},findInternalOffset:function(t,e,n){return t.alignment==O.LockupAlignment.UNSET||t.alignment==O.LockupAlignment.Center?new st.TheoPoint((e.width-n.width)/2,(e.height-n.height)/2):t.alignment==O.LockupAlignment.Left?new st.TheoPoint(0,(e.height-n.height)/2):t.alignment==O.LockupAlignment.Right?new st.TheoPoint(e.width-n.width,(e.height-n.height)/2):new st.TheoPoint(0,0)},conformTextFormaToItem:function(t,e,n){var o;if(e.type==P.LockupItemType.Text){var i=null;n&&((i=new M.FormaAnimationTransactionEvent(t)).duration=0,t.beginUpdate(i));var r,a,s=e.font,h=e.hasPrimaryColor?this.currentPrimaryColor:this.currentSecondaryColor,u=this.currentSecondaryColor,c=this.lockupStyle.textLook;t.style.opacity=1,null!=e.characterStyle&&(m=l.opt(this.lockupStyle,function(t){return t.characterStyles[e.characterStyle]}))&&(m.textLook!=O.LockupTextLook.UNSET&&(c=m.textLook),g.CoreAssert.isTrue(m.colorLibrary==this.lockupStyle.colorLibrary,"char style library doesnt match lockup style"),(r=e.hasPrimaryColor?m.colors.fieldPrimary:m.colors.fieldSecondary)&&(h=r),(a=m.colors.fieldSecondary)&&(u=a),m.opacityRule!=O.OpacityRule.UNSET&&(t.style.opacity=m.textOpacity),m.textLook==O.LockupTextLook.Fill&&O.LockupStyle.isKnockoutLook(this.lockupStyle.textLook)&&m.textOpacity<1&&m.textOpacity!=O.LockupStyle.OPACITY_UNSET&&(c=O.LockupTextLook.KnockoutAndFill));var d=(o=l.opt(this.renderedLayoutResults_,function(t){return t.avgTextPointSize}))||null!=o?o:e.pointSize,p=0,f=this.lockupStyle.strokeWeight+.04;if(c==O.LockupTextLook.OutlineOnly)p=.5*d*f;else if(c==O.LockupTextLook.KnockoutAndOutline)p=.5*d*f,u=h;else if(c==O.LockupTextLook.FillAndOutline)p=.5*d*f;else if(c==O.LockupTextLook.ShadowAndOutline)p=.08*d*(f+.25);else if(c==O.LockupTextLook.KnockoutAndShadow){var m;e.hasPrimaryColor||(p=.08*e.pointSize*(1.7*this.lockupStyle.shadowOffset+.25),t.style.opacity=.75,h=this.currentPrimaryColor,u=this.currentPrimaryColor,null!=e.characterStyle&&(m=l.opt(this.lockupStyle,function(t){return t.characterStyles[e.characterStyle]}))&&(h=m.colors.fieldPrimary||this.currentPrimaryColor,u=m.colors.fieldPrimary||this.currentPrimaryColor))}else c==O.LockupTextLook.FillAndOutline2?e.hasPrimaryColor||(p=.5*d*f):c==O.LockupTextLook.KnockoutAndFill&&this.forceLetterFormaMode&&(p=6);t.setTextProperties(e.text,s,e.pointSize,h,u,p,c,e.rangeInLockup,e.rowIndex,this.lockupStyle.tracking),t.placement=e.placement,n&&t.endUpdate(i)}else g.CoreAssert.fail("Expected text item")},conformShapeFormaToItem:function(t,e,n){var o=null;n&&((o=new M.FormaAnimationTransactionEvent(t)).duration=0,t.beginUpdate(o)),t.style.opacity=1;var i,r,a=e.hasPrimaryColor?this.currentPrimaryColor:this.currentSecondaryColor;switch(null!=e.characterStyle&&(i=l.opt(this.lockupStyle,function(t){return t.characterStyles[e.characterStyle]}))&&(g.CoreAssert.isTrue(i.colorLibrary==this.lockupStyle.colorLibrary,"char style library doesnt match lockup style"),(r=e.hasPrimaryColor?i.colors.fieldPrimary:i.colors.fieldSecondary)&&(a=r),i.opacityRule!=O.OpacityRule.UNSET&&(t.style.opacity=i.backingOpacity)),e.type){case 0:g.CoreAssert.fail("Text item cannot be associated with a shape forma");break;case 1:t.contentID=null,t.preScale=null,t.size=e.size,t.sliceBox=null,t.shapeLibraryID=null,t.canonicalArtwork=Z.TheoArtworkShape.fromPath(e.path),t.style.colors.fieldPrimary=a,t.placement=e.placement;break;case 2:if(t.shapeLibraryID!=e.artworkID&&q.ShapeLibrary.applyToShapeForma(t,e.artworkID),null==t.sliceBox){var s=t.canonicalArtwork.bounds,h=s.width,u=s.height,c=e.size,d=c.width<=c.height?c.width/h:c.height/u;h*=d,u*=d,t.size=new ct.TheoSize(h,u)}else t.size=e.size;t.preScale=e.preScale,t.placement=e.placement,t.style.colors.fieldPrimary=a}n&&t.endUpdate(o)},encode:function(t){var e,n=this,o=(e=this.contentID_)||null!=e?e:"";if(""==o){var r=l.opt(this.forma,function(t){return t.formaID!=l.opt(n.forma,function(t){return t.originalID})})?"Forma is a clone":"NOT A CLONE",a=1==this.validDecode_?"VALID DECODE":"Decode not valid";null==this.validDecode_&&(a="validDecode_ not set"),g.CoreAssert.fail("Why are we encoding an empty text content node id? "+r+" "+a)}if(t.setStringProperty(i.PROPERTY_CONTENT_ID,o),null!=this.wrappingGroup_){var s=this.wrappingGroup_.formaID;t.setStringProperty(i.PROPERTY_WRAPPER_ID,s)}if(t.setIntProperty(i.PROPERTY_HIGHLIGHTMETHOD_ID,this.highlightMethod),this.charStyleRanges.length>0){for(var h=[],u=l.iter(this.charStyleRanges);!u.done;u.next()){var c=u.value;h.push(c.start),h.push(c.end)}var d={};d[i.HIGHLIGHT_STYLE]=l.as(h,"AnyObject"),t.setProperty(i.PROPERTY_CHARSTYLERANGES,l.as(d,"AnyObject"))}},decode:function(t){var e,n,o,r,s;if(this.missingFontCount_=(e=l.opt(l.opt(this.forma,function(t){return t.page.document}),function(t){return t.missingFontList.length}))||null!=e?e:0,this.beginBlockedUpdate(),this.contentID=t.stringProperty(i.PROPERTY_CONTENT_ID,""),this.wrappingGroupID_=t.stringProperty(i.PROPERTY_WRAPPER_ID,""),this.highlightMethod=(n=a.HighlightMethod.toCaseValue(t.intProperty(i.PROPERTY_HIGHLIGHTMETHOD_ID,a.HighlightMethod.Manual)))||null!=n?n:a.HighlightMethod.Manual,o=l.as(t.property(i.PROPERTY_CHARSTYLERANGES),["Dictionary","String","AnyObject"])){this.charStyleRanges.splice(0);for(var h=l.iter(o);!h.done;h.next()){var u=h.key,c=h.value;g.CoreAssert.isTrue(u==i.HIGHLIGHT_STYLE,"unexpected character style");for(var d=l.clone(c),p=l.iter(l.range(0,d.length,!0));!p.done;p.next()){var f=p.value;if(f%2==0&&f<d.length-1){var m=new ut.TextRange(d[f],d[f+1]);this.charStyleRanges.push(m)}}}}(r=l.as(O.LockupStyle.decodeJson(t.property(i.PROPERTY_LOCKUPSTYLE_DEPRECATED),O.LockupStyle.KIND,this.forma.page.document),O.LockupStyle))&&(r.backing==O.LockupBacking.Banner&&(r.backing=this.size.width>this.size.height?O.LockupBacking.BannerHorizontal:O.LockupBacking.BannerVertical),l.opt(this.lockupForma,function(t){return t.applyStyle(r)})),(s=ct.TheoSize.decodeJson(t.property(i.PROPERTY_SIZE_DEPRECATED)))&&(this.size=s),this.endBlockedUpdate()},postDecode:function(){var t,e;this.validDecode_=null!=this.contentNode,this.removeListenersFromNode(),this.addListenersToNode(),this.beginBlockedUpdate(),this.styleController_.legacyColorConversion(),this.endBlockedUpdate();var n,o=(t=l.opt(l.opt(this.lockupForma,function(t){return t.page.document}),function(t){return t.versionDecoded.vers}))||null!=t?t:0,i=!1;if(g.CoreAssert.isTrue(this.lockupForma.controller===this),n=l.as(this.lockupForma.style,O.LockupStyle)){var r;if(g.CoreAssert.isTrue(this.lockupForma.style===this.lockupStyle),n.backing==O.LockupBacking.SVGBackground&&(r=this.contentDocument.nodeWithTag(q.TAG_SHAPE_ID,n.backingArtworkID))&&r.removeFromParent(),o<nt.TheoDocumentVersion.Knockouts&&n.backing==O.LockupBacking.None&&1!=n.textOpacity){var a=n.textOpacity,s=n.backingOpacity;n.textOpacity=a,n.backingOpacity=s}if(O.LockupStyle.isKnockoutLook(n.textLook)){var h=n.backing;n.backing=O.LockupBacking.None,n.backing=h}var u=(e=l.opt(l.opt(this.forma,function(t){return t.page.document}),function(t){return t.missingFontList.length}))||null!=e?e:0;u>this.missingFontCount_?(i=!0,this.missingFontCount_=u):o<nt.TheoDocumentVersion.LetterSpacing&&l.opt(n.font,function(t){return"Pacifico-Regular"==t.fontData.postScriptName||l.opt(n.font,function(t){return"Montserrat-Regular"==t.fontData.postScriptName})})&&(i=!0),o<nt.TheoDocumentVersion.NewTextAnimations&&(this.text.includes("–")||this.text.includes("—"))&&0==n.spacing&&(n.spacing=.5,i=!0)}i&&this.styleChanged()},clone:function(t){var e=new T.FormaControllerFactory(this.owner).createController(this.kind,t);return e.beginBlockedUpdate(),e.size=this.size,e.highlightMethod=this.highlightMethod,e.charStyleRanges=l.clone(this.charStyleRanges),e.contentID=this.contentID,e.validDecode_=this.validDecode_,e.removeListenersFromNode(),e.endBlockedUpdate(),e},match:function(t){var e;(e=l.as(t,i))?(this.size=e.size,this.highlightMethod=e.highlightMethod,0==l.count(l.opt(this.lockupStyle,function(t){return t.characterStyles}))&&0==!this.charStyleRanges.length?this.charStyleRanges.splice(0):it.TypeLockupUtils.rangesAreEqual(l.clone(this.charStyleRanges),l.clone(e.charStyleRanges))||this.text==e.text&&(this.charStyleRanges=l.clone(e.charStyleRanges)),this.updateGroup()):_.GroupController.prototype.match.call(this,t)},textBacked:{get:function(){var t;return!!(t=this.lockupStyle)&&t.textBacked}},maxLineLengthDifference:{get:function(){var t=this.numLines(),e=l.repeat(1/0,t),n=l.repeat(-1/0,t);this.lockupForma.visit(v.FormaTraversal.PreOrder,function(t,o,i){var r,a;return(r=l.as(t,ot.TextForma))&&0!=r.rangeInLockup.length&&(a=r.finalFrame)&&(e[r.rowIndex]=Math.min(e[r.rowIndex],a.minY),n[r.rowIndex]=Math.max(n[r.rowIndex],a.maxY)),!1});for(var o=[],i=l.iter(l.range(0,t,!1));!i.done;i.next()){var r=i.value;isFinite(e[r])&&isFinite(n[r])&&o.push(n[r]-e[r])}return o.length>0?l.max(o)-l.min(o):0}},contrastCheck:function(t){void 0===t&&(t=!0),this.styleController_.backgroundContrastCheck(t)},getBackgroundEdge:function(){var t,e;return(t=l.as(this.visualParent.controller,L.FrameController))&&(e=l.opt(this.forma,function(t){return t.finalFrame}))?t.getAverageEdge(e):null},getBackgroundLightnessSpread:function(t){for(var e=100,n=0,o=l.iter(t);!o.done;o.next()){var i=o.value;e=Math.min(e,i.lightness),n=Math.max(n,i.lightness)}return G.MathUtils.absDouble(n-e)},snapSizeToBounds:function(){var t=new M.FormaTransformChangedEvent(this.lockupForma);if(null!=this.lockupForma.frame&&null!=this.renderedLayoutResults_){var e=this.renderedLayoutResults_.size;this.lockupForma.beginUpdate(t),this.lockupForma.placement=this.wrappingGroup_.placement.concat(this.lockupForma.placement),this.thresholdGroupHeight=e.height,this.thresholdGroupWidth=e.width,this.size=e,this.lockupForma.endUpdate(t)}},isTypeLockup:{get:function(){return!0}},avgLineHeight:{get:function(){var t;return null!=(t=this.averageLineHeight)?t:-1}},averageLineHeight:{get:function(){var t;if(t=this.renderedLayoutResults_){var e=this.lockupForma.placement.transformValues.yscale;if(isFinite(t.avgTextItemHeight))return t.avgTextItemHeight*e}return null}},currentHeightScale:{get:function(){return this.getAverageFontSize()}},getSizeHeightScales:function(){return null==this.sizeHeightScales_&&this.calculateSizeHeightScales(),this.sizeHeightScales_},calculateSizeHeightScales:function(){var t,e=[],n=this.forma.clone();if(t=l.as(n.controller,i)){n.placement=z.Matrix2D.Identity;for(var o=[t.size.aspectRatio,.1,.2,.3,.4,.5,.6,.8,1,1.4,2,3,5,12],r=l.iter(o);!r.done;r.next()){var a=r.value;t.size=new ct.TheoSize(100*a,100),t.snapSizeToBounds();for(var s=t.size,h=!1,u=l.iter(e);!u.done;u.next()){var c=u.value;Math.abs(c.size.aspectRatio-s.aspectRatio)<.01&&(h=!0)}h||e.push({size:s,scale:t.avgLineHeight})}}n.destroy(),this.sizeHeightScales_=l.clone(e)},numLines:function(){var t,e=0;if(null!=(t=l.opt(this.renderedLayoutResults_,function(t){return t.numberOfLines})))e=t;else{var n=-1;this.lockupForma.visit(v.FormaTraversal.PreOrder,function(t,o,i){var r;return(r=l.as(t,ot.TextForma))&&0!=r.rangeInLockup.length&&(n=Math.max(e,r.rowIndex)),!1}),n>-1&&(e=n+1)}return e},textFrame:{get:function(){return this.textBoundsInCoordSpace(this.lockupForma.placement)}},textFinalFrame:{get:function(){var t,e=null;return(t=this.lockupForma)&&t.visitAll(v.FormaTraversal.PreOrder,function(t){t.kind==ot.TextForma.KIND&&(e=ht.TheoRect.unionOf(e,t.finalFrame))}),e}},getKnockoutOutlines:function(t){var e,n,o,i,r=lt.TheoArbitraryPath.init_d41d(),a=!0;if(null!=(i=t.shapeLibraryID)){var s=q.ShapeLibrary.shapeDictionary[i];if(!s.filled)return null;a=s.clockwise}var h,u=t.boundsInCoordSpace(t.placement);return(h=this.lockupForma)&&h.visit(v.FormaTraversal.PreOrder,function(t,i,s){var h;if(h=l.as(t,ot.TextForma)){var c=h.boundsInCoordSpace(h.placement).evalXY(.5,.5);if(!u.containsPoint(c))return!1;var g=l.opt(l.as(h.textModel.attributeAtIndex($.FontDescriptorAttribute.NAME,0).attr,$.FontDescriptorAttribute),function(t){return t.value}),d=l.opt(l.as(h.textModel.attributeAtIndex($.FontSizeAttribute.NAME,0).attr,$.FontSizeAttribute),function(t){return t.value}),p=(e=O.LockupTextLook.toCaseValue((n=l.opt(l.as(l.opt(h.textModel.attributeAtIndex($.TextLookAttribute.NAME,0),function(t){return t.attr}),$.TextLookAttribute),function(t){return t.value}))||null!=n?n:0))||null!=e?e:O.LockupTextLook.Fill,f=O.LockupStyle.isKnockoutLook(p);if(p==O.LockupTextLook.KnockoutAndShadow&&(f=0==l.opt(l.as(h.textModel.attributeAtIndex($.FontStrokeWidthAttribute.NAME,0).attr,$.FontStrokeWidthAttribute),function(t){return t.value})),f){var m=(o=l.opt(l.as(h.textModel.attributeAtIndex($.TrackingAttribute.NAME,0).attr,$.TrackingAttribute),function(t){return t.value}))||null!=o?o:0,y=b.Host.textModelUtils.textOutlines(h.textModel.text,g,d,m);null!=y&&(a==b.Host.textModelUtils.fontHasClockwiseOutlines(g)&&(y=b.Host.textModelUtils.rewindPath(y)||y),r.addPath(y,h.placement))}}return!1}),null==r.bounds?null:r},textBoundsInCoordSpace:function(t){var e,n=null;if(e=this.lockupForma){var o=[];e.visit(v.FormaTraversal.PreOrder,function(e,i,r){var a;return 0==i?o=[t]:(o=o.slice(0,1+i)).push(e.placement.concat(l.last(o))),(a=l.as(e,ot.TextForma))&&(n=ht.TheoRect.unionOf(n,a.boundsInCoordSpace(l.last(o)))),!1})}return n},textBoundsInCoordSpace2:function(t){var e,n=null;return(e=this.lockupForma)&&e.visitPlaced(t,function(t,e,o,i){var r;return(r=l.as(t,ot.TextForma))&&(n=ht.TheoRect.unionOf(n,r.boundsInCoordSpace(e))),!1}),n},shapeCount:function(){return l.as(this.lockupForma.root,W.RootForma).filterByControllerKind(w.GridController.KIND).length},wordCount:function(){return this.text.length>0?l.clone(this.text.split(" ")).length:0},updateScoring:function(){this.styleController_.updateScoring()},shuffleColorAssignment:function(){var t;if(t=this.lockupForma){var e=new M.FormaStyleChangedEvent(t);t.beginUpdate(e),this.styleController_.shuffleColorAssignment(),t.endUpdate(e)}},applyTextStyleSuggestion:function(t){var e;if(!(e=t)){var n=this.getNewStyleAttributes(!0),o=l.as(this.forma.style,O.LockupStyle);return this.forma.applyStyle(n),this.styleController.pickVisibleColorsForCharStyle()&&this.updateGroup(),null!=n.font&&n.font.isSparkFont()?tt.TheoBrandkitUtils.brandDocumentForElement(this.forma.page.document,n.font.sparkElementID,c.AUTHORING_CONTEXT_TYPE_FONT):l.opt(o,function(t){return null!=t.font})&&o.font.isSparkFont()&&tt.TheoBrandkitUtils.unBrandDocumentIfNoBrandedElements(this.forma.page.document),n}return this.forma.applyStyle(e),this.charStyleRanges.length>0&&0==l.count(e.characterStyles)?(this.getCharacterStyle(i.HIGHLIGHT_STYLE),this.updateGroup()):this.styleController.pickVisibleColorsForCharStyle()&&this.updateGroup(),null},getNewStyleAttributes:function(t){return this.styleController_.getNewStyleAttributes(t)},generateAndApplyNewStyleAttributes:function(t){void 0===t&&(t=!0),this.styleController_.generateAndApplyNewStyleAttributes(t)},generateAndApplyInitialStyleAttributes:function(){this.styleController_.generateAndApplyInitialStyleAttributes()},clearLockupFormaPool:function(t){for(var e=l.iter(t.configureTextFormae({}));!e.done;e.next()){var n=e.value;l.opt(n.parent,function(t){return t.removeChild(n)})}for(var o=l.iter(t.configureShapeFormae(0));!o.done;o.next())n=o.value,l.opt(n.parent,function(t){return t.removeChild(n)})},preferredXAlignment:{get:function(){return this.lockupStyle.alignment==O.LockupAlignment.Left?h.AlignmentType.Left:this.lockupStyle.alignment==O.LockupAlignment.Right?h.AlignmentType.Right:h.AlignmentType.CenterX}},setAlignmentType:function(t){this.numLines()>1&&(t==h.AlignmentType.Left&&l.opt(this.lockupStyle,function(t){return t.alignment!=O.LockupAlignment.UNSET})&&l.opt(this.lockupStyle,function(t){return t.alignment!=O.LockupAlignment.Left})&&(this.lockupStyle.alignment=O.LockupAlignment.Left),t==h.AlignmentType.Right&&l.opt(this.lockupStyle,function(t){return t.alignment!=O.LockupAlignment.UNSET})&&l.opt(this.lockupStyle,function(t){return t.alignment!=O.LockupAlignment.Right})&&(this.lockupStyle.alignment=O.LockupAlignment.Right),t==h.AlignmentType.CenterX&&l.opt(this.lockupStyle,function(t){return t.alignment!=O.LockupAlignment.UNSET})&&l.opt(this.lockupStyle,function(t){return t.alignment!=O.LockupAlignment.Center})&&(this.lockupStyle.alignment=O.LockupAlignment.Center))},canClaimForma:function(t){return!1},getPinBounds:function(t){var e,n=l.opt(this.lockupForma,function(t){return t.bounds});return(e=this.lockupStyle)&&(n=t==at.PinBoundsType.Bounds||e.backing==O.LockupBacking.Banner||e.backing==O.LockupBacking.BannerHorizontal||e.backing==O.LockupBacking.BannerVertical?this.textBoundsInCoordSpace(z.Matrix2D.Identity):this.lockupForma.childrenBoundsInCoordSpace(z.Matrix2D.Identity)),n},centerAlignmentIfSingleLine:function(){var t=this,e=l.opt(l.opt(this.wrappingGroup_,function(t){return t.bounds}),function(e){return e.equalWithAccuracy(t.forma.bounds,.01)});1!=this.numLines()||null==e||!e||this.lockupStyle.alignment!=O.LockupAlignment.Left&&this.lockupStyle.alignment!=O.LockupAlignment.Right||(this.lockupStyle.alignment=O.LockupAlignment.Center)},preventOutofBoundsOrOverlap:function(t){var e,n;(e=this.textFinalFrame)&&(n=this.lockupForma)&&!t.contains(e)&&(e.minX<t.minX&&n.move(z.Matrix2D.translationXY(-1*(e.minX-t.minX)+10,0)),e.maxX>t.maxX&&n.move(z.Matrix2D.translationXY(t.maxX-e.maxX-10,0)),e.minY<t.minY&&n.move(z.Matrix2D.translationXY(0,-1*(e.minY-t.minY)+10)),e.maxY>t.maxY&&n.move(z.Matrix2D.translationXY(0,t.maxY-e.maxY-10)))},addForma:function(t,e,n){var o,r,a,s=this;if((o=l.as(t.root,W.RootForma))&&(r=l.as(e,I.GroupForma))&&(a=l.as(e.controller,i))){n.suggestPlacement||e.controller.fit(o.frame.insetRel(.25,.25,.25,.25)),e.applyStyle(O.LockupStyle.createDefault());var h=!1,u=l.clone(o.filterWithCallback(function(t){return t instanceof H.ImageForma&&t.parent instanceof R.FrameForma})),c=null;u.length>0&&(c=l.as(u[0],H.ImageForma)),o.visitAll(v.FormaTraversal.PreOrder,function(t){var n;if((n=l.as(t.controller,i))&&l.opt(n.lockupStyle,function(t){return t.backing!=O.LockupBacking.Knockout})){var o=l.opt(n.lockupStyle,function(t){return t.clone()});e.applyStyle(o),h=!0}});var g=l.clone(o.filterByControllerKind(w.GridController.KIND));if(1==g.length?g[0].appendChild(e):o.appendChild(e),n.suggestPlacement){var d,p=f.CorePromise.resolve(null);return(d=l.opt(l.opt(c,function(t){return t.contentNode}),function(t){return t.image}))&&(d.loaded()||(e.moveCenterToPoint(new st.TheoPoint(-o.frame.center.x,o.frame.center.y)),p=new f.CorePromise(function(t,e){return d.whenLoaded(function(){return t(null)})}))),p.then(function(t){return s.placeStyleLockup(r,o,a,h)})}return f.CorePromise.resolve(null)}return f.CorePromise.reject("TypeLockupController.addFormaToRoot: no lockup forma")},getBackingContrastRole:function(){var t;if(t=this.lockupStyle){var e=t.textLook==O.LockupTextLook.KnockoutOnly||t.textLook==O.LockupTextLook.OutlineOnly,n=t.strokeWeight>.15;return e||n||t.textBacked?y.ColorRole.FieldSecondary:y.ColorRole.FieldPrimary}return y.ColorRole.FieldPrimary},getSuggestableColors:function(){return this.styleController_.getSuggestableColors()},applyColors:function(t,e){var n=l.opt(l.opt(this.owner,function(t){return t.document}),function(t){return t.beginTransaction("set_text_colors")});this.styleController_.applyColors(l.clone(t),e),l.opt(n,function(t){return t.end()})},primaryColorVisible:function(){return this.styleController.targetedTextLook!=O.LockupTextLook.KnockoutOnly&&this.styleController.targetedTextLook!=O.LockupTextLook.OutlineOnly},secondaryColorVisible:function(){return this.styleController.targetedLockupStyle.backing!=O.LockupBacking.None||O.LockupStyle.isOutlineLook(this.styleController.targetedTextLook)||this.styleController.targetedTextLook==O.LockupTextLook.Shadow},applyOpacity:function(t){this.styleController_.setOpacity(t)},currentOpacity:{get:function(){return this.styleController.getOpacityValue()}},getHighlightMethodName:function(t){return t==a.HighlightMethod.Manual?"k_HighlightMethod_None":t==a.HighlightMethod.Numbers?"k_HighlightMethod_Numbers":t==a.HighlightMethod.Nouns?"k_HighlightMethod_Nouns":t==a.HighlightMethod.Verbs?"k_HighlightMethod_Verbs":t==a.HighlightMethod.Names?"k_HighlightMethod_Names":t==a.HighlightMethod.Adjectives?"k_HighlightMethod_Adjectives":t==a.HighlightMethod.SmallWords?"k_HighlightMethod_SmallWords":t==a.HighlightMethod.EvenRows||t==a.HighlightMethod.OddRows||t==a.HighlightMethod.Bracket||t==a.HighlightMethod.InsideBracket?"k_HighlightMethod_Lines":t==a.HighlightMethod.EvenWords||t==a.HighlightMethod.OddWords?this.text.includes(" ")?"k_HighlightMethod_Words":"k_HighlightMethod_Letters":t==a.HighlightMethod.First?"k_HighlightMethod_First":t==a.HighlightMethod.Last?"k_HighlightMethod_Last":l.toString(this.highlightMethod)},placeStyleLockup:function(t,e,n,o){var i;if(i=new A.FormaPlacementSuggester(t,e).fastPlacement()){var r=new M.FormaTransformChangedEvent(t);r.duration=0,t.beginUpdate(r),i.apply(),n.text.length>0&&this.snapSizeToBounds(),n.updateScoring(),o?n.styleController.doesLockupContrastWithBackground()||n.styleController.pickVisibleColorsForLockup():n.generateAndApplyInitialStyleAttributes(),t.endUpdate(r)}return f.CorePromise.resolve(null)},incrementHighlightMethod:function(){this.highlightMethod==a.HighlightMethod.Manual?this.highlightMethod=a.HighlightMethod.Numbers:this.highlightMethod==a.HighlightMethod.Numbers?this.highlightMethod=a.HighlightMethod.Nouns:this.highlightMethod==a.HighlightMethod.Nouns?this.highlightMethod=a.HighlightMethod.Verbs:this.highlightMethod==a.HighlightMethod.Verbs?this.highlightMethod=a.HighlightMethod.Names:this.highlightMethod==a.HighlightMethod.Names?this.highlightMethod=a.HighlightMethod.Adjectives:this.highlightMethod==a.HighlightMethod.Adjectives?this.highlightMethod=a.HighlightMethod.SmallWords:this.highlightMethod==a.HighlightMethod.SmallWords?this.highlightMethod=a.HighlightMethod.EvenRows:this.highlightMethod==a.HighlightMethod.EvenRows||this.highlightMethod==a.HighlightMethod.OddRows?this.highlightMethod=a.HighlightMethod.EvenWords:this.highlightMethod==a.HighlightMethod.EvenWords||this.highlightMethod==a.HighlightMethod.OddWords?this.highlightMethod=a.HighlightMethod.InsideBracket:this.highlightMethod==a.HighlightMethod.First?this.highlightMethod=a.HighlightMethod.Numbers:this.highlightMethod==a.HighlightMethod.Last?this.highlightMethod=a.HighlightMethod.Numbers:this.highlightMethod!=a.HighlightMethod.Bracket&&this.highlightMethod!=a.HighlightMethod.InsideBracket||(this.highlightMethod=a.HighlightMethod.Numbers)},getNextRanges:function(t,e){var n=this,o=[],r=it.TypeLockupUtils.getWordRanges(t,this.highlightMethod);if(0==r.length||t.length<2)return o;var s=l.chars(t),h=1==r.length&&0==r[0].start&&r[0].end==l.chars(t).length;if(e&&t.includes(" ")&&this.highlightMethod==a.HighlightMethod.Manual)return o.push(r[0]),o;if(this.highlightMethod>=i.FIRST_NLP_METHOD&&this.highlightMethod<=i.MAX_NLP_METHOD){var u=t;u==u.toUpperCase()&&(u=u.toLowerCase()),u=l.replace(u,"\n"," ");var c=l.clone(b.Host.textModelUtils.getWordClassRanges(u,this.highlightMethod-i.FIRST_NLP_METHOD));if(h)for(var g=l.iter(c);!g.done;g.next()){var d=g.value;o.push(d)}else this.lockupForma.visit(v.FormaTraversal.PreOrder,function(t,e,n){var i;if(i=l.as(t,ot.TextForma))for(var r=i.rangeInLockup,a=l.iter(c);!a.done;a.next()){var s=a.value;s.start>=r.start&&s.end<=r.end&&o.push(r)}return!1});e&&this.highlightMethod==a.HighlightMethod.Numbers&&0==!o.length&&0!=o[0].start&&o.splice(0)}else if(this.highlightMethod==a.HighlightMethod.EvenWords||this.highlightMethod==a.HighlightMethod.OddWords){for(var p=l.iter(l.toSequence(r));!p.done;p.next()){var f=p.value,m=f.offset,y=f.element;(this.highlightMethod==a.HighlightMethod.EvenWords&&m%2==0||this.highlightMethod==a.HighlightMethod.OddWords&&m%2!=0)&&o.push(y)}if((this.highlightMethod==a.HighlightMethod.EvenWords||this.highlightMethod==a.HighlightMethod.OddWords)&&h){o.splice(0);for(var k=l.iter(l.range(0,l.chars(t).length,!1));!k.done;k.next()){var S=k.value;(this.highlightMethod==a.HighlightMethod.EvenWords&&S%2==0||this.highlightMethod==a.HighlightMethod.OddWords&&S%2!=0)&&o.push(new ut.TextRange(S,S+1))}}}else if(this.highlightMethod!=a.HighlightMethod.Bracket&&this.highlightMethod!=a.HighlightMethod.InsideBracket||!(r.length<3)||!it.TypeLockupUtils.isCurlyQuote(s[0])&&"("!=s[0]||!it.TypeLockupUtils.isCurlyQuote(s[s.length-1])&&")"!=s[s.length-1]){var L=0;this.lockupForma.visit(v.FormaTraversal.PreOrder,function(t,e,i){var r;if(r=l.as(t,ot.TextForma)){var s=r.rangeInLockup;(n.highlightMethod==a.HighlightMethod.EvenRows&&r.rowIndex%2==0||n.highlightMethod==a.HighlightMethod.OddRows&&r.rowIndex%2!=0)&&o.push(s),L=Math.max(L,r.rowIndex)}return!1}),this.highlightMethod!=a.HighlightMethod.EvenRows&&this.highlightMethod!=a.HighlightMethod.OddRows||0!=L||o.splice(0),(this.highlightMethod==a.HighlightMethod.First||this.highlightMethod==a.HighlightMethod.Last)&&0!=L||(this.highlightMethod==a.HighlightMethod.Bracket||this.highlightMethod==a.HighlightMethod.InsideBracket)&&L>1?(o.splice(0),this.lockupForma.visit(v.FormaTraversal.PreOrder,function(t,e,i){var r;if(r=l.as(t,ot.TextForma)){var s=r.rangeInLockup;(n.highlightMethod!=a.HighlightMethod.First&&n.highlightMethod!=a.HighlightMethod.Bracket||0!=r.rowIndex)&&(n.highlightMethod!=a.HighlightMethod.Last&&n.highlightMethod!=a.HighlightMethod.Bracket||r.rowIndex!=L)?n.highlightMethod==a.HighlightMethod.InsideBracket&&0!=r.rowIndex&&r.rowIndex!=L&&o.push(s):o.push(s)}return!1})):this.highlightMethod==a.HighlightMethod.First||this.highlightMethod==a.HighlightMethod.Last||this.highlightMethod==a.HighlightMethod.Bracket?(this.highlightMethod!=a.HighlightMethod.First&&this.highlightMethod!=a.HighlightMethod.Bracket||o.push(r[0]),this.highlightMethod!=a.HighlightMethod.Last&&this.highlightMethod!=a.HighlightMethod.Bracket||o.push(r[r.length-1])):this.highlightMethod==a.HighlightMethod.InsideBracket&&r.length>1&&o.push(new ut.TextRange(r[0].end,r[r.length-1].start))}else o.splice(0),this.highlightMethod==a.HighlightMethod.Bracket?(o.push(new ut.TextRange(0,1)),o.push(new ut.TextRange(l.chars(t).length-1,l.chars(t).length))):this.highlightMethod==a.HighlightMethod.InsideBracket&&o.push(new ut.TextRange(1,l.chars(t).length-1));return l.sortInPlace(o,function(t,e){return t.start<e.start}),o=l.clone(it.TypeLockupUtils.cleanupAndMerge(l.clone(o)))},rangesEqual:function(t,e){if(t.length==e.length){for(var n=l.iter(l.range(0,t.length,!1));!n.done;n.next()){var o=n.value;if(t[o].start!=e[o].start||t[o].end!=e[o].end)return!1}return!0}return!1},updateMethodToMatchCharStyleRange:function(t){var e=l.clone(this.charStyleRanges);if(0==!e.length&&this.highlightMethod==a.HighlightMethod.Manual){g.CoreAssert.isTrue(!l.isEmpty(t)),this.incrementHighlightMethod();for(var n=l.clone(this.getNextRanges(t,!1)),o=0;!this.rangesEqual(l.clone(n),l.clone(e));)if(this.incrementHighlightMethod(),n=l.clone(this.getNextRanges(t,!1)),(o+=1)>i.NUM_HIGHLIGHTMETHODS){this.highlightMethod=a.HighlightMethod.Manual;break}}},autoApplyCharStyle:function(t,e,n){var o;if(void 0===n&&(n=!1),!n){if(0==this.charStyleRanges.length&&t&&!e)return;if(0==!this.charStyleRanges.length&&!t&&!e)return}var r=l.clone(this.charStyleRanges);e&&this.incrementHighlightMethod(),0==r.length&&this.highlightMethod==a.HighlightMethod.Manual&&O.LockupStyle.isLetterGrid((o=l.opt(this.lockupStyle,function(t){return t.layout}))||null!=o?o:O.LockupLayout.Standard)&&(this.highlightMethod=a.HighlightMethod.OddWords);var s=l.clone(this.getNextRanges(this.text,0==r.length));if(0!=!s.length||e||!this.rangesEqual(l.clone(s),l.clone(r))){var h=new M.FormaAnimationTransactionEvent(this.forma);if(h.duration=0,this.forma.beginUpdate(h),this.lockupForma.style.notifyBefore(),this.charStyleRanges.splice(0),!n)for(var u=0;0==s.length||e&&this.rangesEqual(l.clone(s),l.clone(r))||0==s[0].start&&s[0].end==this.text.length;)if(this.incrementHighlightMethod(),s=l.clone(this.getNextRanges(this.text,!1)),(u+=1)>i.NUM_HIGHLIGHTMETHODS){s.splice(0),this.highlightMethod=a.HighlightMethod.Manual;break}this.charStyleRanges=l.clone(s),this.lockupForma.style.notifyAfter(),this.forma.endUpdate(h)}},applyCharStyle:function(t,e,n,o){var r=new ut.TextRange(0,0);if(t.lockupForma!=this.lockupForma)return this.selectCharStyleForma(),r;var s=!1;this.highlightMethod=a.HighlightMethod.Manual;var h=new M.FormaAnimationTransactionEvent(this.forma);h.duration=0,this.forma.beginUpdate(h),this.lockupForma.style.notifyBefore();var u=r=t.rangeInLockup;n==a.CharStyleApplyMode.Apply&&0!=o.length&&(r=it.TypeLockupUtils.getNewCharSelectionRange(o,r,l.clone(this.initialCharStyleRanges_)));for(var c=-1,g=l.iter(l.toSequence(this.charStyleRanges));!g.done;g.next()){var d=g.value,p=d.offset,f=d.element;r.start>=f.start&&r.start<f.end&&(c=p)}if(c>-1){var m=this.charStyleRanges[c];n==a.CharStyleApplyMode.SwipeApply?this.charStyleRanges[c]=new ut.TextRange(Math.min(r.start,m.start),Math.max(r.end,m.end)):n!=a.CharStyleApplyMode.Apply?m.length!=r.length?(r.end>=m.end?this.charStyleRanges.splice(c,1):this.charStyleRanges[c]=new ut.TextRange(r.end,m.end),m.start<r.start&&this.charStyleRanges.splice(c,0,new ut.TextRange(m.start,r.start))):this.charStyleRanges.splice(c,1):n!=a.CharStyleApplyMode.Remove&&(s=!0,this.charStyleRanges[c]=r)}else n!=a.CharStyleApplyMode.Remove&&(s=!0,this.charStyleRanges.push(r),l.sortInPlace(this.charStyleRanges,function(t,e){return t.start<e.start}),0==l.count(this.lockupStyle.characterStyles)&&this.getCharacterStyle(i.HIGHLIGHT_STYLE));this.charStyleRanges=l.clone(it.TypeLockupUtils.cleanupAndMerge(l.clone(this.charStyleRanges))),this.lockupForma.style.notifyAfter(),this.selectCharStyleForma(),this.forma.endUpdate(h);var y=new ut.TextRange(0,0);if(s)for(var k=l.iter(this.charStyleRanges);!k.done;k.next())f=k.value,u.start>=f.start&&u.end<=f.end&&(y=f);return y},getCharacterStyle:function(t){var e=this.lockupStyle.characterStyles[t];if(null==e){var n=O.LockupStyle.createDefault();n.colorLibrary=this.lockupStyle.colorLibrary,n.setEmptyStyle(),O.LockupStyle.isKnockoutLook(this.lockupStyle.textLook)?n.textLook=O.LockupTextLook.Fill:this.lockupStyle.backing==O.LockupBacking.Rows&&this.lockupStyle.padding<.4&&this.lockupStyle.spacing>0&&(n.backing=O.LockupBacking.Rows,n.colors.setColorId(y.ColorRole.FieldPrimary,this.lockupStyle.colors.colorID(y.ColorRole.FieldSecondary)),n.colors.setColorId(y.ColorRole.FieldSecondary,this.lockupStyle.colors.colorID(y.ColorRole.FieldPrimary))),this.lockupStyle.characterStyles[t]=n,this.styleController.pickVisibleColorsForCharStyle(),e=n}return e},getCharacterStyleRanges:function(){return this.charStyleRanges},clearCharStyle:function(){this.highlightMethod=a.HighlightMethod.Manual,0!=this.charStyleRanges.length&&(this.lockupForma.style.notifyBefore(),this.charStyleRanges.splice(0),this.lockupForma.style.notifyAfter())},selectCharStyleForma:function(){var t=this;this.owner.selection.clearSelectionNoUpdate(),this.owner.selection.selectForma(this.lockupForma,!1),this.lockupForma.visit(v.FormaTraversal.PreOrder,function(e,n,o){var i;if(i=l.as(e,ot.TextForma))for(var r=i.rangeInLockup,a=l.iter(t.charStyleRanges);!a.done;a.next()){var s=a.value;if(r.start>=s.start&&r.start<s.end){if(O.LockupStyle.isShadowLook(t.styleController.targetedLockupStyle.textLook)){var h=l.opt(l.as(i.textModel.attributeAtIndex($.FontColorAttribute.NAME,0).attr,$.FontColorAttribute),function(t){return t.value});if(l.opt(h,function(e){return e.isEqual(t.styleController.targetedLockupStyle.colors.fieldSecondary)}))continue}t.owner.selection.selectForma(i,!1)}}return!1}),this.owner.selection.publish(new j.SelectionStateChangedMessage(this.owner.selection))},beginTouches:function(){this.initialCharStyleRanges_=l.clone(this.charStyleRanges)},clearInitialCharStyleRanges:function(){this.initialCharStyleRanges_=[]},updateTouches:function(t,e,n,o){void 0===o&&(o=null);var r=l.opt(this.lockupForma,function(e){return e.page.formaAtPoint(t,void 0,[ot.TextForma.KIND])});null!=r&&r instanceof ot.TextForma&&r.lockupForma!=this.lockupForma&&(r=null);var s,h=n?100:-100;if(null==r||!(r instanceof ot.TextForma)){var u=new st.TheoPoint(t.x+h,t.y);r=l.opt(this.lockupForma,function(t){return t.page.formaAtPoint(u,void 0,[ot.TextForma.KIND])})}if(s=l.as(r,ot.TextForma)){if(null!=o&&0!=l.count(this.lockupStyle.characterStyles)&&l.opt(this.lockupStyle.characterStyles[i.HIGHLIGHT_STYLE],function(t){return null!=t.font})){var c,g=l.opt(this.lockupForma,function(t){return t.page.formaAtPoint(o,void 0,[ot.TextForma.KIND])});if(null==g||!(g instanceof ot.TextForma)){var d=new st.TheoPoint(o.x+h,o.y);g=l.opt(this.lockupForma,function(t){return t.page.formaAtPoint(d,void 0,[ot.TextForma.KIND])})}if((c=l.as(g,ot.TextForma))&&c.rowIndex==s.rowIndex)for(var p=l.opt(l.opt(this.lockupForma,function(t){return t.totalPlacement.inverse}),function(e){return e.transformPoint(t)})||t,f=l.opt(l.opt(this.lockupForma,function(t){return t.totalPlacement.inverse}),function(t){return t.transformPoint(o)})||o,m=p.x>=f.x,y=p.x<=f.x,k=l.iter(this.charStyleRanges);!k.done;k.next()){var S=k.value;if(n){if(y&&s.rangeInLockup.start>=S.start&&s.rangeInLockup.start<S.end){if(s.rangeInLockup.end<S.end)return;break}if(m&&s.rangeInLockup.end==S.start)return}else{if(m&&s.rangeInLockup.start>=S.start&&s.rangeInLockup.start<S.end){if(s.rangeInLockup.end<S.end)return;break}if(y&&s.rangeInLockup.start==S.end)return}}}this.applyCharStyle(s,i.HIGHLIGHT_STYLE,a.CharStyleApplyMode.Apply,e.rangeInLockup)}},enterCharStyleModeWithTextForma:function(t,e){if(this.owner.allowSelectionChanges){var n=0==this.charStyleRanges.length;if(0==t.rangeInLockup.length){this.lockupForma.style.notifyBefore(),this.getCharacterStyle(i.HIGHLIGHT_STYLE),this.lockupForma.style.notifyAfter();var o=l.opt(this.lockupForma,function(t){return t.page.formaAtPoint(e,void 0,[ot.TextForma.KIND])});null!=o&&o instanceof ot.TextForma&&(this.styleController.targetedLockupStyleName=i.HIGHLIGHT_STYLE,this.styleController.pickVisibleColorsForCharStyle(),this.selectCharStyleForma(),this.applyCharStyle(o,i.HIGHLIGHT_STYLE,a.CharStyleApplyMode.SwipeApply,new ut.TextRange(0,0)))}else this.styleController.targetedLockupStyleName=i.HIGHLIGHT_STYLE,0==this.charStyleRanges.length&&this.styleController.pickVisibleColorsForCharStyle(),this.selectCharStyleForma(),this.applyCharStyle(t,i.HIGHLIGHT_STYLE,a.CharStyleApplyMode.SwipeApply,new ut.TextRange(0,0));n&&1==this.charStyleRanges.length&&0==this.charStyleRanges[0].start&&this.charStyleRanges[0].end==this.text.length&&(this.charStyleRanges.splice(0),this.autoApplyCharStyle(!1,!1,!1),this.selectCharStyleForma())}},textChanged:function(t,e){for(var n=0,o=!1,i=l.iter(l.toSequence(this.charStyleRanges));!i.done;i.next()){var r=i.value,a=r.offset,s=r.element;t.start>=s.start&&t.start<s.end?(n=e-t.length,o=!0,s.end+n<s.start?this.charStyleRanges[a]=new ut.TextRange(s.start,s.start):this.charStyleRanges[a]=new ut.TextRange(s.start,s.end+n)):t.start<s.start&&t.end>s.start?(t.end<s.end?this.charStyleRanges[a]=new ut.TextRange(t.start+e,s.end-t.end+t.start+e):this.charStyleRanges[a]=new ut.TextRange(s.start,s.start),o||(n=e-t.length,o=!0)):0!=n&&(this.charStyleRanges[a]=new ut.TextRange(s.start+n,s.end+n)),!o&&t.end<=s.start&&(n=e-t.length,o=!0,this.charStyleRanges[a]=new ut.TextRange(s.start+n,s.end+n))}o&&(this.charStyleRanges=l.clone(it.TypeLockupUtils.cleanupAndMerge(l.clone(this.charStyleRanges))))},applyPredefinedCharStyle:function(t){var e=this.highlightMethod==t;if(this.highlightMethod=t,t==a.HighlightMethod.SmallWords){this.styleController.applyBacking(O.LockupBacking.None,null),e||(this.lockupStyle.characterStyles={});var n=this.getCharacterStyle(i.HIGHLIGHT_STYLE);n.spacing=.5,n.colors.setColorId(y.ColorRole.FieldPrimary,this.lockupStyle.colors.colorID(y.ColorRole.FieldPrimary)),n.colors.setColorId(y.ColorRole.FieldSecondary,this.lockupStyle.colors.colorID(y.ColorRole.FieldSecondary)),e?n.layout==O.LockupLayout.Standard&&n.alignment==O.LockupAlignment.Center&&0==n.lineBreakAtCharacterStyleSizeChange?(n.alignment=O.LockupAlignment.Right,n.lineBreakAtCharacterStyleSizeChange=!1):n.layout==O.LockupLayout.Standard&&n.alignment==O.LockupAlignment.Right?(n.alignment=O.LockupAlignment.Center,n.lineBreakAtCharacterStyleSizeChange=!0):n.layout==O.LockupLayout.UNSET&&0==n.lineBreakAtCharacterStyleSizeChange?(n.alignment=O.LockupAlignment.Center,n.layout=O.LockupLayout.Standard,n.lineBreakAtCharacterStyleSizeChange=!1):(n.alignment=O.LockupAlignment.UNSET,n.layout=O.LockupLayout.UNSET,n.lineBreakAtCharacterStyleSizeChange=!1):n.lineBreakAtCharacterStyleSizeChange=!1,this.autoApplyCharStyle(!0,!1,!0)}else this.highlightMethod==a.HighlightMethod.Manual?this.clearCharStyle():t==a.HighlightMethod.Nouns?(this.styleController.applyBacking(O.LockupBacking.Rows,null),this.lockupStyle.characterStyles={},this.getCharacterStyle(i.HIGHLIGHT_STYLE),this.autoApplyCharStyle(!0,!1,!0)):(e&&(this.highlightMethod==a.HighlightMethod.EvenRows?this.highlightMethod=a.HighlightMethod.OddRows:this.highlightMethod==a.HighlightMethod.OddRows?this.highlightMethod=a.HighlightMethod.Bracket:this.highlightMethod==a.HighlightMethod.Bracket?this.highlightMethod=a.HighlightMethod.InsideBracket:this.highlightMethod==a.HighlightMethod.InsideBracket&&(this.highlightMethod=a.HighlightMethod.EvenRows)),this.lockupStyle.characterStyles={},this.getCharacterStyle(i.HIGHLIGHT_STYLE));this.forma.controller.styleChanged()},snapToClosestExistingSize:function(t){var e=this;if(!l.opt(this.lockupStyle,function(t){return t.layout==O.LockupLayout.FitJustified&&1!=e.numLines()})){var n=l.clone(it.TypeLockupUtils.sizesInDocument(this.forma.page.document)),o=this.getCurrentFontSize();if(0!=o){for(var i=t,r=l.iter(n);!r.done;r.next()){var a=r.value;(o!=a||t==o)&&Math.abs(o-a)<Math.abs(o-i)&&(i=a)}var s=i/o;if(!(0==i||s>1.2||s<(t==i?.2:.8))){var h=new ct.TheoSize(this.forma.bounds.width*s,this.forma.bounds.height*s),u=new C.FormaResizeEvent(this.forma,h,st.TheoPoint.ZERO);this.onEvent(u)}}}},getCurrentFontSize:function(){var t,e=0;return(t=this.lockupForma)&&(t.visit(v.FormaTraversal.PreOrder,function(t,n,o){var i;return!!(i=l.as(t,ot.TextForma))&&(e=l.opt(l.as(i.textModel.attributeAtIndex($.FontSizeAttribute.NAME,0).attr,$.FontSizeAttribute),function(t){return t.value}),!0)}),e*=this.lockupForma.placement.extractedScale.scale.x),e},getAverageFontSize:function(){var t,e=this;if(t=this.lockupForma){var n=[];if(t.visit(v.FormaTraversal.PreOrder,function(t,o,i){var r;if(r=l.as(t,ot.TextForma)){var a=l.opt(l.as(r.textModel.attributeAtIndex($.FontSizeAttribute.NAME,0).attr,$.FontSizeAttribute),function(t){return t.value});if(n.push(a*e.lockupForma.placement.extractedScale.scale.x),l.opt(e.lockupStyle,function(t){return t.layout!=O.LockupLayout.FitJustified}))return!0}return!1}),n.length>0)return n.reduce(function(t,e){return t+e},0)/l.toDouble(n.length)}return 0},getFontSizeSnapValues:function(){var t=[];if(this.styleController.targetedLockupStyle!==this.lockupStyle)return t.push(100),t;var e=l.clone(it.TypeLockupUtils.sizesInDocument(this.forma.page.document,this.forma));l.sortInPlace(e);var n=this.getCurrentFontSize(),o=0;if(0!=n)for(var i=l.iter(e);!i.done;i.next()){var r=i.value;Math.round(r)==o&&r!=n||(o=Math.round(r),t.push(r))}return t},matchNextSize:function(t,e){for(var n=this.getCurrentFontSize(),o=n,i=!1,r=l.iter(t);!r.done;r.next()){var a=r.value,s=a/n;if(Math.round(o)<Math.round(a)&&(s<.99||s>1.01)){o=a,i=!0;break}}t.length>0&&(0==i||o>this.getSizeSliderMaxValue())&&(o=t[0]);var h=o/n;if(h<.99||h>1.01){var u=this.forma.placement.transformValues,c=this.forma.bounds,g=new ct.TheoSize(c.width*u.xscale,c.height*u.xscale),d=new ct.TheoSize(g.width*h,g.height*h),p=new C.FormaResizeEvent(this.forma,d,e);this.onEvent(p)}return o},setSizeSliderValue:function(t,e,n){var o=t;if(this.styleController.targetedLockupStyle!==this.lockupStyle){o=t/100;for(var i=l.iter(e);!i.done;i.next())t>=(a=i.value)-5&&t<=a+5&&(o=a/100);this.styleController.targetedLockupStyle.spacing=1==o?-1:o,this.styleChanged(),this.selectCharStyleForma(),o*=100}else{for(var r=l.iter(e);!r.done;r.next()){var a;t>=(a=r.value)-5&&t<=a+5&&(o=a)}var s=o/this.getCurrentFontSize(),h=this.forma.placement.transformValues,u=this.forma.bounds,c=new ct.TheoSize(u.width*h.xscale,u.height*h.xscale),g=(t=new ct.TheoSize(c.width*s,c.height*s),this.forma.boundsInCoordSpace(this.forma.placement));if(Math.round(1e3*t.width)!=Math.round(1e3*g.width)||Math.round(1e3*t.height)!=Math.round(1e3*g.height)){var d=new C.FormaResizeEvent(this.forma,t,n);this.onEvent(d)}}return o},getSizeSliderValue:function(){return this.styleController.targetedLockupStyle!==this.lockupStyle?-1==this.styleController.targetedLockupStyle.spacing?100:100*this.styleController.targetedLockupStyle.spacing:this.getCurrentFontSize()},getSizeSliderMinValue:function(){if(this.styleController.targetedLockupStyle!==this.lockupStyle)return 20;var t=20,e=this.getCurrentFontSize();return e<20&&(t=e),t},getSizeSliderMaxValue:function(){if(this.styleController.targetedLockupStyle!==this.lockupStyle)return 400;var t=500,e=this.getCurrentFontSize();e>500&&(t=e+200);var n=t/e,o=1.2*this.forma.root.bounds.width/this.forma.bounds.width;return n>o?o*e:t}}}),i)},204:function(t,e,n){var o,i=e,r=n(0),a=n(1),l=n(8),s=n(138),h=n(71),u=n(17),c=n(9),g=n(328),d=n(40),p=n(15),f=n(10);i.SVGBackgroundDecorationStrategy=(o=function(t){if(this.artworkID_=null,this.artworkInfo_=null,this.spacingScalar=.75,this.paddingScalar=.6,this.artworkID_=t,null!=t){var e=l.Host.resourceUtils.urlForResource("shape",t);null!=e?(this.artworkInfo_=l.Host.pathUtils.artworkFromURL(e,!1),a.CoreAssert.isTrue(null!=this.artworkInfo_,"Unable to load artwork!")):r.opt(l.Host.logging,function(t){return t.warning("Invalid artwork ID provided!")})}},r.defineClass({name:"SVGBackgroundDecorationStrategy",ctor:o,superName:"BaseDecorationStrategy",statics:{_implements:function(t){return"LockupDecorationStrategy"==t}},props:{easeOutQuad:function(t,e,n,o){var i=t/o;return-n*i*(i-2)+e},easeOut:function(t,e,n){return this.easeOutQuad(n,t,e-t,1)},supportsConfiguration:function(t){return t.style.backing==u.LockupBacking.SVGBackground&&this.artworkID_==t.style.backingArtworkID&&!u.LockupStyle.isLetterGrid(t.style.layout)},decorate:function(t,e){if(null==this.artworkID_||null==this.artworkInfo_)return r.opt(l.Host.logging,function(t){return t.warning("artworkID or artworkInfo is nil ")}),new s.DecorationResults([]);var n=[],o=this.calcSVGConfiguration(t.style,r.clone(e)),i=o.frame,a=o.preScale;return n.push(r.clone(h.LockupItem.init_9cc6(!1,i.size,c.Matrix2D.translationXY(i.minX,i.minY),this.artworkID_,a))),new s.DecorationResults(r.clone(n))},calcSVGConfiguration:function(t,e,n){void 0===n&&(n=-1);var o=f.TheoRect.fromSize(e.size),i=e.typographicBoundingRatios.backingVerticalOffsetRatio*e.avgLinePointSize,r=t.font.fontData,a=s.BaseDecorationStrategy.getHorizontalOffsetForItalicAngle(e.avgLinePointSize*e.typographicBoundingRatios.heightFromBaselineRatio,r.italicAngle),l=((e.size.width+e.size.height)/4+e.avgLinePointSize)/2,h=t.padding*this.paddingScalar*l,u=t.padding;n>-1?(u=n/2,h=n*this.paddingScalar*l/2):e.numberOfLines>1&&(u+=t.spacing,h+=t.spacing*this.spacingScalar*e.avgLinePointSize),(t.padding>=0||n>-1)&&(h=Math.max(.05*l,h));var c,g=this.easeOut(0,i,Math.min(1,u)),m=o.minX-h,y=o.maxX+h+a,k=o.minY-h+g,S=o.maxY+h+g;if(o=new f.TheoRect(m,k,y,S),(c=d.ShapeLibrary.getShapeDataForArtworkId(this.artworkID_))&&c.category==d.ShapeCategory.Circle){var v=new p.TheoPoint(o.minX,o.minY),L=o.center,T=L.distanceTo(v),F=Math.sqrt(2*Math.pow(T,2))/2;m=L.x-F,y=L.x+F,k=L.y-F,S=L.y+F,o=new f.TheoRect(m,k,y,S)}return this.calcSVGFrame(o)},calcSVGFrame:function(t){var e,n,o=null!=this.artworkInfo_.sliceBox,i=null!=this.artworkInfo_.contentRegion,r=this.artworkInfo_.artwork.bounds,a=i?this.artworkInfo_.contentRegion:r,l=1,s=null;if(i)if(o){a=this.artworkInfo_.contentRegion;var h=t.width/a.width,u=t.height/a.height;s=Math.min(h,u);var d=g.NineSlicingFilter.calculateOuterBoundsForMapping(r,this.artworkInfo_.sliceBox,s,a,t);n=d.bounds,s=(e=d.prescribedPrescale)||null!=e?e:s}else h=t.width/a.width,u=t.height/a.height,l=Math.max(h,u),n=r.transform(c.Matrix2D.scalingXY(l,l));else o?n=t:(h=t.width/r.width,u=t.height/r.height,l=Math.max(h,u),n=r.transform(c.Matrix2D.scalingXY(l,l)));if(!o){var p=a.transform(c.Matrix2D.scalingXY(l,l));n=n.transform(c.Matrix2D.translation(t.center.subtract(p.center)))}return{frame:n,preScale:s}}}}),o)},450:function(t,e,n){var o,i,r=e,a=n(0),l=n(8),s=n(138),h=n(71),u=n(17),c=n(9),g=n(204),d=n(14),p=n(81),f=n(15),m=n(10),y=n(28);r.P=function(t,e){return new f.TheoPoint(t,e)},r.clockwiseRectanglePath=function(t,e,n){var o=p.TheoArbitraryPath.init_d41d(),i=e.transformPoint(t.eval(r.P(0,0)));o.moveTo(i.x,i.y);var l=new m.TheoRect(i.x,i.y,i.x,i.y);if(n)for(var s=a.iter([r.P(0,1),r.P(1,1),r.P(1,0)]);!s.done;s.next()){var h=s.value;i=e.transformPoint(t.eval(h)),o.lineTo(i.x,i.y),l=l.expandToFit(i)}else for(var u=a.iter([r.P(1,0),r.P(1,1),r.P(0,1)]);!u.done;u.next()){h=u.value;i=e.transformPoint(t.eval(h)),o.lineTo(i.x,i.y),l=l.expandToFit(i)}return o.closePath(),{path:o,bounds:l}},r.RowsDecorationStrategy=(o=function(){this.paddingScalar=.6,s.BaseDecorationStrategy.call(this)},a.defineClass({name:"RowsDecorationStrategy",ctor:o,superName:"BaseDecorationStrategy",statics:{_implements:function(t){return"LockupDecorationStrategy"==t}},props:{easeOutQuad:function(t,e,n,o){var i=t/o;return-n*i*(i-2)+e},easeOut:function(t,e,n){return this.easeOutQuad(n,t,e-t,1)},supportsConfiguration:function(t){return t.style.backing==u.LockupBacking.Rows},decorateNoKnockout:function(t,e){var n=t.style,o=[],i={},f={},k=0,S=this.paddingScalar,v=n.padding;0==n.spacing&&e.numberOfLines>1&&(S*=.5,0==n.padding&&(v=.1));var L,T,F=!1;(L=t.style.characterStyles[d.TypeLockupController.HIGHLIGHT_STYLE])&&(F=L.backing==u.LockupBacking.Rows&&n.backing==u.LockupBacking.Rows),n.backing!=u.LockupBacking.Rows&&(S=this.paddingScalar/2,(T=t.style.characterStyles[d.TypeLockupController.HIGHLIGHT_STYLE])&&T.padding>-1&&(v=T.padding));var x=e.avgLinePointSize*e.typographicBoundingRatios.heightRatio,C=x*v*S;v>=0&&(C=Math.max(.05*x,C));for(var R=e.typographicBoundingRatios.backingVerticalOffsetRatio*x,A=this.easeOut(0,R,v),M=C+e.typographicBoundingRatios.sideInsetRatio*e.avgLinePointSize,w=t.style.font.fontData,_=e.numberOfLines,I={},b=-1,H=a.iter(a.toSequence(e.items));!H.done;H.next()){var D=H.value,B=D.offset,E=D.element;if(E.type==h.LockupItemType.Text){var P=E.rowIndex,O=n.backing==u.LockupBacking.Rows,N=null;null!=E.characterStyle&&(K=t.style.characterStyles[E.characterStyle])&&(K.backing==u.LockupBacking.None&&n.backing!=u.LockupBacking.Rows?O=!1:(O=!0,K.backing==u.LockupBacking.UNSET||K.backing==u.LockupBacking.None||u.LockupStyle.isShadowLook(K.textLook)&&K.textLook!=u.LockupTextLook.KnockoutAndShadow||(N=E.characterStyle,n.backing==u.LockupBacking.Rows&&K.backing==u.LockupBacking.Rows&&(k=M))));var z=0;if(B>0&&(z=E.placement.tx-(e.items[B-1].placement.tx+e.items[B-1].size.width)),O&&I[P]==N||(null!=i[P]&&(i[_]=i[P],f[_]=f[P],I[_]=I[P],0!=k&&k>z/2&&(i[_]=new m.TheoRect(i[_].minX,i[_].minY,i[_].maxX-k+z/2,i[_].maxY)),_+=1,a.removeKey(i,P),a.removeKey(I,P),b=P),O)){I[P]=N;var G=E.pointSize*e.typographicBoundingRatios.heightRatio,U=F&&null==i[P]?M:0;0!=k&&b==P&&k>z/2&&(U=z/2);var Y=F?M:0,X=m.TheoRect.fromXYWH(E.placement.tx-U,E.placement.ty,E.size.width+(U+Y),G);null==(q=i[P])?(q=X,f[P]=E.typographicBoundingRatios):q=q.unionWith(X),i[P]=q}}}if(0==a.count(i))return new s.DecorationResults(a.clone(o));for(var W=s.BaseDecorationStrategy.getHorizontalOffsetForItalicAngle(e.avgLinePointSize*e.typographicBoundingRatios.heightFromBaselineRatio,w.italicAngle),V=a.iter(i,!0);!V.done;V.next()){var K,Q=V.key,q=V.value,j=f[Q],J=q.size.height/e.typographicBoundingRatios.heightRatio,Z=(e.typographicBoundingRatios.textVerticalOffsetRatio-w.capRatio)*J,$=e.typographicBoundingRatios.textVerticalOffsetRatio,tt=e.typographicBoundingRatios.heightRatio,et=j.textVerticalOffsetRatio,nt=($-(tt/2-j.heightRatio/2)-et)*J,ot=F?0:M,it=q.size.width+2*ot+W,rt=(G=q.size.height+2*C,q.minX-ot),at=q.minY+nt-Z-C+A,lt=new y.TheoSize(it,G),st=c.Matrix2D.translationXY(rt,at),ht=!1;if(null!=I[Q]&&(K=t.style.characterStyles[I[Q]])&&K.backing==u.LockupBacking.SVGBackground){if(null==K.backingArtworkID||null==K.backingArtworkID)return a.opt(l.Host.logging,function(t){return t.warning("artworkID or artworkInfo is nil ")}),new s.DecorationResults([]);var ut=new g.SVGBackgroundDecorationStrategy(K.backingArtworkID),ct=a.clone(h.LayoutResults.init_8322(a.clone(e.items),q.size,e.placement,e.typographicBoundingRatios,e.avgRowAspect)),gt=ut.calcSVGConfiguration(t.style,a.clone(ct),K.padding),dt=gt.frame,pt=gt.preScale;o.push(a.clone(h.LockupItem.init_9cc6(!1,dt.size,c.Matrix2D.translationXY(dt.minX+q.minX,dt.minY+q.minY+nt-Z),K.backingArtworkID,pt,Q+e.numberOfLines,I[Q]))),ht=!0}if(!ht||n.backing==u.LockupBacking.Rows){var ft=p.TheoArbitraryPath.init_d41d(),mt=r.clockwiseRectanglePath(m.TheoRect.fromSize(lt),c.Matrix2D.Identity,!0).path;ft.addPath(mt,c.Matrix2D.Identity),o.push(a.clone(h.LockupItem.init_708e(!1,lt,st,ft,Q,void 0,ht&&n.backing==u.LockupBacking.Rows?null:I[Q])))}}return o=a.sort(o,function(t,e){return t.characterStyle!=e.characterStyle?null==t.characterStyle:t.rowIndex<e.rowIndex}),new s.DecorationResults(a.clone(o))},decorate:function(t,e){var n,o=t.style,i=!1;if((n=t.style.characterStyles[d.TypeLockupController.HIGHLIGHT_STYLE])&&(i=n.backing!=u.LockupBacking.Rows&&u.LockupStyle.isKnockoutLook(n.textLook)),!l.Host.textModelUtils.useOutlinesForKnockouts()||o.backing!=u.LockupBacking.Rows||!u.LockupStyle.isKnockoutLook(o.textLook)&&!i)return this.decorateNoKnockout(t,a.clone(e));var r=[],g={},f=[],k={},S=p.TheoArbitraryPath.init_d41d(),v=p.TheoArbitraryPath.init_d41d(),L=this.paddingScalar,T=o.padding;0==o.spacing&&e.numberOfLines>1&&(L*=.5,0==o.padding&&(T=.1));var F=e.avgLinePointSize*e.typographicBoundingRatios.heightRatio,x=F*T*L;T>=0&&(x=Math.max(.05*F,x));for(var C=t.style.font.fontData,R=s.BaseDecorationStrategy.getHorizontalOffsetForItalicAngle(e.avgLinePointSize*e.typographicBoundingRatios.heightFromBaselineRatio,C.italicAngle),A=e.typographicBoundingRatios.backingVerticalOffsetRatio*F,M=this.easeOut(0,A,T),w=x+e.typographicBoundingRatios.sideInsetRatio*e.avgLinePointSize,_=e.typographicBoundingRatios.textVerticalOffsetRatio,I=e.typographicBoundingRatios.heightRatio,b=c.Matrix2D.translationXY(-w,-x),H=!1,D=e.numberOfLines,B=a.iter(a.range(0,e.items.length,!1));!B.done;B.next()){var E=B.value,P=a.clone(e.items[E]);if(P.type==h.LockupItemType.Text){var O=P.rowIndex,N=o.backing==u.LockupBacking.Rows;if(null!=P.characterStyle&&null!=t.style.characterStyles[P.characterStyle]&&(N=!0),N){var z=P.pointSize*e.typographicBoundingRatios.heightRatio,G=m.TheoRect.fromXYWH(P.placement.tx,P.placement.ty,P.size.width,z),U=g[O];null==U?(U=G,k[O]=P.typographicBoundingRatios):U=U.unionWith(G),g[O]=U;var Y=k[O],X=U.size.height/e.typographicBoundingRatios.heightRatio,W=(e.typographicBoundingRatios.textVerticalOffsetRatio-P.font.capRatio)*X,V=Y.textVerticalOffsetRatio,K=(_-(I/2-Y.heightRatio/2)-V)*X;if(H||(b=c.Matrix2D.translationXY(-w,U.minY+K-W-x+M),H=!0),E==e.items.length-1||O!=e.items[E+1].rowIndex){var Q=!0,q=U.size.width+2*w+R,j=U.size.height+2*x,J=U.minX,Z=U.minY+K-W+M,$=a.last(f),tt=m.TheoRect.fromXYWH(J,Z,q,j);f.push(tt),null!=$&&$.maxY<tt.minY?(v.lineTo($.maxX,$.maxY),v.lineTo($.minX,$.maxY),v.closePath(),v.moveTo(tt.minX,tt.minY),Q=!1):null==$?v.moveTo(tt.minX,tt.minY):$.maxX>tt.maxX?v.lineTo($.maxX,$.maxY):v.lineTo($.maxX,tt.minY),Q&&null!=$&&$.maxX>tt.maxX?v.lineTo(tt.maxX,$.maxY):v.lineTo(tt.maxX,tt.minY)}}else null!=g[O]&&(g[D]=g[O],k[D]=k[O],D+=1,a.removeKey(g,O))}}if(0==f.length)return new s.DecorationResults(a.clone(r));v.lineTo(f[f.length-1].maxX,f[f.length-1].maxY);for(var et=a.iter(a.stride(f.length-1,0,-1));!et.done;et.next()){var nt=et.value;f[nt-1].maxY>=f[nt].minY?(v.lineTo(f[nt].minX,f[nt].maxY),f[nt].minX<f[nt-1].minX?(v.lineTo(f[nt].minX,f[nt].minY),v.lineTo(f[nt-1].minX,f[nt].minY)):(v.lineTo(f[nt].minX,f[nt-1].maxY),v.lineTo(f[nt-1].minX,f[nt-1].maxY))):nt==f.length-1&&v.lineTo(f[nt].minX,f[nt].maxY)}1==f.length&&v.lineTo(f[0].minX,f[0].maxY),v.closePath();var ot=c.Matrix2D.translationXY(0,-f[0].minY),it=l.Host.textModelUtils.rewindPath(v.simplestForm)||v.simplestForm;S.addPath(it,ot);var rt=new y.TheoSize(a.opt(S.bounds,function(t){return t.width}),a.opt(S.bounds,function(t){return t.height}));return r.push(a.clone(h.LockupItem.init_708e(!1,rt,b,S,null))),new s.DecorationResults(a.clone(r))}}}),o),r.KnockoutDecorationStrategy=(i=function(){s.BaseDecorationStrategy.call(this)},a.defineClass({name:"KnockoutDecorationStrategy",ctor:i,superName:"BaseDecorationStrategy",statics:{_implements:function(t){return"LockupDecorationStrategy"==t}},props:{supportsConfiguration:function(t){return t.style.backing==u.LockupBacking.Knockout},decorate:function(t,e){var n,o,i=(n=a.opt(t.parentBounds,function(t){return t.width}))||null!=n?n:5e3;null!=t.parentBounds&&a.opt(t.parentBounds,function(t){return t.height})>i&&(i=(o=a.opt(t.parentBounds,function(t){return t.height}))||null!=o?o:5e3);var l=p.TheoArbitraryPath.init_d41d(),u=e.placement,g=c.Matrix2D.translationXY(-i,-i),d=[],f=new y.TheoSize(e.size.width+2*i,e.size.height+2*i),k=m.TheoRect.fromSize(f),S=r.clockwiseRectanglePath(k,c.Matrix2D.Identity,!0).path;return l.addPath(S,u),d.push(a.clone(h.LockupItem.init_708e(!1,k.size,g,l,null,!0))),new s.DecorationResults(a.clone(d))}}}),i)},451:function(t,e,n){var o,i=e,r=n(0),a=n(138),l=n(71),s=n(17),h=n(9);i.ShadowDecorationStrategy=(o=function(){a.BaseDecorationStrategy.call(this)},r.defineClass({name:"ShadowDecorationStrategy",ctor:o,superName:"BaseDecorationStrategy",statics:{_implements:function(t){return"LockupDecorationStrategy"==t}},props:{rotatePoint:function(t,e,n){var o=n*Math.PI/180;return{x:Math.cos(o)*(t.x-e.x)-Math.sin(o)*(t.y-e.y)+e.x,y:Math.sin(o)*(t.x-e.x)+Math.cos(o)*(t.y-e.y)+e.y}},supportsConfiguration:function(t){return!1},decorate:function(t,e){for(var n=[],o=e.avgTextPointSize,i=t.style.shadowAngle,u=o/16*t.style.shadowOffset+.02*o,c=this.rotatePoint({x:0,y:-u},{x:0,y:0},i),g=r.iter(r.range(0,e.items.length,!1));!g.done;g.next()){var d=g.value,p=r.clone(e.items[d]);if(p.type==l.LockupItemType.Text){var f,m,y=t.style.textLook;if(null!=(f=p.characterStyle)&&(m=t.style.characterStyles[f])&&(y=m.textLook==s.LockupTextLook.UNSET?y:m.textLook),s.LockupStyle.isShadowLook(y)){u=y==s.LockupTextLook.KnockoutAndShadow?.08*p.pointSize*(1.7*t.style.shadowOffset+.25)/2:y==s.LockupTextLook.ShadowAndOutline?o/8*t.style.shadowOffset+.02*o:o/16*t.style.shadowOffset+.02*o,c=this.rotatePoint({x:0,y:-u},{x:0,y:0},i);var k=p.placement;p.hasPrimaryColor=!1,p.placement=new h.Matrix2D(k.a,k.b,k.c,k.d,k.tx+c.x,k.ty+c.y),n.push(r.clone(p))}}}return new a.DecorationResults(r.clone(n))}}}),o)},72:function(t,e,n){var o,i=e,r=n(0),a=n(39),l=n(202),s=n(134),h=n(1),u=n(4),c=n(11),g=n(86),d=n(163),p=n(8),f=n(17),m=n(326),y=n(9),k=n(327),S=n(120),v=n(164),L=n(58),T=n(244),F=n(14),x=n(15),C=n(10),R=n(95);i.TypeLockupUtils=(o=function(){u.CoreObject.call(this)},r.defineClass({name:"TypeLockupUtils",ctor:o,superName:"CoreObject",statics:{replaceFontsInDocument:function(t,e){var n=p.Host.textModelUtils.defaultFont(),i=o.createTheoFont(n,null);t.firstPage.root.visitAll(c.FormaTraversal.PreOrder,function(t){if(t.style instanceof f.LockupStyle){var n,o=!1,a=t.style,l=r.opt(a.font,function(t){return t.fontData.postScriptName});null!=l&&e.includes(l)&&(a.font=i,o=!0);for(var s=r.iter(a.characterStyles);!s.done;s.next()){var h=s.value;if(null!=h.font){var u=r.opt(h.font,function(t){return t.fontData.postScriptName});null!=u&&e.includes(u)&&(h.font=i,o=!0)}}o&&(n=r.as(t.controller,F.TypeLockupController))&&n.styleChanged()}})},fontsInDocument:function(t){var e=new k.OrderedFontSet;return t.firstPage.root.visitAll(c.FormaTraversal.PreOrder,function(t){var n;if(n=r.as(t,L.TextForma)){var o=n.textModel;o.forEachAttributeValueInRange(S.FontDescriptorAttribute.NAME,o.rangeAll,function(t,n){var o;(o=r.as(n,S.FontDescriptorAttribute))&&e.append(o.value)})}}),e},sizesInDocument:function(t,e){void 0===e&&(e=null);var n=[];return t.firstPage.root.visitAll(c.FormaTraversal.PreOrder,function(t){var o;if((o=r.as(t,L.TextForma))&&o.lockupForma!=e){var i=o.textModel;i.forEachAttributeValueInRange(S.FontSizeAttribute.NAME,i.rangeAll,function(t,e){var i=e;if(!n.includes(i.value)){var r=i.value*o.lockupForma.placement.extractedScale.scale.x;n.push(r)}})}}),r.sortInPlace(n),n},applyFontToController:function(t,e){var n=this,o=t.fontData;if(o.availability==g.FontAvailability.LOADED){var i;if(null!=(i=r.opt(e.styleController.forma,function(t){return t.source}))&&d.FormaSourceUtils.isDesignIngredient(i)){var h=l.BadgeFacade.getDesignIngredientIDAndType(i),u=h.id,c=h.type;r.opt(p.Host.logging,function(e){return e.logToAnalytics(a.AnalyticsConstants.kDesignIngredientFontChanged,{contextualData1:"designIngredientId:"+u,contextualData2:"designIngredientType:"+c,contextualData10:"fontName:"+t.fontData.postScriptName})})}e.styleController.targetedLockupStyle.font=t,null!=t.sparkElementID?v.TheoBrandkitUtils.brandDocumentForElement(e.forma.page.document,t.sparkElementID,s.AUTHORING_CONTEXT_TYPE_FONT):v.TheoBrandkitUtils.unBrandDocumentIfNoBrandedElements(e.forma.page.document),e.styleController.targetedLockupStyle!==e.styleController.forma.style&&(t.isEqual(e.styleController.forma.style.font)&&(e.styleController.targetedLockupStyle.font=null),e.styleChanged())}else o.availability==g.FontAvailability.LOADABLE&&p.Host.fontProvider.loadFont(o,function(){return n.applyFontToController(t,e)},function(){return p.Host.logging.info("Failed to load font")})},createTheoFont:function(t,e){if(null!=e)for(var n=r.iter(e.fonts);!n.done;n.next()){var o=n.value;if(null!=o.descriptor&&o.descriptor.isEqual(t))return T.TheoFont.init_557b(o)}return T.TheoFont.init_9e5c(t)},calculateFontRole:function(t,e){var n,i,a=null;if(null!=t){var l=o.createTheoFont(t,e);a=l.getSparkFontRole(),r.isEmpty((n=a)||null!=n?n:"")&&l.hasSparkFontRole("custom")&&(a="custom")}return r.isEmpty((i=a)||null!=i?i:"")?"":a},calculateFaceWithHighestRole:function(t,e){for(var n=["headline-font","body-font","body-font-italic","body-font-bold","body-font-bold-italic","secondary-font","custom"],i=null,a="",l=r.iter(t);!l.done;l.next()){var s=l.value,h=o.calculateFontRole(s,e);if(0==r.isEmpty(h)){var u=r.indexOf(n,h);null!=u&&(r.isEmpty(a)||u<r.indexOf(n,a))&&(a=h,i=s)}}return i},isLTRCharacter:function(t){return t>="A"&&t<="Z"||t>="a"&&t<="z"||t>="À"&&t<="Ö"||t>="Ø"&&t<="ö"||t>="ø"&&t<="ʻ"||t>="̀"&&t<="֐"||t>="ࠀ"&&t<="῿"||t>="Ⰰ"&&t<="﬜"||t>="﷾"&&t<="﹯"||t>="﻽"&&t<="￿"},isRTLCharacter:function(t){return t>="֑"&&t<="߿"||t>="יִ"&&t<="﷽"||t>="ﹰ"&&t<="ﻼ"},isTextRightToLeft:function(t){for(var e=0,n=0,i=r.iter(r.chars(t));!i.done;i.next()){var a=i.value;o.isLTRCharacter(a)?e+=1:o.isRTLCharacter(a)&&(n+=1)}return n>0&&n>e},canBreakAnywhere:function(t){return t>="ぁ"&&t<="ヿ"||t>="㐀"&&t<="䶵"||t>="一"&&t<="龥"},isWhiteSpace:function(t){for(var e=r.iter(r.chars(t));!e.done;e.next()){var n=e.value;if(!o.isWhiteSpace(n))return!1}return!0},isWhiteSpace:function(t){return t>="\t"&&t<="\r"||" "==t||""==t||" "==t||" "==t||t>=" "&&t<="​"||"\u2028"==t||"\u2029"==t||" "==t||" "==t||"　"==t},iskinsokuBefore:function(t){return"!"==t||")"==t||"."==t||":"==t||";"==t||"?"==t||"’"==t||"”"==t||"、"==t||"。"==t||"々"==t||"〉"==t||"》"==t||"」"==t||"』"==t||"】"==t||"〕"==t||"ゝ"==t||"ゞ"==t||"・"==t||"ヽ"==t||"ヾ"==t||"！"==t||"）"==t||"，"==t||"．"==t||"："==t||"？"==t||"］"==t||"｝"==t},iskinsokuAfter:function(t){return"("==t||"["==t||"{"==t||"£"==t||"§"==t||"‘"==t||"“"==t||"〈"==t||"《"==t||"「"==t||"『"==t||"【"==t||"〒"==t||"〔"==t||"〝"==t||"（"==t},lineBreaks:function(t,e,n){for(var i=0,a=0,l=!1,s=!0,h=r.iter(r.chars(t));!h.done;h.next()){var u=h.value;o.iskinsokuBefore(u)?s=!0:o.iskinsokuAfter(u)?(i!=a&&s&&(e.push(new R.TextRange(i,a)),i=a),l=u.charCodeAt(0)>=12288,s=!1):o.canBreakAnywhere(u)?(i!=a&&s&&(e.push(new R.TextRange(i,a)),i=a),l=!0,s=!0):o.isWhiteSpace(u)?(i!=a&&e.push(new R.TextRange(i,a)),"\n"==u&&n&&e.push(new R.TextRange(a,a+1)),i=a+1,l=!1,s=!0):l&&s?(i!=a&&(e.push(new R.TextRange(i,a)),i=a),l=!1,s=!0):(l=!1,s=!0),a+=1,u.charCodeAt(0)>65535&&(a+=1)}i!=a&&e.push(new R.TextRange(i,a))},getBreakRanges:function(t){var e=[];return o.lineBreaks(t,e,!0),e},getWordRanges:function(t,e){var n=[];o.lineBreaks(t,n,!1);for(var i=r.iter(r.toSequence(n));!i.done;i.next()){var a=i.value,l=a.offset,s=a.element;l+1<n.length&&(n[l]=new R.TextRange(s.start,n[l+1].start))}if(1==n.length){n.splice(0);for(var h=0,u=-1,c=-1,g=-1,d=0,p=!0,f=r.iter(r.chars(t));!f.done;f.next()){var m=f.value,y=r.toString(m).toLowerCase()!=r.toString(m);y&&!p&&(n.push(new R.TextRange(d,h)),d=h),p=y,h+=1,"."==m?(n.push(new R.TextRange(d,h)),d=h,-1==u&&(u=h),c=h,g=n.length-1,p=!0):"/"==m&&(n.push(new R.TextRange(d,h-1)),n.push(new R.TextRange(h-1,h)),d=h)}n.push(new R.TextRange(d,r.chars(t).length)),((e==F.HighlightMethod.Bracket||e==F.HighlightMethod.InsideBracket)&&-1!=u&&-1!=c||-1!=u&&u==c)&&(n[g]=new R.TextRange(n[g].start,c-1),n[g+1]=new R.TextRange(c-1,n[g+1].end))}return n},computeLockupMeasurements:function(t,e,n,i,a,l,s,h,u,c){void 0===u&&(u=1),void 0===c&&(c=!1);for(var g=e,d=32*n,f=32*g.spaceWidthRatio/d,y=a,k=c,S=i?t.toUpperCase():t,v=o.isTextRightToLeft(S),L=o.getBreakRanges(S),T=[],x=null!=h[F.TypeLockupController.HIGHLIGHT_STYLE]&&null!=h[F.TypeLockupController.HIGHLIGHT_STYLE].font,A=r.iter(L);!A.done;A.next()){var M=A.value,w=M,_="",I=!1;y=a,k=c;for(var b=r.iter(s);!b.done;b.next()){var H=b.value;if(1==L.length){y=!0,_=F.TypeLockupController.HIGHLIGHT_STYLE;break}(M.start>=H.start&&M.start<H.end||M.start<=H.start&&M.end>=H.start)&&((H.end<M.end||H.start>M.start)&&(y=!0,k=!0),_=F.TypeLockupController.HIGHLIGHT_STYLE),M.end!=H.end&&M.end!=H.end-1&&M.end!=H.start&&M.end!=H.start-1||(I=!0)}var D=32;g=""!=_&&null!=h[_]&&null!=h[_].font?h[_].font.fontData:e,""!=_&&null!=h[_]&&(D=32*u);var B=t.substr(M.start,M.length);v&&"\n"!=B&&(B="‫"+B);var E=i?B.toUpperCase():B;if(M.end<t.length)for(var P=t.substr(M.end),O=0,N=r.iter(r.chars(P));!N.done;N.next()){var z=N.value;if(!o.isWhiteSpace(z)&&"\n"!=z){0==O&&(f=0);break}if((x||1!=u)&&I){var G=32*u*(r.opt(h[F.TypeLockupController.HIGHLIGHT_STYLE].font,function(t){return t.fontData})||e).spaceWidthRatio/d;f=(32*e.spaceWidthRatio/d+G)/2}else f=D*g.spaceWidthRatio/d;O+=1,w=new R.TextRange(M.start,M.end+O)}else f=D*g.spaceWidthRatio/d;if(y&&!v){var U=0,Y=D*l/d,X=r.clone(p.Host.textModelUtils.getGlyphPositions(E,e,32,!k)),W=r.opt(r.opt(h[F.TypeLockupController.HIGHLIGHT_STYLE],function(t){return t.font}),function(t){return t.fontData})||e,V=null;null!=h[F.TypeLockupController.HIGHLIGHT_STYLE]&&(V=r.clone(p.Host.textModelUtils.getGlyphPositions(E,W,32*u,!k)));for(var K=r.clone(X),Q=r.iter(r.toCharSequence(E));!Q.done;Q.next()){var q=Q.value.element,j=new R.TextRange(U+M.start,U+M.start+1);_="";for(var J=r.iter(s);!J.done;J.next())H=J.value,j.start>=H.start&&j.start<H.end&&(_=F.TypeLockupController.HIGHLIGHT_STYLE);""!=_&&null!=h[_]?(D=32*u,K=r.clone(V)):(D=32,K=r.clone(X)),""!=_&&null!=h[_]&&null!=h[_].font?g.isEqual(W)||(g=W):g.isEqual(e)||(g=e);var Z=r.toString(q),$=p.Host.textModelUtils.measureInkBounds(Z,g,D),tt=(G=(K[U+1]-K[U]-$.width)/d+Y,!1);U==E.length-1&&(G=f,Y>0&&(G+=2*Y),tt=!0);var et=""!=_&&null!=h[_]&&-1!=h[_].spacing&&0!=h[_].spacing?u:1,nt=r.clone(m.LockupWordInfo.init_e9d6(Z,$.width/d,G,_,et,B.includes("\n"),tt,j));T.push(r.clone(nt)),U+=1}}else{var ot=p.Host.textModelUtils.measureInkBoundsWithTracking(E,g,D,l);0!=l&&(ot=new C.TheoRect(ot.minX,ot.minY,ot.maxX-0,ot.maxY),Y=D*l/d,0==f?f=Y:l>0&&(f+=2*Y));var it=""!=_&&null!=h[_]&&-1!=h[_].spacing&&0!=h[_].spacing?u:1;if(nt=r.clone(m.LockupWordInfo.init_e9d6(B,ot.width/d,f,_,it,B.includes("\n"),!0,w)),""!=_&&null!=h[_]&&-1!=h[_].spacing&&0!=h[_].spacing&&h[_].lineBreakAtCharacterStyleSizeChange&&r.opt(r.last(T),function(t){return""==t.characterStyle})&&!B.includes("\n")){var rt=r.clone(m.LockupWordInfo.init_e9d6("\n",0,0,_,it,!0,!0,new R.TextRange(M.start,M.start)));T.push(r.clone(rt))}if(T.push(r.clone(nt)),""!=_&&null!=h[_]&&-1!=h[_].spacing&&0!=h[_].spacing&&h[_].lineBreakAtCharacterStyleSizeChange&&I&&!B.includes("\n")){var at=r.clone(m.LockupWordInfo.init_e9d6("\n",0,0,_,it,!0,!0,new R.TextRange(M.end,M.end)));T.push(r.clone(at))}}}return T},getLockupStringsForRoot:function(t){var e=[];return t.visitAll(c.FormaTraversal.PreOrder,function(t){var n=r.as(t.controller,F.TypeLockupController);null!=n&&e.push(n.text)}),e},getFullCanvasLockups:function(t){var e=[];return t.visitAll(c.FormaTraversal.PreOrder,function(t){if(t.style instanceof f.LockupStyle&&t.style.backing==f.LockupBacking.Knockout){var n=r.as(t.controller,F.TypeLockupController);null!=n&&e.push(n)}}),e},getNewCharSelectionRange:function(t,e,n){for(var o=e,i=t,a=new R.TextRange(0,0),l=r.iter(n);!l.done;l.next()){var s=l.value;t.start>=s.start&&t.end<=s.end&&(i=s),e.start>=s.start&&e.end<=s.end&&(a=s)}if(i.start==a.start&&i.end==a.end){if(e.end<=t.start&&0!=a.length)return new R.TextRange(a.start,e.end);if(e.end<=a.end&&t.end<=e.start)return new R.TextRange(e.start,a.end);if(e.start==t.start&&e.end==t.end)return new R.TextRange(a.start,a.end)}return i.start<e.start?o=new R.TextRange(i.start,e.end):i.end>e.end&&(o=new R.TextRange(e.start,i.end)),o},rangesAreEqual:function(t,e){if(t.length!=e.length)return!1;for(var n=r.iter(r.toSequence(t));!n.done;n.next()){var o=n.value,i=o.offset,a=o.element;if(a.start!=e[i].start||a.end!=e[i].end)return!1}return!0},cleanupAndMerge:function(t){for(var e=[],n=r.iter(r.toSequence(t));!n.done;n.next()){var o=n.value,i=o.offset,a=o.element;if(0!=a.length){h.CoreAssert.isTrue(a.start<a.end,"cleanupAndMerge - bad range");var l=e.length-1;if(e.length>0&&a.start<=e[l].end){var s=Math.max(a.end,e[l].end);e[l]=new R.TextRange(e[l].start,s)}else e.push(t[i])}}return e},invertRanges:function(t,e){for(var n=[],o=0,i=r.iter(t);!i.done;i.next()){var a=i.value;0!=a.start&&n.push(new R.TextRange(o,a.start)),o=a.end}return o!=e&&n.push(new R.TextRange(o,e)),n},getCharFontAdjust:function(t,e,n){void 0===n&&(n=!0);var o=1,i=F.TypeLockupController.HIGHLIGHT_STYLE,a=t.font.fontData,l=r.opt(r.opt(t.characterStyles[i],function(t){return t.font}),function(t){return t.fontData});return null!=t.characterStyles[i]&&-1!=t.characterStyles[i].spacing&&0!=t.characterStyles[i].spacing?(o=t.characterStyles[i].spacing,n&&o>1&&(o=1/o)):null!=l&&(o=e||a.capRatio==a.meanRatio||l.capRatio==l.meanRatio?a.capRatio/l.capRatio:a.meanRatio/l.meanRatio),o},getCharFontYAdjust:function(t,e,n){var o=0,i=F.TypeLockupController.HIGHLIGHT_STYLE;if(null==t.characterStyles[i])return h.CoreAssert.isTrue(e==n,"getCharFontYAdjust - charFontSize should match fontSize if no character style!"),o;var a=t.font.fontData,l=r.opt(r.opt(t.characterStyles[i],function(t){return t.font}),function(t){return t.fontData});return null!=l?(o=e*a.capRatio-e*a.baselineOffsetRatio-(n*l.capRatio-n*l.baselineOffsetRatio),t.characterStyles[i].alignment==f.LockupAlignment.Center?o-=(a.capRatio*e-l.capRatio*n)/2:t.characterStyles[i].alignment==f.LockupAlignment.Right&&(o-=a.capRatio*e-l.capRatio*n)):e!=n&&(o=e*a.capRatio-e*a.baselineOffsetRatio-(n*a.capRatio-n*a.baselineOffsetRatio),t.characterStyles[i].alignment==f.LockupAlignment.Center?o-=(a.capRatio*e-a.capRatio*n)/2:t.characterStyles[i].alignment==f.LockupAlignment.Right&&(o-=a.capRatio*e-a.capRatio*n)),o},polyFromForma:function(t){var e=[],n=t.bounds||C.TheoRect.Zero,o=y._asterisk_TheoPoint_Matrix2D(n.evalXY(0,0),t.totalPlacement);e.push(o);var i=y._asterisk_TheoPoint_Matrix2D(n.evalXY(1,0),t.totalPlacement);e.push(i);var r=y._asterisk_TheoPoint_Matrix2D(n.evalXY(1,1),t.totalPlacement);e.push(r);var a=y._asterisk_TheoPoint_Matrix2D(n.evalXY(0,1),t.totalPlacement);return e.push(a),e},formaIntersect:function(t,e){var n=r.clone(o.polyFromForma(t)),i=r.clone(o.polyFromForma(e)),a=[];a.push(r.clone(n)),a.push(r.clone(i));for(var l=r.iter(a);!l.done;l.next())for(var s=l.value,h=r.iter(r.toSequence(s));!h.done;h.next()){for(var u=h.value,c=u.offset,g=u.element,d=s[(c+1)%s.length],p=new x.TheoPoint(d.y-g.y,g.x-d.x),f=null,m=null,y=r.iter(n);!y.done;y.next()){var k=y.value,S=p.x*k.x+p.y*k.y;(null==f||S<f)&&(f=S),(null==m||S>m)&&(m=S)}for(var v=null,L=null,T=r.iter(i);!T.done;T.next()){var F=T.value,C=p.x*F.x+p.y*F.y;(null==v||C<v)&&(v=C),(null==L||C>L)&&(L=C)}if(null!=m&&null!=v&&m<v)return!1;if(null!=L&&null!=f&&L<f)return!1}return!0},sortTextFormae:function(t){var e,n=r.clone(t);return r.sortInPlace(n,function(t,n){if(t.parent==n.parent)return t.rangeInLockup.start<n.rangeInLockup.start;var i,a,l,s,h,u,c,g;if((i=t.lockupForma)&&(a=n.lockupForma)&&(l=i.finalFrame)&&(s=a.finalFrame)&&(h=i.parent)&&null!=(u=h.indexOfChild(i))&&(c=a.parent)&&null!=(g=c.indexOfChild(a))){if(i!=a&&o.formaIntersect(i,a))return u<g;var d=.5*((e=r.opt(r.as(i.controller,F.TypeLockupController),function(t){return t.averageLineHeight}))||null!=e?e:0);return l.minY-s.minY<-d||!(l.minY-s.minY>d)&&l.minX<s.minX}return!1}),n},leftSingleQuote:"‘",rightSingleQuote:"’",leftDoubleQuote:"“",rightDoubleQuote:"”",doubleStraightQuote:'"',singleStraightQuote:"'",isSingleCurlyQuote:function(t){return t==o.leftSingleQuote||t==o.rightSingleQuote},isDoubleCurlyQuote:function(t){return t==o.leftDoubleQuote||t==o.rightDoubleQuote},isCurlyQuote:function(t){return o.isSingleCurlyQuote(t)||o.isDoubleCurlyQuote(t)},isStraightQuote:function(t){return t==o.doubleStraightQuote||t==o.singleStraightQuote},isInteger:function(t){return t>="0"&&t<="9"},isLetter:function(t){return t>="a"&&t<="z"||t>="A"&&t<="Z"},getLeftCurlyQuoteForStraightQuote:function(t){return t==o.singleStraightQuote?o.leftSingleQuote:o.leftDoubleQuote},getRightCurlyQuoteForStraightQuote:function(t){return t==o.singleStraightQuote?o.rightSingleQuote:o.rightDoubleQuote},fixUpQuotes:function(t,e){if(t.length==e.length){for(var n=r.iter(r.toCharSequence(t));!n.done;n.next()){var i=n.value.element;if(o.isCurlyQuote(i))return t}for(var a=r.iter(r.toCharSequence(e));!a.done;a.next()){var l=a.value.element;if(o.isCurlyQuote(l))return t}}for(var s=r.chars(t),h=!1,u=0,c=r.iter(r.toCharSequence(t));!c.done;c.next()){var g=c.value,d=g.offset,p=g.element,f=" ",m=" ",y=" ",k=" ";if(d-1>=0&&(f=s[d-1]),d+1<s.length&&(m=s[d+1]),d+2<s.length&&(y=s[d+2]),d+3<s.length&&(k=s[d+3]),o.isStraightQuote(p)){if(p==o.singleStraightQuote){if(("s"==m||"S"==m)&&" "==y){s[d]=o.rightSingleQuote;continue}if("s"!=f&&"S"!=f||" "!=m||(s[d]=o.rightSingleQuote),o.isLetter(f)&&o.isLetter(m)&&(" "==y||" "==k)){s[d]=o.rightSingleQuote;continue}if(" "==f&&o.isInteger(m)&&o.isInteger(y)&&" "==k){s[d]=o.leftSingleQuote;continue}}if(!h&&o.isInteger(f))continue;if(!h&&" "==f){h=!0,u=d;continue}if(h&&" "==m){p==s[u]&&(h=!1,s[u]=o.getLeftCurlyQuoteForStraightQuote(s[u]),s[d]=o.getRightCurlyQuoteForStraightQuote(p));continue}}}return s.join("")}}}),o)}}]);
//# sourceMappingURL=logomaker-entry_d2588c49-8ffa1feb.js.map