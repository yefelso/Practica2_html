(window.webpackJsonp=window.webpackJsonp||[]).push([[26],{117:function(e,t,n){var r,a,o,i=t,s=n(0),l=n(1),c=n(4),u=n(118),d=n(11),f=n(82),h=n(237),p=n(44),m=n(168),g=n(8),v=n(21),S=n(253),T=n(206),C=n(339);i.BeginPointerTrackingResponseEnum=s.defineEnum("BeginPointerTrackingResponseEnum",{TrackAsGroup:0,TrackWithinGroup:1,DoNotTrack:2}),i.IPSMDelegate=s.defineProtocol("IPSMDelegate",{handleEvent:"(PSMFormaControllerEvent) -> Void"}),i.nearestFormaWithController=function(e){return null==e?(s.opt(g.Host.logging,function(e){return e.error("nearestFormaWithController nil startingForma")}),null):s.opt(e,function(e){return e.visit(d.FormaTraversal.NearestAncestor,function(e,t,n){return null!=e.controller})})},i.getNearestActionableController=function(e){return null==e?(s.opt(g.Host.logging,function(e){return e.error("getNearestActionableController nil startingForma")}),null):e.visit(d.FormaTraversal.NearestAncestor,function(e,t,n){var r;return!!(r=e.controller)&&(r.selectable||r.moveable)})},i.targetForma=function(e,t){if(null==t)return[null,null];for(var n=i.getNearestActionableController(t),r=t;null!=n;){if(null==n.controller)return l.CoreAssert.fail("PSMpD getNearest calls failed"),[null,r];var a,o=f.BeginPointerTrackingEvent.init_73bd(n,[r]);if(e.handleEvent(o),o.trackingResponse!=i.BeginPointerTrackingResponseEnum.TrackAsGroup)return o.trackingResponse==i.BeginPointerTrackingResponseEnum.TrackWithinGroup?[n.controller,r]:(l.CoreAssert.isTrue(o.trackingResponse==i.BeginPointerTrackingResponseEnum.DoNotTrack),[null,r]);if(!(a=n.parent))return[null,r];r=n,n=i.nearestFormaWithController(a),l.CoreAssert.isTrue(null!=n,"nearestFormaWithController unexpectedly returned nil for forma kind:"+a.kind)}return[null,r]},i.FormaState=(r=function(e,t){this.draggedForma_=e,this.startPlacement_=t},s.defineClass({name:"FormaState",ctor:r,props:{update:function(){this.startPlacement_=this.draggedForma_.placement},clone:function(){return new r(this.draggedForma_,this.startPlacement_)}}}),r),i.FormaPageDragDelegate=(a=function(e,t,n){this.draggedFormae_=[],this.delegate=e,this.dragController=t,this.modifierKeys={},c.CoreObject.call(this);for(var r=s.iter(n);!r.done;r.next()){var a=r.value;this.targetNewForma(a)}},s.defineClass({name:"FormaPageDragDelegate",ctor:a,superName:"CoreObject",statics:{_implements:function(e){return"ActiveDragDelegateProtocol"==e}},props:{draggedFormae:{get:function(){return this.draggedFormae_.map(function(e){return e.draggedForma_},this)}},updateModifierKeys:function(e){e.pointers.length>0&&(this.modifierKeys=s.clone(e.pointers[0].modifierKeys))},targetNewForma:function(e){this.draggedFormae_.push(s.clone(new i.FormaState(e,e.placement)))},startPlacementObsolete:{get:function(){return s.first(this.draggedFormae_).startPlacement_}},forEachDraggedForma:function(e){for(var t=s.iter(this.draggedFormae_);!t.done;t.next()){var n=t.value;e(n.draggedForma_,n.startPlacement_)}},activeDragDidBegin:function(e){var t=new f.BeginFormaDragEvent(e);this.delegate.handleEvent(t)},activeDragDidActivate:function(e){return 1!=e.pointers.length||e.pointers[0].type!=S.PointerTypeEnum.Mouse},activeDragDidDeactivate:function(e,t){if(t){var n=new p.FormaAlignmentChangedEvent(s.first(this.draggedFormae),[],null);s.first(this.draggedFormae).beginUpdate(n),s.first(this.draggedFormae).endUpdate(n)}},activeDragClaimNewPointers:function(e,t,n){var r=[],a=[],o=e.pointers.length;l.CoreAssert.isTrue(o>0&&t.length>0);for(var i=!0,c=s.iter(this.draggedFormae);!c.done;c.next()){var u;if((u=c.value.controller)&&!u.rotateable){i=!1;break}}for(var d=s.iter(t);!d.done;d.next()){var f=d.value;n?r.push(f):i?a.push(f):r.push(f)}return e.commitWithNewPointers(a,!0),r=r.concat(a)},activeDragDidCommit:function(e){for(var t=s.iter(s.range(0,this.draggedFormae_.length,!1));!t.done;t.next()){var n=t.value;this.draggedFormae_[n].update()}},activeDragDidMove:function(e,t){var n=new f.FormaDragEvent(e);this.delegate.handleEvent(n),this.updateModifierKeys(e)},activeDragDidChangePace:function(e,t,n){},activeDragHeldPointerEndedAsTap:function(e,t){},activeDragDidEnd:function(e,t,n){if(t){var r=new f.EndFormaDragEvent(e);this.delegate.handleEvent(r)}else for(var a=s.opt(e.pointerStateMachine,function(e){return e.owner}).selection,o=s.iter(n);!o.done;o.next()){var l=o.value;if(!l.cancelled){var c,u,d=s.opt(s.as(l.currentPage,h.FormaPage),function(e){return e.formaAtPoint(l.startLocation,void 0,null)});(c=i.getNearestActionableController(d))&&(l.tapCount%2==1?((u=new f.FormaClickEvent(c)).clickLocation=l.startLocation,u.modifierKeys=s.clone(e.activeDragDelegate.modifierKeys),!g.Host.platform.isWeb&&C.SelectionFacade.enableAdditionalMultiSelectGestures()&&null!=c.controller&&c.controller.canMultiSelect&&(a.selectedCount>1||n.length>1)&&(u.modifierKeys.shift=!0),this.delegate.handleEvent(u)):((u=new f.FormaDoubleClickEvent(c)).clickLocation=l.startLocation,u.modifierKeys=s.clone(e.activeDragDelegate.modifierKeys),this.delegate.handleEvent(u)))}}}}}),a),i.FormaPagePointerStateMachineDelegate=(o=function(e){this.myDrags=[],this.delegate=e,c.CoreObject.call(this)},s.defineClass({name:"FormaPagePointerStateMachineDelegate",ctor:o,superName:"CoreObject",statics:{_implements:function(e){return"PointerStateMachineDelegateProtocol"==e}},props:{activeDragDidFinish:function(e,t){s.remove(this.myDrags,t)},formaeInFlight:function(){for(var e=[],t=s.iter(this.myDrags);!t.done;t.next()){var n=t.value.activeDragDelegate;e=e.concat(n.draggedFormae)}return e},createDragsForPointers:function(e,t,n,r){for(var a=s.clone(t),o=s.clone(this.newDragsForPointers(e,a,n,r)),i=s.iter(o);!i.done;i.next()){var l=i.value;e.appendDrag(l),this.myDrags.push(l)}return a},newDragsForPointers:function(e,t,n,r){var a=[];if(0==t.length)return a;for(var o=s.as(e.owner,u.DocumentController),l=s.opt(o,function(e){return e.selection}),c=function(e,t){var n,r;return(n=s.opt(e,function(e){return e.viewportTransform}))?Math.sqrt(Math.abs(n.determinant)):(n=s.opt(s.opt(t,function(e){return e.page.view}),function(e){return e.getViewportTransform()}))?Math.sqrt(Math.abs(n.determinant)):null!=(r=s.opt(o,function(e){return e.viewScale}))?r:1},f=!1,p=s.iter(t);!p.done;p.next())if(p.value.type==S.PointerTypeEnum.Touch){f=!0;break}if(!f&&C.SelectionFacade.isMultiSelect(l)&&1==t.length&&t[0].type==S.PointerTypeEnum.Mouse){var g=s.clone(o.model.getHandles());if(g.length>0&&s.as(g[0],m.BoxTransformHandles)){var H=g[0],A=H.reference.bounds,F=H.reference.placement.inverse.transformPoint(t[0].currentLocation);f=A.containsPoint(F)}}var D,b=null,y=[];if(D=s.opt(l,function(e){return e.asFormaArray()}))for(var w=s.iter(D);!w.done;w.next()){var x=w.value,_=x,P=s.clone(x.filterByKind(v.ImageForma.KIND,d.FormaTraversal.JustChildren));P.length>0&&!P[0].isLogo()&&(_=P[0]);var M=i.targetForma(this.delegate,_),I=M[0],R=M[1];(k=I)&&(G=R)&&(null==b?(b=k,y.push(G)):s.opt(b,function(e){return e.kind==k.kind})&&y.push(G))}if(f&&null!=b&&0==r){(W=new i.FormaPageDragDelegate(this.delegate,b,s.clone(y))).modifierKeys=s.clone(t[0].modifierKeys);for(var E=!0,N=s.iter(y);!N.done;N.next()){var L=N.value;if((k=L.controller)&&!k.rotateable){E=!1;break}}if(!E)for(;t.length>1;)t.pop();var B=new T.ActiveDrag(e,W,t,null,c(null,null));a.push(B)}for(;t.length>0;){var k,G,O=t.pop(),U=(_=s.opt(s.as(O.currentPage,h.FormaPage),function(e){return e.formaAtPoint(O.startLocation,void 0,null)}),i.targetForma(this.delegate,_));if(I=U[0],R=U[1],(k=I)&&(G=R)){for(var X=s.iter(a);!X.done;X.next()){var Y=X.value,z=Y.activeDragDelegate,V=z.dragController==k&&s.eq(d._equality_Forma_Forma,s.first(z.draggedFormae),G);if(!n||V){if(G.controller.rotateable){var K=[O];Y.commitWithNewPointers(K,!0)}B=Y;break}}if(null==B){if(!n&&r+a.length>0)break;var W;(W=b==k&&s.containsEq(y,G,d._equality_Forma_Forma)&&r+a.length==0?new i.FormaPageDragDelegate(this.delegate,k,s.clone(y)):new i.FormaPageDragDelegate(this.delegate,k,[G])).modifierKeys=s.clone(O.modifierKeys),K=[O],B=new T.ActiveDrag(e,W,K,null,c(O,G)),a.push(B)}}}return a}}}),o)},135:function(e,t,n){var r,a,o,i=t,s=n(0),l=n(157),c=n(158),u=n(166),d=n(4),f=n(167),h=n(169),p=n(140),m=n(341),g=n(207),v=n(342);i.HandlerFactory=(r=function(){},s.defineClass({name:"HandlerFactory",ctor:r,props:{drag:{get:function(){return f.NullDragHandler.instance}},click:{get:function(){return u.NullClickHandler.instance}},resize:{get:function(){return g.NullResizeHandler.instance}},rotate:{get:function(){return v.NullRotateHandler.instance}},actions:{get:function(){return l.NullActionHandler.instance}},handles:{get:function(){return p.NullHandlesHandler.instance}},attributes:{get:function(){return c.NullAttributesHandler.instance}},featureSets:{get:function(){return h.NullFeatureSetHandler.instance}}}}),r),i.DesignController=(a=function(){this.click=u.NullClickHandler.instance,this.drag=f.NullDragHandler.instance,this.resize=g.NullResizeHandler.instance,this.move=m.NullMoveHandler.instance,this.rotate=v.NullRotateHandler.instance,this.actions=l.NullActionHandler.instance,this.handles=p.NullHandlesHandler.instance,this.attributes=c.NullAttributesHandler.instance,this.featureSets=h.NullFeatureSetHandler.instance,d.CoreObject.call(this)},o={},s.defineClass({name:"DesignController",ctor:a,superName:"CoreObject",statics:{NullController:{get:function(){return void 0===o.NullController&&(o.NullController=new a),o.NullController}}},props:{configureEditorModel:function(){this.handles.updateHandles(),this.attributes.updateAttributes(),this.featureSets.updateFeatureSets()}}}),a)},140:function(e,t,n){var r,a,o,i,s=t,l=n(0),c=n(168),u=n(458),d=n(459);s.IHandlesHandler=l.defineProtocol("IHandlesHandler",{handleTransformEvent:"(HandleTransformEvent) -> Void",handleFormaDragEvents:"(PSMFormaDragControllerEvent) -> Void",updateHandles:"() -> Void"}),s.NullHandlesHandler=(r=function(){},a={},l.defineClass({name:"NullHandlesHandler",ctor:r,statics:{instance:{get:function(){return void 0===a.instance&&(a.instance=new r),a.instance}},_implements:function(e){return"IHandlesHandler"==e}},props:{handleTransformEvent:function(e){},handleFormaDragEvents:function(e){},updateHandles:function(){}}}),r),s.IHandleGenerator=l.defineProtocol("IHandleGenerator",{addHandles:"(BaseHandlesHandler) -> Array<BaseHandle>"}),s.IHandleProcessor=l.defineProtocol("IHandleProcessor",{handleTransformEvent:"(BaseHandlesHandler, HandleTransformEvent) -> Boolean",handleFormaDragEvents:"(BaseHandlesHandler, PSMFormaDragControllerEvent) -> Boolean"}),s.BaseHandlesHandler=(o=function(e,t){this.dc=null,this.delegate=null,this.activeTransform=c.TransformType.None,this.handleGenerators=[],this.handleProcessors=[],o.handlerClock_+=1,this.handlerInstanceID=o.handlerClock_,this.dc=e,this.delegate=t},l.defineClass({name:"BaseHandlesHandler",ctor:o,superName:"CoreObject",statics:{handlerClock_:0,_implements:function(e){return"IHandlesHandler"==e}},props:{clearHandles:function(){l.opt(this.dc,function(e){return e.model.setHandles([])})},handleTransformEvent:function(e){for(var t=l.iter(this.handleProcessors);!t.done&&!t.value.handleTransformEvent(this,e);t.next());},handleFormaDragEvents:function(e){for(var t=l.iter(this.handleProcessors);!t.done&&!t.value.handleFormaDragEvents(this,e);t.next());},updateHandles:function(){var e;if(e=l.opt(this.dc,function(e){return e.model})){e.beginUpdates();for(var t=[],n=l.iter(this.handleGenerators);!n.done;n.next()){var r=n.value;l.append(t,r.addHandles(this))}e.setHandles(l.clone(t)),e.updatesComplete()}},addHandleGenerator:function(e){this.handleGenerators.push(e)},removeHandleGenerator:function(e){this.handleGenerators=this.handleGenerators.filter(function(t){return t!==e},this)},clearHandleGenerators:function(){this.handleGenerators=[]},addHandleProcessor:function(e){this.handleProcessors.push(e)},removeHandleProcessor:function(e){this.handleProcessors=this.handleProcessors.filter(function(t){return t!==e},this)},clearHandleProcessors:function(){this.handleProcessors=[]}}}),o),s.StandardHandlesHandler=(i=function(e,t){s.BaseHandlesHandler.call(this,e,t),this.addHandleGenerator(u.StandardHandleGenerator.instance),this.addHandleProcessor(d.StandardHandleProcessor.instance)},l.defineClass({name:"StandardHandlesHandler",ctor:i,superName:"BaseHandlesHandler",statics:{_implements:function(e){return"IHandlesHandler"==e}}}),i)},157:function(e,t,n){var r,a,o,i=t,s=n(0),l=n(34),c=n(1),u=n(27);i.IActionHandler=s.defineProtocol("IActionHandler",{canDoAction:"(Action) -> Boolean",doActionWithCallback:"(Action, (ActionResult) -> Void) -> Void",doAction:"(Action) -> CorePromise"}),i.NullActionHandler=(r=function(){},a={},s.defineClass({name:"NullActionHandler",ctor:r,statics:{instance:{get:function(){return void 0===a.instance&&(a.instance=new r),a.instance}},_implements:function(e){return"IActionHandler"==e}},props:{canDoAction:function(e){return!1},doActionWithCallback:function(e,t){t(null)},doAction:function(e){return u.CorePromise.resolve(null)}}}),r),i.StandardActionHandler=(o=function(e){this.dc=e},s.defineClass({name:"StandardActionHandler",ctor:o,statics:{_implements:function(e){return"IActionHandler"==e}},props:{canDoAction:function(e){var t;return(t=this.dc)?e.canDo(t):(c.CoreAssert.fail("Still calling actions when the controller has been destroyed"),!1)},doActionWithCallback:function(e,t){var n;if(n=this.dc){var r=null;n.undoRedoMgr.beginUserActionAsync(e.getUserAction(n)).then(function(t){return e.execute(n)}).then(function(e){return r=e,n.undoRedoMgr.endUserActionAsync()}).then(function(e){return t(l.ActionResult.fromPromiseAny(r))})}else c.CoreAssert.fail("Still calling actions when the controller has been destroyed")},doAction:function(e){var t=this;return new u.CorePromise(function(n,r){return t.doActionWithCallback(e,function(e){return n(e)})})}}}),o)},158:function(e,t,n){var r,a,o,i,s=t,l=n(0),c=n(19),u=n(430),d=n(11),f=n(91),h=n(252),p=n(338),m=n(114);s.IAttributesHandler=l.defineProtocol("IAttributesHandler",{updateAttributes:"() -> Void"}),s.NullAttributesHandler=(r=function(){},a={},l.defineClass({name:"NullAttributesHandler",ctor:r,statics:{instance:{get:function(){return void 0===a.instance&&(a.instance=new r),a.instance}},_implements:function(e){return"IAttributesHandler"==e}},props:{updateAttributes:function(){}}}),r),s.IAttributeHandler=l.defineProtocol("IAttributeHandler",{key:"String",calculate:"(DocumentController) -> IEditorAttribute"}),s.AttributeHandlerBase=(o=function(e){this.key=e},l.defineClass({name:"AttributeHandlerBase",ctor:o}),o),s.ImageAttributeHandler=function(){var e=function(){s.AttributeHandlerBase.call(this,u.ImageAttribute.KEY)},t={};return l.defineClass({name:"ImageAttributeHandler",ctor:e,superName:"AttributeHandlerBase",statics:{instance:{get:function(){return void 0===t.instance&&(t.instance=new e),t.instance}},_implements:function(e){return"IAttributeHandler"==e}},props:{calculate:function(e){var t=[];return l.opt(e,function(e){return e.selection.forEachSelected(function(e){var n=f.ImageFacade.getImageStyleForForma(e);if(null!=n){for(var r=!1,a=l.iter(t);!a.done;a.next()){var o=a.value;if(n.equals(o)){r=!0;break}}r||t.push(n)}})}),new u.ImageAttribute(l.clone(t))}}}),e}(),s.OpacityAttributeHandler=function(){var e=function(){s.AttributeHandlerBase.call(this,u.OpacityAttribute.KEY)},t={};return l.defineClass({name:"OpacityAttributeHandler",ctor:e,superName:"AttributeHandlerBase",statics:{instance:{get:function(){return void 0===t.instance&&(t.instance=new e),t.instance}},_implements:function(e){return"IAttributeHandler"==e}},props:{calculate:function(e){var t=[];return l.opt(e,function(e){return e.selection.forEachSelected(function(e){var n=p.OpacityFacade.getOpacityForForma(e);t.includes(n)||t.push(n)})}),new u.OpacityAttribute(l.clone(t))}}}),e}(),s.ControllerSettingAttributeHandler=function(){var e=function(){s.AttributeHandlerBase.call(this,u.ControllerSettingAttribute.KEY)},t={};return l.defineClass({name:"ControllerSettingAttributeHandler",ctor:e,superName:"AttributeHandlerBase",statics:{instance:{get:function(){return void 0===t.instance&&(t.instance=new e),t.instance}},_implements:function(e){return"IAttributeHandler"==e}},props:{calculate:function(e){var t=[];return l.opt(e,function(e){return e.selection.forEachSelected(function(e){var n=l.opt(e.controller,function(e){return e.settings});null!=n&&t.push(n)})}),new u.ControllerSettingAttribute(l.clone(t))}}}),e}(),s.MediaMetadataAttributeHandler=function(){var e=function(){s.AttributeHandlerBase.call(this,u.MediaMetadataAttribute.KEY)},t={};return l.defineClass({name:"MediaMetadataAttributeHandler",ctor:e,superName:"AttributeHandlerBase",statics:{instance:{get:function(){return void 0===t.instance&&(t.instance=new e),t.instance}},_implements:function(e){return"IAttributeHandler"==e}},props:{calculate:function(e){var t=[];return l.opt(e,function(e){return e.selection.forEachSelected(function(e){var n=h.ImageUtils.getMediaMetadataForForma(e);null!=n&&t.push(n)})}),new u.MediaMetadataAttribute(l.clone(t))}}}),e}(),s.ColorAttributeHandler=function(){var e=function(){s.AttributeHandlerBase.call(this,u.ColorAttribute.KEY)},t={};return l.defineClass({name:"ColorAttributeHandler",ctor:e,superName:"AttributeHandlerBase",statics:{instance:{get:function(){return void 0===t.instance&&(t.instance=new e),t.instance}},_implements:function(e){return"IAttributeHandler"==e}},props:{calculate:function(e){var t=l.clone(l.opt(e,function(e){return e.selection.IDs})||[]),n=[];if(0==t.length);else if(1==t.length){var r,a,o;if(r=l.opt(l.opt(e,function(e){return e.document}),function(e){return e.firstPage.formaByID(t[0])}))if(null!=(a=r.style.colors.colorID(c.ColorRole.FieldPrimary)))(o=r.page.colorLibraryController.getTheoColorForKey(a))?n.push(o):n.push(null);else n.push(null)}else{var i=!0;if(l.opt(e,function(e){return e.selection.forEachSelected(function(e){e.hasIntent(d.Forma.INTENT_GRID_CELL)||"Root"==e.kind||(i=!1)})}),i){n=[];var s=[];l.opt(e,function(e){return e.selection.forEachSelected(function(e){var t,r;null!=(t=e.style.colors.colorID(c.ColorRole.FieldPrimary))?(r=e.page.colorLibraryController.getTheoColorForKey(t))?n.push(r):n.push(null):n.push(null)})}),n.length>0&&s.push(n[0]);for(var f=l.iter(l.range(0,n.length-1,!0));!f.done;f.next()){var h=f.value;if(!l.eq(m._equality_TheoColor_TheoColor,s[0],n[h])){s[0]=null;break}}n=l.clone(s)}}return new u.ColorAttribute(l.clone(n))}}}),e}(),s.StandardAttributesHandler=(i=function(e){this.opacity=s.OpacityAttributeHandler.instance,this.media=s.MediaMetadataAttributeHandler.instance,this.image=s.ImageAttributeHandler.instance,this.color=s.ColorAttributeHandler.instance,this.settting=s.ControllerSettingAttributeHandler.instance,this.dc=e},l.defineClass({name:"StandardAttributesHandler",ctor:i,statics:{_implements:function(e){return"IAttributesHandler"==e}},props:{updateAttributes:function(){this.updateFrom([this.opacity,this.color,this.image,this.media,this.settting])},updateFrom:function(e){for(var t=l.iter(e);!t.done;t.next()){var n=t.value,r=n.calculate(this.dc);null!=r?l.opt(this.dc,function(e){return e.model.setAttribute(r)}):l.opt(this.dc,function(e){return e.model.clearAttribute(n.key)})}}}}),i)},166:function(e,t,n){var r,a,o,i=t,s=n(0),l=n(39),c=n(11),u=n(8);i.IClickHandler=s.defineProtocol("IClickHandler",{handleClick:"(FormaClickEvent) -> Void",handleDoubleClick:"(FormaDoubleClickEvent) -> Void"}),i.NullClickHandler=(r=function(){},a={},s.defineClass({name:"NullClickHandler",ctor:r,statics:{instance:{get:function(){return void 0===a.instance&&(a.instance=new r),a.instance}},_implements:function(e){return"IClickHandler"==e}},props:{handleClick:function(e){},handleDoubleClick:function(e){}}}),r),i.StandardClickHandler=(o=function(e){this.dc=e},s.defineClass({name:"StandardClickHandler",ctor:o,statics:{_implements:function(e){return"IClickHandler"==e}},props:{nearestSelectable:function(e){var t,n;return((t=s.opt(s.opt(e,function(e){return e.controller}),function(e){return e.selectable}))||null!=t)&&t?e:s.opt(e,function(e){return e.visit(c.FormaTraversal.NearestAncestor,function(e,t,r){return!(!(n=s.opt(e.controller,function(e){return e.selectable}))&&null==n)&&n})})},handleClick:function(e){var t,n=this;if(t=this.nearestSelectable(e.forma)){var r,a=1==e.modifierKeys.shift||1==e.modifierKeys.command||1==e.modifierKeys.control;r=u.Host.platform.isWeb?"Web":u.Host.platform.isIOS?"iOS":u.Host.platform.isAndroid?"Android":"Unknown",a&&!this.dc.selection.inCharStyleMode?this.dc.selection.isSelected(t)?(this.dc.selection.deselectForma(t),s.opt(u.Host.logging,function(e){return e.logToAnalytics(l.AnalyticsConstants.kAnalyticsEventClickOccured,{contextualData2:"New selected count: "+s.toString(n.dc.selection.selectedCount),contextualData3:"Did deselect: yes",contextualData4:"Platform: "+r})})):this.canAddToSelection(t)&&(this.dc.selection.selectForma(t),s.opt(u.Host.logging,function(e){return e.logToAnalytics(l.AnalyticsConstants.kAnalyticsEventClickOccured,{contextualData2:"New selected count: "+s.toString(n.dc.selection.selectedCount),contextualData3:"Did deselect: no",contextualData4:"Platform: "+r})})):this.dc.selection.isSelected(t)?u.Host.platform.isWeb||this.dc.selection.deselectForma(t):s.opt(u.Host.platform,function(e){return 1==e.isWeb||n.dc.selection.selectedCount<2||t.controller.canMultiSelect})&&(this.dc.selection.inCharStyleMode=!1,this.dc.selection.replaceSelection(t),this.dc.controllerSettingsState.settings=null)}s.opt(this.dc,function(t){return t.notifyClick(e)})},canAddToSelection:function(e){var t,n,r;return!!s.opt(this.dc,function(e){return 0==e.selection.selectedCount})||!(r=s.opt(this.dc,function(e){return e.selection.formaAt(0)}))||!(!(t=s.opt(e.controller,function(e){return e.moveable}))&&null==t)&&t&&!(!(n=s.opt(r.controller,function(e){return e.moveable}))&&null==n)&&n},handleDoubleClick:function(e){s.opt(e.forma.controller,function(t){return t.onEvent(e)}),s.opt(this.dc,function(t){return t.notifyDoubleClick(e)})}}}),o)},167:function(e,t,n){var r,a,o,i,s=t,l=n(0),c=n(39),u=n(123),d=n(340),f=n(11),h=n(82),p=n(25),m=n(8),g=n(140),v=n(460),S=n(31);s.IDragHandler=l.defineProtocol("IDragHandler",{handleFormaDragEvents:"(PSMFormaDragControllerEvent) -> Void"}),s.NullDragHandler=(r=function(){},a={},l.defineClass({name:"NullDragHandler",ctor:r,statics:{instance:{get:function(){return void 0===a.instance&&(a.instance=new r),a.instance}},_implements:function(e){return"IDragHandler"==e}},props:{handleFormaDragEvents:function(e){},isDragging:function(){return!1}}}),r),s.DragFacadeBasedDragHandler=(o=function(e,t){this.dragging=!1,this.swappableFormae=[],this.swapTargetForma=null,this.inSwapMode=!1,this.originalPlacement=null,this.swapModeHandleGenerator=new v.SwapModeHandleGenerator,this.originalHandleGenerators=[],this.dc=e,this.delegate=t},l.defineClass({name:"DragFacadeBasedDragHandler",ctor:o,statics:{_implements:function(e){return"IDragHandler"==e}},props:{handleFormaDragEvents:function(e){var t,n,r,a=this;if(t=l.as(e,h.BeginFormaDragEvent))(C=l.as(l.opt(this.delegate,function(e){return e.handles}),g.BaseHandlesHandler))&&(this.originalHandleGenerators=l.clone(C.handleGenerators)),this.swappableFormae=l.clone(u.DragFacade.getSwappableFormae(t)),null!=l.first(e.dragDelegate.draggedFormae)&&(this.originalPlacement=l.opt(l.first(e.dragDelegate.draggedFormae),function(e){return e.placement})),l.opt(this.dc,function(e){return e.undoRedoMgr.beginUserAction(S.UserActions.MoveItem(),function(){u.DragFacade.processBeginFormaDrag(t),l.opt(a.delegate,function(e){return e.handles.updateHandles()})})});else if(n=l.as(e,h.FormaDragEvent)){var o=this.swapTargetForma;if(this.dc.designControllerHandlesSwap){var i=u.DragFacade.getSwapState(n,l.clone(this.swappableFormae),o,this.inSwapMode,this.originalPlacement),s=i[0],v=i[1];this.inSwapMode=s,this.swapTargetForma=v}var T=l.first(e.dragDelegate.draggedFormae);if(l.opt(T,function(e){return"Image"==e.kind})&&(T=l.opt(T,function(e){return e.parent})),null==T)return;if(!l.eq(f._equality_Forma_Forma,this.swapTargetForma,o)){var C=l.as(l.opt(this.delegate,function(e){return e.handles}),g.BaseHandlesHandler);l.opt(C,function(e){return e.clearHandleGenerators()}),null==this.swapTargetForma||l.eq(f._equality_Forma_Forma,this.swapTargetForma,T)?(l.opt(C,function(e){return e.removeHandleGenerator(a.swapModeHandleGenerator)}),this.swapModeHandleGenerator.clearSwapTargetForma()):(l.opt(C,function(e){return e.addHandleGenerator(a.swapModeHandleGenerator)}),this.swapModeHandleGenerator.setSwapTargetForma(this.swapTargetForma))}if(!this.inSwapMode){var H=l.clone(u.DragFacade.processFormaDrag(n));l.opt(this.dc,function(e){return e.model.beginUpdates()}),l.opt(this.dc,function(e){return e.model.setSnaplines(l.clone(H))}),l.opt(this.dc,function(e){return e.model.updatesComplete()})}this.inSwapMode&&(l.opt(this.dc,function(e){return e.model.beginUpdates()}),l.opt(this.dc,function(e){return e.model.setSwapState(new d.SwapState(T,n.drag.pointers[0].currentLocation))}),l.opt(this.dc,function(e){return e.model.updatesComplete()})),l.opt(this.delegate,function(e){return e.handles.updateHandles()})}else if(r=l.as(e,h.EndFormaDragEvent))if(l.opt(m.Host.logging,function(t){return t.logToAnalytics(c.AnalyticsConstants.kAnalyticsFormaeDragged,{contextualData1:"Selected count: "+a.dc.selection.selectedCount,contextualData2:"Dragged count: "+e.dragDelegate.draggedFormae.length})}),l.opt(this.dc,function(e){return e.model.beginUpdates()}),l.opt(this.dc,function(e){return e.model.setSnaplines([])}),l.opt(this.dc,function(e){return e.model.updatesComplete()}),u.DragFacade.processEndFormaDrag(r),T=l.first(e.dragDelegate.draggedFormae),l.opt(T,function(e){return"Image"==e.kind})&&(T=l.opt(T,function(e){return e.parent})),this.inSwapMode){if(C=l.as(l.opt(this.delegate,function(e){return e.handles}),g.BaseHandlesHandler)){C.clearHandleGenerators();for(var A=l.iter(this.originalHandleGenerators);!A.done;A.next()){var F=A.value;C.addHandleGenerator(F)}}if(l.opt(this.dc,function(e){return e.model.beginUpdates()}),l.opt(this.dc,function(e){return e.model.setSwapState(new d.SwapState(null,null))}),l.opt(this.dc,function(e){return e.model.updatesComplete()}),null==T)return l.opt(this.dc,function(e){return e.selection.clearSelection()}),l.opt(this.delegate,function(e){return e.handles.updateHandles()}),this.swapTargetForma=null,this.inSwapMode=!1,void(this.originalPlacement=null);null==this.swapTargetForma||l.eq(f._equality_Forma_Forma,this.swapTargetForma,T)?l.opt(this.dc,function(e){return e.undoRedoMgr.cancelUserAction(function(){l.opt(a.dc,function(e){return e.selection.replaceSelection(T)}),l.opt(a.delegate,function(e){return e.handles.updateHandles()}),a.swapTargetForma=null,a.inSwapMode=!1,a.originalPlacement=null})}):l.opt(this.dc,function(e){return e.undoRedoMgr.cancelUserAction(function(){return l.opt(a.dc,function(e){return e.undoRedoMgr.beginUserAction(S.UserActions.SwapCells(),function(){var e,t=l.clone(l.opt(l.opt(a.dc,function(e){return e.document}),function(e){return e.firstPage.root.filterByControllerKind(p.GridController.KIND)}));e=l.opt(t,function(e){return null!=e.length&&t.length>0})?l.as(t[0].controller,p.GridController):null,l.opt(e,function(e){return e.swapGridChildren(a.swapTargetForma,T)}),l.opt(a.dc,function(e){return e.undoRedoMgr.endUserAction(function(){l.opt(a.dc,function(e){return e.selection.replaceSelection(T)}),l.opt(a.delegate,function(e){return e.handles.updateHandles()}),a.swapTargetForma=null,a.inSwapMode=!1,a.originalPlacement=null})})})})})})}else l.opt(this.dc,function(e){return e.undoRedoMgr.endUserAction(function(){l.opt(a.delegate,function(e){return e.handles.updateHandles()}),a.swapTargetForma=null,a.inSwapMode=!1,a.originalPlacement=null})})}}}),o),s.MultiObjectDragHandler=(i=function(e,t){this.startPlacements={},this.basePlacements={},this.dragging=!1,this.dc=e,this.delegate=t},l.defineClass({name:"MultiObjectDragHandler",ctor:i,statics:{_implements:function(e){return"IDragHandler"==e}},props:{handleFormaDragEvents:function(e){var t,n,r,a=this;if(t=l.as(e,h.BeginFormaDragEvent))l.opt(this.dc,function(e){return e.undoRedoMgr.beginUserAction(S.UserActions.MoveItem(),function(){u.DragFacade.processBeginFormaDrag(t),l.opt(a.delegate,function(e){return e.handles.updateHandles()})})});else if(n=l.as(e,h.FormaDragEvent)){var o=l.clone(u.DragFacade.processFormaDrag(n));l.opt(this.dc,function(e){return e.model.beginUpdates()}),l.opt(this.dc,function(e){return e.model.setSnaplines(l.clone(o))}),l.opt(this.dc,function(e){return e.model.updatesComplete()}),l.opt(this.delegate,function(e){return e.handles.updateHandles()})}else(r=l.as(e,h.EndFormaDragEvent))&&(l.opt(m.Host.logging,function(t){return t.logToAnalytics(c.AnalyticsConstants.kAnalyticsFormaeDragged,{contextualData1:"Selected count: "+a.dc.selection.selectedCount,contextualData2:"Dragged count: "+e.dragDelegate.draggedFormae.length})}),l.opt(this.dc,function(e){return e.model.beginUpdates()}),l.opt(this.dc,function(e){return e.model.setSnaplines([])}),l.opt(this.dc,function(e){return e.model.updatesComplete()}),u.DragFacade.processEndFormaDrag(r),l.opt(this.dc,function(e){return e.undoRedoMgr.endUserAction(function(){return l.opt(a.delegate,function(e){return e.handles.updateHandles()})})}))},isDragging:function(){return this.dragging}}}),i)},169:function(e,t,n){var r,a,o,i=t,s=n(0),l=n(29),c=n(461),u=n(21),d=n(252),f=n(30),h=n(14);i.IFeatureSetHandler=s.defineProtocol("IFeatureSetHandler",{updateFeatureSets:"() -> Void"}),i.NullFeatureSetHandler=(r=function(){},a={},s.defineClass({name:"NullFeatureSetHandler",ctor:r,statics:{instance:{get:function(){return void 0===a.instance&&(a.instance=new r),a.instance}},_implements:function(e){return"IFeatureSetHandler"==e}},props:{updateFeatureSets:function(){}}}),r),i.StandardFeatureSetHandler=(o=function(e){this.dc=e},s.defineClass({name:"StandardFeatureSetHandler",ctor:o,statics:{_implements:function(e){return"IFeatureSetHandler"==e}},props:{updateFeatureSets:function(){var e,t,n,r,a,o,i,d=this,p=0,m=0,g=0,v=0,S=0,T=!1,C=!1,H=!1,A=0,F=!1,D=0,b=0,y=(e=s.opt(this.dc,function(e){return e.selection.selectedCount}))||null!=e?e:0;s.opt(this.dc,function(e){return e.selection.forEachSelected(function(e){e.isTypeLockup()&&(p+=1),(e instanceof u.ImageForma||e instanceof l.FrameForma)&&(g+=1),e instanceof f.ShapeForma&&(v+=1),((t=s.opt(e.controller,function(e){return e.moveable}))||null!=t)&&t&&(m+=1),((n=s.opt(e.controller,function(e){return e.opacityChangeable}))||null!=n)&&n&&(b+=1),((r=s.opt(e.controller,function(e){return e.canMultiSelect}))||null!=r)&&r&&(S+=1),((a=s.opt(e.controller,function(e){return e.deleteable}))||null!=a)&&a&&(A+=1),((o=s.opt(e.controller,function(e){return e.duplicatable}))||null!=o)&&o&&(D+=1),1==y&&(d.hasLicenseInfo(e)&&(T=!0),s.opt(e.controller,function(e){return null!=e.settings})&&(C=!0),((i=s.opt(e.controller,function(e){return e.replaceable}))||null!=i)&&i&&(F=!0),e.controller instanceof h.TypeLockupController&&(H=!0))})}),s.opt(this.dc,function(e){return e.model.clearFeatureSets()}),1==p&&1==y&&s.opt(this.dc,function(e){return e.model.setFeatureSet(new c.TextFrameAttributesFeature)}),m==y&&m>1&&s.opt(this.dc,function(e){return e.model.setFeatureSet(new c.AlignSpacingAttributesFeature(!0,m>2,!0,!0))}),b==y&&b>0&&s.opt(this.dc,function(e){return e.model.setFeatureSet(new c.OpacityAttributesFeature)}),y>0&&s.opt(this.dc,function(e){return e.model.setFeatureSet(new c.FormaEditFeature(S==y,D==y,A==y,C,H))}),g+v==y&&s.opt(this.dc,function(e){return e.model.setFeatureSet(new c.ImageFeature(g==y&&g>0,F,T))})},hasLicenseInfo:function(e){var t=d.ImageUtils.getMediaMetadataForForma(e);return!(null==t||!t.sourceHasLicense())}}}),o)},207:function(e,t,n){var r,a,o,i=t,s=n(0),l=n(123),c=n(82),u=n(89),d=n(14),f=n(15),h=n(10),p=n(31);i.IResizeHandler=s.defineProtocol("IResizeHandler",{handleBeginSelectionBoxResize:"(BoxReference, TheoPoint) -> Void",handleSelectionBoxResize:"(BoxReference, TheoPoint, TheoPoint, Double) -> Void",handleEndSelectionBoxResize:"(BoxReference, TheoPoint) -> Void"}),i.NullResizeHandler=(r=function(){},a={},s.defineClass({name:"NullResizeHandler",ctor:r,statics:{instance:{get:function(){return void 0===a.instance&&(a.instance=new r),a.instance}},_implements:function(e){return"IResizeHandler"==e}},props:{handleBeginSelectionBoxResize:function(e,t){},handleSelectionBoxResize:function(e,t,n,r){},handleEndSelectionBoxResize:function(e,t){}}}),r),i.locate=function(e,t,n){return new f.TheoPoint((e.x-t.x)/(n.x-t.x),(e.y-t.y)/(n.y-t.y))},i.eval=function(e,t,n){return new f.TheoPoint((1-e.x)*t.x+e.x*n.x,(1-e.y)*t.y+e.y*n.y)},i.SingleItemResizeHandler=(o=function(e,t,n){this.dc=e,this.forma=t,this.delegate=n},s.defineClass({name:"SingleItemResizeHandler",ctor:o,statics:{_implements:function(e){return"IResizeHandler"==e}},props:{handleBeginSelectionBoxResize:function(e,t){var n=this;this.dc.undoRedoMgr.beginUserAction(p.UserActions.ResizeItem(),function(){return s.opt(n.forma.controller,function(e){return e.onEvent(new c.BeginFormaResizeEvent(n.forma,t))})})},handleSelectionBoxResize:function(e,t,n,r){var a=this,o=Math.sqrt(Math.abs(e.placement.determinant))*Math.abs(r),l=new f.TheoPoint(1-t.x,1-t.y),p=e.bounds,m=e.placement.inverse.transformPoint(n),g=i.locate(m,e.bounds.eval(l),e.bounds.eval(t));if(!(isFinite(g.x)&&g.x<0||isFinite(g.y)&&g.y<0)){var v;v=.5==t.x?h.TheoRect.fromPoints(p.evalXY(0,l.y),new f.TheoPoint(p.maxX,m.y)):.5==t.y?h.TheoRect.fromPoints(p.evalXY(l.x,0),new f.TheoPoint(m.x,p.maxY)):h.TheoRect.fromPoints(p.eval(l),m);var S=50/o,T=10/o;this.forma.controller instanceof u.ImageController&&(S=100/o,T=100/o),v.width<T||v.height<T||v.width+v.height<S||(1==t.x&&.5==t.y&&this.forma.controller instanceof d.TypeLockupController?this.forma.controller.recalculateTracking(v.size):.5==t.x&&1==t.y&&this.forma.controller instanceof d.TypeLockupController?this.forma.controller.recalculateLeading(v.size):s.opt(this.forma.controller,function(e){return e.onEvent(new c.FormaResizeEvent(a.forma,v.size,l))}),s.opt(this.delegate,function(e){return e.handles.updateHandles()}))}},handleEndSelectionBoxResize:function(e,t){var n=this;s.opt(this.forma.controller,function(e){return e.onEvent(new c.EndFormaResizeEvent(n.forma))}),l.DragFacade.rescueFormaToPageBounds(this.forma),this.dc.undoRedoMgr.endUserAction(function(){})}}}),o)},341:function(e,t,n){var r,a,o,i=t,s=n(0),l=n(9),c=n(124),u=n(15),d=n(31);i.IMoveHandler=s.defineProtocol("IMoveHandler",{beginMove:"(BoxReference) -> Void",updateMove:"(BoxReference, TheoPoint, Double) -> Void",endMove:"(BoxReference) -> Void"}),i.NullMoveHandler=(r=function(){},a={},s.defineClass({name:"NullMoveHandler",ctor:r,statics:{instance:{get:function(){return void 0===a.instance&&(a.instance=new r),a.instance}},_implements:function(e){return"IMoveHandler"==e}},props:{beginMove:function(e){},updateMove:function(e,t,n){},endMove:function(e){}}}),r),i.StandardMoveHandler=(o=function(e,t){this.formaUnderMove=null,this.lastAppliedTotalDelta=u.TheoPoint.ZERO,this.moveUA=null,this.dc=e,this.delegate=t},s.defineClass({name:"StandardMoveHandler",ctor:o,statics:{_implements:function(e){return"IMoveHandler"==e}},props:{beginMove:function(e){this.lastAppliedTotalDelta=u.TheoPoint.ZERO},updateMove:function(e,t,n){var r=this;null==this.moveUA?t.isEqual(u.TheoPoint.ZERO)||(this.moveUA=d.UserActions.MoveItem(),this.formaUnderMove=s.opt(this.dc,function(e){return e.selection.formaAt(0)}),s.opt(this.dc,function(a){return a.undoRedoMgr.beginUserAction(r.moveUA,function(){return r.applyMove(e,t,n)})})):this.applyMove(e,t,n)},endMove:function(e){s.opt(this.dc,function(e){return e.model.beginUpdates()}),s.opt(this.dc,function(e){return e.model.setSnaplines([])}),s.opt(this.dc,function(e){return e.model.updatesComplete()}),null!=this.moveUA&&(this.moveUA=null,s.opt(this.dc,function(e){return e.undoRedoMgr.endUserAction(function(){})}))},applyMove:function(e,t,n){var r=this.lastAppliedTotalDelta;if(!t.isEqual(this.lastAppliedTotalDelta)){var a=u._minus_TheoPoint_TheoPoint(t,this.lastAppliedTotalDelta);this.lastAppliedTotalDelta=t,c.TransformFacade.transformFormaeInPageSpaceAboutPoint([this.formaUnderMove],l.Matrix2D.translation(new u.TheoPoint(a.x,a.y)),e.placement.transformPoint(e.bounds.center))}var o,i,d=s.opt(this.formaUnderMove.controller,function(e){return e.setSnappedPlacement(null,8/n,!1)}),f=[];if((o=s.opt(d,function(e){return e.snapLines}))&&(f=s.clone(o)),i=s.opt(d,function(e){return e.movement})){var h=i.transformValues;this.lastAppliedTotalDelta=this.lastAppliedTotalDelta.add(new u.TheoPoint(h.tx,h.ty))}s.opt(this.dc,function(e){return e.model.beginUpdates()}),s.opt(this.dc,function(e){return e.model.setSnaplines(s.clone(f))}),r!=this.lastAppliedTotalDelta&&s.opt(this.delegate,function(e){return e.handles.updateHandles()}),s.opt(this.dc,function(e){return e.model.updatesComplete()})}}}),o)},342:function(e,t,n){var r,a,o,i=t,s=n(0),l=n(9),c=n(124),u=n(15),d=n(31);i.IRotateHandler=s.defineProtocol("IRotateHandler",{beginRotate:"(BoxReference) -> Void",updateRotate:"(BoxReference, Double) -> Void",endRotate:"(BoxReference) -> Void"}),i.NullRotateHandler=(r=function(){},a={},s.defineClass({name:"NullRotateHandler",ctor:r,statics:{instance:{get:function(){return void 0===a.instance&&(a.instance=new r),a.instance}},_implements:function(e){return"IRotateHandler"==e}},props:{beginRotate:function(e){},updateRotate:function(e,t){},endRotate:function(e){}}}),r),i.StandardRotateHandler=(o=function(e,t){this.formaUnderRotation=null,this.lastAppliedTotalDeltaRadians=0,this.rotateUA=null,this.dc=e,this.delegate=t},s.defineClass({name:"StandardRotateHandler",ctor:o,statics:{_implements:function(e){return"IRotateHandler"==e}},props:{beginRotate:function(e){this.lastAppliedTotalDeltaRadians=0},updateRotate:function(e,t){var n=this;null==this.rotateUA?Math.abs(t)>0&&(this.rotateUA=d.UserActions.AdjustRotation(),this.formaUnderRotation=s.opt(this.dc,function(e){return e.selection.formaAt(0)}),s.opt(this.dc,function(r){return r.undoRedoMgr.beginUserAction(n.rotateUA,function(){return n.applyRotation(e,t)})})):this.applyRotation(e,t)},endRotate:function(e){s.opt(this.dc,function(e){return e.model.beginUpdates()}),s.opt(this.dc,function(e){return e.model.setSnaplines([])}),s.opt(this.dc,function(e){return e.model.updatesComplete()}),null!=this.rotateUA&&(this.rotateUA=null,s.opt(this.dc,function(e){return e.undoRedoMgr.endUserAction(function(){})}))},applyRotation:function(e,t){var n=this.lastAppliedTotalDeltaRadians;if(t!=this.lastAppliedTotalDeltaRadians){var r=t-this.lastAppliedTotalDeltaRadians;this.lastAppliedTotalDeltaRadians=t,c.TransformFacade.transformFormaeInPageSpaceAboutPoint([this.formaUnderRotation],l.Matrix2D.rotation(Math.cos(r),Math.sin(r)),e.placement.transformPoint(e.bounds.center))}var a,o,i=s.opt(this.formaUnderRotation.controller,function(e){return e.setSnappedPlacement(new u.TheoPoint(.5,.5),20,!1)}),d=[];if((a=s.opt(i,function(e){return e.snapLines}))&&(d=s.clone(a)),o=s.opt(i,function(e){return e.movement})){var f=o.transformValues;this.lastAppliedTotalDeltaRadians+=Math.atan2(f.rotSine,f.rotCosine)}s.opt(this.dc,function(e){return e.model.beginUpdates()}),s.opt(this.dc,function(e){return e.model.setSnaplines(s.clone(d))}),n!=this.lastAppliedTotalDeltaRadians&&s.opt(this.delegate,function(e){return e.handles.updateHandles()}),s.opt(this.dc,function(e){return e.model.updatesComplete()})}}}),o)},437:function(e,t,n){var r,a=t,o=n(0),i=n(1),s=n(161),l=n(9),c=n(15),u=n(10);a.BadgeLayoutController=(r=function(e,t){void 0===t&&(t=!0),this._formae=o.clone(e),this._usePerceivedBounds=t},o.defineClass({name:"BadgeLayoutController",ctor:r,props:{update:function(){if(0!=this._formae.length){var e=this._formae[0],t=e.page.root,n=u.TheoRect.Zero;if(this._usePerceivedBounds){var r=this._formae.map(function(e){return e.controller.getUserPerceivedFrame()},this);n=r.reduce(function(e,t){return e.unionWith(t)},r[0])}else n=this._formae.reduce(function(e,t){return e.unionWith(t.finalFrame)},e.finalFrame);var a=new s.FormaPlacementSuggester(e,t),d=o.clone(a.createPlacementSuggestions(!0,n.aspectRatio));if(0==!d.length)for(var f=d[0].location,h=f.height/n.height,p=l.Matrix2D.translation(f.origin),m=o.iter(this._formae);!m.done;m.next()){var g=m.value;g.bounds=g.bounds.scale(h,c.TheoPoint.ZERO);var v=g.totalPlacement,S=(v.tx-n.minX)*h,T=(v.ty-n.minY)*h;g.placement=new l.Matrix2D(v.a,v.b,v.c,v.d,S,T).concat(p)}else i.CoreAssert.warning("Did not find a placement suggestion for badge.")}}}}),r)},458:function(e,t,n){var r,a,o=t,i=n(0),s=n(11),l=n(29),c=n(168),u=n(17),d=n(9),f=n(14);o.StandardHandleGenerator=(r=function(){},a={},i.defineClass({name:"StandardHandleGenerator",ctor:r,statics:{instance:{get:function(){return void 0===a.instance&&(a.instance=new r),a.instance}},_implements:function(e){return"IHandleGenerator"==e}},props:{addHandles:function(e){var t;return(t=i.opt(e.dc,function(e){return e.selection.asFormaArray()}))?0==t.length?this.handleNoSelectionCase(e):e.dc.selection.inCharStyleMode?this.handleCharStyleSelectionCase(e,i.clone(t)):1==t.length?this.handleSingleSelectionCase(e,t[0]):this.handleMultiSelectionCase(e,i.clone(t)):[]},handleNoSelectionCase:function(e){return[]},handleSingleSelectionCase:function(e,t){var n,r,a=[],o=[],d=[];if(r=t.controller){r.moveable&&(o.push(c.TransformType.Translate),t.isShape()&&!t.hasIntent(s.Forma.INTENT_ICON)||d.push(c.BoxHandleDisplayHint.ThinOutline));var h,p=!(!(n=i.opt(r.owner,function(e){return e.selection.inSpacingMode}))&&null==n)&&n;t.isTypeLockup()&&(d.push(c.BoxHandleDisplayHint.TextFrame),(h=i.as(t.controller,f.TypeLockupController))&&(h.text.length>300&&d.push(c.BoxHandleDisplayHint.SuppressResizeAnimation),u.LockupStyle.isKnockoutLook(h.lockupStyle.textLook)&&d.push(c.BoxHandleDisplayHint.SuppressResizeAnimation))),r.rotateable&&!p&&(o.push(c.TransformType.RotateAboutCenter),t instanceof l.FrameForma&&!r.moveable&&d.push(c.BoxHandleDisplayHint.SuppressRotationHandle)),r.moveable&&!t.isGridCell()&&(o.push(c.TransformType.TopLeftCornerTranslate),t.isTypeLockup()&&p?(o.push(c.TransformType.LetterSpacing),o.push(c.TransformType.LineSpacing)):(o.push(c.TransformType.TopRightCornerTranslate),o.push(c.TransformType.BottomLeftCornerTranslate),o.push(c.TransformType.BottomRightCornerTranslate)));for(var m=i.iter(r.visibleSelectionHandlePositions);!m.done;m.next()){var g=m.value;.5==g.x?0==g.y?o.push(c.TransformType.TopSideTranslate):o.push(c.TransformType.BottomSideTranslate):.5==g.y&&(0==g.x?o.push(c.TransformType.LeftSideTranslate):o.push(c.TransformType.RightSideTranslate))}}return a.push(new c.BoxTransformHandles(new c.BoxReference(t.totalPlacement,t.bounds),i.clone(o),i.clone(d),e.activeTransform,t.formaID)),a},handleMultiSelectionCase:function(e,t){var n=[],r=[];r.push(c.BoxHandleDisplayHint.ThinOutline);for(var a=[],o=null,s=i.iter(t);!s.done;s.next()){var l=s.value;a.push(l.formaID),o=null==o?l.finalFrame:o.unionWith(l.finalFrame)}return i.sortInPlace(a),null==o?[]:(n.push(new c.BoxTransformMultipleFormae(new c.BoxReference(d.Matrix2D.Identity,o),[c.TransformType.Translate],i.clone(r),e.activeTransform,a.reduce(function(e,t){return e+"/"+t},""),i.clone(a))),n)},handleCharStyleSelectionCase:function(e,t){return[]}}}),r)},459:function(e,t,n){var r,a,o=t,i=n(0),s=n(82),l=n(168),c=n(15);o.StandardHandleProcessor=(r=function(){},a={},i.defineClass({name:"StandardHandleProcessor",ctor:r,statics:{instance:{get:function(){return void 0===a.instance&&(a.instance=new r),a.instance}},_implements:function(e){return"IHandleProcessor"==e}},props:{handleTransformEvent:function(e,t){var n,r,a,o,s;if(n=i.as(t.handle,l.BoxTransformHandles))if(r=i.as(t,l.MoveTransformEvent))switch(r.stage){case 0:e.activeTransform=l.TransformType.Translate,i.opt(e.delegate,function(e){return e.move.beginMove(n.reference)}),e.updateHandles();break;case 1:i.opt(e.delegate,function(e){return e.move.updateMove(n.reference,r.totalDelta,r.viewportScale)});break;case 2:e.activeTransform=l.TransformType.None,i.opt(e.delegate,function(e){return e.move.endMove(n.reference)}),e.updateHandles()}else if(a=i.as(t,l.RotateAboutCenterTransformEvent))switch(a.stage){case 0:e.activeTransform=l.TransformType.RotateAboutCenter,i.opt(e.delegate,function(e){return e.rotate.beginRotate(n.reference)}),e.updateHandles();break;case 1:i.opt(e.delegate,function(e){return e.rotate.updateRotate(n.reference,a.totalDeltaRadians)});break;case 2:e.activeTransform=l.TransformType.None,i.opt(e.delegate,function(e){return e.rotate.endRotate(n.reference)}),e.updateHandles()}else if(o=i.as(t,l.CornerTranslateTransformEvent)){var c=this.canonicalPointForTransformType(o.transformType);switch(o.stage){case 0:e.activeTransform=o.transformType,i.opt(e.delegate,function(e){return e.resize.handleBeginSelectionBoxResize(n.reference,c)}),e.updateHandles();break;case 1:i.opt(e.delegate,function(e){return e.resize.handleSelectionBoxResize(n.reference,c,o.position,o.viewportScale)});break;case 2:e.activeTransform=l.TransformType.None,i.opt(e.delegate,function(e){return e.resize.handleEndSelectionBoxResize(n.reference,c)}),e.updateHandles()}}else if(s=i.as(t,l.SideTranslateTransformEvent))switch(c=this.canonicalPointForTransformType(s.transformType),s.stage){case 0:e.activeTransform=s.transformType,i.opt(e.delegate,function(e){return e.resize.handleBeginSelectionBoxResize(n.reference,c)}),e.updateHandles();break;case 1:i.opt(e.delegate,function(e){return e.resize.handleSelectionBoxResize(n.reference,c,s.position,s.viewportScale)});break;case 2:e.activeTransform=l.TransformType.None,i.opt(e.delegate,function(e){return e.resize.handleEndSelectionBoxResize(n.reference,c)}),e.updateHandles()}return!0},handleFormaDragEvents:function(e,t){return t instanceof s.BeginFormaDragEvent&&(e.activeTransform=l.TransformType.Translate,e.updateHandles()),i.opt(e.delegate,function(e){return e.drag.handleFormaDragEvents(t)}),t instanceof s.EndFormaDragEvent&&(e.activeTransform=l.TransformType.None,e.updateHandles()),!0},canonicalPointForTransformType:function(e){switch(e){case 4:return new c.TheoPoint(0,0);case 5:return new c.TheoPoint(1,0);case 6:return new c.TheoPoint(0,1);case 7:return new c.TheoPoint(1,1);case 10:return new c.TheoPoint(.5,0);case 11:return new c.TheoPoint(.5,1);case 8:return new c.TheoPoint(0,.5);case 9:case 12:return new c.TheoPoint(1,.5);case 13:return new c.TheoPoint(.5,1);default:return c.TheoPoint.ZERO}}}}),r)},460:function(e,t,n){var r,a=t,o=n(0),i=n(168),s=n(9);a.SwapModeHandleGenerator=(r=function(){this.swapTarget=null},o.defineClass({name:"SwapModeHandleGenerator",ctor:r,statics:{_implements:function(e){return"IHandleGenerator"==e}},props:{setSwapTargetForma:function(e){this.swapTarget=e},clearSwapTargetForma:function(){this.swapTarget=null},addHandles:function(e){var t=null;return null!=this.swapTarget&&(t=this.swapTarget.finalFrame),null==t?[]:[new i.BoxTransformHandles(new i.BoxReference(s.Matrix2D.Identity,t),[i.TransformType.Translate],[],i.TransformType.None,o.toString(e.handlerInstanceID))]}}}),r)},462:function(e,t,n){var r,a=t,o=n(0),i=n(1),s=n(463),l=n(135),c=n(464),u=n(465),d=n(466);a.DesignControllerFactory=(r=function(){},o.defineClass({name:"DesignControllerFactory",ctor:r,props:{getNewDesignController:function(){var e,t;return(t=this.owner)?e=0==t.selection.selectedCount?new u.NoSelectionDesignController(t):t.selection.inCharStyleMode?new s.CharStyleModeDesignController(t):1==t.selection.selectedCountInDocument?new d.SingleSelectionDesignController(t):new c.MultiSelectionDesignController(t):(i.CoreAssert.fail("owner has gone out of scope, yet we are still asking to create design controllers"),e=new l.DesignController),e}}}),r)},463:function(e,t,n){var r,a=t,o=n(0),i=n(157),s=n(158),l=n(166),c=n(135),u=n(167),d=n(169),f=n(140);a.CharStyleModeDesignController=(r=function(e){this.dc=e,c.DesignController.call(this),this.handles=new f.BaseHandlesHandler(e,this),this.drag=new u.DragFacadeBasedDragHandler(e,this),this.click=new l.StandardClickHandler(e),this.actions=new i.StandardActionHandler(e),this.attributes=new s.StandardAttributesHandler(e),this.featureSets=new d.StandardFeatureSetHandler(e)},o.defineClass({name:"CharStyleModeDesignController",ctor:r,superName:"DesignController"}),r)},464:function(e,t,n){var r,a=t,o=n(0),i=n(157),s=n(158),l=n(166),c=n(135),u=n(167),d=n(169),f=n(140),h=n(207);a.MultiSelectionDesignController=(r=function(e){this.dc=e,c.DesignController.call(this),this.handles=new f.StandardHandlesHandler(e,this),this.drag=new u.MultiObjectDragHandler(e,this),this.click=new l.StandardClickHandler(e),this.resize=h.NullResizeHandler.instance,this.actions=new i.StandardActionHandler(e),this.attributes=new s.StandardAttributesHandler(e),this.featureSets=new d.StandardFeatureSetHandler(e)},o.defineClass({name:"MultiSelectionDesignController",ctor:r,superName:"DesignController"}),r)},465:function(e,t,n){var r,a=t,o=n(0),i=n(157),s=n(158),l=n(166),c=n(135),u=n(167),d=n(169),f=n(140),h=n(207);a.NoSelectionDesignController=(r=function(e){this.dc=e,c.DesignController.call(this),this.handles=new f.StandardHandlesHandler(e,this),this.drag=new u.DragFacadeBasedDragHandler(e,this),this.click=new l.StandardClickHandler(e),this.resize=h.NullResizeHandler.instance,this.actions=new i.StandardActionHandler(e),this.attributes=new s.StandardAttributesHandler(e),this.featureSets=new d.StandardFeatureSetHandler(e)},o.defineClass({name:"NoSelectionDesignController",ctor:r,superName:"DesignController"}),r)},466:function(e,t,n){var r,a=t,o=n(0),i=n(157),s=n(158),l=n(166),c=n(135),u=n(167),d=n(169),f=n(140),h=n(341),p=n(207),m=n(342);a.SingleSelectionDesignController=(r=function(e){this.dc=e,c.DesignController.call(this),this.handles=new f.StandardHandlesHandler(e,this),this.drag=new u.DragFacadeBasedDragHandler(e,this),this.click=new l.StandardClickHandler(e),this.resize=new p.SingleItemResizeHandler(e,e.selection.formaAt(0),this),this.move=new h.StandardMoveHandler(e,this),this.rotate=new m.StandardRotateHandler(e,this),this.actions=new i.StandardActionHandler(e),this.attributes=new s.StandardAttributesHandler(e),this.featureSets=new d.StandardFeatureSetHandler(e)},o.defineClass({name:"SingleSelectionDesignController",ctor:r,superName:"DesignController"}),r)},468:function(e,t,n){var r,a=t,o=n(0),i=n(4),s=n(11),l=n(25),c=n(43),u=n(122),d=n(92),f=n(14),h=n(15);a.ResizeLayoutController=o.defineProtocol("ResizeLayoutController",{beginUpdateGroup:"() -> Void",updateGroup:"() -> Void",endUpdateGroup:"() -> Void"}),a.PinLayoutController=(r=function(e){this.formaToUpdate_=[],this.inferredGroups_=null,this.group_=e,i.CoreObject.call(this)},o.defineClass({name:"PinLayoutController",ctor:r,superName:"CoreObject",statics:{_implements:function(e){return"ResizeLayoutController"==e}},props:{beginUpdateGroup:function(){if(this.oldBounds_=this.group_.bounds,o.as(o.opt(this.group_.root,function(e){return e.controller}),d.RootController)&&!this.group_.hasIntent(s.Forma.INTENT_INFERRED_TEMP_GROUP)){var e=o.clone(u.GroupDetector.createOverlapGroups(this.group_));if(e.length>0){this.inferredGroups_=[];for(var t=o.iter(e);!t.done;t.next()){var n=t.value;this.inferredGroups_.push(n)}o.opt(o.as(this.group_.controller,l.GridController),function(e){return e.inferGridCellAssignment()})}}this.formaToUpdate_=[];for(var r=o.iter(this.group_.visitAsArray(s.FormaTraversal.JustChildren));!r.done;r.next()){var a,i=r.value;(a=o.as(i.controller,c.GroupController))&&a.beginUpdateGroup();var f=o.opt(i.controller,function(e){return e.getPin(!0)});null==f||f.isRelativePin?this.formaToUpdate_.push({forma:i,pin:f}):this.formaToUpdate_.splice(0,0,{forma:i,pin:f})}},updateGroup:function(){if(null!=this.oldBounds_){for(var e=this.oldBounds_.size,t=this.group_.bounds.size,n=new h.TheoPoint(t.width/e.width,t.height/e.height),r=o.iter(this.formaToUpdate_);!r.done;r.next()){var a;if((a=(v=r.value).forma.frame)&&a.area>0){var i=v.forma,s=i.placement.transformValues,l=Math.abs(s.rotCosine)/(Math.abs(s.rotCosine)+Math.abs(s.rotSine)),c=Math.abs(s.rotSine)/(Math.abs(s.rotCosine)+Math.abs(s.rotSine)),u=new h.TheoPoint(n.x*l+n.y*c,n.x*c+n.y*l);if((g=o.as(i.controller,f.TypeLockupController))&&g.addLineBreakConstraints(),null!=i.controller&&i.controller.maintainAspectRatio){var d=Math.min(u.x,u.y);i.bounds=o.opt(i.bounds,function(e){return e.scaleXY(d,d,new h.TheoPoint(0,0))})}else i.bounds=o.opt(i.bounds,function(e){return e.scaleXY(u.x,u.y,new h.TheoPoint(0,0))});i.moveCenterToPoint(new h.TheoPoint(a.center.x*n.x,a.center.y*n.y))}}for(var p=o.iter(this.formaToUpdate_);!p.done;p.next()){var m,g,v=p.value;(m=v.pin)&&(o.opt(v.forma.controller,function(e){return e.matchPreviousPin(m)}),(g=o.as(v.forma.controller,f.TypeLockupController))&&g.removeLineBreakConstraints())}}},endUpdateGroup:function(){for(var e=o.iter(this.group_.visitAsArray(s.FormaTraversal.JustChildren));!e.done;e.next()){var t=e.value;if(t.hasIntent(s.Forma.INTENT_INFERRED_TEMP_GROUP)&&null!=this.inferredGroups_&&this.inferredGroups_.includes(t)){for(var n=o.iter(t.visitAsArray(s.FormaTraversal.JustChildren));!n.done;n.next()){var r=n.value;this.group_.appendChild(r,!0)}t.removeFromParent(),o.opt(o.as(this.group_.controller,l.GridController),function(e){return e.inferGridCellAssignment()}),o.remove(this.inferredGroups_,t)}}}}}),r)},469:function(e,t,n){var r,a,o=t,i=n(0),s=n(49),l=n(1),c=n(4),u=n(11),d=n(8),f=n(21),h=n(17),p=n(9),m=n(14),g=n(94),v=n(15),S=n(10),T=n(28),C=n(250);o.SpringConstraint=(r=function(e,t,n,r,a,o,i){this.nodeA=e,this.nodeB=t,this.pinA=n,this.pinB=r,this.vertical=a,this.length=o,this.stiffness=i,this.oldLengthDebug=0,this.oldStiffnessDebug=0,this.proportional=!1},i.defineClass({name:"SpringConstraint",ctor:r}),r),o.SpringLayoutController=(a=function(e){this.parentNode_=null,this.springConstraints_={},this.debugPrint_=!1,this.STRONG_STIFF=9e4,this.STRUT_STIFF=9e7,this.ITERATION_STEP_SIZE=50,this.SPACER_UPDATE_THRESHOLD=50,this.LOGISTIC_L_SCALE=1e3,this.LOGISTIC_K_SCALE=.01,this.LOGISTIC_X_SCALE=100,this.LOGISTIC_B_SCALE=1,this.SPACER_LOGISTIC_L=.5,this.SPACER_LOGISTIC_K=1,this.SPACER_LOGISTIC_X=0,this.SPACER_LOGISTIC_B=10,this.NODE_LOGISTIC_L=1,this.NODE_LOGISTIC_K=.5,this.NODE_LOGISTIC_X=0,this.NODE_LOGISTIC_B=1,this.group_=e,c.CoreObject.call(this)},i.defineClass({name:"SpringLayoutController",ctor:a,superName:"CoreObject",statics:{_implements:function(e){return"ResizeLayoutController"==e}},props:{beginUpdateGroup:function(){if(this.oldBounds_=this.group_.bounds,null!=this.oldBounds_){var e=i.clone(this.group_.filterWithCallback(function(e){return null!=e.controller&&!e.isGridCell()&&e.kind!=f.ImageForma.KIND&&e.frame.area>1},u.FormaTraversal.JustChildren));this.parentNode_=new C.VisualStructureDetector(i.clone(e),this.group_).inferVisualStructure();for(var t=i.iter(this.group_.filterWithCallback(function(e){return e.isTypeLockup()}));!t.done;t.next()){var n,r=t.value;(n=i.as(r.controller,m.TypeLockupController))&&n.addLineBreakConstraints()}}},endUpdateGroup:function(){for(var e=i.iter(this.group_.filterWithCallback(function(e){return e.isTypeLockup()}));!e.done;e.next()){var t,n=e.value;(t=i.as(n.controller,m.TypeLockupController))&&t.removeLineBreakConstraints()}},updateGroup:function(){var e,t,n;(e=this.oldBounds_)&&(t=this.group_.bounds)&&(n=this.solveSpringSystem(e,t))&&this.updateFormaFromStructure(n)},solveSpringSystem:function(e,t){if(null==this.parentNode_)return null;var n={};n[this.parentNode_.id]=this.parentNode_;for(var r=i.iter(this.parentNode_.descendents);!r.done;r.next()){var a=r.value;n[a.id]=a}var o=this.parentNode_.clone();this.createSpringConstraints(o),this.updateAllConstraints(o,!1);var s=[o];i.append(s,o.descendents);for(var c=i.clone(this.getForegroundLeafs(o)),u=o.frame.scaleXY(t.width/e.width,t.height/e.height,v.TheoPoint.ZERO),d=i.toInt(Math.ceil(Math.max(Math.abs(u.height-o.frame.height),Math.abs(u.width-o.frame.width))/this.ITERATION_STEP_SIZE)+1),f=i.iter(i.range(0,d,!1));!f.done;f.next()){var h=f.value;this.debugPrint_&&(i.info("\n-----------------\niteration: "+h+"\n"),this.printNodes(o),i.info("\n")),o.frame=u;for(var p=h>=d-1,m=i.iter(s);!m.done;m.next()){var g,T,H,A=m.value;if((g=A.frame)&&(T=i.as(A,C.VisualNodeGroup))&&(H=this.springConstraints_[T.id])){l.CoreAssert.isTrue(null!=n[A.origNode.id]),this.debugPrint_&&i.info("node:"+A.description+" oldFrame: "+n[A.origNode.id].frame.asIntString);for(var F=i.iter(H);!F.done;F.next()){var D=F.value,b=D[0].vertical,y=b?g.height:g.width,w=b?T.frame.minY:T.frame.minX,x=this.adjustSpringSet(i.clone(D),y,w,p,o);T.frame=b?new S.TheoRect(g.minX,g.minY,g.maxX,g.minY+x):new S.TheoRect(g.minX,g.minY,g.minX+x,g.maxY),this.setSpringStiffnesses(T,i.clone(D),i.clone(c),this.debugPrint_),this.adjustSpringsToMatchOldSize(i.clone(D),i.clone(n))&&this.setSpringStiffnesses(T,i.clone(D),i.clone(c))}}}}return this.debugPrint_&&(i.info("\n -----------------------------\n  after resize: "),this.printNodes(o)),o},adjustSpringSet:function(e,t,n,r,a){if(e.length<1)return 0;for(var o=e[0].vertical,s=0,l=0,c=i.iter(e);!c.done;c.next())s+=(T=c.value).length,l+=1/((T.proportional?1:T.stiffness)*(t/T.length));var u=t-s,f=1/l,h=u;Math.abs(u)>this.ITERATION_STEP_SIZE&&!r&&(h=u<0?-1*this.ITERATION_STEP_SIZE:this.ITERATION_STEP_SIZE);var m=f*h;this.debugPrint_&&i.info("  constraint set: "+(o?"vert":"horiz")+"  desiredL "+Math.round(t)+" currL "+Math.round(s)+" totalD "+Math.round(u)+"  currD "+Math.round(h));for(var g=0,v=i.iter(i.range(0,e.length,!1));!v.done;v.next()){var T,C=v.value;(T=e[C]).oldLengthDebug=T.length,T.oldStiffnessDebug=T.stiffness;var H=m/((T.proportional?1:T.stiffness)*(t/T.length));isNaN(H)&&(i.opt(d.Host.logging,function(e){return e.error("nan update")}),H=0);var A=Math.max(0,T.length+H);if(T.nodeA==T.nodeB){var F=T.nodeA,D=F.frame.aspectRatio,b=n+g;if(F.frame=o?new S.TheoRect(F.frame.minX,b,F.frame.maxX,b+A):new S.TheoRect(b,F.frame.minY,b+A,F.frame.maxY),F.maintainAspectRatio&&!T.proportional&&F.parent!=a){var y=S.TheoRect.fromSize(F.frame.fitAspectRatioWithin(D));if(y.height>15){var w=this.getParentChildPin(F.frame,F.parent.frame),x=p.Matrix2D.translation(F.frame.eval(w).subtract(y.eval(w)));y=y.transform(x);var _=o?F.frame.height-y.height:F.frame.width-y.width;F.frame=y;var P=T.vertical?w.y:w.x;.5==P?(e[C-1].length+=_/2,e[C+1].length+=_/2):0==P?e[C+1].length+=_:1==P&&(e[C-1].length+=_),A=o?y.height:y.width}}}T.length=A,g+=A}return g},adjustSpringsToMatchOldSize:function(e,t){for(var n=!1,r=i.iter(i.range(1,e.length-1,!1));!r.done;r.next()){var a=r.value,o=e[a];if(o.nodeA==o.nodeB&&!o.proportional){var s=o.nodeA,l=t[s.origNode.id].frame,c=s.frame;if(l.area-c.area>0){var u=e[a-1],d=e[a+1],f=.2*Math.max(u.length,d.length);if(f<10)continue;var h=o.vertical?c.height:c.width,p=l.area/(o.vertical?c.width:c.height)-h;Math.abs(p)>f&&(p=p<0?-1*f:f);var m=1/(1/u.stiffness+1/o.stiffness+1/d.stiffness)*p,g=m/u.stiffness,v=u.length;u.length-g>this.SPACER_UPDATE_THRESHOLD&&(u.length=Math.max(1e-4,u.length-g));var S=m/d.stiffness,T=d.length;d.length-S>this.SPACER_UPDATE_THRESHOLD&&(d.length=Math.max(1e-4,d.length-S));var C=o.length;o.length=o.length+(v-u.length)+(T-d.length),n=n||Math.abs(C-o.length)>0}}}return n},createSpringConstraints:function(e){this.springConstraints_={};for(var t=i.clone(this.getForegroundLeafs(e)),n=[e];n.length>0;){var r,a=n[0];n.splice(0,1),(r=i.as(a,C.VisualNodeGroup))&&(this.springConstraints_[r.id]=this.createSpringConstraintsForGroup(r,!1,i.clone(t)).concat(this.createSpringConstraintsForGroup(r,!0,i.clone(t))),n=r.children.concat(n))}},updateAllConstraints:function(e,t){void 0===e&&(e=null),void 0===t&&(t=!1);for(var n=null!=e?e:this.parentNode_,r=[n],a=i.clone(this.getForegroundLeafs(n));r.length>0;){var o,s,l=r[0];if(r.splice(0,1),(o=i.as(l,C.VisualNodeGroup))&&(s=this.springConstraints_[o.id])){for(var c=i.iter(s);!c.done;c.next()){var u=c.value;this.setSpringStiffnesses(o,i.clone(u),i.clone(a),t)}r=o.children.concat(r)}}},printNodes:function(e){for(var t=[e],n=[];t.length>0;){var r,a=t[0];if(t.splice(0,1),(S=i.as(a,C.VisualNodeGroup))&&(r=this.springConstraints_[S.id])){for(var o=i.iter(r);!o.done;o.next())for(var s=o.value,l=i.iter(s);!l.done;l.next()){var c=l.value;if(c.nodeA==c.nodeB){var u=this.getNodeStiffness(c.nodeA,c.vertical);n.push({node:c.nodeA,vertical:c.vertical,stiffness:u})}}t=S.children.concat(t)}}for(var d=[],f={},h=i.iter(n);!h.done;h.next())if(u=h.value,!d.includes(u.node)){for(var p="",m=(a=u.node).parent;null!=m;)m=i.opt(m,function(e){return e.parent}),p+="\t";p+="node: "+a.description;for(var g=i.iter(n);!g.done;g.next()){var v=g.value;v.node==a&&(p+=(v.vertical?" v: ":" h: ")+i.toString(Math.round(v.stiffness)))}f[a.shortID]=p,d.push(a)}for(t=[e];t.length>0;){var S,T;a=t[0],t.splice(0,1),(S=i.as(a,C.VisualNodeGroup))&&(t=S.children.concat(t)),this.debugPrint_&&null!=(T=f[a.shortID])&&i.info(T)}},setConstraintsOnNode:function(e,t,n,r,a){var o,s=a?e.frame.minY:e.frame.minX,l=(a?e.frame.maxY:e.frame.maxX)-s,c=a?t.frame.minY:t.frame.minX,u=(a?t.frame.maxY:t.frame.maxX)-c,d=!1,f=!1,h=!1;n<.1*l&&(d=!0),r<.1*l&&(f=!0),(o=i.as(t,C.VisualNodeLeaf))&&(o.forma.isTypeLockup()?u>.66*l&&(d=!0,f=!0):Math.abs(n-r)<=1&&n<.25*l&&(d=!0,f=!0)),d&&f||(h=!0),a?(t.constraintBottom=d,t.constraintTop=f,t.constraintHeight=h):(t.constraintLeft=d,t.constraintRight=f,t.constraintWidth=h)},getContextualSpacerLength:function(e,t,n){var r,a=e.vertical,o=e.nodeA==t?e.nodeB:e.nodeA,s=e.length,c=!1,u=[];(h=i.as(o,C.VisualNodeLeaf))&&(c=h.hasForegroundRole,u=[h]),(r=i.as(o,C.VisualNodeGroup))&&(c=(u=i.clone(this.getForegroundLeafs(r))).length>0);for(var d=n.concat(),f=i.iter(u);!f.done;f.next()){var h=f.value;d.includes(h)&&i.remove(d,h)}if(c){var p=S.TheoRect.Zero;if(a){var m=e.nodeA.frame.horizontalLine(e.pinA).p1.y,g=e.nodeB.frame.horizontalLine(e.pinB).p1.y;p=new S.TheoRect(o.frame.minX,m,o.frame.maxX,g)}else{var v=e.nodeA.frame.verticalLine(e.pinA).p1.x,T=e.nodeB.frame.verticalLine(e.pinB).p1.x;p=new S.TheoRect(v,o.frame.minY,T,o.frame.maxY)}for(var H=i.iter(d);!H.done;H.next()){h=H.value,l.CoreAssert.isTrue(o!=h);for(var A,F=!1,D=i.iter(u);!D.done;D.next()){var b=D.value;(h.forma.finalFrame.xDistance(b.forma.finalFrame)<=0&&!a||h.forma.finalFrame.yDistance(b.forma.finalFrame)<=0&&a)&&(F=!0)}F||(A=i.opt(h.frame,function(e){return e.intersectionWith(p)}))&&(s=Math.min(s,A.L1Distance(o.frame)))}}return s},setSpringStiffnesses:function(e,t,n,r){if(void 0===r&&(r=!1),0!=t.length){var a=t[0].vertical,o=a?e.frame.minY:e.frame.minX,s=(a?e.frame.maxY:e.frame.maxX)-o;if(3==t.length){l.CoreAssert.isTrue(t[1].nodeA==t[1].nodeB);var c=t[1].nodeA,u=this.getContextualSpacerLength(t[0],e,i.clone(n)),f=this.getContextualSpacerLength(t[2],e,i.clone(n));c.resetConstraints(a),c instanceof C.VisualNodeLeaf&&this.setConstraintsOnNode(e,c,u,f,a);var h=a?c.constraintBottom:c.constraintLeft,p=a?c.constraintHeight:c.constraintWidth,m=a?c.constraintTop:c.constraintRight;t[0].stiffness=h?this.STRONG_STIFF:this.getSpacerStiffness(u,s,a),t[1].stiffness=p?this.STRONG_STIFF:this.getNodeStiffness(c,a),t[2].stiffness=m?this.STRONG_STIFF:this.getSpacerStiffness(f,s,a),(0==t[0].stiffness||isNaN(t[0].stiffness)||0==t[1].stiffness||isNaN(t[1].stiffness)||0==t[2].stiffness||isNaN(t[2].stiffness))&&i.opt(d.Host.logging,function(e){return e.error("error in spring stiffness")})}else for(var g=i.iter(t);!g.done;g.next())(H=g.value).nodeA==H.nodeB?H.stiffness=this.getNodeStiffness(H.nodeA,H.vertical):H.stiffness=this.getSpacerStiffness(H.length,s,H.vertical),(0==H.stiffness||isNaN(H.stiffness))&&i.opt(d.Host.logging,function(e){return e.error("error in spring stiffness")});for(var v=i.iter(t);!v.done;v.next())(H=v.value).length<1&&(H.stiffness=this.STRUT_STIFF);for(var S=!1,T=i.iter(t);!T.done;T.next()){var H=T.value;Math.abs(H.oldLengthDebug-H.length)>1&&(S=r)}if(S)for(var A=i.iter(t);!A.done;A.next()){var F=A.value,D=F.vertical?"vert":"horiz";i.info("\t A:"+F.nodeA.shortID+" B:"+F.nodeB.shortID+" "+D+" oldK:"+Math.round(F.oldStiffnessDebug)+"  newK:"+Math.round(F.stiffness)+" oldL:"+Math.round(F.oldLengthDebug)+"  newL:"+Math.round(F.length)+"  ")}}},createFlowSpringConstraints:function(e,t){l.CoreAssert.isTrue(e.children.length>1);var n=t?e.frame.minY:e.frame.minX,r=t?e.frame.maxY:e.frame.maxX,a=r-n,s=i.sort(e.children,function(e,n){return t?e.frame.minY<n.frame.minY:e.frame.minX<n.frame.minX}),c=[],u=t?s[0].frame.minY:s[0].frame.minX,d=(H=t?s[s.length-1].frame.maxY:s[s.length-1].frame.maxX)-u,f=Math.max(u-n,0),h=Math.max(r-H,0),p=Math.max(n-u,0)/d,m=Math.max(H-r,0)/d;c.push(new o.SpringConstraint(e,s[0],0,p,t,f,this.getSpacerStiffness(f,a,t)));for(var g=!1,v=i.iter(i.range(0,s.length,!1));!v.done;v.next()){var S=v.value;g=g||s[S].bgConstraint;var T=t?s[S].frame.minY:s[S].frame.minX,C=t?s[S].frame.maxY:s[S].frame.maxX;if(c.push(new o.SpringConstraint(s[S],s[S],0,1,t,C-T,this.getNodeStiffness(s[S],t))),S<s.length-1){var H=t?s[S].frame.maxY:s[S].frame.maxX,A=t?s[S+1].frame.minY:s[S+1].frame.minX,F=Math.abs(H-A);c.push(new o.SpringConstraint(s[S],s[S+1],1,0,t,F,this.getSpacerStiffness(F,a,t)))}}c.push(new o.SpringConstraint(s[s.length-1],e,m,1,t,h,this.getSpacerStiffness(h,a,t)));for(var D=i.iter(c);!D.done;D.next())D.value.proportional=g;for(var b=0,y=i.iter(c);!y.done;y.next())b+=y.value.length;return Math.abs(a-b)>1&&l.CoreAssert.fail("constraint length failure"),c},createParentSpringConstraints:function(e,t,n,r){var a=n?e.frame.minY:e.frame.minX,s=n?e.frame.maxY:e.frame.maxX,l=n?t.frame.minY:t.frame.minX,c=n?t.frame.maxY:t.frame.maxX,u=[],d=Math.max(l-a,0),f=Math.max(s-c,0),h=Math.abs(d-f)/(s-a);if(h<.05&&h>0){var p=(d+f)/2;d=p,f=p}u.push(new o.SpringConstraint(e,t,0,0,n,d,1)),u.push(new o.SpringConstraint(t,t,0,1,n,c-l,1)),u.push(new o.SpringConstraint(t,e,1,1,n,f,1));for(var m=i.iter(u);!m.done;m.next())m.value.proportional=t.bgConstraint;return this.setSpringStiffnesses(e,i.clone(u),i.clone(r)),u},createSpringConstraintsForGroup:function(e,t,n){if(e.layoutStrategy==C.GroupLayoutStrategy.VerticalFlow&&t||e.layoutStrategy==C.GroupLayoutStrategy.HorizontalFlow&&!t)return[this.createFlowSpringConstraints(e,t)];for(var r=[],a=i.iter(e.children);!a.done;a.next()){var o=a.value;r.push(i.clone(this.createParentSpringConstraints(e,o,t,i.clone(n))))}return r},getNodeStiffness:function(e,t){if((t?e.frame.height:e.frame.width)<10)return 1e6;var n,r,a=1;if(n=i.as(e,C.VisualNodeLeaf)){var o,s,l=e.frame;if((o=i.as(n.forma.controller,m.TypeLockupController))&&(s=n.forma.finalFrame)){var c=o.getAverageFontSize(),u=i.toDouble(o.numLines())/i.toDouble(o.text.split("\n").length),d=s.height/u,f=s.width*u,h=new T.TheoSize(f,d).aspectRatio,p=s.aspectRatio,g=l.fitAspectRatioWithin(h).area,v=l.fitAspectRatioWithin(p).area,S=Math.max(g,v)/s.area;a=this.getFormaStiffness(c*S)}else a=this.getFormaStiffness(l.height)}else if(r=i.as(e,C.VisualNodeGroup)){var H;if(H=this.springConstraints_[r.id]){for(var A=0,F=i.iter(H);!F.done;F.next()){var D=F.value;if(D[0].vertical==t){for(var b=1,y=1,w=i.iter(D);!w.done;w.next()){var x=w.value,_=x.nodeA==x.nodeB?this.getNodeStiffness(x.nodeA,t):x.stiffness;_<this.STRONG_STIFF&&(b+=x.length*_,y+=x.length)}A=Math.max(A,b/i.toDouble(y))}}a=0==A?1:A}}return a},getParentChildPin:function(e,t){var n=.5,r=.5;return Math.abs(e.minX-t.minX)/t.width<.1&&(n=0),Math.abs(e.maxX-t.maxX)/t.width<.1&&(n=1),Math.abs(e.center.x-t.center.x)/t.width<.1&&(n=.5),Math.abs(e.minY-t.minY)/t.height<.1&&(r=0),Math.abs(e.maxY-t.maxY)/t.height<.1&&(r=1),Math.abs(e.center.y-t.center.y)/t.height<.1&&(r=.5),new v.TheoPoint(n,r)},updateFormaFromStructure:function(e){for(var t=[],n=i.clone(e.leafDescendents),r=i.iter(n);!r.done;r.next()){var a=r.value;t.push(a.forma)}for(var o={},l=i.iter(n);!l.done;l.next()){(a=l.value).inferenceData=C.VisualNodeData.init_ff0a(a,i.clone(t));for(var c=i.iter(n);!c.done;c.next()){var u,d=c.value;a!=d&&(ne=a.forma.finalFrame)&&(u=d.forma.finalFrame)&&(o[a.forma.formaID+d.forma.formaID]=ne.intersects(u),o[d.forma.formaID+a.forma.formaID]=ne.intersects(u))}}for(var f=i.iter(e.descendents);!f.done;f.next()){var g,S,T,H=f.value;if((a=i.as(H,C.VisualNodeLeaf))&&(U=a.frame)&&(g=a.forma.frame)&&(S=a.initFrame)&&(T=a.parent)){var A=a.forma,F=U,D=!1;(M=i.as(a.forma.controller,m.TypeLockupController))&&(1!=M.numLines()||h.LockupStyle.layoutSupportsAlignments(M.lockupStyle.layout)||(D=!0));var b=A.placement.transformValues,y=Math.abs(b.rotCosine)/(Math.abs(b.rotCosine)+Math.abs(b.rotSine)),w=Math.abs(b.rotSine)/(Math.abs(b.rotCosine)+Math.abs(b.rotSine)),x=new v.TheoPoint(F.width/S.width,F.height/S.height),_=new v.TheoPoint(x.x*y+x.y*w,x.x*w+x.y*y);if(null!=A.controller&&A.controller.maintainAspectRatio){var P=Math.min(_.x,_.y);A.bounds=i.opt(A.bounds,function(e){return e.scaleXY(P,P,new v.TheoPoint(0,0))})}else A.bounds=i.opt(A.bounds,function(e){return e.scaleXY(_.x,_.y,new v.TheoPoint(0,0))});(M=i.as(a.forma.controller,m.TypeLockupController))&&M.snapSizeToBounds();var M,I=.5,R=.5,E=F.center.x,N=F.center.y,L=T.layoutStrategy==C.GroupLayoutStrategy.VerticalFlow&&1==T.alignments.length&&T.alignments.includes(s.AlignmentType.Left),B=T.layoutStrategy==C.GroupLayoutStrategy.VerticalFlow&&1==T.alignments.length&&T.alignments.includes(s.AlignmentType.Right);if(!(Math.abs(S.center.x-g.center.x)/S.width<.01)){var k=S.minX-g.minX,G=g.maxX-S.maxX;L=L||k>0&&G<=0,B=B||G>0&&k<=0}L?(I=(S.minX-g.minX)/g.width,E=F.minX):B&&(I=1-(g.maxX-S.maxX)/g.width,E=F.maxX),D&&(M=i.as(a.forma.controller,m.TypeLockupController))&&(M.beginBlockedUpdate(),i.opt(M.lockupStyle,function(e){return e.layout=h.LockupLayout.Standard}),M.lockupStyle.alignment=L?h.LockupAlignment.Left:B?h.LockupAlignment.Right:h.LockupAlignment.Center,M.endBlockedUpdate(),M.styleChanged()),S.minY-g.minY>0&&(R=(S.minY-g.minY)/g.height,N=F.minY),g.maxY-S.maxY>0&&(R=1-(g.maxY-S.maxY)/g.height,N=F.maxY),A.movePinToPoint(new v.TheoPoint(I,R),new v.TheoPoint(E,N))}}for(var O=i.iter(e.descendents);!O.done;O.next()){var U;if(H=O.value,(a=i.as(H,C.VisualNodeLeaf))&&(U=a.forma.frame)){var X,Y=null,z=1/0,V=null,K=null,W=1/0,j=null;if(X=i.opt(a.inferenceData,function(e){return e.alignments}))for(var q=i.iter(n);!q.done;q.next()){var Z;if(Z=X[(le=q.value).forma.formaID])for(var J=le.forma.frame,Q=i.iter(Z);!Q.done;Q.next()){var $=Q.value,ee=null;$.line.type==s.AlignmentType.Right&&(ee=Math.abs(J.maxX-U.maxX)+.1*J.L1Distance(U)),$.line.type==s.AlignmentType.Left&&(ee=Math.abs(J.minX-U.minX)+.1*J.L1Distance(U)),$.line.type==s.AlignmentType.CenterX&&(ee=Math.abs(J.center.x-U.center.x)+.1*J.L1Distance(U)),null!=ee&&ee<z&&$.line.line.length<600&&(z=ee,V=$.line.type,Y=J);var te=null;$.line.type==s.AlignmentType.Top&&(te=Math.abs(J.minY-U.minY)+.1*J.L1Distance(U)),$.line.type==s.AlignmentType.Bottom&&(te=Math.abs(J.maxY-U.maxY)+.1*J.L1Distance(U)),$.line.type==s.AlignmentType.CenterY&&(te=Math.abs(J.center.y-U.center.y)+.1*J.L1Distance(U)),null!=te&&te<W&&$.line.line.length<600&&(W=te,j=$.line.type,K=J)}}var ne,re,ae=0,oe=0;if(null!=V&&V==s.AlignmentType.CenterX&&(ae=Y.center.x-a.forma.frame.center.x),null!=V&&V==s.AlignmentType.Left&&(ae=Y.minX-a.forma.frame.minX),null!=V&&V==s.AlignmentType.Right&&(ae=Y.maxX-a.forma.frame.maxX),null!=j&&j==s.AlignmentType.CenterY&&(oe=K.center.y-a.forma.frame.center.y),null!=j&&j==s.AlignmentType.Bottom&&(oe=K.maxY-a.forma.frame.maxY),null!=j&&j==s.AlignmentType.Top&&(oe=K.minY-a.forma.frame.minY),ae=Math.min(ae,0),oe=Math.min(oe,0),(ae<0||oe<0)&&(null!=V&&a.forma.controller.setAlignmentType(V),a.forma.move(p.Matrix2D.translationXY(ae,oe)),(ne=a.forma.finalFrame)&&(re=i.opt(a.forma.parent,function(e){return e.finalFrame})))){for(var ie=!1,se=i.iter(n);!se.done;se.next()){var le;(le=se.value)!=a&&le.forma.finalFrame.intersects(ne)&&!o[a.forma.formaID+le.forma.formaID]&&(ie=!0)}re.contains(ne)&&!ie||a.forma.move(p.Matrix2D.translationXY(-ae,-oe))}}}this.debugPrint_&&i.info("after update: \n "+this.group_.print())},getSpacerStiffness:function(e,t,n){if(e<1)return this.STRUT_STIFF;var r=this.SPACER_LOGISTIC_L*this.LOGISTIC_L_SCALE,a=this.SPACER_LOGISTIC_K*this.LOGISTIC_K_SCALE,o=this.SPACER_LOGISTIC_X*this.LOGISTIC_X_SCALE,i=this.SPACER_LOGISTIC_B*this.LOGISTIC_B_SCALE;return r/(1+Math.pow(g.TheoMatrix.E_DOUBLE,a*(e-o)))+i},getFormaStiffness:function(e){var t=this.NODE_LOGISTIC_L*this.LOGISTIC_L_SCALE,n=this.NODE_LOGISTIC_K*this.LOGISTIC_K_SCALE,r=this.NODE_LOGISTIC_X*this.LOGISTIC_X_SCALE,a=this.NODE_LOGISTIC_B*this.LOGISTIC_B_SCALE;return t/(1+Math.pow(g.TheoMatrix.E_DOUBLE,n*(e-r)))+a},getForegroundLeafs:function(e){for(var t=[],n=i.iter(e.leafDescendents);!n.done;n.next()){var r=n.value;r.hasForegroundRole&&t.push(r)}return t}}}),a)}}]);
//# sourceMappingURL=logomaker-entry_5d636a00-83a9ce27.js.map