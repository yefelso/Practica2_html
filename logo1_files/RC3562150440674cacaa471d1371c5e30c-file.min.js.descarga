// For license information, see `https://assets.adobedtm.com/d4d114c60e50/f3fbfbe0e7ca/8ad3749fa089/RC3562150440674cacaa471d1371c5e30c-file.js`.
!function(){var e=window,t=function(){var t,a;t=this,a=function(){"use strict";function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(t)}function t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){for(var a=0;a<t.length;a++){var i=t[a];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function i(e,t,i){return t&&a(e.prototype,t),i&&a(e,i),e}function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function n(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,i)}return a}function s(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?n(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):n(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function o(e){return(o=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function d(e,t){return(d=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function c(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function l(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function u(){var e=0;return{getUniqueId:function(){return e+=1}}}function h(){return(new Date).getTime()}function f(e,t){return setInterval(e,t)}function p(e){var t=e.debugLogging;D(t)&&(L=t)}function m(e,t,a){(L||e===w.Error)&&function(e,t){if(window.console){var a;switch(e){case w.Log:a=window.console.log;break;case w.Info:a=window.console.info;break;case w.Warn:a=window.console.warn;break;case w.Error:a=window.console.error}a&&a(t)}}(e,"MediaSDK: ["+function(){var e=new Date,t=function(e){return e<10?"00"+e:e<100?"0"+e:""+e}(e.getMilliseconds());return e.toTimeString()+"."+t}()+"] "+t+" "+a)}function _(e){var t=R(e)?"["+e+"]":"";return{log:function(e){!function(e,t){m(w.Log,e,t)}(t,e)},info:function(e){!function(e,t){m(w.Info,e,t)}(t,e)},warn:function(e){!function(e,t){m(w.Warn,e,t)}(t,e)},error:function(e){!function(e,t){m(w.Error,e,t)}(t,e)}}}function v(e){var t={};return X(e)&&Object.keys(e).forEach((function(a){var i=e[a],r=i.id,n=i.authState,s=void 0===n?0:n;R(r)&&(t[a]={id:r,authState:s})})),t}function g(e){var t,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=r({},Y.EventType,e.eventType);i[Y.PlayerTime]=(r(t={},W.Playhead,e.playhead),r(t,W.Ts,e.ts),t),Z(e.customMetadata)||(i[Y.CustomMetadata]=e.customMetadata),Z(e.qoeData)||(i[Y.QoE]=e.qoeData);var n=s({},e.params);if(e.eventType===V.SessionStart){R(a[N.AnalyticsTrackingServer])&&(n[F.AnalyticsTrackingServer]=a[N.AnalyticsTrackingServer]),R(a[N.Rsid])&&(n[F.AnalyticsRsid]=a[N.Rsid]),D(a[N.AnalyticsSsl])&&(n[F.AnalyticsSsl]=a[N.AnalyticsSsl]),R(a[N.Vid])&&(n[F.AnalyticsVisitorId]=a[N.Vid]),R(a[N.Aid])&&(n[F.AnalyticsAid]=a[N.Aid]),R(a[N.McOrgId])&&(n[F.VisitorMcOrgId]=a[N.McOrgId]),R(a[N.Mcid])&&(n[F.VisitorMcuserId]=a[N.Mcid]),J(a[N.AamLocHint])&&(n[F.VisitorAamLocHint]=a[N.AamLocHint]);var o=v(a[N.CustomerIds]);if(X(o)&&!Z(o)&&(n[F.VisitorCustomerIds]=o),!R(n[U.Channel])){var d=a[N.MediaChannel];n[U.Channel]=R(d)?d:"unknown"}var c=a[N.MediaPlayerName];n[U.PlayerName]=R(c)?c:"unknown",R(a[N.MediaAppVersion])&&(n[U.SdkVersion]=a[N.MediaAppVersion]),n[F.MediaVersion]="js-3.0.0"}else if(e.eventType===V.AdStart){var l=a[N.MediaPlayerName];n[q.PlayerName]=R(l)?l:"unknown"}return Z(n)||(i[Y.Params]=n),te((function(){return JSON.stringify(i)}),"")}function y(e){try{var t=e.split("/");return t[4]?t[4]:""}catch(e){return""}}var k=Object.freeze({AdBreakStart:"adBreakStart",AdBreakComplete:"adBreakComplete",AdStart:"adStart",AdComplete:"adComplete",AdSkip:"adSkip",ChapterStart:"chapterStart",ChapterComplete:"chapterComplete",ChapterSkip:"chapterSkip",SeekStart:"seekStart",SeekComplete:"seekComplete",BufferStart:"bufferStart",BufferComplete:"bufferComplete",BitrateChange:"bitrateChange",StateStart:"stateStart",StateEnd:"stateEnd"}),S=Object.freeze({MediaResumed:"media.resumed"}),E=Object.freeze({Video:"video",Audio:"audio"}),P=Object.freeze({FullScreen:"fullScreen",ClosedCaption:"closedCaptioning",Mute:"mute",PictureInPicture:"pictureInPicture",InFocus:"inFocus"}),I=Object.freeze({Show:"a.media.show",Season:"a.media.season",Episode:"a.media.episode",AssetId:"a.media.asset",Genre:"a.media.genre",FirstAirDate:"a.media.airDate",FirstDigitalDate:"a.media.digitalDate",Rating:"a.media.rating",Originator:"a.media.originator",Network:"a.media.network",ShowType:"a.media.type",AdLoad:"a.media.adLoad",MVPD:"a.media.pass.mvpd",Authorized:"a.media.pass.auth",DayPart:"a.media.dayPart",Feed:"a.media.feed",StreamFormat:"a.media.format"}),A=Object.freeze({Artist:"a.media.artist",Album:"a.media.album",Label:"a.media.label",Author:"a.media.author",Station:"a.media.station",Publisher:"a.media.publisher"}),C=Object.freeze({Advertiser:"a.media.ad.advertiser",CampaignId:"a.media.ad.campaign",CreativeId:"a.media.ad.creative",PlacementId:"a.media.ad.placement",SiteId:"a.media.ad.site",CreativeUrl:"a.media.ad.creativeURL"}),b=Object.freeze({VOD:"vod",Live:"live",Linear:"linear",Podcast:"podcast",Audiobook:"audiobook",AOD:"aod"}),T=Object.freeze({OptOut:"optout",OptIn:"optin",OptUnknown:"optunknown"}),M=function(e){return null==e},w=Object.freeze({Log:"log",Info:"info",Warn:"warn",Error:"error"}),D=function(e){return"boolean"==typeof e},O=function(e){return"string"==typeof e},R=function(e){return O(e)&&e.length>0},L=!1,N=Object.freeze({AnalyticsTrackingServer:"analyticstrackingserver",AnalyticsSsl:"analyticsssl",Rsid:"rsid",Vid:"vid",Aid:"aid",Mcid:"mid",McOrgId:"orgid",AamLocHint:"aamlochint",CustomerIds:"customerids",MediaTrackingServer:"mediatrackingserver",MediaChannel:"mediachannel",MediaPlayerName:"mediaplayername",MediaAppVersion:"mediaappversion",MediaSsl:"mediassl"}),B=Object.freeze({Get:"GET",Post:"POST"}),V=Object.freeze({SessionStart:"sessionStart",SessionComplete:"sessionComplete",SessionEnd:"sessionEnd",AdBreakStart:"adBreakStart",AdBreakComplete:"adBreakComplete",AdStart:"adStart",AdComplete:"adComplete",AdSkip:"adSkip",ChapterStart:"chapterStart",ChapterComplete:"chapterComplete",ChapterSkip:"chapterSkip",Play:"play",Ping:"ping",BufferStart:"bufferStart",PauseStart:"pauseStart",BitrateChange:"bitrateChange",Error:"error",StateStart:"stateStart",StateEnd:"stateEnd"}),j=Object.freeze({Show:"media.show",Season:"media.season",Episode:"media.episode",AssetId:"media.assetId",Genre:"media.genre",FirstAirDate:"media.firstAirDate",FirstDigitalDate:"media.firstDigitalDate",Rating:"media.rating",Originator:"media.originator",Network:"media.network",ShowType:"media.showType",AdLoad:"media.adLoad",MVPD:"media.pass.mvpd",Auth:"media.pass.auth",DayPart:"media.dayPart",Feed:"media.feed",StreamFormat:"media.streamFormat",Artist:"media.artist",Album:"media.album",Label:"media.label",Author:"media.author",Station:"media.station",Publisher:"media.publisher"}),z=Object.freeze({Advertiser:"media.ad.advertiser",CampaignId:"media.ad.campaignId",CreativeId:"media.ad.creativeId",SiteId:"media.ad.siteId",CreativeUrl:"media.ad.creativeURL",PlacementId:"media.ad.placementId"}),U=Object.freeze({Id:"media.id",Name:"media.name",Length:"media.length",ContentType:"media.contentType",StreamType:"media.streamType",PlayerName:"media.playerName",Resume:"media.resume",Channel:"media.channel",Publisher:"media.publisher",SdkVersion:"media.sdkVersion"}),F=Object.freeze({AppInstallationId:"appInstallationId",AnalyticsTrackingServer:"analytics.trackingServer",AnalyticsRsid:"analytics.reportSuite",AnalyticsSsl:"analytics.enableSSL",AnalyticsVisitorId:"analytics.visitorId",AnalyticsAid:"analytics.aid",VisitorMcOrgId:"visitor.marketingCloudOrgId",VisitorMcuserId:"visitor.marketingCloudUserId",VisitorAamLocHint:"visitor.aamLocationHint",VisitorCustomerIds:"visitor.customerIDs",VisitorCustomerKeyId:"id",VisitorCustomerKeyAuthState:"authState",MediaVersion:"media.libraryVersion"}),H=Object.freeze({Channel:"media.channel"}),x=Object.freeze({PodFriendlyName:"media.ad.podFriendlyName",PodIndex:"media.ad.podIndex",PodSecond:"media.ad.podSecond"}),q=Object.freeze({Name:"media.ad.name",Id:"media.ad.id",Length:"media.ad.length",PodPosition:"media.ad.podPosition",PlayerName:"media.ad.playerName"}),G=Object.freeze({FriendlyName:"media.chapter.friendlyName",Length:"media.chapter.length",Offset:"media.chapter.offset",Index:"media.chapter.index"}),Q=Object.freeze({StateName:"media.state.name"}),K=Object.freeze({Bitrate:"media.qoe.bitrate",DroppedFrames:"media.qoe.droppedFrames",Fps:"media.qoe.framesPerSecond",StartupTime:"media.qoe.timeToStart",ErrorId:"media.qoe.errorID",ErrorSource:"media.qoe.errorSource",ErrorSourcePlayer:"player",ErrorSourceExternal:"external"}),Y=Object.freeze({EventType:"eventType",Params:"params",QoE:"qoeData",CustomMetadata:"customMetadata",PlayerTime:"playerTime"}),W=Object.freeze({Playhead:"playhead",Ts:"ts"}),Z=function(e){return 0===Object.keys(e).length},$=function(e){return"number"==typeof e&&!isNaN(e)},J=function(e){var t=parseInt(e,10);return $(t)&&e===t},X=function(t){return!M(t)&&!Array.isArray(t)&&"object"===e(t)},ee=function(e){return"function"==typeof e},te=function(e,t){if(!ee(e))return t;try{return e()}catch(e){return t}},ae=[N.AnalyticsTrackingServer,N.AnalyticsSsl,N.Rsid,N.Vid,N.Aid,N.Mcid,N.McOrgId,N.AamLocHint,N.CustomerIds,N.MediaChannel,N.MediaAppVersion,N.MediaPlayerName,N.MediaTrackingServer,N.MediaSsl],ie=function(){function e(a){t(this,e),this._logger=_("MediaSession("+a+")"),this._hits=[],this._ecParams=null,this._sessionId=null,this._creatingMCSession=!1,this._createSessionFailureCount=0,this._internalError=!1,this._doneQueuing=!1}return i(e,[{key:"queue",value:function(e){this._internalError||this._doneQueuing||this._hits.push(e)}},{key:"process",value:function(e){this._internalError||0!==this._hits.length&&e.isReady()&&(this._ecParams||(this._ecParams=e.resolveKeys(ae)),M(this._sessionId)?this._startMCSession():this._flushPendingHits())}},{key:"end",value:function(){this._logger.log("end"),this._doneQueuing=!0}},{key:"abort",value:function(){this._logger.log("abort"),this._doneQueuing=!0,this._hits=[]}},{key:"doneProcessing",value:function(){return this._internalError||this._doneQueuing&&0===this._hits.length}},{key:"_startMCSession",value:function(){var e=this;if(!this._creatingMCSession){var t=this._hits[0];if(t.eventType!==V.SessionStart)return this._logger.log("Dropping hit("+t.eventType+") as we expected sessionStart"),void this._hits.shift();var a,i=((a=this._ecParams)[N.MediaSsl]?"https":"http")+"://"+a[N.MediaTrackingServer]+"/api/v1/sessions",r=g(t,this._ecParams);this._creatingMCSession=!0,this._sendRequest(i,B.Post,r,(function(t,a){var i,r=!1;do{if(201!==t)break;var n=a.location;if(!R(n))break;if(!(i=y(n)))break;r=!0}while(0);r?(e._logger.log("Media collection session created with session id :  "+i),e._sessionId=i,e._hits.shift()):(e._logger.log("Creating Media collection session failed"),e._createSessionFailureCount+=1,e._createSessionFailureCount>=3&&(e._logger.log("Internal error: Creating Media collection session failed 3 times"),e._internalError=!0)),e._creatingMCSession=!1}))}}},{key:"_flushPendingHits",value:function(){var e=this;this._hits.splice(0,3).forEach((function(t){var a,i,r=(a=e._ecParams,i=e._sessionId,(a[N.MediaSsl]?"https":"http")+"://"+a[N.MediaTrackingServer]+"/api/v1/sessions/"+i+"/events"),n=g(t,e._ecParams);e._sendRequest(r,B.Post,n,(function(){}))}))}},{key:"_sendRequest",value:function(e,t,a,i){!function(e,t,a,i){if(void 0!==window.XMLHttpRequest){var r=new window.XMLHttpRequest;if("withCredentials"in r){var n=r;return n.open(t,e,!0),n.timeout=5e3,n.onload=function(){var e=n.status&&parseInt(n.status,10),t=n.responseText,a=function(e){var t={};try{e.trim().split(/[\r\n]+/).forEach((function(e){var a=e.split(":",1)[0],i=e.substring(a.length+2);a.length>0&&(t[a.toLowerCase()]=i)}))}catch(e){}return t}(n.getAllResponseHeaders());i(e,a,t)},n.onerror=function(){i(0)},void n.send(a)}i(0)}}(e,t,a,i)}}]),e}(),re=function(){function e(){t(this,e),this._logger=_("MediaProcessor"),this._isConfigured=!1,this._privacyStatus=T.OptUnknown,this._sessionIdGenerator=u(),this._sessionMap={}}return i(e,[{key:"configure",value:function(e){var t=this;this._isConfigured||(this._ecResolver=e,this._privacyStatus=this._ecResolver.getPrivacyStatus(),this._ecResolver.notifyPrivacyChange(this._onPrivacyChange.bind(this)),this._isConfigured=!0,this._processSessionTimer=f((function(){t._tick()}),500),this._logger.log("Configured with resolver"))}},{key:"startSession",value:function(){if(this._privacyStatus===T.OptOut)return this._logger.log("Privacy is opted out. Not starting a session"),-1;var t=this._sessionIdGenerator.getUniqueId();return this._sessionMap[t]=e._createMediaSession(t),t}},{key:"processHit",value:function(e,t){if(-1!==e){var a=this._sessionMap[e];M(a)||(this._logger.log("Process hit for session("+e+") => "+t),a.queue(t))}}},{key:"endSession",value:function(e){if(-1!==e){var t=this._sessionMap[e];M(t)||t.end()}}},{key:"_tick",value:function(){var e=this;Object.keys(this._sessionMap).forEach((function(t){var a=e._sessionMap[t];a.process(e._ecResolver),a.doneProcessing()&&(e._logger.log("Removing session "+t+" from store as it has finished processing"),delete e._sessionMap[t])}))}},{key:"_onPrivacyChange",value:function(e){var t=this;this._logger.log("Privacy switched to "+e),this._privacyStatus=e,e===T.OptOut&&(this._logger.log("Aborting all active sessions"),Object.keys(this._sessionMap).forEach((function(e){t._sessionMap[e].abort()})))}}],[{key:"_createMediaSession",value:function(e){return new ie(e)}}]),e}(),ne=function(){function e(a){var i=a.id,r=a.name,n=a.position,s=a.length;if(t(this,e),!R(i))throw new TypeError("id is not a valid string");if(!R(r))throw new TypeError("name is not a valid string");if(!J(n)||n<1)throw new TypeError("position should be a valid integer greater than zero");if(!$(s)||s<0)throw new TypeError("length cannot be less than zero");this.id=i,this.name=r,this.position=n,this.length=s}return i(e,[{key:"equal",value:function(t){return!M(t)&&t instanceof e&&this.id===t.id&&this.name===t.name&&this.position===t.position&&this.length===t.length}},{key:"serialize",value:function(){var e;return r(e={},"ad.id",this.id),r(e,"ad.name",this.name),r(e,"ad.position",this.position),r(e,"ad.length",this.length),e}}],[{key:"deserialize",value:function(t){return X(t)?te((function(){return new e({id:t["ad.id"],name:t["ad.name"],position:t["ad.position"],length:t["ad.length"]})}),null):null}}]),e}(),se=function(){function e(a){var i=a.name,r=a.position,n=a.startTime;if(t(this,e),!R(i))throw new TypeError("name is not a valid string");if(!J(r)||r<1)throw new TypeError("position should be a valid integer greater than zero");if(!$(n)||n<0)throw new TypeError("startTime cannot be less than zero");this.name=i,this.position=r,this.startTime=n}return i(e,[{key:"equal",value:function(t){return!M(t)&&t instanceof e&&this.name===t.name&&this.position===t.position&&this.startTime===t.startTime}},{key:"serialize",value:function(){var e;return r(e={},"adbreak.name",this.name),r(e,"adbreak.position",this.position),r(e,"adbreak.starttime",this.startTime),e}}],[{key:"deserialize",value:function(t){return X(t)?te((function(){return new e({name:t["adbreak.name"],position:t["adbreak.position"],startTime:t["adbreak.starttime"]})}),null):null}}]),e}(),oe=function(){function e(a){var i=a.name,r=a.position,n=a.startTime,s=a.length;if(t(this,e),!R(i))throw new TypeError("name is not a valid string");if(!J(r)||r<1)throw new TypeError("position should be a valid integer greater than zero");if(!$(n)||n<0)throw new TypeError("startTime cannot be less than zero");if(!$(s)||s<0)throw new TypeError("length cannot be less than zero");this.name=i,this.position=r,this.startTime=n,this.length=s}return i(e,[{key:"equal",value:function(t){return!M(t)&&t instanceof e&&this.name===t.name&&this.position===t.position&&this.startTime===t.startTime&&this.length===t.length}},{key:"serialize",value:function(){var e;return r(e={},"chapter.name",this.name),r(e,"chapter.position",this.position),r(e,"chapter.starttime",this.startTime),r(e,"chapter.length",this.length),e}}],[{key:"deserialize",value:function(t){return X(t)?te((function(){return new e({name:t["chapter.name"],position:t["chapter.position"],startTime:t["chapter.starttime"],length:t["chapter.length"]})}),null):null}}]),e}(),de=new RegExp("^[a-zA-Z0-9_\\.]{1,64}$"),ce=function(){function e(a){var i=a.name;if(t(this,e),!R(i))throw new TypeError("name is not a valid string");if(!de.test(i))throw new TypeError("name should match '^[a-zA-Z0-9_\\.]{1,64}$' pattern");this.name=i}return i(e,[{key:"equal",value:function(t){return!M(t)&&t instanceof e&&this.name===t.name}},{key:"serialize",value:function(){return r({},"customstate.name",this.name)}}],[{key:"deserialize",value:function(t){return X(t)?te((function(){return new e({name:t["customstate.name"]})}),null):null}}]),e}(),le=function(){function e(a){var i=a.id,r=a.name,n=a.streamType,s=a.mediaType,o=a.length,d=a.resumed,c=a.prerollWaitTime;if(t(this,e),!R(i))throw new TypeError("id is not a valid string");if(!R(r))throw new TypeError("name is not a valid string");if(!R(n))throw new TypeError("streamType is not a valid string");if(!$(o)||o<0)throw new TypeError("length cannot be less than zero");this.id=i,this.name=r,this.streamType=n,this.mediaType=s!==E.Audio?E.Video:s,this.length=o,this.resumed=!!D(d)&&d,this.prerollWaitTime=!J(c)||c<0?250:c}return i(e,[{key:"equal",value:function(t){return!M(t)&&t instanceof e&&this.id===t.id&&this.name===t.name&&this.streamType===t.streamType&&this.mediaType===t.mediaType&&this.length===t.length&&this.resumed===t.resumed&&this.prerollWaitTime===t.prerollWaitTime}},{key:"serialize",value:function(){var e;return r(e={},"media.id",this.id),r(e,"media.name",this.name),r(e,"media.streamtype",this.streamType),r(e,"media.type",this.mediaType),r(e,"media.length",this.length),r(e,"media.resumed",this.resumed),r(e,"media.prerollwaittime",this.prerollWaitTime),e}}],[{key:"deserialize",value:function(t){return X(t)?te((function(){return new e({id:t["media.id"],name:t["media.name"],streamType:t["media.streamtype"],mediaType:t["media.type"],length:t["media.length"],resumed:t["media.resumed"],prerollWaitTime:t["media.prerollwaittime"]})}),null):null}}]),e}(),ue=function(){function e(a){var i=a.bitrate,r=a.droppedFrames,n=a.fps,s=a.startupTime;if(t(this,e),!$(i)||i<0)throw new TypeError("bitrate must not be less than zero");if(!$(r)||r<0)throw new TypeError("dropped frames must not be less than zero");if(!$(n)||n<0)throw new TypeError("fps must not be less than zero");if(!$(s)||s<0)throw new TypeError("startupTime must not be less than zero");this.bitrate=i,this.droppedFrames=r,this.fps=n,this.startupTime=s}return i(e,[{key:"equal",value:function(t){return!M(t)&&t instanceof e&&this.bitrate===t.bitrate&&this.droppedFrames===t.droppedFrames&&this.fps===t.fps&&this.startupTime===t.startupTime}},{key:"serialize",value:function(){var e;return r(e={},"qoe.bitrate",this.bitrate),r(e,"qoe.droppedframes",this.droppedFrames),r(e,"qoe.fps",this.fps),r(e,"qoe.startuptime",this.startupTime),e}}],[{key:"deserialize",value:function(t){return X(t)?te((function(){return new e({bitrate:t["qoe.bitrate"],droppedFrames:t["qoe.droppedframes"],fps:t["qoe.fps"],startupTime:t["qoe.startuptime"]})}),null):null}}]),e}(),he=_("Media"),fe=function(e){try{return JSON.stringify(e,null,4)}catch(e){return"[Error formatting object]"}},pe=Object.freeze({Name:"event.name",Params:"event.params",Metadata:"event.metadata",TimeStamp:"event.ts",InternalEvent:"event.internal",Playhead:"event.playhead",ErrorId:"error.id"}),me=Object.freeze(s({SessionStart:"sessionStart",SessionEnd:"sessionEnd",SessionComplete:"sessionComplete",Play:"play",Pause:"pause",Error:"error",QoEUpdate:"qoeUpdate",PlayheadUpdate:"playheadUpdate"},k)),_e=function(){function e(a,i){if(t(this,e),M(a))throw new Error("id is not valid");this.id=a,this.description=i,this.predicates=[],this.actions=[]}return i(e,[{key:"addPredicate",value:function(e,t,a){if(!ee(e))throw new Error("predicate is not a function");return this.predicates.push({predicate:e,val:t,message:a}),this}},{key:"addAction",value:function(e){if(!ee(e))throw new Error("action is not a function");return this.actions.push(e),this}},{key:"runPredicates",value:function(e){for(var t=0;t<this.predicates.length;++t){var a=this.predicates[t];if(a.predicate(e)!==a.val)return{success:!1,message:a.message}}return{success:!0,message:""}}},{key:"runActions",value:function(e){for(var t=0;t<this.actions.length;++t)if(!(0,this.actions[t])(e))return!1;return!0}}]),e}(),ve=function(){function e(a){if(t(this,e),!a)throw new Error("RuleEngine needs a logger");this.logger=a,this.rules={}}return i(e,[{key:"setEnterAction",value:function(e){if(!ee(e))throw new Error("enterAction is not a function");this.enterAction=e}},{key:"setExitAction",value:function(e){if(!ee(e))throw new Error("exitAction is not a function");this.exitAction=e}},{key:"addRule",value:function(e){if(!(e instanceof _e))throw new Error("rule is not valid");this.rules[e.id]=e}},{key:"processRule",value:function(e,t){var a=this.rules[e];if(!a)return{success:!1,message:"Matching rule is not found"};var i=a.runPredicates(t);do{if(!i.success){this.logger.log("RuleEngine: Predicates failed for rule "+a.description+" : "+i.message);break}if(this.enterAction&&!this.enterAction(a,t)){this.logger.log("RuleEngine: Enter action prevents further processing for rule "+a.description);break}if(!a.runActions(t)){this.logger.log("RuleEngine: Rule action prevents further processing for rule "+a.description);break}this.exitAction&&this.exitAction(a,t)}while(0);return i}}]),e}(),ge=Object.freeze({Init:0,Play:1,Pause:2,Buffer:3,Seek:4,Stall:5}),ye=function(){function e(a,i){t(this,e),this._mediaInfo=a,this._mediaMetadata=i,this._adBreakInfo=null,this._adInfo=null,this._adMetadata=null,this._chapterInfo=null,this._chapterMetadata=null,this._qoeInfo=null,this._playhead=0,this._playstate=ge.Init,this._buffering=!1,this._seeking=!1,this._customStates=new Map}return i(e,[{key:"setAdBreakInfo",value:function(e){this._adBreakInfo=e}},{key:"clearAdBreakInfo",value:function(){this._adBreakInfo=null}},{key:"setAdInfo",value:function(e,t){this._adInfo=e,this._adMetadata=t}},{key:"clearAdInfo",value:function(){this._adInfo=null,this._adMetadata=null}},{key:"setChapterInfo",value:function(e,t){this._chapterInfo=e,this._chapterMetadata=t}},{key:"clearChapterInfo",value:function(){this._chapterInfo=null,this._chapterMetadata=null}},{key:"enterPlaybackState",value:function(e){switch(e){case ge.Play:case ge.Pause:case ge.Stall:this._playstate=e;break;case ge.Buffer:this._buffering=!0;break;case ge.Seek:this._seeking=!0}}},{key:"exitPlaybackState",value:function(e){switch(e){case ge.Buffer:this._buffering=!1;break;case ge.Seek:this._seeking=!1}}},{key:"isInPlaybackState",value:function(e){var t=!1;switch(e){case ge.Init:case ge.Play:case ge.Pause:case ge.Stall:t=this._playstate===e;break;case ge.Buffer:t=this._buffering;break;case ge.Seek:t=this._seeking}return t}},{key:"isIdle",value:function(){return!this.isInPlaybackState(ge.Play)||this.isInPlaybackState(ge.Seek)||this.isInPlaybackState(ge.Buffer)}},{key:"startCustomState",value:function(e){this._customStates.set(e.name,e)}},{key:"endCustomState",value:function(e){this._customStates.set(e.name,null)}},{key:"isCustomStateActive",value:function(e){return!!this._customStates.get(e.name)}},{key:"getActiveCustomStates",value:function(){var e=[];return this._customStates.forEach((function(t){t&&e.push(t)})),e}},{key:"hasTrackedCustomState",value:function(e){return this._customStates.has(e.name)}},{key:"numTrackedCustomStates",value:function(){return this._customStates.size}},{key:"mediaInfo",get:function(){return this._mediaInfo}},{key:"mediaMetadata",get:function(){return this._mediaMetadata}},{key:"isInAdBreak",get:function(){return!!this._adBreakInfo}},{key:"adBreakInfo",get:function(){return this._adBreakInfo}},{key:"isInAd",get:function(){return!!this._adInfo}},{key:"adInfo",get:function(){return this._adInfo}},{key:"adMetadata",get:function(){return this._adMetadata}},{key:"isInChapter",get:function(){return!!this._chapterInfo}},{key:"chapterInfo",get:function(){return this._chapterInfo}},{key:"chapterMetadata",get:function(){return this._chapterMetadata}},{key:"qoeInfo",get:function(){return this._qoeInfo},set:function(e){this._qoeInfo=e}},{key:"playhead",get:function(){return this._playhead},set:function(e){this._playhead=e}}]),e}(),ke=function(){function e(a){var i=a.eventType,r=a.params,n=a.customMetadata,s=a.qoeData,o=a.playhead,d=a.ts;if(t(this,e),!O(i))throw new Error("eventType should be a valid string");if(!$(o))throw new Error("playhead should be a valid number");if(!J(d)||d<0)throw new Error("ts should be a valid positive integer");this.eventType=i,this.params=X(r)?r:{},this.customMetadata=X(n)?n:{},this.qoeData=X(s)?s:{},this.playhead=o,this.ts=d}return i(e,[{key:"toString",value:function(){return fe(this)}}]),e}(),Se=function(){function e(a,i,r,n,s){t(this,e),this._logger=a,this._hitProcessor=i,this._config=r,this._media=n,this._refTs=s,this._previousState=ge.Init,this._previousStateTs=s,this._interval=1e4,this._lastQoeInfo=null,this._startSession()}return i(e,[{key:"setRefTS",value:function(e){this._refTs=e}},{key:"processMediaStart",value:function(){this._processMediaStart(!1)}},{key:"processMediaComplete",value:function(){this._generateHit(V.SessionComplete),this._endSession()}},{key:"processMediaSkip",value:function(){this._generateHit(V.SessionEnd),this._endSession()}},{key:"processAdBreakStart",value:function(){var t=e._extractAdBreakParams(this._media);this._generateHit(V.AdBreakStart,t,{})}},{key:"processAdBreakComplete",value:function(){this._generateHit(V.AdBreakComplete)}},{key:"processAdBreakSkip",value:function(){this._generateHit(V.AdBreakComplete)}},{key:"processAdStart",value:function(){this._interval=1e3;var t=e._extractAdParams(this._media),a=e._extractAdMetadata(this._media);this._generateHit(V.AdStart,t,a)}},{key:"processAdComplete",value:function(){this._interval=1e4,this._generateHit(V.AdComplete)}},{key:"processAdSkip",value:function(){this._interval=1e4,this._generateHit(V.AdSkip)}},{key:"processChapterStart",value:function(){var t=e._extractChapterParams(this._media),a=e._extractChapterMetadata(this._media);this._generateHit(V.ChapterStart,t,a)}},{key:"processChapterComplete",value:function(){this._generateHit(V.ChapterComplete)}},{key:"processChapterSkip",value:function(){this._generateHit(V.ChapterSkip)}},{key:"processCustomStateStart",value:function(e){var t={};t[Q.StateName]=e.name,this._generateHit(V.StateStart,t,{},{})}},{key:"processCustomStateEnd",value:function(e){var t={};t[Q.StateName]=e.name,this._generateHit(V.StateEnd,t,{},{})}},{key:"processIdleStart",value:function(){this.processMediaSkip()}},{key:"processIdleComplete",value:function(){this._previousState=ge.Init,this._previousStateTs=this._refTs,this._lastQoeInfo=null,this._startSession(),this.processMediaStart(!0),this._media.isInChapter&&this.processChapterStart(),this._media.isInAdBreak&&this.processAdBreakStart(),this._media.isInAd&&this.processAdStart();var e,t=this._media.getActiveCustomStates();for(e=0;e<t.length;e++)this.processCustomStateStart(t[e]);this.processPlayback(!0)}},{key:"processBitrateChange",value:function(){var t=e._extractQoeData(this._media);this._generateHit(V.BitrateChange,{},{},t)}},{key:"processError",value:function(t){var a=e._extractQoeData(this._media);a[K.ErrorId]=t,a[K.ErrorSource]=K.ErrorSourcePlayer,this._generateHit(V.Error,{},{},a)}},{key:"processPlayback",value:function(t){if(this._isTracking){var a=this._getPlaybackState();if(this._previousState!==a||t){var i=e._playbackStateToMediaCollectionEvent(a);this._generateHit(i),this._previousState=a,this._previousStateTs=this._refTs}else a===this._previousState&&this._refTs-this._previousStateTs>=this._interval&&(this._generateHit(V.Ping),this._previousStateTs=this._refTs)}}},{key:"_processMediaStart",value:function(t){var a={};a=e._extractMediaParams(this._media),t&&(a[U.Resume]=!0);var i=this._config[H.Channel];R(i)&&(a[H.Channel]=i);var r=e._extractMediaMetadata(this._media);this._generateHit(V.SessionStart,a,r)}},{key:"_generateHit",value:function(t){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(M(r)){var n=this._media.qoeInfo;!(M(n)||!M(this._lastQoeInfo)&&this._lastQoeInfo.equal(n))&&(r=e._extractQoeData(this._media),this._lastQoeInfo=n)}if(this._isTracking){var s=this._media.playhead,o=this._refTs,d=new ke({eventType:t,params:a,customMetadata:i,qoeData:r,playhead:s,ts:o});this._hitProcessor.processHit(this._sessionId,d)}else this._logger.log("#_generateHit - Dropping hit as we have internally stopped tracking the session")}},{key:"_getPlaybackState",value:function(){return this._media.isInPlaybackState(ge.Buffer)?ge.Buffer:this._media.isInPlaybackState(ge.Seek)?ge.Seek:this._media.isInPlaybackState(ge.Play)?ge.Play:this._media.isInPlaybackState(ge.Pause)?ge.Pause:this._media.isInPlaybackState(ge.Stall)?ge.Stall:ge.Init}},{key:"_startSession",value:function(){this._sessionId=this._hitProcessor.startSession(),this._isTracking=!0,this._logger.log("Start internal session("+this._sessionId+")")}},{key:"_endSession",value:function(){this._hitProcessor.endSession(this._sessionId),this._isTracking=!1,this._logger.log("End internal session("+this._sessionId+")")}}],[{key:"_extractMediaParams",value:function(t){var a={},i=t.mediaInfo;M(i)||(a[U.Id]=i.id,a[U.Name]=i.name,a[U.Length]=i.length,a[U.ContentType]=i.streamType,a[U.StreamType]=i.mediaType,a[U.Resume]=i.resumed);var r=t.mediaMetadata;return X(r)&&Object.keys(r).forEach((function(t){if(e._standardMediaMetadataMap.has(t)){var i=e._standardMediaMetadataMap.get(t);a[i]=r[t]}})),a}},{key:"_extractMediaMetadata",value:function(t){var a={},i=t.mediaMetadata;return X(i)&&Object.keys(i).forEach((function(t){e._standardMediaMetadataMap.has(t)||(a[t]=i[t])})),a}},{key:"_extractAdBreakParams",value:function(e){var t={},a=e.adBreakInfo;return M(a)||(t[x.PodFriendlyName]=a.name,t[x.PodIndex]=a.position,t[x.PodSecond]=a.startTime),t}},{key:"_extractAdParams",value:function(t){var a={},i=t.adInfo;M(i)||(a[q.Name]=i.name,a[q.Id]=i.id,a[q.Length]=i.length,a[q.PodPosition]=i.position);var r=t.adMetadata;return X(r)&&Object.keys(r).forEach((function(t){if(e._standardAdMetadataMap.has(t)){var i=e._standardAdMetadataMap.get(t);a[i]=r[t]}})),a}},{key:"_extractAdMetadata",value:function(t){var a={},i=t.adMetadata;return X(i)&&Object.keys(i).forEach((function(t){e._standardAdMetadataMap.has(t)||(a[t]=i[t])})),a}},{key:"_extractChapterParams",value:function(e){var t={},a=e.chapterInfo;return M(a)||(t[G.FriendlyName]=a.name,t[G.Index]=a.position,t[G.Length]=a.length,t[G.Offset]=a.startTime),t}},{key:"_extractChapterMetadata",value:function(e){var t={},a=e.chapterMetadata;return X(a)&&Object.keys(a).forEach((function(e){t[e]=a[e]})),t}},{key:"_extractQoeData",value:function(e){var t={},a=e.qoeInfo;return X(a)&&(t[K.Bitrate]=parseInt(a.bitrate,10),t[K.Fps]=parseInt(a.fps,10),t[K.DroppedFrames]=parseInt(a.droppedFrames,10),t[K.StartupTime]=parseInt(a.startupTime,10)),t}},{key:"_playbackStateToMediaCollectionEvent",value:function(e){switch(e){case ge.Buffer:return V.BufferStart;case ge.Seek:return V.PauseStart;case ge.Play:return V.Play;case ge.Pause:return V.PauseStart;case ge.Stall:return V.Play;case ge.Init:return V.Ping;default:return""}}}]),e}(),Ee=new Map;Ee.set(I.Show,j.Show),Ee.set(I.Season,j.Season),Ee.set(I.Episode,j.Episode),Ee.set(I.AssetId,j.AssetId),Ee.set(I.Genre,j.Genre),Ee.set(I.FirstAirDate,j.FirstAirDate),Ee.set(I.FirstDigitalDate,j.FirstDigitalDate),Ee.set(I.Rating,j.Rating),
Ee.set(I.Originator,j.Originator),Ee.set(I.Network,j.Network),Ee.set(I.ShowType,j.ShowType),Ee.set(I.AdLoad,j.AdLoad),Ee.set(I.MVPD,j.MVPD),Ee.set(I.Authorized,j.Auth),Ee.set(I.DayPart,j.DayPart),Ee.set(I.Feed,j.Feed),Ee.set(I.StreamFormat,j.StreamFormat),Ee.set(A.Artist,j.Artist),Ee.set(A.Album,j.Album),Ee.set(A.Label,j.Label),Ee.set(A.Author,j.Author),Ee.set(A.Station,j.Station),Ee.set(A.Publisher,j.Publisher),Se._standardMediaMetadataMap=Ee;var Pe=new Map;Pe.set(C.Advertiser,z.Advertiser),Pe.set(C.CampaignId,z.CampaignId),Pe.set(C.CreativeId,z.CreativeId),Pe.set(C.PlacementId,z.PlacementId),Pe.set(C.SiteId,z.SiteId),Pe.set(C.CreativeUrl,z.CreativeUrl),Se._standardAdMetadataMap=Pe;var Ie="Media tracker is not in active tracking session, call 'API:trackSessionStart' to begin a new tracking session.",Ae="Media tracker is in active tracking session, call 'API:trackSessionEnd' or 'API:trackComplete' to end current tracking session.",Ce="Media tracker is tracking buffer events, call 'API:trackEvent(BufferComplete)' first to stop tracking buffer events.",be="Media tracker is not tracking buffer events, call 'API:trackEvent(BufferStart)' before 'API:trackEvent(BufferComplete)'.",Te="Media tracker is tracking seek events, call 'API:trackEvent(SeekComplete)' first to stop tracking seek events.",Me="Media tracker is not tracking seek events, call 'API:trackEvent(SeekStart)' before 'API:trackEvent(SeekComplete)'.",we="Media tracker is not tracking any AdBreak, call 'API:trackEvent(AdBreakStart)' to begin tracking AdBreak",De="Media tracker is not tracking any Ad, call 'API:trackEvent(AdStart)' to begin tracking Ad",Oe="Media tracker is not tracking any Chapter, call 'API:trackEvent(ChapterStart)' to begin tracking Chapter",Re="MediaInfo passed into 'API:trackSessionStart' is invalid.",Le="AdBreakInfo passed into 'API:trackEvent(AdBreakStart)' is invalid.",Ne="Media tracker is currently tracking the AdBreak passed into 'API:trackEvent(AdBreakStart)'.",Be="AdInfo passed into 'API:trackEvent(AdStart)' is invalid.",Ve="StateInfo passed into 'API:trackEvent(StateStart|StateEnd)' is invalid.",je="ErrorId passed into 'API:trackError()' is invalid.",ze="Media tracker is currently tracking the Ad passed into 'API:trackEvent(AdStart)'.",Ue="ChapterInfo passed into 'API:trackEvent(ChapterStart)' is invalid.",Fe="Media tracker is currently tracking the Chapter passed into 'API:trackEvent(ChapterStart)'.",He="QoEInfo passed into 'API:updateQoEInfo' is invalid.",xe="Media tracker is tracking an AdBreak but not tracking any Ad and will drop any calls to track player state (Play, Pause, Buffer or Seek) in this state.",qe="Media tracker is already tracking a state with the same state name.",Ge="Media tracker is not already tracking a state with the same state name.",Qe="Media tracker has reached maximum number of states per session (10).",Ke=new RegExp("^[a-zA-Z0-9_\\.]+$"),Ye=function(){function e(a,i,r){if(t(this,e),!a)throw new Error("hitProcessor should be valid");if(!i)throw new Error("logger should be valid");this._hitProcessor=a,this._logger=i,this._config=X(r)?r:{},this._resetStates(),this._setupRules()}return i(e,[{key:"track",value:function(t){var a=t[pe.Name];return R(a)?J(t[pe.TimeStamp])?(X(t[pe.Params])||(t[pe.Params]={}),t[pe.Metadata]=e._cleanMetadata(t[pe.Metadata]),!!this._prerollDeferRule(a,t)||this._processRule(a,t)):(this._logger.log("#track - Event timestamp is missing in track event data. - "+a),!1):(this._logger.log("#track - Event name is missing in track event data"),!1)}},{key:"_resetStates",value:function(){this._media=null,this._hitGenerator=null,this._inPrerollInterval=!1,this._prerollRefTs=null,this._prerollQueuedRules=[],this._contentStarted=!1,this._contentStartRefTs=-1,this._mediaIdle=!1,this._trackerIdle=!1,this._mediaIdleStartTs=0}},{key:"_createHitGenerator",value:function(e){return new Se(this._logger,this._hitProcessor,this._config,this._media,e)}},{key:"_processRule",value:function(e,t){return this._ruleEngine.processRule(e,t).success}},{key:"_setupRules",value:function(){this._ruleEngine=new ve(this._logger),this._ruleEngine.setEnterAction(this._cmdEnterAction.bind(this)),this._ruleEngine.setExitAction(this._cmdExitAction.bind(this));var e=this._isInMedia.bind(this),t=this._isInAdBreak.bind(this),a=this._isInAd.bind(this),i=this._isInChapter.bind(this),r=this._isInTrackedState.bind(this),n=this._isValidMediaInfo.bind(this),s=this._isValidAdBreakInfo.bind(this),o=this._isValidAdInfo.bind(this),d=this._isValidChapterInfo.bind(this),c=this._isValidQoEInfo.bind(this),l=this._isValidStateInfo.bind(this),u=this._isValidErrorInfo.bind(this),h=this._isDifferentAdBreakInfo.bind(this),f=this._isDifferentAdInfo.bind(this),p=this._isDifferentChapterInfo.bind(this),m=this._allowPlayerStateChange.bind(this),_=this._allowStateTrack.bind(this),v=this._isInBuffering.bind(this),g=this._isInSeeking.bind(this),y=this._cmdMediaStart.bind(this),k=this._cmdMediaSkip.bind(this),S=this._cmdMediaComplete.bind(this),E=this._cmdError.bind(this),P=this._cmdPlay.bind(this),I=this._cmdPause.bind(this),A=this._cmdBufferStart.bind(this),C=this._cmdBufferComplete.bind(this),b=this._cmdSeekStart.bind(this),T=this._cmdSeekComplete.bind(this),M=this._cmdAdStart.bind(this),w=this._cmdAdComplete.bind(this),D=this._cmdAdSkip.bind(this),O=this._cmdAdBreakStart.bind(this),R=this._cmdAdBreakComplete.bind(this),L=this._cmdAdBreakSkip.bind(this),N=this._cmdChapterStart.bind(this),B=this._cmdChapterComplete.bind(this),V=this._cmdChapterSkip.bind(this),j=this._cmdStateStart.bind(this),z=this._cmdStateEnd.bind(this),U=this._cmdBitrateChange.bind(this),F=this._cmdQoEUpdate.bind(this),H=this._cmdPlayheadUpdate.bind(this),x=new _e(me.SessionStart,"API:trackSessionStart");x.addPredicate(e,!1,Ae).addPredicate(n,!0,Re).addAction(y),this._ruleEngine.addRule(x);var q=new _e(me.SessionComplete,"API:trackComplete");q.addPredicate(e,!0,Ie).addAction(D).addAction(L).addAction(V).addAction(S),this._ruleEngine.addRule(q);var G=new _e(me.SessionEnd,"API:trackSessionEnd");G.addPredicate(e,!0,Ie).addAction(D).addAction(L).addAction(V).addAction(k),this._ruleEngine.addRule(G);var Q=new _e(me.Error,"API:trackError");Q.addPredicate(e,!0,Ie).addPredicate(u,!0,je).addAction(E),this._ruleEngine.addRule(Q);var K=new _e(me.Play,"API:trackPlay");K.addPredicate(e,!0,Ie).addPredicate(m,!0,xe).addAction(T).addAction(C).addAction(P),this._ruleEngine.addRule(K);var Y=new _e(me.Pause,"API:trackPause");Y.addPredicate(e,!0,Ie).addPredicate(m,!0,xe).addPredicate(v,!1,Ce).addPredicate(g,!1,Te).addAction(I),this._ruleEngine.addRule(Y);var W=new _e(me.BufferStart,"API:trackEvent(BufferStart)");W.addPredicate(e,!0,Ie).addPredicate(m,!0,xe).addPredicate(v,!1,Ce).addPredicate(g,!1,Te).addAction(A),this._ruleEngine.addRule(W);var Z=new _e(me.BufferComplete,"API:trackEvent(BufferComplete)");Z.addPredicate(e,!0,Ie).addPredicate(m,!0,xe).addPredicate(v,!0,be).addAction(C),this._ruleEngine.addRule(Z);var $=new _e(me.SeekStart,"API:trackEvent(SeekStart)");$.addPredicate(e,!0,Ie).addPredicate(m,!0,xe).addPredicate(g,!1,Te).addPredicate(v,!1,Ce).addAction(b),this._ruleEngine.addRule($);var J=new _e(me.SeekComplete,"API:trackEvent(SeekComplete)");J.addPredicate(e,!0,Ie).addPredicate(m,!0,xe).addPredicate(g,!0,Me).addAction(T),this._ruleEngine.addRule(J);var X=new _e(me.AdBreakStart,"API:trackEvent(AdBreakStart)");X.addPredicate(e,!0,Ie).addPredicate(s,!0,Le).addPredicate(h,!0,Ne).addAction(D).addAction(L).addAction(O),this._ruleEngine.addRule(X);var ee=new _e(me.AdBreakComplete,"API:trackEvent(AdBreakComplete)");ee.addPredicate(e,!0,Ie).addPredicate(t,!0,we).addAction(D).addAction(R),this._ruleEngine.addRule(ee);var te=new _e(me.AdStart,"API:trackEvent(AdStart)");te.addPredicate(e,!0,Ie).addPredicate(t,!0,we).addPredicate(o,!0,Be).addPredicate(f,!0,ze).addAction(D).addAction(M),this._ruleEngine.addRule(te);var ae=new _e(me.AdComplete,"API:trackEvent(AdComplete)");ae.addPredicate(e,!0,Ie).addPredicate(t,!0,we).addPredicate(a,!0,De).addAction(w),this._ruleEngine.addRule(ae);var ie=new _e(me.AdSkip,"API:trackEvent(AdSkip)");ie.addPredicate(e,!0,Ie).addPredicate(t,!0,we).addPredicate(a,!0,De).addAction(D),this._ruleEngine.addRule(ie);var re=new _e(me.ChapterStart,"API::trackEvent(chapterStart)");re.addPredicate(e,!0,Ie).addPredicate(d,!0,Ue).addPredicate(p,!0,Fe).addAction(V).addAction(N),this._ruleEngine.addRule(re);var ne=new _e(me.ChapterComplete,"API::trackEvent(chapterComplete)");ne.addPredicate(e,!0,Ie).addPredicate(i,!0,Oe).addAction(B),this._ruleEngine.addRule(ne);var se=new _e(me.ChapterSkip,"API:trackEvent(chapterSkip)");se.addPredicate(e,!0,Ie).addPredicate(i,!0,Oe).addAction(V),this._ruleEngine.addRule(se);var oe=new _e(me.BitrateChange,"API:trackEvent(BitrateChange)");oe.addPredicate(e,!0,Ie).addAction(U),this._ruleEngine.addRule(oe);var de=new _e(me.QoEUpdate,"API:trackEvent(QoEUpdate)");de.addPredicate(e,!0,Ie).addPredicate(c,!0,He).addAction(F),this._ruleEngine.addRule(de);var ce=new _e(me.PlayheadUpdate,"API:trackEvent(PlayheadUpdate)");ce.addPredicate(e,!0,Ie).addAction(H),this._ruleEngine.addRule(ce);var le=new _e(me.StateStart,"API:trackEvent(StateStart)");le.addPredicate(e,!0,Ie).addPredicate(l,!0,Ve).addPredicate(r,!1,qe).addPredicate(_,!0,Qe).addAction(j),this._ruleEngine.addRule(le);var ue=new _e(me.StateEnd,"API:trackEvent(StateEnd)");ue.addPredicate(e,!0,Ie).addPredicate(l,!0,Ve).addPredicate(r,!0,Ge).addAction(z),this._ruleEngine.addRule(ue)}},{key:"_isInMedia",value:function(){return!M(this._media)}},{key:"_isInAdBreak",value:function(){return this._media.isInAdBreak}},{key:"_isInAd",value:function(){return this._media.isInAd}},{key:"_isInChapter",value:function(){return this._media.isInChapter}},{key:"_isInBuffering",value:function(){return this._media.isInPlaybackState(ge.Buffer)}},{key:"_isInSeeking",value:function(){return this._media.isInPlaybackState(ge.Seek)}},{key:"_isInTrackedState",value:function(e){var t=ce.deserialize(e[pe.Params]);return this._media.isCustomStateActive(t)}},{key:"_isValidMediaInfo",value:function(e){return null!=le.deserialize(e[pe.Params])}},{key:"_isValidAdBreakInfo",value:function(e){return null!=se.deserialize(e[pe.Params])}},{key:"_isValidAdInfo",value:function(e){return null!=ne.deserialize(e[pe.Params])}},{key:"_isValidStateInfo",value:function(e){return null!=ce.deserialize(e[pe.Params])}},{key:"_isValidChapterInfo",value:function(e){return null!=oe.deserialize(e[pe.Params])}},{key:"_isValidQoEInfo",value:function(e){return null!=ue.deserialize(e[pe.Params])}},{key:"_isValidErrorInfo",value:function(e){var t=e[pe.Params];if(!X(t))return!1;var a=t[pe.ErrorId];return R(a)}},{key:"_isDifferentAdBreakInfo",value:function(e){return!se.deserialize(e[pe.Params]).equal(this._media.adBreakInfo)}},{key:"_isDifferentAdInfo",value:function(e){return!ne.deserialize(e[pe.Params]).equal(this._media.adInfo)}},{key:"_isDifferentChapterInfo",value:function(e){return!oe.deserialize(e[pe.Params]).equal(this._media.chapterInfo)}},{key:"_allowPlayerStateChange",value:function(){return!this._media.isInAdBreak||this._media.isInAd}},{key:"_allowStateTrack",value:function(e){var t=ce.deserialize(e[pe.Params]);return this._media.hasTrackedCustomState(t)||this._media.numTrackedCustomStates()<10}},{key:"_cmdEnterAction",value:function(e,t){var a=this._getRefTs(t);return M(this._hitGenerator)||this._hitGenerator.setRefTS(a),!0}},{key:"_cmdExitAction",value:function(e,t){if(M(this._media))return!1;e.id===me.AdStart&&(!this._media.isInPlaybackState(ge.Init)||this._media.isInPlaybackState(ge.Buffer)||this._media.isInPlaybackState(ge.Seek)||this._media.enterPlaybackState(ge.Play)),e.id!==me.BufferComplete&&e.id!==me.SeekComplete||this._media.isInPlaybackState(ge.Init)&&this._media.enterPlaybackState(ge.Pause),this._cmdIdleDetection(t),this._cmdContentStartDetection(t);var a=e.id===me.AdStart||e.id===me.AdBreakComplete;return this._hitGenerator.processPlayback(a),!0}},{key:"_cmdMediaStart",value:function(e){var t=le.deserialize(e[pe.Params]),a=e[pe.Metadata],i=this._getRefTs(e);return this._media=new ye(t,a),this._hitGenerator=this._createHitGenerator(i),this._hitGenerator.processMediaStart(),this._inPrerollInterval=0!==t.prerollWaitTime,this._prerollRefTs=i,!0}},{key:"_cmdMediaComplete",value:function(){return this._hitGenerator.processMediaComplete(),this._resetStates(),!0}},{key:"_cmdMediaSkip",value:function(){return this._hitGenerator.processMediaSkip(),this._resetStates(),!0}},{key:"_cmdAdBreakStart",value:function(e){var t=se.deserialize(e[pe.Params]);return this._media.setAdBreakInfo(t),this._hitGenerator.processAdBreakStart(),!0}},{key:"_cmdAdBreakComplete",value:function(){return this._hitGenerator.processAdBreakComplete(),this._media.clearAdBreakInfo(),!0}},{key:"_cmdAdBreakSkip",value:function(){return this._media.isInAdBreak&&(this._hitGenerator.processAdBreakSkip(),this._media.clearAdBreakInfo()),!0}},{key:"_cmdAdStart",value:function(e){var t=ne.deserialize(e[pe.Params]),a=e[pe.Metadata];return this._media.setAdInfo(t,a),this._hitGenerator.processAdStart(),!0}},{key:"_cmdAdComplete",value:function(){return this._hitGenerator.processAdComplete(),this._media.clearAdInfo(),!0}},{key:"_cmdAdSkip",value:function(){return this._media.isInAd&&(this._hitGenerator.processAdSkip(),this._media.clearAdInfo()),!0}},{key:"_cmdChapterStart",value:function(e){var t=oe.deserialize(e[pe.Params]),a=e[pe.Metadata];return this._media.setChapterInfo(t,a),this._hitGenerator.processChapterStart(),!0}},{key:"_cmdChapterComplete",value:function(){return this._hitGenerator.processChapterComplete(),this._media.clearChapterInfo(),!0}},{key:"_cmdChapterSkip",value:function(){return this._media.isInChapter&&(this._hitGenerator.processChapterSkip(),this._media.clearChapterInfo()),!0}},{key:"_cmdError",value:function(e){var t=e[pe.Params][pe.ErrorId];return this._hitGenerator.processError(t),!0}},{key:"_cmdBitrateChange",value:function(){return this._hitGenerator.processBitrateChange(),!0}},{key:"_cmdPlay",value:function(){return this._media.enterPlaybackState(ge.Play),!0}},{key:"_cmdPause",value:function(){return this._media.enterPlaybackState(ge.Pause),!0}},{key:"_cmdBufferStart",value:function(){return this._media.enterPlaybackState(ge.Buffer),!0}},{key:"_cmdBufferComplete",value:function(){return this._media.isInPlaybackState(ge.Buffer)&&this._media.exitPlaybackState(ge.Buffer),!0}},{key:"_cmdSeekStart",value:function(){return this._media.enterPlaybackState(ge.Seek),!0}},{key:"_cmdSeekComplete",value:function(){return this._media.isInPlaybackState(ge.Seek)&&this._media.exitPlaybackState(ge.Seek),!0}},{key:"_cmdQoEUpdate",value:function(e){var t=ue.deserialize(e[pe.Params]);return this._media.qoeInfo=t,!0}},{key:"_cmdPlayheadUpdate",value:function(e){var t=e[pe.Params];if(X(t)){var a=t[pe.Playhead];$(a)&&a>=0&&(this._media.playhead=a)}return!0}},{key:"_cmdIdleDetection",value:function(e){if(this._media.isIdle()){var t=this._getRefTs(e);this._mediaIdle?!this._trackerIdle&&t-this._mediaIdleStartTs>18e5&&(this._hitGenerator.processIdleStart(),this._trackerIdle=!0):(this._mediaIdle=!0,this._mediaIdleStartTs=t)}else this._trackerIdle&&(this._hitGenerator.processIdleComplete(),this._trackerIdle=!1,this._contentStarted=!1,this._contentStartRefTs=-1),this._mediaIdle=!1}},{key:"_cmdContentStartDetection",value:function(e){return!(!this._media.isIdle()&&!this._contentStarted&&(this._media.isInAdBreak?(this._contentStartRefTs=-1,0):(-1===this._contentStartRefTs&&(this._contentStartRefTs=this._getRefTs(e)),this._getRefTs(e)-this._contentStartRefTs>=1e3&&(this._hitGenerator.processPlayback(!0),this._contentStarted=!0),0)))}},{key:"_cmdStateStart",value:function(e){var t=ce.deserialize(e[pe.Params]);return this._media.startCustomState(t),this._hitGenerator.processCustomStateStart(t),!0}},{key:"_cmdStateEnd",value:function(e){var t=ce.deserialize(e[pe.Params]);return this._media.endCustomState(t),this._hitGenerator.processCustomStateEnd(t),!0}},{key:"_getRefTs",value:function(e){var t=e[pe.TimeStamp];return J(t)?t:null}},{key:"_prerollDeferRule",value:function(e,t){if(this._inPrerollInterval&&null!=this._media){var a=this._media.mediaInfo.prerollWaitTime;if(this._prerollQueuedRules.push({eventName:e,context:t}),this._getRefTs(t)-this._prerollRefTs>=a||e===me.AdBreakStart||e===me.MediaComplete||e===me.MediaSkip){for(var i=this._prerollReorderRules(this._prerollQueuedRules),r=0;r<i.length;r++){var n=i[r];this._processRule(n.eventName,n.context)}this._prerollQueuedRules=[],this._inPrerollInterval=!1}return!0}return!1}},{key:"_prerollReorderRules",value:function(e){for(var t=[],a=!1,i=0;i<e.length;++i)if(e[i].eventName===me.AdBreakStart){a=!0;break}for(var r=a,n=0;n<e.length;n++){var s=e[n];s.eventName===me.Play&&r||(s.eventName===me.AdBreakStart&&(r=!1),t.push(s))}return t}}],[{key:"_cleanMetadata",value:function(e){var t={};return X(e)&&Object.keys(e).forEach((function(a){var i=e[a];Ke.test(a)&&!M(i)&&(t[a]=String(i))})),t}}]),e}(),We=function(){function e(a,i,r){t(this,e),this._logger=_(i),this._tracker=new Ye(a,this._logger,r),this._timer=null,this._lastEventTS=null,this._lastPlayheadParams=null}return i(e,[{key:"trackSessionStart",value:function(e,t){this._logger.log("trackSessionStart(info:"+fe(e)+" metadata:"+fe(t)+")"),this._trackInternal(me.SessionStart,e,t)}},{key:"trackSessionEnd",value:function(){this._logger.log("trackSessionEnd"),this._trackInternal(me.SessionEnd)}},{key:"trackComplete",value:function(){this._logger.log("trackComplete"),this._trackInternal(me.SessionComplete)}},{key:"trackPlay",value:function(){this._logger.log("trackPlay"),this._trackInternal(me.Play)}},{key:"trackPause",value:function(){this._logger.log("trackPause"),this._trackInternal(me.Pause)}},{key:"trackEvent",value:function(e,t,a){this._logger.log("trackEvent("+e+" info:"+fe(t)+" metadata:"+fe(a)+")"),this._trackInternal(e,t,a)}},{key:"trackError",value:function(e){this._logger.log("trackError("+e+")");var t=r({},pe.ErrorId,e);this._trackInternal(me.Error,t)}},{key:"updatePlayhead",value:function(e){var t=r({},pe.Playhead,e);this._trackInternal(me.PlayheadUpdate,t)}},{key:"updateQoEObject",value:function(e){this._logger.log("updateQoEObject("+fe(e)+")"),this._trackInternal(me.QoEUpdate,e)}},{key:"destroy",value:function(){this._logger.log("destroy()"),this._stopTimer(),this._tracker=null}},{key:"_trackInternal",value:function(e,t,a){var i,n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(this._tracker){var s=h(),o=(r(i={},pe.Name,e),r(i,pe.Params,t),r(i,pe.Metadata,a),r(i,pe.TimeStamp,s),r(i,pe.InternalEvent,n),i),d=this._tracker.track(o);this._lastEventTS=s,e===me.PlayheadUpdate&&(this._lastPlayheadParams=t),e===me.SessionStart&&d?this._startTimer():e!==me.SessionComplete&&e!==me.SessionEnd||this._stopTimer()}else this._logger.warn("Dropping the call as the tracker instance is already destroyed")}},{key:"_startTimer",value:function(){var e=this;this._timer||(this._timer=f((function(){e._onTick()}),500))}},{key:"_stopTimer",value:function(){var e;this._timer&&(e=this._timer,clearInterval(e),this._timer=null)}},{key:"_onTick",value:function(){h()-this._lastEventTS>750&&this._trackInternal(me.PlayheadUpdate,this._lastPlayheadParams,null,!0)}}]),e}(),Ze=new re,$e=u(),Je={configure:function(e){Ze.configure(e)},getInstance:function(e){var t="tracker"+$e.getUniqueId();return new We(Ze,t,e)},createMediaObject:function(e,t,a,i,r){var n=null;try{n=new le({id:t,name:e,streamType:i,mediaType:r,length:a}).serialize()}catch(e){he.error("Error creating MediaObject ("+e.message+")")}return n},createAdBreakObject:function(e,t,a){var i=null;try{i=new se({name:e,position:t,startTime:a}).serialize()}catch(e){he.error("Error creating AdBreakObject ("+e.message+")")}return i},createAdObject:function(e,t,a,i){var r=null;try{r=new ne({id:t,name:e,position:a,length:i}).serialize()}catch(e){he.error("Error creating AdObject ("+e.message+")")}return r},createChapterObject:function(e,t,a,i){var r=null;try{r=new oe({name:e,position:t,length:a,startTime:i}).serialize()}catch(e){he.error("Error creating ChapterObject ("+e.message+")")}return r},createQoEObject:function(e,t,a,i){var r=null;try{r=new ue({bitrate:e,droppedFrames:i,fps:a,startupTime:t}).serialize()}catch(e){he.error("Error creating QoEObject ("+e.message+")")}return r},createStateObject:function(e){var t=null;try{t=new ce({name:e}).serialize()}catch(e){he.error("Error creating StateObject ("+e.message+")")}return t},version:"js-3.0.0",Event:k,MediaType:E,PlayerState:P,StreamType:b,MediaObjectKey:S,VideoMetadataKeys:I,AudioMetadataKeys:A,AdMetadataKeys:C},Xe="ecid",et="analytics",tt="mediaanalytics",at=function(e){function a(e,i){var r;if(t(this,a),r=s.call(this),!e)throw new Error("Valid appmeasurement instance is required");if(!e.visitor)throw new Error("Valid visitor instance is required");return r._mediaConfig=i,r._appMeasurement=e,r._appMeasurementReady=!1,r._privacyResolved=!1,r._logger=_("WebECResolver"),r._fetchECParams(),r._fetchPrivacyStatus(),r._setupResolver(),r}!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&d(e,t)}(a,e);var n,s=(n=a,function(){var e,t=o(n);if(c()){var a=o(this).constructor;e=Reflect.construct(t,arguments,a)}else e=t.apply(this,arguments);return l(this,e)});return i(a,[{key:"resolveKeys",value:function(e){if(!e||0===e.length)return{};for(var t={},a=0;a<e.length;a++){var i=e[a],r=Object.prototype.hasOwnProperty.call(this._fnMap,i)?this._fnMap[i].call(this):null;M(r)||(t[i]=r)}return t}},{key:"getPrivacyStatus",value:function(){return this._privacyStatus[tt]}},{key:"notifyPrivacyChange",value:function(e){this._mediaPrivacyClb.push(e)}},{key:"isReady",value:function(){return!!this._privacyResolved&&this._privacyStatus[tt]===T.OptIn&&(this._privacyStatus[et]!==T.OptIn||this._appMeasurementReady)}},{key:"_setupResolver",value:function(){var e=this,t={};t[N.Rsid]=function(){return e._appMeasurement.account},t[N.AnalyticsTrackingServer]=function(){return e._appMeasurement.ssl&&e._appMeasurement.trackingServerSecure?e._appMeasurement.trackingServerSecure:e._appMeasurement.trackingServer},t[N.AnalyticsSsl]=function(){return e._appMeasurement.ssl},t[N.Vid]=function(){return e._appMeasurement.visitorID},t[N.Aid]=function(){var t=e._appMeasurement.analyticsVisitorID;if(""!==t)return t},t[N.Mcid]=function(){return e._appMeasurement.marketingCloudVisitorID},t[N.McOrgId]=function(){return e._appMeasurement.visitor.marketingCloudOrgID},t[N.AamLocHint]=function(){var t=parseInt(e._appMeasurement.audienceManagerLocationHint,10);return isNaN(t)?void 0:t},t[N.CustomerIds]=function(){return e._appMeasurement.visitor.getCustomerIDs()},t[N.MediaTrackingServer]=function(){return e._mediaConfig.trackingServer},t[N.MediaChannel]=function(){return e._mediaConfig.channel},t[N.MediaAppVersion]=function(){return e._mediaConfig.appVersion},t[N.MediaPlayerName]=function(){return e._mediaConfig.playerName},t[N.MediaSsl]=function(){return e._mediaConfig.ssl},this._fnMap=t}},{key:"_fetchECParams",value:function(){this._appMeasurement.isReadyToTrack()?this._onAppMeasurementReady():this._appMeasurement.callbackWhenReadyToTrack(this,this._onAppMeasurementReady,[])}},{key:"_onAppMeasurementReady",value:function(){this._logger.log("AppMeasurement ready"),this._appMeasurementReady=!0}},{key:"_fetchPrivacyStatus",value:function(){var e,t=this;this._mediaPrivacyClb=[],this._optIn=window.adobe&&window.adobe.optIn?window.adobe.optIn:void 0;var a=this._optIn&&this._optIn.doesOptInApply,i=a?T.OptUnknown:T.OptIn;this._privacyStatus=(r(e={},Xe,i),r(e,et,i),r(e,tt,i),e),a?this._optIn.fetchPermissions((function(){t._privacyResolved=!0,t._privacyStatus[Xe]=t._optIn.isApproved(t._optIn.Categories.ECID)?T.OptIn:T.OptOut,t._privacyStatus[et]=t._optIn.isApproved(t._optIn.Categories.ANALYTICS)?T.OptIn:T.OptOut,t._privacyStatus[tt]=t._optIn.isApproved(t._optIn.Categories.MEDIA_ANALYTICS)?T.OptIn:T.OptOut,t._mediaPrivacyClb.forEach((function(e){e(t._privacyStatus[tt])})),t._logger.log("Privacy Status "+fe(t._privacyStatus))}),!0):(this._privacyResolved=!0,this._logger.log("OptIn service not used, defaulting privacy status to "+fe(this._privacyStatus)))}}]),a}(function(){function e(){t(this,e)}return i(e,[{key:"resolveKeys",value:function(){throw new Error("Implementation error: Method must be overridden.")}},{key:"isReady",value:function(){}},{key:"getPrivacyStatus",value:function(){}},{key:"notifyPrivacyChange",value:function(){}}]),e}()),it=_("Media"),rt=!1;return{Media:s({},Je,{configure:function(e,t){if(p(e||{}),rt)it.error("MediaSDK is already configured");else{it.log("configure("+fe(e)+")");try{!function(e){if(!X(e))throw new Error("mediaConfig is not a valid object");var t=e.trackingServer;if(!R(t))throw new Error("trackingServer is empty");if(-1!==t.indexOf("hb.omtrdc.net"))throw new Error("trackingServer should be set to Media collection endpoint and not heartbeat endpoint. Contact your Adobe representative for more information.")}(e);var a=new at(t,e);Je.configure(a),rt=!0}catch(e){it.error("Error configuring MediaSDK : "+e.message),p({debugLogging:!1})}}},getInstance:function(e){return rt?Je.getInstance(e):(it.error("MediaSDK should be configured before calling getInstance"),null)}}),MediaConfig:function e(){t(this,e),this.trackingServer=void 0,this.channel=void 0,this.appVersion=void 0,this.playerName=void 0,this.ssl=!0,this.debugLogging=!1}}},"object"==typeof exports&&"undefined"!=typeof module?module.exports=a():"function"==typeof define&&define.amd?define(a):(t=t||self).ADB=a(),function(){"use strict";function e(){this._events={}}function t(){return t.prototype._instance||(t.prototype._instance=new e),t.prototype._instance}e.prototype.addEventListener=function(e,t,a){e&&t&&(a=a||window,this._events[e]=this._events[e]||[],this._events[e].push({cb:t,ctx:a}))},e.prototype.removeEventListener=function(e,t,a){if(e&&t){a=a||window;var i,r,n=!1;for(r in this._events)if(e===r){n=!0;break}if(n){for(i=this._events[r].length-1;i>=0;i--){var s=this._events[r][i];t===s.cb&&a===s.ctx&&this._events[r].splice(i,1)}this._events[r].length||delete this._events[r]}}},e.prototype.dispatchEvent=function(e){var t,a;if(e)for(t in this._events)if(this._events.hasOwnProperty(t)&&e===t){var i=this._events[t].slice(0),r=i.length;for(a=0;a<r;a++)i[a].cb.call(i[a].ctx);break}},window.NotificationCenter=t}(),function(){"use strict";var t,a;t="mobileRider",a=digitalData._get("video.videoInfo.videoMediaType"),e.Configuration={PLAYER:{NAME:t,VIDEO_ID:digitalData._get("video.videoInfo.videoId")||"video id not set",VIDEO_NAME:digitalData._get("video.videoInfo.videoName")||"video name not set"},streamType:a,VISITOR:{MARKETING_CLOUD_ORG_ID:"9E1005A551ED61CA0A490D45@AdobeOrg",TRACKING_SERVER:"adobecorp.adobe.com",DPID:"sample-dpid",DPUUID:"sample-dpuuid"},APP_MEASUREMENT:{RSID:s_adbadobenonacdc.account,TRACKING_SERVER:"adobecorp.sc.omtrdc.net",PAGE_NAME:digitalData._get("digitalData.page.pageInfo.pageName")},HEARTBEAT:{TRACKING_SERVER:"adobecorp.hb-api.omtrdc.net",PUBLISHER:"Marketing Enablement Team",CHANNEL:digitalData._get("digitalData.page.pageInfo.location.hostname"),SDK:"Media SDK 3.x Sample Player v1.0"}}}(),function(){"use strict";function t(e){this._playerName=Configuration.PLAYER.NAME,this._videoId=Configuration.PLAYER.VIDEO_ID,this._videoName=Configuration.PLAYER.VIDEO_NAME,this._streamType=Configuration.streamType,this._videoLoaded=!1,this._adBreakInfo=null,this._adInfo=null,this._chapterInfo=null,this._clock=null,this._lastReportedTime=-1,this._qoeInfo={bitrate:5e4,startupTime:1,fps:23,droppedFrames:0},this.el=document.querySelectorAll(e)[0],this._muted=!!this.el.muted,this._fullScreen=!1;var t=this;if(this.el){this.el.addEventListener("playing",(function(){t._onPlay()})),this.el.addEventListener("seeking",(function(){t._onSeekStart()})),this.el.addEventListener("seeked",(function(){t._onSeekComplete()})),this.el.addEventListener("pause",(function(){t._onPause()})),this.el.addEventListener("ended",(function(){t._onComplete()})),this.el.addEventListener("volumechange",(function(){var e=0===t.el.volume||t.el.muted;t._muted!=e&&(t._muted=e,t._onMuteChange())}));var a=function(){var e=!!(document.fullScreen||document.mozFullScreen||document.webkitIsFullScreen);t._fullScreen!=e&&(t._fullScreen=e,t._onFullScreenChange())};document.addEventListener("mozfullscreenchange",a),document.addEventListener("webkitfullscreenchange",a),document.addEventListener("fullscreenchange",a)}}var a={VIDEO_LOAD:"video_load",VIDEO_UNLOAD:"video_unload",PLAY:"play",PAUSE:"pause",COMPLETE:"COMPLETE",BUFFER_START:"buffer_start",BUFFER_COMPLETE:"buffer_complete",SEEK_START:"seek_start",SEEK_COMPLETE:"seek_complete",AD_START:"ad_start",AD_COMPLETE:"ad_complete",CHAPTER_START:"chapter_start",CHAPTER_COMPLETE:"chapter_complete",PLAYHEAD_UPDATE:"playhead_update",QOE_UPDATE:"qoe_update",MUTE_CHANGE:"mute_change",FULLSCREEN_CHANGE:"fullscreen_change"},i=500;t.prototype.getCurrentPlaybackTime=function(){return this.getPlayhead()},t.prototype.getVideoInfo=function(){return this._videoInfo},t.prototype.getQoEInfo=function(){return this._qoeInfo},t.prototype.getDuration=function(){return this.el.duration},t.prototype.getPlayhead=function(){var e=this.el.currentTime;return e||0},t.prototype.isMuted=function(){return this._muted},t.prototype.isFullscreen=function(){return this._fullScreen},t.prototype._onMuteChange=function(){this._videoLoaded&&NotificationCenter().dispatchEvent(a.MUTE_CHANGE)},t.prototype._onFullScreenChange=function(){this._videoLoaded&&NotificationCenter().dispatchEvent(a.FULLSCREEN_CHANGE)},t.prototype._onPlay=function(){this._openVideoIfNecessary(),NotificationCenter().dispatchEvent(a.PLAY)},t.prototype._onPause=function(){NotificationCenter().dispatchEvent(a.PAUSE)},t.prototype._onSeekStart=function(){this._openVideoIfNecessary(),NotificationCenter().dispatchEvent(a.SEEK_START)},t.prototype._onSeekComplete=function(){this._doPostSeekComputations(),NotificationCenter().dispatchEvent(a.SEEK_COMPLETE)},t.prototype._onComplete=function(){this._completeVideo()},t.prototype._openVideoIfNecessary=function(){if(!this._videoLoaded){this._resetInternalState(),this._startVideo();var e=this;this._clock=setInterval((function(){e._onTick()}),i)}},t.prototype._completeVideo=function(){this._videoLoaded&&(NotificationCenter().dispatchEvent(a.COMPLETE),this._unloadVideo())},t.prototype._unloadVideo=function(){NotificationCenter().dispatchEvent(a.VIDEO_UNLOAD),clearInterval(this._clock),this._resetInternalState()},t.prototype._resetInternalState=function(){this._videoLoaded=!1,this._clock=null},t.prototype._startVideo=function(){this._videoInfo={},this._videoInfo.id=this._videoId,this._videoInfo.name=this._videoName,this._videoInfo.playerName=this._playerName,this._videoInfo.playhead=this.getPlayhead(),this._videoInfo.streamType=this._streamType,this._videoInfo.length=this.getDuration?this.getDuration():86400,this._videoLoaded=!0,NotificationCenter().dispatchEvent(a.VIDEO_LOAD),NotificationCenter().dispatchEvent(a.QOE_UPDATE),this._muted&&this._onMuteChange(),this._fullScreen&&this._onFullScreenChange()},t.prototype._doPostSeekComputations=function(){this.getPlayhead()},t.prototype._onTick=function(){if(!this.el.seeking&&!this.el.paused){this.getPlayhead();var e=this.getCurrentPlaybackTime();e!=this._lastReportedTime&&NotificationCenter().dispatchEvent(a.PLAYHEAD_UPDATE),this._lastReportedTime=e}},e.PlayerEvent=a,e.VideoPlayer=t}(),function(){"use strict";function t(e){if(!e)throw new Error("Illegal argument. Player reference cannot be null.");this._player=e,this._mediaTracker=a.getInstance(),this._installEventListeners()}var a=ADB.Media,i=ADB.MediaConfig,r=Visitor.getInstance(Configuration.VISITOR.MARKETING_CLOUD_ORG_ID);r.trackingServer=Configuration.VISITOR.TRACKING_SERVER,r.setCustomerIDs({userId:{id:Configuration.VISITOR.DPID},puuid:{id:Configuration.VISITOR.DPUUID}});var n=new i;n.trackingServer=Configuration.HEARTBEAT.TRACKING_SERVER,n.playerName=Configuration.PLAYER.NAME,n.channel=Configuration.HEARTBEAT.CHANNEL,n.appVersion=Configuration.HEARTBEAT.SDK,n.ssl=!0,n.debugLogging=!1,a.configure(n,s_adbadobenonacdc),t.prototype.destroy=function(){this._mediaTracker&&(this._mediaTracker.destroy(),this._mediaTracker=null),this._player&&(this._player=null,this._uninstallEventListeners())};var s=function(){if(digitalData._get("digitalData.video.videoInfo.videoId")){var t=digitalData._get("digitalData.video.videoInfo.videoId").toString();t=t.replace("/",""),digitalData._set("digitalData.video.videoInfo.videoId",t)}var a={};a=digitalData._flatten(digitalData,"digitalData",!1),
digitalData._get("digitalData.video.videoInfo.videoId")&&digitalData._get("digitalData.video.videoInfo.videoName")&&(a["digitalData.video.videoInfo.nameId"]=digitalData._get("digitalData.video.videoInfo.videoName")+"|"+digitalData._get("digitalData.video.videoInfo.videoId").toString()),e.vidID&&(a["digitalData.video.videoInfo.videoSessionDetail"]=digitalData._get("digitalData.video.videoInfo.videoId").toString()+"|"+e.vidID);var i=document.createElement("a");i.href=e.location.href,i&&_satellite.getVar("adobe_pageNameLogic")&&(i=_satellite.getVar("adobe_pageNameLogic")(i));var r=function(e){var t=document.createElement("a");return t.href=e,t},n=r(e.location.href);return a["digitalData.page.pageInfo.pageName"]=i,digitalData._set("digitalData.page.pageInfo.pageName",i),a["digitalData.page.pageInfo.location.href"]=digitalData._get("digitalData.video.videoInfo.videoParentPageUrl"),digitalData._set("digitalData.page.pageInfo.location.href",digitalData._get("digitalData.video.videoInfo.videoParentPageUrl")),a["digitalData.page.pageInfo.location.hostname"]=digitalData._get("digitalData.video.videoInfo.videoParentHost"),digitalData._set("digitalData.page.pageInfo.location.hostname",digitalData._get("digitalData.video.videoInfo.videoParentHost")),a["digitalData.page.pageInfo.location.host"]=digitalData._get("digitalData.video.videoInfo.videoParentHost"),digitalData._set("digitalData.page.pageInfo.location.host",digitalData._get("digitalData.video.videoInfo.videoParentHost")),n&&n.pathname&&(a["digitalData.page.pageInfo.location.pathname"]=n.pathname,digitalData._set("digitalData.page.pageInfo.location.pathname",n.pathname)),a["hit.type"]="video",a};t.prototype._onLoad=function(){var e=this._player.getVideoInfo();if(e){var t=a.createMediaObject(e.name,e.id,e.length,e.streamType,e.playhead,a.MediaType.Video);this._mediaTracker.trackSessionStart(t,s())}},t.prototype._onUnload=function(){this._mediaTracker.trackSessionEnd()},t.prototype._onPlay=function(){this._mediaTracker.trackPlay()},t.prototype._onPause=function(){this._mediaTracker.trackPause()},t.prototype._onSeekStart=function(){this._mediaTracker.trackEvent(a.Event.SeekStart)},t.prototype._onSeekComplete=function(){this._mediaTracker.trackEvent(a.Event.SeekComplete)},t.prototype._onBufferStart=function(){this._mediaTracker.trackEvent(a.Event.BufferStart)},t.prototype._onBufferComplete=function(){this._mediaTracker.trackEvent(a.Event.BufferComplete)},t.prototype._onComplete=function(){var e={};e.contextData=s(),e.contextData["digitalData.primaryEvent.eventInfo.eventName"]="videoComplete",s_adbadobenonacdc.tl(!0,"o","videoComplete",e),this._mediaTracker.trackComplete()},t.prototype._onPlayheadUpdate=function(){var e=this._player.getCurrentPlaybackTime();this._mediaTracker.updatePlayhead(e)},t.prototype._onQoEUpdate=function(){var e=this._player.getQoEInfo(),t=a.createQoEObject(e.bitrate,e.startupTime,e.fps,e.droppedFrames);this._mediaTracker.updateQoEObject(t)},t.prototype._onMuteChange=function(){var e=this._player.isMuted(),t=a.createStateObject(a.PlayerState.Mute),i=e?a.Event.StateStart:a.Event.StateEnd;this._mediaTracker.trackEvent(i,t)},t.prototype._onFullscreenChange=function(){var e=this._player.isFullscreen(),t=a.createStateObject(a.PlayerState.FullScreen),i=e?a.Event.StateStart:a.Event.StateEnd;this._mediaTracker.trackEvent(i,t)},t.prototype._installEventListeners=function(){NotificationCenter().addEventListener(PlayerEvent.VIDEO_LOAD,this._onLoad,this),NotificationCenter().addEventListener(PlayerEvent.VIDEO_UNLOAD,this._onUnload,this),NotificationCenter().addEventListener(PlayerEvent.PLAY,this._onPlay,this),NotificationCenter().addEventListener(PlayerEvent.PAUSE,this._onPause,this),NotificationCenter().addEventListener(PlayerEvent.SEEK_START,this._onSeekStart,this),NotificationCenter().addEventListener(PlayerEvent.SEEK_COMPLETE,this._onSeekComplete,this),NotificationCenter().addEventListener(PlayerEvent.BUFFER_START,this._onBufferStart,this),NotificationCenter().addEventListener(PlayerEvent.BUFFER_COMPLETE,this._onBufferComplete,this),NotificationCenter().addEventListener(PlayerEvent.COMPLETE,this._onComplete,this),NotificationCenter().addEventListener(PlayerEvent.PLAYHEAD_UPDATE,this._onPlayheadUpdate,this),NotificationCenter().addEventListener(PlayerEvent.QOE_UPDATE,this._onQoEUpdate,this),NotificationCenter().addEventListener(PlayerEvent.MUTE_CHANGE,this._onMuteChange,this),NotificationCenter().addEventListener(PlayerEvent.FULLSCREEN_CHANGE,this._onFullscreenChange,this)},t.prototype._uninstallEventListeners=function(){NotificationCenter().removeEventListener(PlayerEvent.VIDEO_LOAD,this._onLoad,this),NotificationCenter().removeEventListener(PlayerEvent.VIDEO_UNLOAD,this._onUnload,this),NotificationCenter().removeEventListener(PlayerEvent.PLAY,this._onPlay,this),NotificationCenter().removeEventListener(PlayerEvent.PAUSE,this._onPause,this),NotificationCenter().removeEventListener(PlayerEvent.SEEK_START,this._onSeekStart,this),NotificationCenter().removeEventListener(PlayerEvent.SEEK_COMPLETE,this._onSeekComplete,this),NotificationCenter().removeEventListener(PlayerEvent.BUFFER_START,this._onBufferStart,this),NotificationCenter().removeEventListener(PlayerEvent.BUFFER_COMPLETE,this._onBufferComplete,this),NotificationCenter().removeEventListener(PlayerEvent.COMPLETE,this._onComplete,this),NotificationCenter().removeEventListener(PlayerEvent.PLAYHEAD_UPDATE,this._onPlayheadUpdate,this),NotificationCenter().removeEventListener(PlayerEvent.QOE_UPDATE,this._onQoEUpdate,this),NotificationCenter().removeEventListener(PlayerEvent.MUTE_CHANGE,this._onMuteChange,this),NotificationCenter().removeEventListener(PlayerEvent.FULLSCREEN_CHANGE,this._onFullscreenChange,this)},e.VideoAnalyticsProvider=t}();var i=new VideoPlayer("video");new VideoAnalyticsProvider(i)};digitalData._on("video.videoInfo.videoMediaType",(function(){digitalData._set("digitalData.primaryEvent.eventInfo.eventName","Media Started"),_satellite.track("event"),t()}))}();