(window.webpackJsonp=window.webpackJsonp||[]).push([[45],{11:function(t,e,n){var r,o=e,i=n(0),a=n(190),s=n(1),l=n(19),c=n(62),u=n(26),h=n(163),d=n(53),m=n(44),p=n(25),f=n(23),_=n(116),g=n(56),E=n(8),P=n(9),T=n(35),v=n(191),I=n(58),F=n(14);o.FormaPlatformView=i.defineProtocol("FormaPlatformView",{beginUpdate:"(FormaUpdateEvent) -> Void",endUpdate:"(FormaUpdateEvent) -> Void",formaDeleted:"() -> Void"}),o.FormaTraversal=i.defineEnum("FormaTraversal",{PreOrder:1,PostOrder:2,NearestAncestor:4,FurthestAncestor:5,JustChildren:6}),o.Forma=(r=function(t,e,n){this.PROPERTY_CONTROLLER_KIND="controller-kind",this.PROPERTY_CONTROLLER_METADATA="controller-metadata",this.intent_=null,this.moveable_=null,this.isFullCanvas=!1,this.originalID_=null,this.source_=null,this.isModel_=!1,this.page_=t,this.kind=e,this.style_=n||d.FormaStyle.createDefault(),this.uuid_=g.GUIDUtils.makeGUID(),this.id_=g.GUIDUtils.makeGUID(),this.placement_=P.Matrix2D.Identity,v.TheoDOMElement.call(this),s.CoreAssert.isTrue(null==this.style_.owner,"Initializing a forma with a style that is already owned."),this.style_.owner=this,this.styleSubscription_=this.style_.subscribe(this,d.FormaStyleChangedMessage.TYPE),this.style_.colorLibrary=this.page_.colorLibrary},i.defineClass({name:"Forma",ctor:r,superName:"TheoDOMElement",statics:{PROPERTY_KIND:"kind",PROPERTY_PLACEMENT:"placement",PROPERTY_STYLE:"style",PROPERTY_ANIMATION:"animation",PROPERTY_MOVEABLE:"moveable",PROPERTY_INTENT:"intent",PROPERTY_ORIGINAL_ID:"original-id",PROPERTY_SOURCE:"source",INTENT_LOGO:"logo",INTENT_PATTERN:"pattern",INTENT_ICON:"icon",INTENT_FLOATING_SHAPE:"floating-shape",INTENT_GRID_CELL:"grid-cell",INTENT_INFERRED_TEMP_GROUP:"inferred-temp-group",INTENT_STICKER:"sticker",ancestorsNearest:function(t,e,n){return null==t?null:n(t,e,0)?t:r.ancestorsNearest(t.parent,e-1,n)},ancestorsFurthest:function(t,e,n){if(null==t)return null;var o=r.ancestorsFurthest(t.parent,e-1,n);return null!=o?o:n(t,e,0)?t:null},_implements:function(t){return"TheoMessageSubscriber"==t}},props:{initializeToDefaults:function(){},destroy:function(){this.style.dispose(),i.opt(this.styleSubscription_,function(t){return t.unsubscribe()}),this.styleSubscription_=null},decode:function(t){var e,n,o,a=this;if(this.uuid_=t.id,this.id_=t.path,this.placement_=P.Matrix2D.decodeJson(t.property(r.PROPERTY_PLACEMENT)),this.animation_=c.FormaAnimation.decodeJson(t.property(r.PROPERTY_ANIMATION),null,this.page.document),e=this.animation_)for(var s=i.iter(e.keyFrames);!s.done;s.next()){var l=s.value;i.opt(l.style,function(t){return t.colorLibrary=a.page_.colorLibrary})}this.moveable_=t.optionalBooleanProperty(r.PROPERTY_MOVEABLE),this.intent_=t.optionalStringProperty(r.PROPERTY_INTENT),this.originalID_=t.optionalStringProperty(r.PROPERTY_ORIGINAL_ID),this.source_=t.optionalStringProperty(r.PROPERTY_SOURCE),(n=i.as(t.property(r.PROPERTY_STYLE),["Dictionary","String","Any"]))&&null!=(o=i.as(n[r.PROPERTY_KIND],"String"))&&(o==this.style.kind?this.style.decodeFromJson(n,this.page.document):this.protectedSetStyle(d.FormaStyle.decodeJson(n,o,this.page.document))),this.decodeController(t)},decodeController:function(t){var e=t.stringProperty(this.PROPERTY_CONTROLLER_KIND,"");if(0!=e.length){var n=i.opt(i.opt(this.page.document,function(t){return t.controller}),function(t){return t.controllerFactory});if(null!=n)if(this.controller=n.createController(e,this),null!=this.controller){var r=t.metadata(this.PROPERTY_CONTROLLER_METADATA);null!=r?this.controller.decode(r):s.CoreAssert.warning("Forma: No controller metadata found?")}else s.CoreAssert.warning("Forma: Factory did not create a controller for "+e+"!");else s.CoreAssert.warning("Forma: No constructor for controller kind "+e+"!")}},postDecode:function(){this.style.colorLibrary=this.page_.colorLibrary,i.opt(this.controller,function(t){return t.postDecode()})},encode:function(t){t.setStringProperty(r.PROPERTY_KIND,this.kind),t.setPath(this.id_),t.setProperty(r.PROPERTY_PLACEMENT,this.placement_.encodeJson()),t.setProperty(r.PROPERTY_STYLE,this.style.encodeJson()),t.setOptionalBooleanProperty(r.PROPERTY_MOVEABLE,this.moveable_),null!=this.animation_&&t.setProperty(r.PROPERTY_ANIMATION,this.animation_.encodeJson()),null!=this.intent_&&t.setOptionalStringProperty(r.PROPERTY_INTENT,this.intent_),null!=this.originalID_&&t.setOptionalStringProperty(r.PROPERTY_ORIGINAL_ID,this.originalID_),null!=this.source_&&t.setOptionalStringProperty(r.PROPERTY_SOURCE,this.source_),null!=this.controller&&(t.setStringProperty(this.PROPERTY_CONTROLLER_KIND,this.controller.kind),this.controller.encode(t.appendMetadata(this.PROPERTY_CONTROLLER_METADATA)))},clone:function(){var t,e;return(t=this.page_.createModelForma(this.kind))?(t.placement=this.placement,t.allowUserMove=this.allowUserMove,t.originalID=this.originalID,t.intent=this.intent,null!=this.controller&&(t.controller=this.controller.clone(t)),(e=this.style.clone())?t.protectedSetStyle(e):s.CoreAssert.fail("Forma.clone: Couldn't clone style"),t):(s.CoreAssert.fail("Forma.clone: doc.createForma returned nil"),null)},controller:{get:function(){return this.controller_},set:function(t){null==t&&i.opt(E.Host.logging,function(t){return t.warning("setting a nil controller")}),this.controller_=t}},animation:{get:function(){return this.animation_},set:function(t){this.animation_=t}},formaID:{get:function(){return this.id_}},uuid:{get:function(){return this.uuid_}},contentID:{get:function(){return null!=this.controller?this.controller.contentID:null}},originalID:{get:function(){return null!=this.originalID_?this.originalID_:this.formaID},set:function(t){this.originalID_=t}},source:{get:function(){return this.source_},set:function(t){s.CoreAssert.isTrue(h.FormaSourceUtils.isValid(t)),this.source_=t}},parent:{get:function(){return this.parent_},set:function(t){this.parent_=t}},removeFromParent:function(){null!=this.parent_&&this.parent_.removeChild(this)},root:{get:function(){return null==this.parent_?i.as(this,f.GroupForma):this.parent_.root}},isDescendent:function(t){for(var e=this.parent;null!=e;){if(e==t)return!0;e=i.opt(e,function(t){return t.parent})}return!1},visit:function(t,e){switch(t){case 4:return r.ancestorsNearest(this,0,e);case 5:return r.ancestorsFurthest(this,0,e);case 6:return null;default:if(e(this,0,0))return this}return null},visitPlaced:function(t,e){var n=[];return this.visit(o.FormaTraversal.PreOrder,function(r,o,a){return 0==o?n=[t]:(n=n.slice(0,1+o)).push(r.placement.concat(i.last(n))),e(r,i.last(n),o,a)})},visitAll:function(t,e){this.visit(t,function(t,n,r){return e(t),!1})},visitAsArray:function(t){var e=[];return this.visitAll(t,function(t){e.push(t)}),e},visitChildren:function(t){return this.visit(o.FormaTraversal.JustChildren,function(e,n,r){return t(e,r)})},filterByKind:function(t,e){void 0===e&&(e=o.FormaTraversal.PreOrder);var n=[];return this.visitAll(e,function(e){e.kind==t&&n.push(e)}),n},filterByControllerKind:function(t,e){void 0===e&&(e=o.FormaTraversal.PreOrder);var n=[];return this.visitAll(e,function(e){i.opt(e.controller,function(e){return e.kind==t})&&n.push(e)}),n},filterWithCallback:function(t,e){void 0===e&&(e=o.FormaTraversal.PreOrder);var n=[];return this.visitAll(e,function(e){t(e)&&n.push(e)}),n},successor:function(){return null==this.parent_?null:null!=(t=this.parent_.indexOfChild(this))?this.parent_.childAt(t+1):null;var t},predecessor:function(){return null==this.parent_?null:null!=(t=this.parent_.indexOfChild(this))?this.parent_.childAt(t-1):null;var t},formaByID:function(t){return this.visit(o.FormaTraversal.PreOrder,function(e,n,r){return e.formaID==t})},formaByContentID:function(t){return this.visit(o.FormaTraversal.PreOrder,function(e,n,r){return e.contentID==t})},allowUserMove:{get:function(){return this.moveable_},set:function(t){this.moveable_=t}},page:{get:function(){return this.page_},set:function(t){this.page_=t}},bounds:{get:function(){return this.boundsInCoordSpace(P.Matrix2D.Identity)},set:function(t){s.CoreAssert.fail("Forma does not support setting it's bounds")}},boundsInCoordSpace:function(t){return null},frame:{get:function(){return this.boundsInCoordSpace(this.placement)}},finalFrame:{get:function(){return this.boundsInCoordSpace(this.totalPlacement)}},placement:{get:function(){return this.placement_},set:function(t){if(!i.eq(P._equality_Matrix2D_Matrix2D,t,this.placement_))if(t.finite&&0!=t.determinant){var e=new m.FormaTransformChangedEvent(this);this.beginUpdate(e),this.placement_=t,this.endUpdate(e)}else s.CoreAssert.fail("Placement is not finite")}},totalPlacement:{get:function(){var t=P.Matrix2D.Identity;return this.visitAll(o.FormaTraversal.FurthestAncestor,function(e){t=e.placement.concat(t)}),t}},placementFromAncestor:function(t){for(var e=P.Matrix2D.Identity,n=i.iter(this.visitAsArray(o.FormaTraversal.NearestAncestor));!n.done;n.next()){var r=n.value;if(i.eq(o._equality_Forma_Forma,r,t))break;e=e.precat(r.placement)}return e},move:function(t){this.placement=this.placement.concat(t)},moveOriginToPoint:function(t){var e;(e=this.frame)?this.move(P.Matrix2D.translation(e.evalXY(0,0).multiply(-1)).translate(t)):s.CoreAssert.warning("moveOriginToPoint not possible because could not obtain frame")},moveCenterToPoint:function(t){var e;(e=this.frame)?this.move(P.Matrix2D.translation(e.evalXY(.5,.5).multiply(-1)).translate(t)):s.CoreAssert.warning("moveCenterToPoint not possible because could not obtain frame")},movePinToPoint:function(t,e){var n;(n=this.frame)?this.move(P.Matrix2D.translation(n.eval(t).multiply(-1)).translate(e)):s.CoreAssert.warning("moveCenterToPoint not possible because could not obtain frame")},rotateToDegree:function(t){var e=this.placement.transformValues;this.move(P.Matrix2D.rotation(e.rotCosine,-e.rotSine));var n=-t*Math.PI/180;this.move(P.Matrix2D.rotation(Math.cos(n),Math.sin(n)))},rotation:function(){var t=this.placement.transformValues;return 180*Math.atan2(t.rotSine,t.rotCosine)/Math.PI},containsPoint:function(t,e){if(void 0===e&&(e=0),null!=this.controller_)return this.controller.containsPoint(t,e);var n=this.bounds;return null!=n&&(0!=e&&(n=n.outsetXY(e,e)),n.containsPoint(t))},style:{get:function(){return this.style_}},applyStyle:function(t){if(null!=t){var e=new m.FormaStyleChangedEvent(this);this.beginUpdate(e),this.style.dispose(),i.opt(this.styleSubscription_,function(t){return t.unsubscribe()}),this.style_=t.clone()||this.style_,this.style.colorLibrary=this.page_.colorLibrary,this.styleSubscription_=this.style_.subscribe(this,d.FormaStyleChangedMessage.TYPE),i.opt(this.controller,function(t){return t.styleChanged()}),this.endUpdate(e)}},protectedSetStyle:function(t){if(null!=t){var e=new m.FormaStyleChangedEvent(this);this.beginUpdate(e),this.style.dispose(),i.opt(this.styleSubscription_,function(t){return t.unsubscribe()}),this.style_=t,this.style.colorLibrary=this.page_.colorLibrary,s.CoreAssert.isTrue(null==this.style_.owner,"Setting a forma style that is already owned."),this.style_.owner=this,this.styleSubscription_=this.style_.subscribe(this,d.FormaStyleChangedMessage.TYPE),this.endUpdate(e)}},onMessage:function(t){var e;(e=i.as(t,d.FormaStyleChangedMessage))&&(e.isBefore?(s.CoreAssert.isTrue(null==this.styleUpdateEvent_,"nested FormaStyleChangedMessage not allowed right now"),this.styleUpdateEvent_=new m.FormaStyleChangedEvent(this),this.beginUpdate(this.styleUpdateEvent_)):(i.opt(this.controller,function(t){return t.styleChanged()}),this.endUpdate(this.styleUpdateEvent_),this.styleUpdateEvent_=null))},match:function(t){if((this.isShape()||this.isImage()&&null!=this.controller&&this.controller.floating)&&this.placement.determinant<0!=t.placement.determinant<0){var e=this.placement.transformValues,n=P.Matrix2D.scalingXY(e.xscale<0?-1:1,e.yscale<0?-1:1);this.placement=P._asterisk_Matrix2D_Matrix2D(n,t.placement)}else this.placement=t.placement;var r,o,i;this.style.kind==t.style.kind?this.style.kind==_.GridStyle.KIND||this.style.kind==a.AlignmentGroupStyle.KIND?this.style.match(t.style):(r=t.style.clone())?this.protectedSetStyle(r):s.CoreAssert.fail("Forma.match: could not clone style"):(null!=(o=t.style.colors.colorID(l.ColorRole.FieldPrimary))&&this.style.colors.setColorId(l.ColorRole.FieldPrimary,o),null!=(i=t.style.colors.colorID(l.ColorRole.FieldSecondary))&&this.style.colors.setColorId(l.ColorRole.FieldSecondary,i)),this.allowUserMove=t.allowUserMove,null!=this.controller&&null!=t.controller&&this.controller.match(t.controller),this.source=t.source},siblingForma:function(){var t,e=[];if(t=this.parent)for(var n=i.clone(t.visitAsArray(o.FormaTraversal.JustChildren)),r=i.iter(n);!r.done;r.next()){var a=r.value;i.eq(o._equality_Forma_Forma,a,this)||e.push(a)}return e},postMatch:function(t){null!=this.controller&&null!=t.controller&&this.controller.postMatch(t.controller)},isText:function(){return!1},isImage:function(){return!1},isShape:function(){return!1},isVideo:function(){return!1},isSticker:function(){return!1},isGraphic:function(){return this.isImage()||this.isShape()},isTypeLockup:function(){return null!=this.controller&&i.opt(this.controller,function(t){return t.kind==F.TypeLockupController.KIND})},isLogo:function(){return this.hasIntent(r.INTENT_LOGO)},isGridCell:function(){var t;return!!(t=i.as(i.opt(this.parent,function(t){return t.controller}),p.GridController))&&t.isGridCell(this)},isBackgroundImage:function(){var t;return!!(t=i.as(this.controller,u.FrameController))&&!t.moveable},hasIntent:function(t){var e;return null!=(e=this.intent_)&&e==t},intent:{get:function(){return this.intent_},set:function(t){this.intent_=t}},isModel:{get:function(){return this.isModel_},set:function(t){this.isModel_=t}},isSameContent:function(t){return this.kind==T.RootForma.KIND&&t.kind==T.RootForma.KIND||null!=this.contentID&&null!=t.contentID&&this.contentID==t.contentID&&this.kind==t.kind},asString:{get:function(){var t,e,n,r=(t=i.opt(this.contentID,function(t){return t.substr(0,8)}))||null!=t?t:"nil",o=this.id_.substr(0,8),a=(e=i.opt(this.controller,function(t){return t.kind}))||null!=e?e:"";a==F.TypeLockupController.KIND&&"nil"==r&&this.contentID;var s=(n=i.opt(this.finalFrame,function(t){return t.asString}))||null!=n?n:"(nil finalFrame)";return this.kind+": "+a+" "+o+" "+r+" "+this.style.opacity+" "+(null!=this.animation_?"A":"NA")+" "+s}},print:function(){var t="";return this.visit(o.FormaTraversal.PreOrder,function(e,n,r){if(!(e instanceof I.TextForma)){for(var o="",a=i.iter(i.range(0,n,!0));!a.done;a.next())o+="    ";null!=e.controller&&(t+=o+e.asString+"\n")}return!1}),t},beginUpdate:function(t){this.isModel||this.page.beginUpdate(t)},endUpdate:function(t){this.isModel||this.page.endUpdate(t)}}}),r),o._equality_Forma_Forma=function(t,e){return null!=e&&t.formaID==e.formaID}},139:function(t,e,n){var r,o,i,a,s,l,c=e,u=n(0),h=n(50);c.FormaPageView=u.defineProtocol("FormaPageView",{beginViewUpdate:"(FormaUpdateEvent) -> AnyObject",endViewUpdate:"(AnyObject) -> Void",getViewportTransform:"() -> Matrix2D"}),c.FormaBeginUpdateMessage=(r=function(t,e){this.event=e,h.TheoMessage.call(this,r.TYPE,t)},u.defineClass({name:"FormaBeginUpdateMessage",ctor:r,superName:"TheoMessage",statics:{TYPE:{get:function(){return"FormaBeginUpdateMessage"}}}}),r),c.FormaEndUpdateMessage=(o=function(t,e){this.event=e,h.TheoMessage.call(this,o.TYPE,t)},u.defineClass({name:"FormaEndUpdateMessage",ctor:o,superName:"TheoMessage",statics:{TYPE:{get:function(){return"FormaEndUpdateMessage"}}}}),o),c.PageSizeUpdateMessage=(i=function(t,e){this.newSize=e,h.TheoMessage.call(this,i.TYPE,t)},u.defineClass({name:"PageSizeUpdateMessage",ctor:i,superName:"TheoMessage",statics:{TYPE:{get:function(){return"PageSizeUpdateMessage"}}}}),i),c.BeginFormaDragMessage=(a=function(t){h.TheoMessage.call(this,a.TYPE,t)},u.defineClass({name:"BeginFormaDragMessage",ctor:a,superName:"TheoMessage",statics:{TYPE:{get:function(){return"BeginFormaDragMessage"}}}}),a),c.FormaDragMessage=(s=function(t){h.TheoMessage.call(this,s.TYPE,t)},u.defineClass({name:"FormaDragMessage",ctor:s,superName:"TheoMessage",statics:{TYPE:{get:function(){return"FormaDragMessage"}}}}),s),c.EndFormaDragMessage=(l=function(t){h.TheoMessage.call(this,l.TYPE,t)},u.defineClass({name:"EndFormaDragMessage",ctor:l,superName:"TheoMessage",statics:{TYPE:{get:function(){return"EndFormaDragMessage"}}}}),l)},163:function(t,e,n){var r,o,i=e,a=n(0);i.FormaSourceNamespace=a.defineEnum("FormaSourceNamespace",{DesignIngredient:"di:"}),i.FormaSourceUtils=(r=function(){},o={},a.defineClass({name:"FormaSourceUtils",ctor:r,statics:{allNamespaces:{get:function(){return void 0===o.allNamespaces&&(o.allNamespaces=[i.FormaSourceNamespace.DesignIngredient]),o.allNamespaces}},isValid:function(t){if(null==t)return!0;for(var e=a.iter(r.allNamespaces);!e.done;e.next()){var n=e.value;if(r.checkMatch(t,n))return!0}return!1},isDesignIngredient:function(t){return r.checkMatch(t,i.FormaSourceNamespace.DesignIngredient)},stripNamespace:function(t){for(var e=a.iter(r.allNamespaces);!e.done;e.next()){var n=e.value;if(t.startsWith(n))return t.substr(a.toString(n).length)}return t},checkMatch:function(t,e){var n;return!(!(n=a.opt(t,function(t){return t.startsWith(e)}))&&null==n)&&n}}}),r)},21:function(t,e,n){var r,o,i,a=e,s=n(0),l=n(1),c=n(19),u=n(11),h=n(44),d=n(89),m=n(150),p=n(80),f=n(133),_=n(10);a.LRUColorCacheEntry=(r=function(t,e){this.key=t,this.value=e},s.defineClass({name:"LRUColorCacheEntry",ctor:r}),r),a.LRUColorCache=(o=function(t){this.cachedItemsByKey_={},this.cachedItemsLRU_=[],void 0===t&&(t=50),this.maxEntries_=t},s.defineClass({name:"LRUColorCache",ctor:o,props:{get:function(t){var e;return(e=this.cachedItemsByKey_[t])?(s.remove(this.cachedItemsLRU_,e),this.cachedItemsLRU_.splice(0,0,e),e.value):null},remove:function(t){var e;(e=this.cachedItemsByKey_[t])&&(s.removeKey(this.cachedItemsByKey_,t),s.remove(this.cachedItemsLRU_,e))},add:function(t,e){(n=this.cachedItemsByKey_[t])&&(s.removeKey(this.cachedItemsByKey_,t),s.remove(this.cachedItemsLRU_,n));var n=new a.LRUColorCacheEntry(t,e);this.cachedItemsByKey_[t]=n,this.cachedItemsLRU_.splice(0,0,n);var r=this.cachedItemsLRU_.length;r>this.maxEntries_&&this.cachedItemsLRU_.splice(this.maxEntries_,r-this.maxEntries_)}}}),o),a.PROPERTY_CONTENTID="content-id",a.PROPERTY_IMAGE_STYLE_DEPRECATED="image-style",a.ImageForma=(i=function(){this.contentID_=null,this.cachedBounds_=null,this.cachedContent_=null,this.avgColorCache_=new a.LRUColorCache},s.defineClass({name:"ImageForma",ctor:i,superName:"Forma",statics:{KIND:{get:function(){return"Image"}},_implements:function(t){return"TheoMessageSubscriber"==t}},props:{init_7186:function(t){u.Forma.call(this,t,i.KIND,p.ImageStyle.createDefault())},init_1fa2:function(t,e,n){u.Forma.call(this,t,e,n||p.ImageStyle.createDefault())},initializeToDefaults:function(){var t;(t=s.opt(this.page.document,function(t){return t.controller}))&&(this.controller=t.controllerFactory.createController(d.ImageController.KIND,this))},match:function(t){var e,n=this.placement;if(u.Forma.prototype.match.call(this,t),e=s.as(t,i)){if(0==e.style.colors.hasReferencedColorsFromColorLibrary()){var r,o,a=e.page.colorLibraryController.applyLegacyFilterColorsAndReturnKeys(e.style);null!=(r=a.primaryKey)&&e.style.colors.setColorId(c.ColorRole.FieldPrimary,r),null!=(o=a.secondaryKey)&&e.style.colors.setColorId(c.ColorRole.FieldSecondary,o)}this.applyStyle(e.style),t.contentID!=this.contentID&&(this.placement=n)}},contentNode:{get:function(){var t=this;return null==this.cachedContent_&&null!=this.contentID_&&(this.cachedContent_=s.as(s.opt(this.page.document,function(e){return e.content.nodeByID(t.contentID_)}),m.ImageContentNode)),this.cachedContent_},set:function(t){this.cachedContent_=t,this.contentID=s.opt(t,function(t){return t.id})}},contentID:{get:function(){return this.contentID_},set:function(t){var e=new h.FormaContentChangedEvent(this);this.beginUpdate(e),this.contentID_=t,this.cachedBounds_=null,s.opt(this.cachedContent_,function(e){return e.id!=t})&&(this.cachedContent_=null),this.avgColorCache_=new a.LRUColorCache,this.endUpdate(e)}},clone:function(){var t;return(t=s.as(u.Forma.prototype.clone.call(this),i))?(t.contentID=this.contentID,t):(l.CoreAssert.fail("ImageForma.clone: super.clone didn't return an ImageForma"),null)},boundsInCoordSpace:function(t){if(null==this.cachedBounds_){var e=this.contentNode;null!=e&&(this.cachedBounds_=_.TheoRect.fromXYWH(0,0,s.toDouble(e.pixelWidth),s.toDouble(e.pixelHeight)))}return s.opt(this.cachedBounds_,function(e){return e.transform(t)})},invalidateCachedBounds:function(){this.cachedBounds_=null},getFocusRegion:function(){var t;return(t=s.opt(this.contentNode,function(t){return t.focusRegion}))?t.transform(this.placement):null},getAverageEdge:function(t){var e,n=t.transform(this.placement.inverse);return(e=this.contentNode)?e.getAverageEdge(n):0},getFaceIntersections:function(t){var e,n,r=t.transform(this.placement.inverse);if((e=this.contentNode)&&(n=e.image)){var o=s.toDouble(n.getWidth())/s.toDouble(e.pixelWidth),i=s.toDouble(n.getHeight())/s.toDouble(e.pixelHeight);return n.getFaceIntersections(r.multiplyXY(o,i))}return 0},getAverageColor:function(t){var e;if(e=this.avgColorCache_.get(t.asString))return e;var n,r,o=t.transform(this.placement.inverse);if((n=this.contentNode)&&(r=n.image)){var i,a=s.toDouble(r.getWidth())/s.toDouble(n.pixelWidth),l=s.toDouble(r.getHeight())/s.toDouble(n.pixelHeight);if(i=r.getAverageColor(o.multiplyXY(a,l),s.as(this.style,p.ImageStyle)))return this.avgColorCache_.add(t.asString,i),i}return null},hasAlpha:function(){return null!=this.contentNode&&this.contentNode.hasAlpha},isImage:function(){return!0},decode:function(t){var e;u.Forma.prototype.decode.call(this,t),this.contentID_=t.stringProperty(a.PROPERTY_CONTENTID,""),(e=p.ImageStyle.decodeJson(t.property(a.PROPERTY_IMAGE_STYLE_DEPRECATED),p.ImageStyle.KIND,this.page.document))&&this.protectedSetStyle(e)},encode:function(t){u.Forma.prototype.encode.call(this,t),null!=this.contentID_&&t.setStringProperty(a.PROPERTY_CONTENTID,this.contentID_)},postDecode:function(){var t,e,n;(t=this.contentNode)&&(e=t.mediaMetadata)&&null!=(n=e.designIntent)&&(n==f.MediaMetadata.DESIGNINTENT_LOGO&&(this.intent=u.Forma.INTENT_LOGO),n==f.MediaMetadata.DESIGNINTENT_PATTERN&&(this.intent=u.Forma.INTENT_PATTERN))}}}),i)},23:function(t,e,n){var r,o=e,i=n(0),a=n(1),s=n(11),l=n(53),c=n(44),u=n(43),h=n(17),d=n(9),m=n(14),p=n(10),f=n(95);o.PROPERTY_BOUNDS="bounds",o.OLD_PROPERTY_CHARSTYLES="character-styles",o.OLD_PROPERTY_CHARSTYLERANGES="charstyle-ranges",o.GroupForma=(r=function(t,e,n){this.children_=[],s.Forma.call(this,t,e,n||l.FormaStyle.createDefault())},i.defineClass({name:"GroupForma",ctor:r,superName:"Forma",statics:{KIND:{get:function(){return"group"}},childrenPostOrder:function(t,e){for(var n=null,r=0,o=t.childCount,l=i.iter(i.range(0,t.childCount,!1));!l.done;l.next()){var c=l.value;if(null!=(n=t.childAt(c).visit(s.FormaTraversal.PostOrder,function(t,n,o){return e(t,n+1,(r+=1)-1)})))return n}return a.CoreAssert.isTrue(o<=t.childCount,"this function should not delete any children"),e(t,0,r)?t:n},childrenPreOrder:function(t,e){var n=null,r=0;if(e(t,0,r))return t;for(var o=t.childCount,l=i.iter(i.range(0,t.childCount,!1));!l.done;l.next()){var c=l.value;if(null!=(n=t.childAt(c).visit(s.FormaTraversal.PreOrder,function(t,n,o){return e(t,n+1,(r+=1)-1)})))return n}return a.CoreAssert.isTrue(o<=t.childCount,"this function should not delete any children"),n},childrenOnly:function(t,e){for(var n=i.iter(i.range(0,t.childCount,!1));!n.done;n.next()){var r=n.value,o=t.childAt(r);if(e(o,1,r))return o}return null},_implements:function(t){return"TheoMessageSubscriber"==t}},props:{destroy:function(){s.Forma.prototype.destroy.call(this);for(var t=i.iter(this.children_);!t.done;t.next())t.value.destroy()},bounds:{get:function(){return null!=this.bounds_?this.bounds_:this.childrenBoundsInCoordSpace(d.Matrix2D.Identity)},set:function(t){var e=this;if(!(null!=t&&null!=this.bounds_&&t.equal(this.bounds_)||null==t&&null==this.bounds_)){var n=new c.FormaGeometryChangedEvent(this);this.beginUpdate(n),i.opt(i.as(this.controller,u.GroupController),function(t){return t.beginUpdateGroup(e.bounds_)}),this.bounds_=t,i.opt(i.as(this.controller,u.GroupController),function(t){return t.updateGroup()}),i.opt(i.as(this.controller,u.GroupController),function(t){return t.endUpdateGroup()}),this.endUpdate(n)}}},setBounds:{get:function(){return this.bounds_}},childrenAsArray:{get:function(){return this.children_.concat()}},contentID:{get:function(){if(null!=(r=s.Forma._getters.contentID.call(this)))return r;var t=[];if(this.visit(s.FormaTraversal.JustChildren,function(e,n,r){var o;return null!=(o=e.contentID)&&t.push(o),!1}),0==t.length)return null;i.sortInPlace(t);for(var e="",n=i.iter(t);!n.done;n.next()){var r;e+=r=n.value}return e}},match:function(t){if(s.Forma.prototype.match.call(this,t),!this.bounds.equal(t.bounds))if(null!=this.controller&&this.controller.maintainAspectRatio){var e=t.bounds.fitAspectRatioWithin(this.bounds.aspectRatio);this.bounds=p.TheoRect.fromXYWH(t.bounds.minX,t.bounds.minY,e.width,e.height)}else this.bounds=t.bounds},visit:function(t,e){switch(t){case 1:return r.childrenPreOrder(this,e);case 2:return r.childrenPostOrder(this,e);case 6:return r.childrenOnly(this,e);default:return s.Forma.prototype.visit.call(this,t,e)}},insertChildrenInternal:function(t,e,n){if(e<0||e>this.children_.length)a.CoreAssert.fail("insertChildrenInternal: invalid index "+e);else{for(var r=i.iter(t);!r.done;r.next())if((u=r.value).page.uuid!=this.page.uuid)return void a.CoreAssert.fail("insertChildrenAt: attempting to insert children from a different page");var o=new c.FormaInsertedChildrenEvent(this,t,e);this.beginUpdate(o);for(var s=e,l=i.iter(t);!l.done;l.next()){var u,h=(u=l.value).totalPlacement;if(null!=u.parent&&(u.parent!=this?u.parent.removeChild(u):i.remove(this.children_,u)),u.parent=this,this.children_.splice(s,0,u),s+=1,n){var m=u.totalPlacement;m.equal(h)||u.move(d.Matrix2D.concat2(m.inverse,h))}}this.endUpdate(o)}},removeChildrenAt:function(t,e){if(t<0||e<0||t+e>this.children_.length)a.CoreAssert.fail("removeChildrenAt: Invalid index ("+t+") or count ("+e+")");else if(0==e);else{var n=this.children_.slice(t,t+e),r=new c.FormaRemovedChildrenEvent(this,n,t);this.beginUpdate(r);for(var o=i.iter(n);!o.done;o.next())o.value.parent=null;this.children_.splice(t,e),this.endUpdate(r)}},insertChildrenAt:function(t,e,n){void 0===n&&(n=!1),this.insertChildrenInternal(t,e,n)},appendChild:function(t,e){void 0===e&&(e=!1);var n=[];n.push(t),this.insertChildrenInternal(n,this.children_.length,e)},appendChildren:function(t,e){void 0===e&&(e=!1),this.insertChildrenAt(t,this.children_.length,e)},insertBefore:function(t,e,n){void 0===n&&(n=!1),null==e?this.insertChildAt(t,this.children_.length,n):e.parent!==this?(a.CoreAssert.fail("insertBefore: refForma must be a child of this forma; appending"),this.insertChildAt(t,this.children_.length,n)):this.insertChildAt(t,i.indexOfEq(this.children_,e,s._equality_Forma_Forma),n)},insertChildAt:function(t,e,n){void 0===n&&(n=!1);var r=[];r.push(t),this.insertChildrenAt(r,e,n)},removeChild:function(t){var e;null!=(e=i.indexOfEq(this.children_,t,s._equality_Forma_Forma))?this.removeChildAt(e):a.CoreAssert.fail("Child is not part of this group")},removeChildAt:function(t){this.removeChildrenAt(t,1)},removeAllChildren:function(){this.removeChildrenAt(0,this.children_.length)},indexOfChild:function(t){return i.indexOfEq(this.children_,t,s._equality_Forma_Forma)},indexOfTop:function(t){for(var e=-1,n=i.iter(i.range(0,this.childCount,!1).reversed());!n.done;n.next()){var r=n.value;if(t(this.childAt(r))){e=r;break}}return e},findChild:function(t){return this.children_.find(t,this)},childAt:function(t){return a.CoreAssert.isTrue(t>=0&&t<this.children_.length),t>=0&&t<this.children_.length?this.children_[t]:null},childCount:{get:function(){return this.children_.length}},boundsInCoordSpace:function(t){return null!=this.bounds_?this.bounds_.transform(t):this.childrenBoundsInCoordSpace(t)},childrenFinalFrame:{get:function(){return this.childrenBoundsInCoordSpace(this.totalPlacement)}},childrenFrame:{get:function(){return this.childrenBoundsInCoordSpace(this.placement)}},childrenBoundsInCoordSpace:function(t){var e=null;return this.children_.forEach(function(n){var o;if(o=i.as(n,r))e=p.TheoRect.unionOf(e,o.childrenBoundsInCoordSpace(n.placement.concat(t)));else if(!n.isFullCanvas){var a=n.boundsInCoordSpace(n.placement.concat(t));e=p.TheoRect.unionOf(e,a)}}),e},clone:function(){var t;if(t=i.as(s.Forma.prototype.clone.call(this),r)){i.opt(i.as(t.controller,u.GroupController),function(t){return t.beginBlockedUpdate()}),t.bounds=this.bounds,i.opt(i.as(t.controller,u.GroupController),function(t){return t.endBlockedUpdate()});for(var e=i.iter(this.children_);!e.done;e.next()){var n;(n=e.value.clone())?t.appendChild(n,!1):a.CoreAssert.warning("Failed to clone a child during Group clone")}return i.opt(i.as(this.controller,u.GroupController),function(e){return e.postClone(t)}),t}return a.CoreAssert.fail("GroupForma.clone: super didn't return a GroupForma"),null},isImage:function(){return this.children_.length>0&&null==this.children_.find(function(t){return!t.isImage()},this)},isGraphic:function(){return this.children_.length>0&&null==this.children_.find(function(t){return!t.isGraphic()},this)},isText:function(){return this.children_.length>0&&null==this.children_.find(function(t){return!t.isText()},this)},isShape:function(){return this.children_.length>0&&null==this.children_.find(function(t){return!t.isShape()},this)},isVideo:function(){return this.children_.length>0&&null==this.children_.find(function(t){return!t.isVideo()},this)},isLogo:function(){return this.children_.length>0&&null==this.children_.find(function(t){return!t.isLogo()},this)},isSticker:function(){return this.children_.length>0&&null==this.children_.find(function(t){return!t.isSticker()},this)},decode:function(t){var e=this;s.Forma.prototype.decode.call(this,t),t.forEachChild(function(t,n){var r=e.page.decodeForma(t);null!=r&&(r.parent=e,e.children_.push(r))});var n,r,l,c,u=p.TheoRect.decodeJson(t.property(o.PROPERTY_BOUNDS));if(null!=u&&(this.bounds_=u),(n=i.as(t.property(o.OLD_PROPERTY_CHARSTYLES),["Dictionary","String","AnyObject"]))&&(r=i.as(this.style,h.LockupStyle))&&0==i.count(r.characterStyles)){r.characterStyles={};for(var d=i.iter(n);!d.done;d.next()){var _=d.key,g=d.value,E=h.LockupStyle.createDefault();E.setEmptyStyle(),E.decodeFromJson(g,this.page.document),E.colorLibrary=this.page.colorLibrary,r.characterStyles[_]=E}}if((l=i.as(t.property(o.OLD_PROPERTY_CHARSTYLERANGES),["Dictionary","String","AnyObject"]))&&(c=i.as(this.controller,m.TypeLockupController))&&0==c.getCharacterStyleRanges().length)for(var P=i.iter(l);!P.done;P.next()){_=P.key;var T=P.value;a.CoreAssert.isTrue(_==m.TypeLockupController.HIGHLIGHT_STYLE,"unexpected character style");for(var v=i.clone(T),I=i.iter(i.range(0,v.length,!0));!I.done;I.next()){var F=I.value;if(F%2==0&&F<v.length-1){var C=new f.TextRange(v[F],v[F+1]);c.charStyleRanges.push(C)}}}},encode:function(t){s.Forma.prototype.encode.call(this,t),this.children_.concat().forEach(function(e){return e.encode(t.appendChild(e.uuid))}),null!=this.bounds_&&t.setProperty(o.PROPERTY_BOUNDS,this.bounds_.encodeJson())}}}),r)},237:function(t,e,n){var r,o,i=e,a=n(0),s=n(426),l=n(238),c=n(1),u=n(234),h=n(79),d=n(118),m=n(483),p=n(11),f=n(484),_=n(29),g=n(255),E=n(486),P=n(139),T=n(44),v=n(23),I=n(239),F=n(56),C=n(8),R=n(192),y=n(21),S=n(500),D=n(17),O=n(35),A=n(151),b=n(58),N=n(14),M=n(10),L=n(28);i.FormaPage=(r=function(t){this.pgmSource_=null,this.document_=t,this.uuid_=F.GUIDUtils.makeGUID(),this.formaFactory_=new f.DefaultFormaFactory,this.pageSize_=new L.TheoSize(1200,1200),this.sizeID_=r.DEFAULT_SIZE_ID,this.originalSizeID_=r.DEFAULT_ORIGINAL_SIZE_ID,this.customSizeFormat_=r.DEFAULT_CUSTOM_SIZE_FORMAT,this.customSizePPI_=r.DEFAULT_CUSTOM_SIZE_PPI,this.colorLibrary_=new u.ColorLibrary,this.colorLibraryController_=new h.ColorLibraryController(this.colorLibrary_,t),this.imageFilterLibrary_=new S.ImageFilterLibrary,this.animationLibrary_=new l.AnimationLibrary,this.animationController_=new s.AnimationController(t),this.exportData_=null,A.TheoDOMPublishingElement.call(this),this.root_=a.as(this.createForma(O.RootForma.KIND),v.GroupForma)},o={},a.defineClass({name:"FormaPage",ctor:r,superName:"TheoDOMPublishingElement",statics:{PROPERTY_KIND:"kind",PROPERTY_PAGE_SIZE:"size",PROPERTY_TEMPLATE_ID:"template-id",PROPERTY_COLOR_LIBRARY:"color-library",PROPERTY_SIZE_ID:"size-id",PROPERTY_ORIGINAL_SIZE_ID:"original-size-id",PROPERTY_CUSTOM_SIZE_FORMAT:"custom-size-format",PROPERTY_CUSTOM_SIZE_PPI:"custom-size-ppi",PROPERTY_EXPORT_DATA:"export-data",DEFAULT_SIZE_ID:"Instagram",DEFAULT_ORIGINAL_SIZE_ID:"Unknown",DEFAULT_CUSTOM_SIZE_FORMAT:{get:function(){return void 0===o.DEFAULT_CUSTOM_SIZE_FORMAT&&(o.DEFAULT_CUSTOM_SIZE_FORMAT=g.PageExportFormat.PIXELS),o.DEFAULT_CUSTOM_SIZE_FORMAT}},DEFAULT_CUSTOM_SIZE_PPI:300,DCXTYPE:{get:function(){return"application/vnd.adobe.theo.forma+dcx"}},PATH:{get:function(){return"forma-document"}},_implements:function(t){return"TheoMessagePublisher"==t}},props:{uuid:{get:function(){return this.uuid_}},document:{get:function(){return this.document_},set:function(t){c.CoreAssert.isTrue(!1,"why change the document of a FormaPage?"),this.document_=t}},view:{get:function(){return this.view_},set:function(t){this.view_=t}},pgm:{get:function(){return this.pgmSource_=this.pgmSource_||new E.FormaPagePGMSource(this),this.pgmSource_}},setPageSizeFromDesignSize:function(t){var e=Math.max(this.pageSize_.width,this.pageSize_.height),n=t.aspectRatio>1?Math.round(e/t.aspectRatio):e,r=Math.round(t.aspectRatio*n);this.sizeID=t.id,this.customSizeFormat=t.exportData.format,this.customSizePPI=t.exportData.PPI,this.templateID=null,this.setPageSize(new L.TheoSize(r,n),t.exportData)},setPageSize:function(t,e){void 0===e&&(e=null),null!=e&&Math.abs((e.dimensions.aspectRatio-t.aspectRatio)/Math.max(e.dimensions.aspectRatio,t.aspectRatio))>.02?c.CoreAssert.fail("Incompatible dimensions"):(t.equal(this.pageSize_)||(this.pageSize_=t,this.root.bounds=M.TheoRect.fromSize(t),this.publish(new P.PageSizeUpdateMessage(this,t))),this.exportData_=e)},getExportDataWithLimitTo:function(t){return this.getExportData(t,null)},getPageExportData:function(){return this.getExportData(null,null)},getExportData:function(t,e){var n=null;if(null!=this.exportData_)n=this.exportData_;else{var r=m.DesignSizeLibrary.getById(this.sizeID);null!=r&&(n=r.exportData)}var o=this.pageSize.aspectRatio,i=null!=e?e:m.DesignSizeLibrary.MAX_EDGE;null==n&&(n=o<1?new g.FormaPageExportData(new L.TheoSize(Math.round(i*o),i),g.PageExportFormat.PIXELS):new g.FormaPageExportData(new L.TheoSize(i,Math.round(i/o)),g.PageExportFormat.PIXELS));var a=Math.max(n.pixelDimensions.width,n.pixelDimensions.height);return null!=t&&a>t&&(i=t,n=o<1?new g.FormaPageExportData(new L.TheoSize(Math.round(i*o),i),g.PageExportFormat.PIXELS):new g.FormaPageExportData(new L.TheoSize(i,Math.round(i/o)),g.PageExportFormat.PIXELS)),n},pageSize:{get:function(){return this.pageSize_}},exportData:{get:function(){return this.exportData_}},templateID:{get:function(){return this.templateID_},set:function(t){this.templateID_=t}},sizeID:{get:function(){return this.sizeID_},set:function(t){this.sizeID_=t}},originalSizeID:{get:function(){return this.originalSizeID_},set:function(t){this.originalSizeID_=t}},customSizeFormat:{get:function(){return this.customSizeFormat_},set:function(t){this.customSizeFormat_=t}},customSizePPI:{get:function(){return this.customSizePPI_},set:function(t){this.customSizePPI_=t}},hasRoot:function(){return null!=this.root_},root:{get:function(){return this.root_}},colorLibraryController:{get:function(){return this.colorLibraryController_}},colorLibrary:{get:function(){return this.colorLibrary_}},imageFilterLibrary:{get:function(){return this.imageFilterLibrary_}},animationLibrary:{get:function(){return this.animationLibrary_}},layoutLibrary:{get:function(){return I.GridLibrary.instance}},animationController:{get:function(){return this.animationController_}},imageColors:{get:function(){var t,e,n=[],r=a.clone(this.root_.filterWithCallback(function(t){return t instanceof y.ImageForma}));return r.length>0&&(t=a.as(r[0],y.ImageForma))&&(e=a.opt(t.contentNode,function(t){return t.image}))&&a.append(n,e.getImageColors(10)),n}},formaByID:function(t){return this.root_.formaByID(t)},selectableFormaeIntersectingRect:function(t){var e=[];return this.root_.visit(p.FormaTraversal.PreOrder,function(n,r,o){var i,s;return null!=n.controller&&n.controller.canMultiSelect&&(n.isFullCanvas||M.TheoRect.PointInCommon(t,n.totalPlacement.inverse,n.bounds)&&((i=a.as(n.parent,_.FrameForma))?M.TheoRect.PointInCommon(t,i.totalPlacement.inverse,i.bounds)&&e.push(n):(s=a.as(n,b.TextForma))?e.push(s.lockupForma):e.push(n))),!1}),e},formaAtPoint:function(t,e,n,r){void 0===e&&(e=0),void 0===n&&(n=null),void 0===r&&(r=null);var o=this,i=null;return this.root_.visit(p.FormaTraversal.PreOrder,function(s,l,u){var h;if(h=a.opt(s.totalPlacement.inverse,function(e){return e.transformPoint(t)})){var m=Math.sqrt(Math.abs(s.totalPlacement.determinant));c.CoreAssert.isTrue(0!=m,"framescale is zero");var p=e/m;if(s.containsPoint(h,p)&&!s.isFullCanvas){if(o.document.controller.interactionMode==d.InteractionMode.AutomaticGrid&&null!=s.controller&&s.controller.floating&&!C.Host.platform.isWeb)return!0;if(null!=r&&0==r(s))return!1;if(null!=n){for(var f=!1,g=a.iter(n);!g.done;g.next()){var E=g.value;if(s.kind==E&&(!s.isShape()||null!=s.controller)){f=!0;break}}if(0==f)return!1}var P,T;if(P=a.as(s.parent,_.FrameForma)){if(T=a.opt(P.totalPlacement.inverse,function(e){return e.transformPoint(t)})){var v=Math.sqrt(Math.abs(P.totalPlacement.determinant));c.CoreAssert.isTrue(0!=v,"framescale is zero");var I=e/v;P.containsPoint(T,I)&&(i=s)}}else i=s}}return!1}),i},formaAtPointInSelection:function(t,e){var n=null;return e.forEachSelected(function(e){return e.visit(p.FormaTraversal.PreOrder,function(e,r,o){var i;if((i=a.opt(e.totalPlacement.inverse,function(e){return e.transformPoint(t)}))&&e.containsPoint(i)&&!e.isFullCanvas){if(e instanceof b.TextForma)return n=e,!0;var s,l;(s=a.as(e.parent,_.FrameForma))?(l=a.opt(s.totalPlacement.inverse,function(e){return e.transformPoint(t)}))&&s.containsPoint(l)&&(n=e):n=e}return!1})}),n},createForma:function(t){var e=this.formaFactory_.createForma(this,t);if(null==e)return null;var n=new T.FormaCreatedEvent(e);return this.beginUpdate(n),e.initializeToDefaults(),this.endUpdate(n),e},createFormaWithController:function(t,e){var n=this.formaFactory_.createForma(this,t);if(null==n)return null;var r=new T.FormaCreatedEvent(n);return this.beginUpdate(r),n.initializeToDefaults(),n.controller=a.opt(a.opt(this.document_,function(t){return t.controller}),function(t){return t.controllerFactory.createController(e,n)}),this.endUpdate(r),n},createModelForma:function(t){var e=this.formaFactory_.createForma(this,t);return null==e?null:(e.isModel=!0,e)},decodeForma:function(t){var e=t.stringProperty(r.PROPERTY_KIND,""),n=this.createForma(e);return null!=n&&n.decode(t),n},beginUpdate:function(t){null!=this.view_&&(t.token=this.view_.beginViewUpdate(t)),this.publish(new P.FormaBeginUpdateMessage(this,t))},endUpdate:function(t){this.publish(new P.FormaEndUpdateMessage(this,t)),null!=this.view_&&(t.type!=T.FormaInsertedChildrenEvent.TYPE&&a.opt(this.document_,function(t){return t.recordModification()}),this.view_.endViewUpdate(t.token))},decode:function(t){var e,n=this;this.uuid_=t.id,this.root_=null;var o=L.TheoSize.decodeJson(t.property(r.PROPERTY_PAGE_SIZE));this.pageSize_=null==o?new L.TheoSize(900,556):o,this.templateID_=t.optionalStringProperty(r.PROPERTY_TEMPLATE_ID),this.sizeID_=t.stringProperty(r.PROPERTY_SIZE_ID,r.DEFAULT_SIZE_ID),this.originalSizeID_=t.stringProperty(r.PROPERTY_ORIGINAL_SIZE_ID,r.DEFAULT_ORIGINAL_SIZE_ID),this.customSizeFormat_=(e=g.PageExportFormat.toCaseValue(t.intProperty(r.PROPERTY_CUSTOM_SIZE_FORMAT,r.DEFAULT_CUSTOM_SIZE_FORMAT)))||null!=e?e:r.DEFAULT_CUSTOM_SIZE_FORMAT,this.customSizePPI_=t.numberProperty(r.PROPERTY_CUSTOM_SIZE_PPI,r.DEFAULT_CUSTOM_SIZE_PPI),this.colorLibrary_.decodeAndSetJson(t.property(r.PROPERTY_COLOR_LIBRARY)),this.exportData_=g.FormaPageExportData.decodeJson(t.property(r.PROPERTY_EXPORT_DATA)),t.forEachChild(function(t,e){var r=n.decodeForma(t);null!=r&&(n.root_=a.as(r,v.GroupForma))})},postDecode:function(){null==this.colorLibrary_.color(a.as(this.colorLibraryController.getThemeColorKeys()[0],"String"))&&this.colorLibraryController_.applyLegacyColorThemeFromDocument(this.document_),this.colorLibraryController_.ensureDerivedColorsAreSet(),this.root_.visitAll(p.FormaTraversal.PostOrder,function(t){var e;t.postDecode(),a.as(t.controller,N.TypeLockupController)&&(e=a.as(t.style,D.LockupStyle))&&(e.wheelUsed=!1)})},encode:function(t){var e;t.setType(r.DCXTYPE),t.setPath(r.PATH),t.setProperty(r.PROPERTY_PAGE_SIZE,this.pageSize_.encodeJson()),t.setOptionalStringProperty(r.PROPERTY_SIZE_ID,this.sizeID_),(e=a.as(t,R.IExportDataObjectDocument))&&(e.setManifestProperty(r.PROPERTY_PAGE_SIZE,this.pageSize_.encodeJson()),e.setManifestProperty(r.PROPERTY_SIZE_ID,a.as(this.sizeID_,"AnyObject")),e.setManifestProperty(r.PROPERTY_ORIGINAL_SIZE_ID,a.as(this.originalSizeID_,"AnyObject"))),t.setOptionalStringProperty(r.PROPERTY_TEMPLATE_ID,this.templateID_),t.setProperty(r.PROPERTY_COLOR_LIBRARY,this.colorLibrary_.encodeJson()),t.setIntProperty(r.PROPERTY_CUSTOM_SIZE_FORMAT,this.customSizeFormat_),t.setNumberProperty(r.PROPERTY_CUSTOM_SIZE_PPI,this.customSizePPI_),null!=this.exportData_&&t.setProperty(r.PROPERTY_EXPORT_DATA,this.exportData_.encodeJson()),this.root.encode(t.appendChild(this.root.uuid))}}}),r)},255:function(t,e,n){var r,o,i=e,a=n(0),s=n(1),l=n(237),c=n(28);i.PageExportFormat=a.defineEnum("PageExportFormat",{PIXELS:0,MILLIMETERS:1,INCHES:2}),i.describePageExportFormat=function(t){switch(t){case 0:return"pixels";case 1:return"millimeters";case 2:return"inches"}},i.FormaPageExportData=(r=function(t,e,n){void 0===n&&(n=null),this.dimensions_=t,this.format_=e,this.ppi_=n,null!=n&&e==i.PageExportFormat.PIXELS?s.CoreAssert.fail("should not specify ppi for pixels"):null!=n||e!=i.PageExportFormat.MILLIMETERS&&e!=i.PageExportFormat.INCHES||s.CoreAssert.fail("Must specify ppi for mm or inches")},o={},a.defineClass({name:"FormaPageExportData",ctor:r,superName:"CoreObject",statics:{PROPERTY_DIMENSIONS:"dimensions",PROPERTY_FORMAT:"format",PROPERTY_PPI:"ppi",MM_TO_INCHES:{get:function(){return void 0===o.MM_TO_INCHES&&(o.MM_TO_INCHES=1/25.4),o.MM_TO_INCHES}},POINTS_PER_INCH:72,DEFAULT_PPI:300,exportPixels:function(t){return new r(t,i.PageExportFormat.PIXELS,null)},exportInches:function(t,e){return new r(t,i.PageExportFormat.INCHES,e)},exportMillimeters:function(t,e){return new r(t,i.PageExportFormat.MILLIMETERS,e)},decodeJson:function(t){var e;if(null==t)return null;var n=a.as(t,["Dictionary","String","Any"]);if(null==n)return s.CoreAssert.fail("FormaPageExportData.decodeJSON : object passed isn't a dictionary"),null;var o,l,u,h=null,d=i.PageExportFormat.PIXELS,m=c.TheoSize.Zero;return(o=c.TheoSize.decodeJson(a.as(n[r.PROPERTY_DIMENSIONS],"AnyObject")))&&(m=o),null!=(l=a.as(n[r.PROPERTY_FORMAT],"Int"))?d=(e=i.PageExportFormat.toCaseValue(l))||null!=e?e:i.PageExportFormat.PIXELS:s.CoreAssert.fail("Must have format encoded"),null!=(u=a.as(n[r.PROPERTY_PPI],"Double"))&&(h=u),new r(m,d,h)}},props:{dimensions:{get:function(){return this.dimensions_}},format:{get:function(){return this.format_}},PPI:{get:function(){return null==this.ppi?l.FormaPage.DEFAULT_CUSTOM_SIZE_PPI:this.ppi_}},ppi:{get:function(){return this.ppi_}},pixelDimensions:{get:function(){return this.format_==i.PageExportFormat.MILLIMETERS?this.dimensions_.multiply(r.MM_TO_INCHES*this.ppi_):this.format_==i.PageExportFormat.INCHES?this.dimensions_.multiply(this.ppi_):(s.CoreAssert.isTrue(this.format_==i.PageExportFormat.PIXELS),this.dimensions_)}},pointDimensions:{get:function(){return this.format_==i.PageExportFormat.MILLIMETERS?this.dimensions_.multiply(r.MM_TO_INCHES*r.POINTS_PER_INCH):this.format_==i.PageExportFormat.INCHES?this.dimensions_.multiply(r.POINTS_PER_INCH):(s.CoreAssert.isTrue(this.format_==i.PageExportFormat.PIXELS),this.dimensions_)}},encodeJson:function(){var t={};return t[r.PROPERTY_DIMENSIONS]=this.dimensions_.encodeJson(),t[r.PROPERTY_FORMAT]=this.format_,null!=this.ppi_&&(t[r.PROPERTY_PPI]=this.ppi_),t}}}),r)},256:function(t,e,n){var r,o=e,i=n(0),a=n(1),s=n(11),l=n(53),c=n(44),u=n(22),h=n(10),d=n(28),m=n(88);o.PROPERTY_COLOR="color",o.PROPERTY_CONTENTID="content-id",o.PROPERTY_SIZE="size",o.VectorForma=(r=function(t){this.contentID_=null,this.cachedBounds_=null,this.size_=null,this.color_=u.SolidColor.BLACK,s.Forma.call(this,t,r.KIND,l.FormaStyle.createDefault())},i.defineClass({name:"VectorForma",ctor:r,superName:"Forma",statics:{KIND:{get:function(){return"Vector"}},_implements:function(t){return"TheoMessageSubscriber"==t}},props:{contentNode:{get:function(){var t=this;return null==this.contentID_?null:i.as(i.opt(this.page.document,function(e){return e.content.nodeByID(t.contentID_)}),m.VectorContentNode)},set:function(t){this.contentID=null==t?null:t.id}},size:{get:function(){return this.size_},set:function(t){this.size_=t}},contentID:{get:function(){return this.contentID_},set:function(t){var e=new c.FormaContentChangedEvent(this);this.beginUpdate(e),this.contentID_=t,this.cachedBounds_=null,this.endUpdate(e)}},isShape:function(){return!0},clone:function(){var t;return(t=i.as(s.Forma.prototype.clone.call(this),r))?(t.contentID=this.contentID,t):(a.CoreAssert.fail("VectorForma.clone: super.clone did not return a VectorForma"),null)},boundsInCoordSpace:function(t){if(null==this.cachedBounds_){var e=this.contentNode;null!=e&&(this.cachedBounds_=h.TheoRect.fromSize(e.size))}return i.opt(this.cachedBounds_,function(e){return e.transform(t)})},isGraphic:function(){return!0},decode:function(t){var e;s.Forma.prototype.decode.call(this,t),this.contentID_=t.stringProperty(o.PROPERTY_CONTENTID,""),(e=u.SolidColor.decodeJson(t.property(o.PROPERTY_COLOR)))&&(this.color_=e),this.size_=d.TheoSize.decodeJson(t.property(o.PROPERTY_SIZE))},encode:function(t){s.Forma.prototype.encode.call(this,t),null!=this.contentID_&&t.setStringProperty(o.PROPERTY_CONTENTID,this.contentID_),t.setProperty(o.PROPERTY_COLOR,this.color_.encodeJson()),null!=this.size_&&t.setProperty(o.PROPERTY_SIZE,this.size_.encodeJson())}}}),r)},29:function(t,e,n){var r,o=e,i=n(0),a=n(1),s=n(26),l=n(23),c=n(21),u=n(10);o.PROPERTY_BOUNDS_DEPRECATED="bounds",o.PROPERTY_CLIPMODE="clipmode",o.FrameForma=(r=function(t){this.clipMode_=!0,l.GroupForma.call(this,t,r.KIND,null)},i.defineClass({name:"FrameForma",ctor:r,superName:"GroupForma",statics:{KIND:{get:function(){return"Frame"}},_implements:function(t){return"TheoMessageSubscriber"==t}},props:{initializeToDefaults:function(){var t;(t=i.opt(this.page.document,function(t){return t.controller}))&&(this.controller=t.controllerFactory.createController(s.FrameController.KIND,this))},bounds:{get:function(){return l.GroupForma._getters.bounds.call(this)},set:function(t){l.GroupForma._setters.bounds.call(this,t)}},clipMode:{get:function(){return this.clipMode_},set:function(t){this.clipMode_!=t&&(this.clipMode_=t)}},clone:function(){var t;return(t=i.as(l.GroupForma.prototype.clone.call(this),r))?(t.clipMode=this.clipMode_,t):(a.CoreAssert.fail("FrameForma: clone failed to return a FrameForma"),null)},decode:function(t){l.GroupForma.prototype.decode.call(this,t);var e=u.TheoRect.decodeJson(t.property(o.PROPERTY_BOUNDS_DEPRECATED));null!=e&&(this.bounds=e),this.clipMode_=t.booleanProperty(o.PROPERTY_CLIPMODE,!0)},encode:function(t){l.GroupForma.prototype.encode.call(this,t),t.setBooleanProperty(o.PROPERTY_CLIPMODE,this.clipMode_);for(var e=i.iter(i.range(0,this.childCount,!1));!e.done;e.next()){var n=e.value,r=this.childAt(n);a.CoreAssert.isTrue(null!=i.as(r,c.ImageForma),"Found unexpected frame forma child of type "+r.kind)}}}}),r)},30:function(t,e,n){var r,o=e,i=n(0),a=n(1),s=n(19),l=n(11),c=n(44),u=n(56),h=n(8),d=n(9),m=n(40),p=n(330),f=n(205),_=n(14),g=n(81),E=n(10),P=n(28),T=n(88);o.PROPERTY_ARTWORK="artwork",o.PROPERTY_CONTENTID="content-id",o.PROPERTY_SHAPELIBRARYID="shape-id",o.PROPERTY_SIZE="size",o.PROPERTY_SLICE_BOX="slice-box",o.PROPERTY_PRESCALE="prescale",o.PROPERTY_SHAPE_STYLE_DEPRECATED="style",o.PROPERTY_CONTENT_REGION="content-region",o.PROPERTY_TEXT_BOX="text-box",o.ShapeForma=(r=function(t){this.contentID_=null,this.shapeLibraryID_=null,this.size_=null,this.sliceBox_=null,this.textBox_=null,this.contentRegion_=null,this.cachedMaskImage_=null,this.preScale_=null,this.size_=new P.TheoSize(1,1);var e=new f.TheoArtworkShape;e.paths=[new g.TheoRectanglePath(E.TheoRect.fromSize(this.size_))],this.artwork_=e,l.Forma.call(this,t,r.KIND,p.ShapeStyle.createDefault())},i.defineClass({name:"ShapeForma",ctor:r,superName:"Forma",statics:{KIND:{get:function(){return"Shape"}},_implements:function(t){return"TheoMessageSubscriber"==t}},props:{match:function(t){var e,n;if(l.Forma.prototype.match.call(this,t),e=i.as(t,r)){var o=new c.FormaGeometryChangedEvent(this);this.beginUpdate(o),this.artwork_=e.canonicalArtwork.clone(),this.sliceBox_=e.sliceBox,this.contentRegion_=e.contentRegion,this.size_=e.size,this.endUpdate(o)}(n=i.as(t.controller,_.TypeLockupController))&&i.opt(n.lockupStyle,function(t){return null!=t.textBacked})&&this.style.colors.setColorId(s.ColorRole.FieldPrimary,t.style.colors.colorID(s.ColorRole.FieldSecondary))},contentNode:{get:function(){var t=this;return null==this.contentID_?null:i.opt(this.page.document,function(e){return e.content.nodeByID(t.contentID_)})},set:function(t){this.contentID=null==t?null:t.id}},placement:{get:function(){return l.Forma._getters.placement.call(this)},set:function(t){l.Forma._setters.placement.call(this,t)}},canonicalArtwork:{get:function(){return this.artwork_},set:function(t){var e=new c.FormaContentChangedEvent(this);this.beginUpdate(e),this.artwork_=t,null==this.artwork_.uid&&(this.artwork_.uid=u.GUIDUtils.makeGUID()),this.artworkSized_=null,this.endUpdate(e)}},preScale:{get:function(){return this.preScale_},set:function(t){if(t!=this.preScale_){var e=new c.FormaGeometryChangedEvent(this);this.beginUpdate(e),this.preScale_=t,this.artworkSized_=null,this.endUpdate(e)}}},sizedArtwork:{get:function(){var t,e;return null==this.artworkSized_&&((t=this.artwork_.bounds)?(e=null!=this.preScale_&&isFinite(this.preScale_)?this.preScale_:Math.min(this.size_.width/t.width,this.size_.height/t.height),this.artworkSized_=this.artwork_.applySlicing(t,E.TheoRect.fromSize(this.size_),this.sliceBox_,e,!0)):(a.CoreAssert.warning("No bounds obtained from artwork"),this.artworkSized_=this.artwork_.clone())),this.artworkSized_}},sliceBox:{get:function(){return this.sliceBox_},set:function(t){var e=new c.FormaContentChangedEvent(this);this.beginUpdate(e),this.sliceBox_=t,this.artworkSized_=null,this.endUpdate(e)}},contentRegion:{get:function(){return this.contentRegion_},set:function(t){var e=new c.FormaContentChangedEvent(this);this.beginUpdate(e),this.contentRegion_=t,this.endUpdate(e)}},size:{get:function(){return this.size_},set:function(t){if(this.size_!=t){var e=new c.FormaGeometryChangedEvent(this);this.beginUpdate(e),this.size_=t,this.artworkSized_=null,this.endUpdate(e)}}},bounds:{get:function(){return this.boundsInCoordSpace(d.Matrix2D.Identity)},set:function(t){var e;if(e=t){if(this.size.equal(e.size))return;this.size=e.size}else a.CoreAssert.fail("shouldnt be setting nil bounds for a shape")}},boundsInCoordSpace:function(t){return i.opt(this.calcBounds(),function(e){return e.transform(t)})},calcBounds:function(){var t;return(t=this.size)?E.TheoRect.fromSize(t):null},contentID:{get:function(){return this.contentID_},set:function(t){if(t!=this.contentID_){var e=new c.FormaContentChangedEvent(this);this.beginUpdate(e),this.contentID_=t,this.endUpdate(e)}}},shapeLibraryID:{get:function(){return this.shapeLibraryID_},set:function(t){if(t!=this.shapeLibraryID_){var e=new c.FormaContentChangedEvent(this);this.beginUpdate(e),this.shapeLibraryID_=t,this.endUpdate(e)}}},clone:function(){var t;return(t=i.as(l.Forma.prototype.clone.call(this),r))?(t.contentID=this.contentID,t.canonicalArtwork=this.artwork_.clone(),t.sliceBox=this.sliceBox,t.contentRegion=this.contentRegion,t.size=this.size,t):(a.CoreAssert.fail("ShapeForma.clone: super.clone() did not return a ShapeForma"),null)},isGraphic:function(){return!0},isShape:function(){return!0},maskImage:{get:function(){return null==this.cachedMaskImage_&&h.Host.imageAnalysis.setShapeFormaTransparencyMask(this,25),this.cachedMaskImage_},set:function(t){this.cachedMaskImage_=t}},getAverageAlpha:function(t){if(this.isGridCell())return 1;var e,n,r=t.transform(this.placement.inverse);if(null!=i.as(this.contentNode,T.VectorContentNode)&&(e=this.maskImage)&&(n=this.bounds)){var o,a=i.toDouble(e.cols)/i.toDouble(n.width),s=i.toDouble(e.rows)/i.toDouble(n.height),l=r.multiplyXY(a,s).rounded();if(o=l.intersectionWith(new E.TheoRect(0,0,e.size.width-1,e.size.height-1)))return e.sumRegion(o)/l.area}return 1},decode:function(t){var e,n;l.Forma.prototype.decode.call(this,t),this.contentID_=t.optionalStringProperty(o.PROPERTY_CONTENTID),this.shapeLibraryID_=t.optionalStringProperty(o.PROPERTY_SHAPELIBRARYID),(e=f.TheoArtworkNode.decodeJson(t.property(o.PROPERTY_ARTWORK)))&&(this.artwork_=e,null==this.artwork_.uid&&(this.artwork_.uid=u.GUIDUtils.makeGUID())),this.size_=P.TheoSize.decodeJson(t.property(o.PROPERTY_SIZE)),this.sliceBox_=E.TheoRect.decodeJson(t.property(o.PROPERTY_SLICE_BOX)),this.preScale_=t.numberProperty(o.PROPERTY_PRESCALE,NaN),null==this.preScale||isFinite(this.preScale_)||(this.preScale_=null),(n=p.ShapeStyle.decodeJson(t.property(o.PROPERTY_SHAPE_STYLE_DEPRECATED),p.ShapeStyle.KIND,this.page.document))&&this.protectedSetStyle(n),this.contentRegion_=E.TheoRect.decodeJson(t.property(o.PROPERTY_CONTENT_REGION)),null==this.contentRegion_&&(this.contentRegion_=E.TheoRect.decodeJson(t.property(o.PROPERTY_TEXT_BOX)))},postDecode:function(){null!=this.shapeLibraryID_&&m.ShapeLibrary.applyToShapeForma(this,this.shapeLibraryID_)},encode:function(t){l.Forma.prototype.encode.call(this,t),null!=this.contentID_&&t.setStringProperty(o.PROPERTY_CONTENTID,this.contentID_),null!=this.shapeLibraryID_&&t.setStringProperty(o.PROPERTY_SHAPELIBRARYID,this.shapeLibraryID_),null==this.shapeLibraryID_&&t.setProperty(o.PROPERTY_ARTWORK,this.artwork_.encodeJson()),null!=this.size_&&t.setProperty(o.PROPERTY_SIZE,this.size_.encodeJson()),null!=this.sliceBox_&&t.setProperty(o.PROPERTY_SLICE_BOX,this.sliceBox_.encodeJson()),null!=this.preScale_&&t.setNumberProperty(o.PROPERTY_PRESCALE,this.preScale_),null!=this.contentRegion_&&t.setProperty(o.PROPERTY_CONTENT_REGION,this.contentRegion_.encodeJson())}}}),r)},35:function(t,e,n){var r,o=e,i=n(0),a=n(1),s=n(11),l=n(44),c=n(23),u=n(92),h=n(337),d=n(22),m=n(10);o.PROPERTY_FILLCOLOR_DEPRECATED="fill-color",o.PROPERTY_ROOT_STYLE_DEPRECATED="root-style",o.RootForma=(r=function(t){c.GroupForma.call(this,t,r.KIND,h.RootStyle.createDefault())},i.defineClass({name:"RootForma",ctor:r,superName:"GroupForma",statics:{KIND:{get:function(){return"Root"}},_implements:function(t){return"TheoMessageSubscriber"==t}},props:{initializeToDefaults:function(){var t;(t=i.opt(this.page.document,function(t){return t.controller}))&&(this.controller=t.controllerFactory.createController(u.RootController.KIND,this)),this.bounds=m.TheoRect.fromSize(this.page.pageSize)},bounds:{get:function(){return null!=this.setBounds?this.setBounds:m.TheoRect.fromSize(this.page.pageSize)},set:function(t){null==t?a.CoreAssert.fail("cant set a nil root bounds"):(a.CoreAssert.isTrue(m.TheoRect.fromSize(this.page.pageSize).equal(t),"Root bounds doesnt match the FormaPage pageSize."),c.GroupForma._setters.bounds.call(this,t))}},placement:{get:function(){return c.GroupForma._getters.placement.call(this)},set:function(t){t.isIdentity||a.CoreAssert.fail("RootForma: Someone's trying to set the root forma placement to something other than identity!")}},contentID:{get:function(){return"root"}},clone:function(){var t;return(t=i.as(c.GroupForma.prototype.clone.call(this),r))?t:(a.CoreAssert.fail("RootForma.clone: super.clone failed to return a RootForma"),null)},isImage:function(){return!1},isGraphic:function(){return!1},isText:function(){return!1},isShape:function(){return!1},isLogo:function(){return!1},decode:function(t){var e,n;c.GroupForma.prototype.decode.call(this,t),null==this.controller&&this.initializeToDefaults(),(e=h.RootStyle.decodeJson(t.property(o.PROPERTY_ROOT_STYLE_DEPRECATED),h.RootStyle.KIND,this.page.document))?this.protectedSetStyle(e):(n=d.SolidColor.decodeJson(t.property(o.PROPERTY_FILLCOLOR_DEPRECATED)))&&(this.style.colors.fieldPrimary=n)},encode:function(t){c.GroupForma.prototype.encode.call(this,t)},postDecode:function(){var t,e=this;c.GroupForma.prototype.postDecode.call(this),i.opt(this.controller,function(t){return t.kind!=u.RootController.KIND})&&(this.controller=i.opt(i.opt(this.page.document,function(t){return t.controller}),function(t){return t.controllerFactory.createController(u.RootController.KIND,e)})),(t=i.as(this.controller,u.RootController))&&t.createGridControllerIfNone(),null==this.animation&&this.visit(s.FormaTraversal.PreOrder,function(t,n,o){return!(t instanceof r||!i.opt(t.animation,function(t){return null!=t.animationStyle})||(e.page.animationLibrary.setStillAnimation(e,t.animation.animationStyle),0))})},hackGenerateArtificialUpdateEvent:function(){var t=new l.FormaInsertedChildrenEvent(this,[],0);this.beginUpdate(t),this.endUpdate(t)},boundsInCoordSpace:function(t){return this.bounds.transform(t)},visible:{get:function(){var t;if(t=this.finalFrame){var e=!1,n=m.TheoRect.Zero;return this.visitAll(s.FormaTraversal.PreOrder,function(t){var o;t instanceof r||((o=t.finalFrame)&&(n=n.unionWith(o)),t.isImage()&&(e=!0))}),!e||!n.contains(t)}return!1}}}}),r)},425:function(t,e,n){var r,o=e,i=n(0),a=n(1),s=n(56),l=n(8),c=n(115),u=n(191);o.DocumentHistory=(r=function(t){this.entries_=[],this.uuid_=s.GUIDUtils.makeGUID(),this.parent_=t,u.TheoDOMElement.call(this),this.postEntry("initialized")},i.defineClass({name:"DocumentHistory",ctor:r,superName:"TheoDOMElement",statics:{PATH:"document-history",PROPERTY_ENTRIES:"entries",MAX_HISTORY_SIZE:100},props:{uuid:{get:function(){return this.uuid_}},parent:{get:function(){return this.parent_},set:function(t){this.parent_=t}},postEntry:function(t){var e,n,o;this.entries_.length>=r.MAX_HISTORY_SIZE&&this.entries_.shift();var a="when:'"+((e=i.opt(l.Host.logging,function(t){return t.timeStamp()}))||null!=e?e:"?")+"';platform:'"+((n=i.opt(l.Host.logging,function(t){return t.platformID()}))||null!=n?n:"?")+" ("+((o=i.opt(l.Host.logging,function(t){return t.additionalPlatformInfo()}))||null!=o?o:"?")+")';format#:"+i.toString(c.TheoDocument.CURRENT_VERSION)+";operation:'"+t+"'";this.entries_.push(a)},entryCount:{get:function(){return this.entries_.length}},entryAt:function(t){return t<0||t>=this.entries_.length?(a.CoreAssert.warning("entryAt: Invalid index requested, returning empty string"),""):this.entries_[t]},forEachEntry:function(t){for(var e=i.iter(this.entries_);!e.done;e.next())t(e.value)},encode:function(t){t.setPath("document-history"),t.setProperty(r.PROPERTY_ENTRIES,i.as(this.entries_,"AnyObject"))},decode:function(t){var e;if(this.entries_.splice(0),e=i.as(t.property(r.PROPERTY_ENTRIES),["Array","String"]))for(var n=i.iter(e);!n.done;n.next()){var o=n.value;this.entries_.push(o)}},clear:function(){this.entries_=[]},postDecode:function(){}}}),r)},44:function(t,e,n){var r,o,i,a,s,l,c,u,h,d,m,p,f,_,g,E,P,T,v,I,F,C=e,R=n(0);C.FormaUpdateEvent=(r=function(t,e){this.duration=0,this.type=t,this.forma=e},R.defineClass({name:"FormaUpdateEvent",ctor:r,superName:"CoreObject"}),r),C.TextPlacementEvent=(o=function(t){C.FormaUpdateEvent.call(this,o.TYPE,t)},R.defineClass({name:"TextPlacementEvent",ctor:o,superName:"FormaUpdateEvent",statics:{TYPE:{get:function(){return"TextPlacementEvent"}}}}),o),C.FormaTransformChangedEvent=(i=function(t){C.FormaUpdateEvent.call(this,i.TYPE,t)},R.defineClass({name:"FormaTransformChangedEvent",ctor:i,superName:"FormaUpdateEvent",statics:{TYPE:{get:function(){return"FormaTransformChangedEvent"}}}}),i),C.FormaCreatedEvent=(a=function(t){C.FormaUpdateEvent.call(this,a.TYPE,t)},R.defineClass({name:"FormaCreatedEvent",ctor:a,superName:"FormaUpdateEvent",statics:{TYPE:{get:function(){return"FormaCreatedEvent"}}}}),a),C.FormaNullChangedEvent=(s=function(t){C.FormaUpdateEvent.call(this,s.TYPE,t)},R.defineClass({name:"FormaNullChangedEvent",ctor:s,superName:"FormaUpdateEvent",statics:{TYPE:{get:function(){return"FormaNullChangedEvent"}}}}),s),C.FormaAnimationTransactionEvent=(l=function(t){C.FormaUpdateEvent.call(this,l.TYPE,t)},R.defineClass({name:"FormaAnimationTransactionEvent",ctor:l,superName:"FormaUpdateEvent",statics:{TYPE:{get:function(){return"FormaAnimationTransactionEvent"}}}}),l),C.FormaHierarchyChangedEvent=(c=function(t){C.FormaUpdateEvent.call(this,c.TYPE,t)},R.defineClass({name:"FormaHierarchyChangedEvent",ctor:c,superName:"FormaUpdateEvent",statics:{TYPE:{get:function(){return"FormaHierarchyChangedEvent"}}}}),c),C.FormaInsertedChildrenEvent=(u=function(t,e,n){this.children=e,this.index=n,C.FormaUpdateEvent.call(this,u.TYPE,t)},R.defineClass({name:"FormaInsertedChildrenEvent",ctor:u,superName:"FormaUpdateEvent",statics:{TYPE:{get:function(){return"FormaInsertedChildrenEvent"}}}}),u),C.FormaRemovedChildrenEvent=(h=function(t,e,n){this.children=e,this.index=n,C.FormaUpdateEvent.call(this,h.TYPE,t)},R.defineClass({name:"FormaRemovedChildrenEvent",ctor:h,superName:"FormaUpdateEvent",statics:{TYPE:{get:function(){return"FormaRemovedChildrenEvent"}}}}),h),C.FormaGeometryChangedEvent=(d=function(t){C.FormaUpdateEvent.call(this,d.TYPE,t)},R.defineClass({name:"FormaGeometryChangedEvent",ctor:d,superName:"FormaUpdateEvent",statics:{TYPE:{get:function(){return"FormaGeometryChangedEvent"}}}}),d),C.FormaBoundsInvalidatedEvent=(m=function(t){C.FormaUpdateEvent.call(this,m.TYPE,t)},R.defineClass({name:"FormaBoundsInvalidatedEvent",ctor:m,superName:"FormaUpdateEvent",statics:{TYPE:{get:function(){return"FormaBoundsInvalidatedEvent"}}}}),m),C.FormaPathChangedEvent=(p=function(t){C.FormaUpdateEvent.call(this,p.TYPE,t)},R.defineClass({name:"FormaPathChangedEvent",ctor:p,superName:"FormaUpdateEvent",statics:{TYPE:{get:function(){return"FormaPathChangedEvent"}}}}),p),C.FormaColorChangedEvent=(f=function(t){C.FormaUpdateEvent.call(this,f.TYPE,t)},R.defineClass({name:"FormaColorChangedEvent",ctor:f,superName:"FormaUpdateEvent",statics:{TYPE:{get:function(){return"FormaColorChangedEvent"}}}}),f),C.FormaStrokeChangedEvent=(_=function(t){C.FormaUpdateEvent.call(this,_.TYPE,t)},R.defineClass({name:"FormaStrokeChangedEvent",ctor:_,superName:"FormaUpdateEvent",statics:{TYPE:{get:function(){return"FormaStrokeChangedEvent"}}}}),_),C.FormaFillRuleChangedEvent=(g=function(t){C.FormaUpdateEvent.call(this,g.TYPE,t)},R.defineClass({name:"FormaFillRuleChangedEvent",ctor:g,superName:"FormaUpdateEvent",statics:{TYPE:{get:function(){return"FormaFillRuleChangedEvent"}}}}),g),C.FormaContentChangedEvent=(E=function(t){C.FormaUpdateEvent.call(this,E.TYPE,t)},R.defineClass({name:"FormaContentChangedEvent",ctor:E,superName:"FormaUpdateEvent",statics:{TYPE:{get:function(){return"FormaContentChangedEvent"}}}}),E),C.FormaStyleChangedEvent=(P=function(t){C.FormaUpdateEvent.call(this,P.TYPE,t)},R.defineClass({name:"FormaStyleChangedEvent",ctor:P,superName:"FormaUpdateEvent",statics:{TYPE:{get:function(){return"FormaStyleChangedEvent"}}}}),P),C.AnimationStyleChangedEvent=(T=function(t){C.FormaUpdateEvent.call(this,T.TYPE,t)},R.defineClass({name:"AnimationStyleChangedEvent",ctor:T,superName:"FormaUpdateEvent",statics:{TYPE:{get:function(){return"AnimationStyleChangedEvent"}}}}),T),C.AnimationTimeChangedEvent=(v=function(t,e){this.time=e,C.FormaUpdateEvent.call(this,v.TYPE,t)},R.defineClass({name:"AnimationTimeChangedEvent",ctor:v,superName:"FormaUpdateEvent",statics:{TYPE:{get:function(){return"AnimationTimeChangedEvent"}}}}),v),C.AnimationStateChangedEvent=(I=function(t,e){this.state=e,C.FormaUpdateEvent.call(this,I.TYPE,t)},R.defineClass({name:"AnimationStateChangedEvent",ctor:I,superName:"FormaUpdateEvent",statics:{TYPE:{get:function(){return"AnimationStateChangedEvent"}}}}),I),C.FormaAlignmentChangedEvent=(F=function(t,e,n){this.activeSnaplines=R.clone(e),this.nearbySnaplines=R.clone(n),C.FormaUpdateEvent.call(this,F.TYPE,t)},R.defineClass({name:"FormaAlignmentChangedEvent",ctor:F,superName:"FormaUpdateEvent",statics:{TYPE:{get:function(){return"FormaAlignmentChangedEvent"}}}}),F)},484:function(t,e,n){var r,o=e,i=n(0),a=n(1),s=n(4),l=n(29),c=n(23),u=n(21),h=n(35),d=n(30),m=n(485),p=n(58),f=n(256),_=n(73);o.FormaFactory=i.defineProtocol("FormaFactory",{createForma:"(FormaPage, String) -> Forma"}),o.DefaultFormaFactory=(r=function(){this.constructors_={},this.constructors_[h.RootForma.KIND]=function(t,e){return new h.RootForma(t)},this.constructors_[p.TextForma.KIND]=function(t,e){return new p.TextForma(t)},this.constructors_[u.ImageForma.KIND]=function(t,e){return u.ImageForma.init_7186(t)},this.constructors_[f.VectorForma.KIND]=function(t,e){return new f.VectorForma(t)},this.constructors_[c.GroupForma.KIND]=function(t,e){return new c.GroupForma(t,e,null)},this.constructors_[m.SmartGroupForma.KIND]=function(t,e){return new c.GroupForma(t,c.GroupForma.KIND,null)},this.constructors_[l.FrameForma.KIND]=function(t,e){return new l.FrameForma(t)},this.constructors_[d.ShapeForma.KIND]=function(t,e){return new d.ShapeForma(t)},this.constructors_[_.VideoForma.KIND]=function(t,e){return new _.VideoForma(t)},s.CoreObject.call(this)},i.defineClass({name:"DefaultFormaFactory",ctor:r,superName:"CoreObject",statics:{_implements:function(t){return"FormaFactory"==t}},props:{createForma:function(t,e){var n=this.constructors_[e];return null==n?(a.CoreAssert.warning("createForma: No constructor for kind "+e+" available."),null):n(t,e)}}}),r)},485:function(t,e,n){var r,o=e,i=n(0),a=n(53),s=n(23);o.SmartGroupForma=(r=function(t,e,n){s.GroupForma.call(this,t,e,n||a.FormaStyle.createDefault())},i.defineClass({name:"SmartGroupForma",ctor:r,superName:"GroupForma",statics:{KIND:{get:function(){return"smart-group"}},_implements:function(t){return"TheoMessageSubscriber"==t}}}),r)},58:function(t,e,n){var r,o=e,i=n(0),a=n(1),s=n(19),l=n(11),c=n(44),u=n(23),h=n(8),d=n(22),m=n(120),p=n(14),f=n(194),_=n(10),g=n(95),E=n(325);o.PROPERTY_SIZE="size",o.PROPERTY_TEXT="text",o.PROPERTY_TEXT_STYLE="text-style",o.PROPERTY_FILLCOLOR_DEPRECATED="fill-color",o.PROPERTY_RANGEINLOCKUP="range-in-lockup",o.PROPERTY_ROWINDEX="row-index",o.TextForma=(r=function(t){this.model_=f.TextModel.init_d41d(),this.rangeInLockup_=new g.TextRange(0,0),this.rowIndex_=0,this.activeModelChangeEventCount_=0,this.activeModelChangeEvent_=null,l.Forma.call(this,t,r.KIND,E.TextStyle.createDefault())},i.defineClass({name:"TextForma",ctor:r,superName:"Forma",statics:{KIND:{get:function(){return"Text"}},_implements:function(t){return"TheoMessageSubscriber"==t}},props:{onMessage:function(t){},isSameContent:function(t){var e;return!!(e=i.as(t,r))&&this.model_.text==e.textModel.text},clone:function(){var t;return(t=i.as(l.Forma.prototype.clone.call(this),r))?(t.model_.match(this.model_),t):(a.CoreAssert.fail("TextForma.clone: super.clone() did not return a TextForma"),null)},isText:function(){return!0},decode:function(t){var e;l.Forma.prototype.decode.call(this,t);var n,r,s=f.TextModel.decodeJson(t.property(o.PROPERTY_TEXT),this.page.document);if(null!=s?this.model_.match(s):a.CoreAssert.warning("TextForma: Could not decode TextModel"),(n=E.TextStyle.decodeJson(t.property(o.PROPERTY_TEXT_STYLE),E.TextStyle.KIND,this.page.document))?this.protectedSetStyle(n):d.SolidColor.decodeJson(t.property(o.PROPERTY_FILLCOLOR_DEPRECATED)),(r=i.as(t.property(o.PROPERTY_RANGEINLOCKUP),["Array","Any"]))&&2==r.length){var c=new g.TextRange(r[0],r[1]);this.rangeInLockup_=c}this.rowIndex_=(e=i.as(t.property(o.PROPERTY_ROWINDEX),"Int"))||null!=e?e:0},encode:function(t){l.Forma.prototype.encode.call(this,t),t.setProperty(o.PROPERTY_TEXT,this.model_.encodeJson());var e=[];e.push(this.rangeInLockup_.start),e.push(this.rangeInLockup_.end),t.setProperty(o.PROPERTY_RANGEINLOCKUP,e),t.setProperty(o.PROPERTY_ROWINDEX,i.as(this.rowIndex_,"AnyObject"))},boundsInCoordSpace:function(t){var e,n;if(0==this.model_.text.length)return _.TheoRect.Zero;if(null==this.bounds_){var r=i.opt(i.as(this.model_.attributeAtIndex(m.FontDescriptorAttribute.NAME,0).attr,m.FontDescriptorAttribute),function(t){return t.value}),o=i.opt(i.as(this.model_.attributeAtIndex(m.FontSizeAttribute.NAME,0).attr,m.FontSizeAttribute),function(t){return t.value}),a=(e=i.opt(i.as(this.model_.attributeAtIndex(m.FontStrokeWidthAttribute.NAME,0).attr,m.FontStrokeWidthAttribute),function(t){return t.value}))||null!=e?e:0,s=(n=i.opt(i.as(this.model_.attributeAtIndex(m.TrackingAttribute.NAME,0).attr,m.TrackingAttribute),function(t){return t.value}))||null!=n?n:0;this.bounds_=h.Host.textModelUtils.measureInkBoundsWithTracking(this.model_.text,r,o,s),0!=a&&(this.bounds_=this.bounds_.insetXY(-a/2,-a/2))}return this.bounds_.transform(t)},baselineBoundsInCoordSpace:function(t){var e;if(0==this.model_.text.length)return _.TheoRect.Zero;var n=i.opt(i.as(this.model_.attributeAtIndex(m.FontDescriptorAttribute.NAME,0).attr,m.FontDescriptorAttribute),function(t){return t.value}),r=i.opt(i.as(this.model_.attributeAtIndex(m.FontSizeAttribute.NAME,0).attr,m.FontSizeAttribute),function(t){return t.value}),o=(e=i.opt(i.as(this.model_.attributeAtIndex(m.TrackingAttribute.NAME,0).attr,m.TrackingAttribute),function(t){return t.value}))||null!=e?e:0;return h.Host.textModelUtils.measureBaselineBounds(this.model_.text,n,r,o).transform(t)},setTextProperties:function(t,e,n,r,o,i,a,l,u,h){var d=new c.FormaGeometryChangedEvent(this);this.beginUpdate(d),null!=this.cachedText_&&t==this.cachedText_||(this.model_.clear(),this.model_.insert(t,0),this.cachedText_=t);var p=this.model_.rangeAll;this.model_.apply(new m.FontDescriptorAttribute(e),p),this.model_.apply(new m.FontSizeAttribute(n),p),this.model_.apply(new m.FontColorAttribute(r),p),this.model_.apply(new m.FontStrokeColorAttribute(o),p),this.model_.apply(new m.FontStrokeWidthAttribute(i),p),this.model_.apply(new m.TextLookAttribute(a),p),this.model_.apply(new m.TrackingAttribute(h),p),this.bounds_=null,this.rangeInLockup_=l,this.rowIndex_=u,this.style.colors.setColor(s.ColorRole.FieldPrimary,r),this.endUpdate(d)},textModel:{get:function(){return this.model_}},rangeInLockup:{get:function(){return this.rangeInLockup_}},lockupForma:{get:function(){var t=function(t){return t.visit(l.FormaTraversal.NearestAncestor,function(t,e,n){var r;return!!(r=t.controller)&&r instanceof p.TypeLockupController})};return a.CoreAssert.isTrue(t(this)==i.opt(i.opt(this.parent,function(t){return t.parent}),function(t){return t.parent})),i.as(t(this),u.GroupForma)}},isRangeStart:function(){var t,e=this.textModel.text.includes("‫");if(t=i.as(i.opt(this.lockupForma,function(t){return t.controller}),p.TypeLockupController))for(var n=i.iter(t.getCharacterStyleRanges());!n.done;n.next()){var r=n.value;if(e){if(r.end==this.rangeInLockup.end)return!0}else if(r.start==this.rangeInLockup.start)return!0}return!1},isRangeEnd:function(){var t,e=this.textModel.text.includes("‫");if(t=i.as(i.opt(this.lockupForma,function(t){return t.controller}),p.TypeLockupController))for(var n=i.iter(t.getCharacterStyleRanges());!n.done;n.next()){var r=n.value;if(e){if(r.start==this.rangeInLockup.start)return!0}else if(r.end==this.rangeInLockup.end)return!0}return!1},rowIndex:{get:function(){return this.rowIndex_}}}}),r)},73:function(t,e,n){var r,o=e,i=n(0),a=n(1),s=n(44),l=n(21),c=n(80),u=n(48),h=n(332),d=n(153);o.PROPERTY_VIDEO_CONTENTID="video-content-id",o.VideoForma=(r=function(t){this.videoContentID_=null,this.cachedVideoContent_=null,i.super_init(this,l.ImageForma,l.ImageForma.prototype.init_1fa2,t,r.KIND,c.ImageStyle.createDefault())},i.defineClass({name:"VideoForma",ctor:r,superName:"ImageForma",statics:{KIND:{get:function(){return"Video"}},_implements:function(t){return"TheoMessageSubscriber"==t}},props:{getFrameForTime:function(t){var e;if(e=this.videoContentNode){if(0==e.times.length)return 0;var n=i.opt(this.animation,function(t){return t.startTime})||e.times[0],r=e.times[e.times.length-1],o=i.opt(this.animation,function(t){return t.endTime})||r;if(t.seconds>o.seconds)return e.times.length-1;if(t.seconds-n.seconds<=0)return 0;var a=t.subtract(n),s=new u.TheoTime(i.toInt(a.seconds*i.toDouble(r.timescale))%r.value,r.timescale);if(s.value<e.times[0].value)return 0;for(var l=i.iter(i.range(0,e.times.length-1,!1));!l.done;l.next()){var c=l.value;if(s.value>=e.times[c].value&&s.value<e.times[c+1].value)return c+1}return e.times.length-1}return 0},initializeToDefaults:function(){var t;(t=i.opt(this.page.document,function(t){return t.controller}))&&(this.controller=t.controllerFactory.createController(h.VideoController.KIND,this))},isVideo:function(){return!0},isSticker:function(){var t,e;return!!((t=this.videoContentNode)&&(e=i.opt(this.parent,function(t){return t.controller}))&&t.isGIF&&e.moveable)},videoContentNode:{get:function(){var t=this;return null==this.cachedVideoContent_&&null!=this.videoContentID_&&(this.cachedVideoContent_=i.as(i.opt(this.page.document,function(e){return e.content.nodeByID(t.videoContentID_)}),d.VideoContentNode)),this.cachedVideoContent_},set:function(t){this.cachedVideoContent_=t,this.contentID=i.opt(t,function(t){return t.id})}},videoContentID:{get:function(){return this.videoContentID_},set:function(t){var e=new s.FormaContentChangedEvent(this);this.beginUpdate(e),this.videoContentID_=t,i.opt(this.cachedVideoContent_,function(e){return e.id!=t})&&(this.cachedVideoContent_=null),this.endUpdate(e)}},clone:function(){var t;return(t=i.as(l.ImageForma.prototype.clone.call(this),r))?(t.videoContentID=this.videoContentID,t):(a.CoreAssert.fail("VideoForma: super.clone didn't return an VideoForma"),null)},decode:function(t){l.ImageForma.prototype.decode.call(this,t),this.videoContentID_=t.stringProperty(o.PROPERTY_VIDEO_CONTENTID,"")},encode:function(t){l.ImageForma.prototype.encode.call(this,t),null!=this.videoContentID_&&t.setStringProperty(o.PROPERTY_VIDEO_CONTENTID,this.videoContentID_)}}}),r)}}]);
//# sourceMappingURL=logomaker-entry_a8d0cedb-41aef922.js.map